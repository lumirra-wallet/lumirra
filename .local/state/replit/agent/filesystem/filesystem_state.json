{"file_contents":{"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\nimport { safeStorage } from \"@/lib/safe-storage\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n  toggleTheme: () => void;\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState | undefined>(\n  undefined\n);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"light\",\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const saved = safeStorage.getItem(\"theme\", { fallback: defaultTheme });\n    return (saved === \"light\" || saved === \"dark\") ? saved : defaultTheme;\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    safeStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeProviderContext.Provider value={{ theme, setTheme, toggleTheme }}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeProviderContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","size_bytes":1397},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function formatNumber(value: number | string, decimals: number = 2): string {\n  const num = typeof value === 'string' ? parseFloat(value) : value;\n  if (isNaN(num)) return '0.00';\n  \n  return num.toLocaleString('en-US', {\n    minimumFractionDigits: decimals,\n    maximumFractionDigits: decimals,\n  });\n}\n\nexport function formatCrypto(value: number | string, decimals: number = 5): string {\n  const num = typeof value === 'string' ? parseFloat(value) : value;\n  if (isNaN(num)) return '0.00000';\n  \n  if (num < 0.00001 && num > 0) {\n    return num.toExponential(2);\n  }\n  \n  // Use toLocaleString for formatting with thousands separators\n  return num.toLocaleString('en-US', {\n    minimumFractionDigits: 0,\n    maximumFractionDigits: Math.min(decimals, 8),\n  });\n}\n\nexport function formatUSD(value: number | string): string {\n  const num = typeof value === 'string' ? parseFloat(value) : value;\n  if (isNaN(num)) return '$0.00';\n  \n  return '$' + num.toLocaleString('en-US', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  });\n}\n","size_bytes":1218},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/pages/create-wallet.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Logo } from \"@/components/logo\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { AlertCircle, Copy, Download, Eye, EyeOff, CheckCircle2, ArrowLeft } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useWallet } from \"@/contexts/wallet-context\";\n\nexport default function CreateWallet() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { setWallet } = useWallet();\n  const [step, setStep] = useState<\"generate\" | \"confirm\" | \"complete\">(\"generate\");\n  const [seedPhrase, setSeedPhrase] = useState<string[]>([]);\n  const [walletData, setWalletData] = useState<any>(null);\n  const [hideSeed, setHideSeed] = useState(false);\n  const [confirmed, setConfirmed] = useState(false);\n  const [selectedWords, setSelectedWords] = useState<Record<number, number>>({});\n  const [testWords] = useState([2, 5, 9]); // indices to test\n\n  const createWalletMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/wallet/create\", {\n        password: \"demo-password-123\", // In production, get from user\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setSeedPhrase(data.mnemonic.split(\" \"));\n      setWalletData(data.wallet);\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to create wallet. Please try again.\",\n      });\n      setLocation(\"/\");\n    },\n  });\n\n  const copySeedPhrase = () => {\n    navigator.clipboard.writeText(seedPhrase.join(\" \"));\n    toast({\n      title: \"Copied to clipboard\",\n      description: \"Your recovery phrase has been copied.\",\n    });\n  };\n\n  const downloadSeedPhrase = () => {\n    const element = document.createElement(\"a\");\n    const file = new Blob([seedPhrase.join(\" \")], { type: \"text/plain\" });\n    element.href = URL.createObjectURL(file);\n    element.download = \"lumirra-recovery-phrase.txt\";\n    document.body.appendChild(element);\n    element.click();\n    document.body.removeChild(element);\n    toast({\n      title: \"Downloaded\",\n      description: \"Recovery phrase saved to your downloads.\",\n    });\n  };\n\n  const handleWordSelect = (position: number, wordIndex: number) => {\n    setSelectedWords(prev => {\n      const newSelected = { ...prev };\n      if (newSelected[position] === wordIndex) {\n        delete newSelected[position];\n      } else {\n        newSelected[position] = wordIndex;\n      }\n      return newSelected;\n    });\n  };\n\n  const verifySelection = () => {\n    const correct = testWords.every((word, i) => selectedWords[i] === word);\n    if (correct) {\n      if (walletData) {\n        setWallet(walletData.id, walletData.address);\n      }\n      setStep(\"complete\");\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Incorrect words\",\n        description: \"Please select the correct words in order.\",\n      });\n    }\n  };\n\n  // Generate wallet on mount\n  useEffect(() => {\n    if (seedPhrase.length === 0 && !createWalletMutation.isPending) {\n      createWalletMutation.mutate();\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"absolute top-4 right-4\">\n        <ThemeToggle />\n      </div>\n\n      <div className=\"container max-w-2xl mx-auto px-4 py-8\">\n        <div className=\"mb-8\">\n          <Button\n            variant=\"ghost\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back\"\n            className=\"hover-elevate\"\n          >\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            Back\n          </Button>\n        </div>\n\n        <div className=\"flex justify-center mb-8\">\n          <Logo size=\"lg\" />\n        </div>\n\n        {step === \"generate\" && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-2xl font-display\">Your Recovery Phrase</CardTitle>\n              <CardDescription>\n                Write down these 12 words in order and store them securely offline.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {createWalletMutation.isPending && (\n                <div className=\"text-center py-12\">\n                  <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent\"></div>\n                  <p className=\"mt-4 text-muted-foreground\">Creating your wallet...</p>\n                </div>\n              )}\n\n              {seedPhrase.length === 0 && !createWalletMutation.isPending && null}\n              {seedPhrase.length > 0 && (\n              <>\n              <Alert variant=\"destructive\">\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertDescription className=\"font-medium\">\n                  Never share your recovery phrase. Anyone with these words can access your funds.\n                  Lumirra cannot recover your wallet without this phrase.\n                </AlertDescription>\n              </Alert>\n\n              <div className=\"relative\">\n                <div className={`grid grid-cols-3 gap-3 ${hideSeed ? \"blur-md select-none\" : \"\"}`}>\n                  {seedPhrase.map((word, index) => (\n                    <div\n                      key={index}\n                      className=\"bg-muted rounded-lg p-3 text-center\"\n                      data-testid={`text-seed-word-${index}`}\n                    >\n                      <span className=\"text-xs text-muted-foreground mr-2\">{index + 1}.</span>\n                      <span className=\"font-mono font-medium\">{word}</span>\n                    </div>\n                  ))}\n                </div>\n                {hideSeed && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <p className=\"text-sm text-muted-foreground\">\n                      Recovery phrase hidden\n                    </p>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setHideSeed(!hideSeed)}\n                  data-testid=\"button-toggle-seed\"\n                  className=\"flex-1 hover-elevate\"\n                >\n                  {hideSeed ? <Eye className=\"mr-2 h-4 w-4\" /> : <EyeOff className=\"mr-2 h-4 w-4\" />}\n                  {hideSeed ? \"Show\" : \"Hide\"}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={copySeedPhrase}\n                  data-testid=\"button-copy-seed\"\n                  className=\"flex-1 hover-elevate\"\n                >\n                  <Copy className=\"mr-2 h-4 w-4\" />\n                  Copy\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={downloadSeedPhrase}\n                  data-testid=\"button-download-seed\"\n                  className=\"flex-1 hover-elevate\"\n                >\n                  <Download className=\"mr-2 h-4 w-4\" />\n                  Download\n                </Button>\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <Checkbox\n                  id=\"confirmed\"\n                  checked={confirmed}\n                  onCheckedChange={(checked) => setConfirmed(checked as boolean)}\n                  data-testid=\"checkbox-confirmed\"\n                />\n                <label\n                  htmlFor=\"confirmed\"\n                  className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n                >\n                  I have written down my recovery phrase and stored it safely\n                </label>\n              </div>\n\n              <Button\n                className=\"w-full\"\n                size=\"lg\"\n                disabled={!confirmed}\n                onClick={() => setStep(\"confirm\")}\n                data-testid=\"button-continue\"\n              >\n                Continue\n              </Button>\n              </>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {step === \"confirm\" && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-2xl font-display\">Verify Recovery Phrase</CardTitle>\n              <CardDescription>\n                Select the correct words to confirm you saved your recovery phrase.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"space-y-4\">\n                {testWords.map((wordIndex, position) => (\n                  <div key={position}>\n                    <p className=\"text-sm font-medium mb-2\">Word #{wordIndex + 1}</p>\n                    <div className=\"grid grid-cols-4 gap-2\">\n                      {seedPhrase.map((word, index) => (\n                        <Button\n                          key={index}\n                          variant={selectedWords[position] === index ? \"default\" : \"outline\"}\n                          size=\"sm\"\n                          onClick={() => handleWordSelect(position, index)}\n                          data-testid={`button-word-${index}`}\n                          className=\"hover-elevate\"\n                        >\n                          {word}\n                        </Button>\n                      ))}\n                    </div>\n                  </div>\n                ))}\n              </div>\n\n              <Button\n                className=\"w-full\"\n                size=\"lg\"\n                onClick={verifySelection}\n                disabled={Object.keys(selectedWords).length < 3}\n                data-testid=\"button-verify\"\n              >\n                Verify & Create Wallet\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n\n        {step === \"complete\" && (\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"text-center space-y-6\">\n                <div className=\"flex justify-center\">\n                  <div className=\"bg-success/10 p-6 rounded-full\">\n                    <CheckCircle2 className=\"h-16 w-16 text-success\" />\n                  </div>\n                </div>\n                <div>\n                  <h2 className=\"text-2xl font-display font-semibold mb-2\">\n                    Wallet Created Successfully!\n                  </h2>\n                  <p className=\"text-muted-foreground\">\n                    Your Lumirra wallet is ready to use.\n                  </p>\n                </div>\n                <Button\n                  size=\"lg\"\n                  className=\"w-full\"\n                  onClick={() => setLocation(\"/dashboard\")}\n                  data-testid=\"button-go-dashboard\"\n                >\n                  Go to Dashboard\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":11408},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport \"./i18n\";\n\nconst rootElement = document.getElementById(\"root\");\n\nif (!rootElement) {\n  throw new Error(\"Root element not found\");\n}\n\ncreateRoot(rootElement).render(<App />);\n","size_bytes":275},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/token-card.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ArrowUpRight, ArrowDownLeft } from \"lucide-react\";\n\ninterface TokenCardProps {\n  symbol: string;\n  name: string;\n  balance: string;\n  fiatValue: string;\n  currencySymbol?: string;\n  icon?: string;\n  price?: string;\n  priceChange?: string;\n  chainSymbol?: string;\n  chainIcon?: string;\n  chainId?: string;\n  onClick?: () => void;\n}\n\nexport function TokenCard({\n  symbol,\n  name,\n  balance,\n  fiatValue,\n  currencySymbol = \"$\",\n  icon,\n  price,\n  priceChange = \"+0.00\",\n  chainSymbol,\n  chainIcon,\n  chainId,\n  onClick\n}: TokenCardProps) {\n  const isPositive = priceChange.startsWith(\"+\") || parseFloat(priceChange) >= 0;\n  const [tokenIconError, setTokenIconError] = useState(false);\n  const [chainIconError, setChainIconError] = useState(false);\n  \n  // Hide chain badge for native tokens (token symbol matches chain symbol)\n  const isNativeToken = symbol === chainSymbol;\n  \n  return (\n    <Card \n      className=\"hover-elevate cursor-pointer transition-all\" \n      onClick={onClick}\n      data-testid={chainId ? `card-token-${symbol.toLowerCase()}-${chainId}` : `card-token-${symbol.toLowerCase()}`}\n    >\n      <CardContent className=\"p-3\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n            <div className=\"relative w-8 h-8 sm:w-10 sm:h-10 flex-shrink-0\">\n              <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-white/10\">\n                {icon && !tokenIconError ? (\n                  <img \n                    src={icon} \n                    alt={symbol} \n                    className=\"w-full h-full object-cover\" \n                    onError={() => setTokenIconError(true)}\n                    loading=\"lazy\"\n                  />\n                ) : (\n                  <span className=\"text-primary font-bold text-xs sm:text-sm\">{symbol[0]}</span>\n                )}\n              </div>\n              {chainIcon && !isNativeToken && (\n                <div className=\"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 sm:w-4 sm:h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n                  {!chainIconError ? (\n                    <img \n                      src={chainIcon} \n                      alt=\"\" \n                      className=\"w-full h-full object-cover\" \n                      onError={() => setChainIconError(true)}\n                      loading=\"lazy\"\n                    />\n                  ) : (\n                    <span className=\"text-[8px] sm:text-[9px] font-medium\">{symbol[0]}</span>\n                  )}\n                </div>\n              )}\n            </div>\n            <div className=\"min-w-0 flex-1\">\n              <div className=\"flex items-center gap-1.5\">\n                <p className=\"font-semibold text-sm sm:text-base text-foreground truncate\">{symbol}</p>\n                {chainSymbol && (\n                  <span className=\"text-xs text-muted-foreground\">({chainSymbol})</span>\n                )}\n              </div>\n              {price && (\n                <div className=\"flex items-center gap-1.5\">\n                  <p className=\"text-xs sm:text-sm font-medium text-foreground\">${price}</p>\n                  <span className={`text-xs font-medium ${isPositive ? \"text-success\" : \"text-destructive\"}`}>\n                    {isPositive && parseFloat(priceChange) > 0 ? '+' : ''}{priceChange}%\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n          <div className=\"text-right flex-shrink-0\">\n            <p className=\"font-semibold text-sm sm:text-base text-foreground\">{balance}</p>\n            <p className=\"text-xs sm:text-sm text-muted-foreground\">{currencySymbol}{fiatValue}</p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\ninterface QuickActionButtonProps {\n  icon: React.ReactNode;\n  label: string;\n  onClick?: () => void;\n  testId?: string;\n}\n\nexport function QuickActionButton({ icon, label, onClick, testId }: QuickActionButtonProps) {\n  return (\n    <button\n      onClick={onClick}\n      data-testid={testId}\n      className=\"flex flex-col items-center gap-1.5 p-3 rounded-lg bg-white/10 hover:bg-white/20 active:bg-white/30 transition-all text-white\"\n    >\n      <div className=\"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center\">\n        {icon}\n      </div>\n      <span className=\"text-xs sm:text-sm font-medium text-white\">{label}</span>\n    </button>\n  );\n}\n","size_bytes":4629},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/pages/settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, ChevronRight, LogOut } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useTheme } from \"@/components/theme-provider\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Check } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { languageCodeToName } from \"@/i18n\";\n\nexport default function Settings() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { clearWallet, isAuthenticated, isLoading } = useWallet();\n  const { theme, setTheme } = useTheme();\n  const { t, i18n } = useTranslation('common');\n  \n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n  \n  const [appearanceOpen, setAppearanceOpen] = useState(false);\n  \n  // Load from localStorage\n  const [selectedCurrency, setSelectedCurrency] = useState(() => \n    localStorage.getItem(\"fiatCurrency\") || \"USD\"\n  );\n  \n  // Get current language from i18n and convert to display name\n  const currentLanguageCode = i18n.language || 'en';\n  const selectedLanguage = languageCodeToName[currentLanguageCode] || \"English\";\n\n  const handleLogout = async () => {\n    try {\n      await apiRequest(\"POST\", \"/api/auth/logout\", {});\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    } finally {\n      clearWallet();\n      toast({\n        title: t('settings.loggedOut'),\n        description: t('settings.loggedOutDescription'),\n      });\n      setLocation(\"/\");\n    }\n  };\n\n  const handleClearCache = () => {\n    // Clear TanStack Query cache\n    queryClient.clear();\n    \n    // Clear localStorage except for important settings\n    const preserve = [\"fiatCurrency\", \"transactionCost\", \"theme\", \"i18nextLng\"];\n    const toRemove = [];\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key && !preserve.includes(key)) {\n        toRemove.push(key);\n      }\n    }\n    toRemove.forEach(key => localStorage.removeItem(key));\n    \n    toast({\n      title: t('settings.cacheCleared'),\n      description: t('settings.cacheDescription'),\n    });\n  };\n\n\n  const getThemeDisplay = () => {\n    if (theme === \"dark\") return t('settings.darkMode');\n    return t('settings.lightMode');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/dashboard\")}\n              data-testid=\"button-back\"\n              className=\"mr-2\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold flex-1 text-center mr-10\">{t('settings.title')}</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl\">\n        {/* First Group - Security & Cache */}\n        <div className=\"bg-card rounded-xl mb-4\">\n          <button\n            onClick={() => setLocation(\"/settings/security\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-t-xl border-b border-border\"\n            data-testid=\"button-security\"\n          >\n            <span className=\"text-foreground\">{t('settings.security')}</span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </button>\n          \n          <button\n            onClick={handleClearCache}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-b-xl\"\n            data-testid=\"button-clear-cache\"\n          >\n            <span className=\"text-foreground\">{t('settings.clearCache')}</span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </button>\n        </div>\n\n        {/* Second Group - Preferences */}\n        <div className=\"bg-card rounded-xl mb-4\">\n          <button\n            onClick={() => setAppearanceOpen(true)}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-t-xl border-b border-border\"\n            data-testid=\"button-appearance\"\n          >\n            <span className=\"text-foreground\">{t('settings.appearance')}</span>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">{getThemeDisplay()}</span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n          </button>\n          \n          <button\n            onClick={() => setLocation(\"/settings/currency\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 border-b border-border\"\n            data-testid=\"button-fiat-currency\"\n          >\n            <span className=\"text-foreground\">{t('settings.fiatCurrency')}</span>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">$ {selectedCurrency}</span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n          </button>\n          \n          <button\n            onClick={() => setLocation(\"/settings/language\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-b-xl\"\n            data-testid=\"button-language\"\n          >\n            <span className=\"text-foreground\">{t('settings.language')}</span>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">{selectedLanguage}</span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n          </button>\n        </div>\n\n        {/* Third Group - Help & Info */}\n        <div className=\"bg-card rounded-xl mb-4\">\n          <button\n            onClick={() => setLocation(\"/faq\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-t-xl border-b border-border\"\n            data-testid=\"button-help-center\"\n          >\n            <span className=\"text-foreground\">{t('settings.helpCenter')}</span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </button>\n          \n          <button\n            onClick={() => setLocation(\"/contact\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 border-b border-border\"\n            data-testid=\"button-support\"\n          >\n            <span className=\"text-foreground\">{t('settings.support')}</span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </button>\n          \n          <button\n            onClick={() => setLocation(\"/settings/about\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-b-xl\"\n            data-testid=\"button-about\"\n          >\n            <span className=\"text-foreground\">{t('settings.about')}</span>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"flex items-center gap-1\">\n                <span className=\"w-2 h-2 bg-red-500 rounded-full\"></span>\n                <span className=\"text-sm text-muted-foreground\">V4.9.2</span>\n              </span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n          </button>\n        </div>\n\n        {/* Logout Button */}\n        <Button\n          variant=\"destructive\"\n          className=\"w-full\"\n          onClick={handleLogout}\n          data-testid=\"button-logout\"\n        >\n          <LogOut className=\"mr-2 h-4 w-4\" />\n          {t('settings.logOut')}\n        </Button>\n      </div>\n\n      {/* Appearance Dialog */}\n      <Dialog open={appearanceOpen} onOpenChange={setAppearanceOpen}>\n        <DialogContent className=\"sm:max-w-md\" data-testid=\"dialog-appearance\">\n          <DialogHeader>\n            <DialogTitle>{t('settings.appearance')}</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-2\">\n            <button\n              onClick={() => {\n                setTheme(\"dark\");\n                setAppearanceOpen(false);\n              }}\n              className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-lg\"\n              data-testid=\"option-dark-mode\"\n            >\n              <span className=\"text-foreground\">{t('settings.darkMode')}</span>\n              {theme === \"dark\" && <Check className=\"h-5 w-5 text-primary\" />}\n            </button>\n            \n            <button\n              onClick={() => {\n                setTheme(\"light\");\n                setAppearanceOpen(false);\n              }}\n              className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-lg\"\n              data-testid=\"option-light-mode\"\n            >\n              <span className=\"text-foreground\">{t('settings.lightMode')}</span>\n              {theme === \"light\" && <Check className=\"h-5 w-5 text-primary\" />}\n            </button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n    </div>\n  );\n}\n","size_bytes":9667},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/pages/not-found.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { Home, Search } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function NotFound() {\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center px-4\">\n      <div className=\"max-w-md w-full text-center\">\n        {/* Large 404 Text */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-9xl font-bold text-primary/20\">404</h1>\n          <div className=\"relative -mt-8\">\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <Search className=\"h-16 w-16 text-muted-foreground/30\" />\n            </div>\n          </div>\n        </div>\n\n        {/* Error Message */}\n        <div className=\"space-y-4 mb-8\">\n          <h2 className=\"text-2xl font-semibold text-foreground\">\n            Page Not Found\n          </h2>\n          <p className=\"text-muted-foreground\">\n            The page you're looking for doesn't exist or has been moved.\n          </p>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n          <Button\n            onClick={() => setLocation(\"/dashboard\")}\n            className=\"min-w-[140px]\"\n            data-testid=\"button-go-home\"\n          >\n            <Home className=\"h-4 w-4 mr-2\" />\n            Go to Dashboard\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={() => window.history.back()}\n            className=\"min-w-[140px]\"\n            data-testid=\"button-go-back\"\n          >\n            Go Back\n          </Button>\n        </div>\n\n        {/* Help Text */}\n        <p className=\"mt-8 text-sm text-muted-foreground\">\n          If you think this is a mistake, please contact support.\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1874},"client/src/pages/receive.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { ArrowLeft, Search, ChevronDown, QrCode, Copy } from \"lucide-react\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatAddress } from \"@/lib/format-address\";\nimport { getWalletAddress } from \"@shared/wallet-addresses\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface ReceiveTokenProps {\n  symbol: string;\n  name: string;\n  chainName: string;\n  address: string;\n  icon?: string;\n  chainIcon?: string;\n  chainId: string;\n  chainSymbol?: string;\n  onQrClick: () => void;\n  onCopyClick: () => void;\n}\n\nfunction ReceiveToken({\n  symbol,\n  name,\n  chainName,\n  address,\n  icon,\n  chainIcon,\n  chainId,\n  chainSymbol,\n  onQrClick,\n  onCopyClick,\n}: ReceiveTokenProps) {\n  const [tokenIconError, setTokenIconError] = useState(false);\n  const [chainIconError, setChainIconError] = useState(false);\n  \n  // Hide chain badge for native tokens\n  const isNativeToken = symbol === chainSymbol;\n\n  return (\n    <div\n      className=\"flex items-center justify-between p-3 hover-elevate active-elevate-2 rounded-lg cursor-pointer\"\n      onClick={onQrClick}\n      data-testid={`receive-token-${symbol.toLowerCase()}-${chainId}`}\n    >\n      <div className=\"flex items-center gap-3 flex-1 min-w-0\">\n        <div className=\"relative w-10 h-10 flex-shrink-0\">\n          <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-white/10\">\n            {icon && !tokenIconError ? (\n              <img\n                src={icon}\n                alt={symbol}\n                className=\"w-full h-full object-cover\"\n                onError={() => setTokenIconError(true)}\n                loading=\"lazy\"\n              />\n            ) : (\n              <span className=\"text-primary font-bold text-sm\">{symbol[0]}</span>\n            )}\n          </div>\n          {chainIcon && !isNativeToken && (\n            <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n              {!chainIconError ? (\n                <img\n                  src={chainIcon}\n                  alt=\"\"\n                  className=\"w-full h-full object-cover\"\n                  onError={() => setChainIconError(true)}\n                  loading=\"lazy\"\n                />\n              ) : (\n                <span className=\"text-[9px] font-medium\">{symbol[0]}</span>\n              )}\n            </div>\n          )}\n        </div>\n        <div className=\"min-w-0 flex-1\">\n          <p className=\"font-semibold text-sm text-foreground\">{symbol}</p>\n          <p className=\"text-xs text-muted-foreground truncate\">{chainName}</p>\n          <p className=\"text-xs text-muted-foreground truncate\">{formatAddress(address)}</p>\n        </div>\n      </div>\n      <div className=\"flex items-center gap-2\" onClick={(e) => e.stopPropagation()}>\n        <Button\n          size=\"icon\"\n          variant=\"ghost\"\n          onClick={(e) => {\n            e.stopPropagation();\n            onCopyClick();\n          }}\n          data-testid={`button-copy-${symbol.toLowerCase()}-${chainId}`}\n        >\n          <Copy className=\"h-5 w-5\" />\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default function Receive() {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { walletId, isAuthenticated, isLoading } = useWallet();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedChain, setSelectedChain] = useState(\"all\");\n  const { toast } = useToast();\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  // Fetch ALL available tokens from wallet (not just portfolio)\n  const { data: allTokensData, isLoading: tokensLoading } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"all-tokens\"],\n    enabled: !!walletId,\n  });\n\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const chains = (chainsData as any) || [];\n  const allTokens = (allTokensData as any)?.tokens || [];\n\n  // Filter tokens based on search and selected chain\n  const filteredTokens = allTokens.filter((token: any) => {\n    const matchesSearch =\n      token.symbol.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      token.name.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesChain = selectedChain === \"all\" || token.chainId === selectedChain;\n    return matchesSearch && matchesChain;\n  });\n\n  // Group tokens into Popular and All crypto\n  const popularSymbols = [\"BTC\", \"ETH\", \"SOL\", \"BNB\", \"USDT\", \"USDC\"];\n  const popularTokens = filteredTokens.filter((token: any) =>\n    popularSymbols.includes(token.symbol)\n  );\n  const allCryptoTokens = filteredTokens;\n\n  const handleQrClick = (token: any) => {\n    setLocation(`/receive-qr/${token._id}`);\n  };\n\n  const handleCopyClick = (token: any) => {\n    const address = getWalletAddress(token.chainId);\n    \n    navigator.clipboard.writeText(address).then(() => {\n      toast({\n        title: t('receive.addressCopied'),\n        description: t('receive.addressCopiedDescription', { symbol: token.symbol }),\n      });\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-6\">\n      {/* Header */}\n      <div className=\"sticky top-0 z-50 bg-background border-b border-border\">\n        <div className=\"flex items-center gap-4 p-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold\">{t('receive.title')}</h1>\n        </div>\n      </div>\n\n      <div className=\"max-w-2xl mx-auto px-4 mt-4\">\n        {/* Search */}\n        <div className=\"relative mb-4\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={t('receive.search')}\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-receive\"\n          />\n        </div>\n\n        {/* Network Filter */}\n        <div className=\"mb-6\">\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                className=\"gap-2 px-0 hover:bg-transparent\"\n                data-testid=\"button-network-filter\"\n              >\n                <span className=\"text-sm font-medium\">\n                  {selectedChain === \"all\"\n                    ? t('receive.allNetworks')\n                    : chains.find((c: any) => c.id === selectedChain)?.name || t('receive.allNetworks')}\n                </span>\n                <ChevronDown className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"start\" className=\"w-48\">\n              <DropdownMenuItem\n                onClick={() => setSelectedChain(\"all\")}\n                data-testid=\"menu-filter-all\"\n                className=\"cursor-pointer\"\n              >\n                {t('receive.allNetworks')}\n              </DropdownMenuItem>\n              {chains.map((chain: any) => (\n                <DropdownMenuItem\n                  key={chain.id}\n                  onClick={() => setSelectedChain(chain.id)}\n                  data-testid={`menu-filter-${chain.id}`}\n                  className=\"cursor-pointer\"\n                >\n                  {chain.name}\n                </DropdownMenuItem>\n              ))}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n\n        {/* Popular Section */}\n        {popularTokens.length > 0 && (\n          <div className=\"mb-6\">\n            <h2 className=\"text-sm font-medium text-muted-foreground mb-3\">{t('receive.popular')}</h2>\n            <div className=\"space-y-1\">\n              {popularTokens.map((token: any) => {\n                const tokenChain = chains.find((c: any) => c.id === token.chainId);\n                const address = getWalletAddress(token.chainId);\n                \n                return (\n                  <ReceiveToken\n                    key={`${token.symbol}-${token.chainId}`}\n                    symbol={token.symbol}\n                    name={token.name}\n                    chainName={tokenChain?.name || \"\"}\n                    address={address}\n                    icon={token.icon}\n                    chainIcon={tokenChain?.icon}\n                    chainId={token.chainId}\n                    chainSymbol={tokenChain?.symbol}\n                    onQrClick={() => handleQrClick(token)}\n                    onCopyClick={() => handleCopyClick(token)}\n                  />\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        {/* All crypto Section */}\n        {allCryptoTokens.length > 0 && (\n          <div>\n            <h2 className=\"text-sm font-medium text-muted-foreground mb-3\">{t('receive.allCrypto')}</h2>\n            <div className=\"space-y-1\">\n              {allCryptoTokens.map((token: any) => {\n                const tokenChain = chains.find((c: any) => c.id === token.chainId);\n                const address = getWalletAddress(token.chainId);\n                \n                return (\n                  <ReceiveToken\n                    key={`${token.symbol}-${token.chainId}`}\n                    symbol={token.symbol}\n                    name={token.name}\n                    chainName={tokenChain?.name || \"\"}\n                    address={address}\n                    icon={token.icon}\n                    chainIcon={tokenChain?.icon}\n                    chainId={token.chainId}\n                    chainSymbol={tokenChain?.symbol}\n                    onQrClick={() => handleQrClick(token)}\n                    onCopyClick={() => handleCopyClick(token)}\n                  />\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        {/* Empty state */}\n        {filteredTokens.length === 0 && !tokensLoading && (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">{t('receive.noTokens')}</p>\n          </div>\n        )}\n\n        {/* Loading state */}\n        {tokensLoading && (\n          <div className=\"space-y-3\">\n            {[1, 2, 3, 4, 5].map((i) => (\n              <div key={i} className=\"h-16 bg-muted/20 rounded-lg animate-pulse\" />\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":10951},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/pages/swap.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { ProcessingOverlay } from \"@/components/processing-overlay\";\nimport { ArrowUpDown, ChevronDown, ChevronUp, X, Search, Info, Clock, Wallet, MoreVertical, Repeat, Fuel, ArrowRightLeft, Building2, Zap, ArrowLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { formatBalance } from \"@/lib/format-balance\";\nimport { BottomNav } from \"@/components/bottom-nav\";\nimport bridgersLogo from \"@assets/apps_bridgers_1761781872710.png\";\nimport omniBridgeLogo from \"@assets/3101e014191d4923a19db3414a699551_1761779869124.png\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\n\n\n// Providers data with real logos\nconst PROVIDERS = {\n  CEX: [\n    { \n      id: \"xyswap\", \n      name: \"XYSwap\", \n      logoUrl: \"https://www.xyswap.com/assets/img/logo.svg\",\n      time: \"~5min\",\n      feePercent: 0.0\n    },\n    { \n      id: \"mexc\", \n      name: \"MEXC\", \n      logoUrl: \"https://cdn.brandfetch.io/idCHi7bZkV/theme/dark/idpLaB5EuB.svg?c=1bxid64Mup7aczewSAYMX&t=1754032387524\",\n      time: \"~10min\",\n      feePercent: 0.2\n    },\n    { \n      id: \"bingx\", \n      name: \"BingX\", \n      logoUrl: \"https://logosandtypes.com/wp-content/uploads/2022/04/bingx.svg\",\n      time: \"~10min\",\n      feePercent: 0.15\n    },\n    { \n      id: \"omnibridge\", \n      name: \"OmniBridge\", \n      logoUrl: omniBridgeLogo,\n      time: \"~10min\",\n      feePercent: 0.3\n    },\n    { \n      id: \"binance\", \n      name: \"Binance\", \n      logoUrl: \"https://cdn.brandfetch.io/id-pjrLx_q/theme/dark/symbol.svg?c=1bxid64Mup7aczewSAYMX&t=1675846246641\",\n      time: \"~10min\",\n      feePercent: 0.1\n    },\n  ],\n  DEX: [\n    { \n      id: \"bridgers\", \n      name: \"Bridgers\", \n      logoUrl: bridgersLogo,\n      time: \"Instant\",\n      feePercent: 0.5\n    },\n  ]\n};\n\nexport default function Swap() {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { walletId, isAuthenticated, isLoading } = useWallet();\n  const { toast } = useToast();\n  \n  // State for swap\n  const [payToken, setPayToken] = useState<any>(null);\n  const [receiveToken, setReceiveToken] = useState<any>(null);\n  const [payAmount, setPayAmount] = useState(\"\");\n  const [selectedProvider, setSelectedProvider] = useState(PROVIDERS.DEX[0]);\n  const [slippageTolerance, setSlippageTolerance] = useState(3);\n  \n  // Dialog states\n  const [showPayDialog, setShowPayDialog] = useState(false);\n  const [showReceiveDialog, setShowReceiveDialog] = useState(false);\n  const [showProviderDialog, setShowProviderDialog] = useState(false);\n  const [showSlippageDialog, setShowSlippageDialog] = useState(false);\n  const [showInsufficientGasDialog, setShowInsufficientGasDialog] = useState(false);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [providerExpanded, setProviderExpanded] = useState(false);\n  \n  // Processing overlay states\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [pendingSuccessMessage, setPendingSuccessMessage] = useState<string | null>(null);\n  \n  // Search and filter states\n  const [paySearchQuery, setPaySearchQuery] = useState(\"\");\n  const [receiveSearchQuery, setReceiveSearchQuery] = useState(\"\");\n  const [activeTab, setActiveTab] = useState(\"swap\");\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  // Fetch data - use all-tokens to include hidden tokens\n  const { data: portfolioData } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"all-tokens\"],\n    enabled: !!walletId,\n  });\n\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Fetch real-time prices for all tokens\n  const { data: pricesData } = useQuery({\n    queryKey: [\"/api/prices\"],\n    enabled: !!walletId,\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  // Fetch user data for profile picture\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/user\"],\n    enabled: isAuthenticated && !!walletId,\n  });\n\n  const chains = (chainsData as any) || [];\n  const portfolioTokens = (portfolioData as any)?.tokens || [];\n  \n  // Merge tokens with their real-time prices and sort by market cap (most popular first)\n  const allTokens = portfolioTokens.map((token: any) => {\n    const coingeckoId = token.coingeckoId || token.symbol.toLowerCase();\n    const priceInfo = (pricesData as any)?.[coingeckoId];\n    \n    return {\n      ...token,\n      usd_price: priceInfo?.usd || 0,\n      usd_24h_change: priceInfo?.usd_24h_change || 0,\n      usd_market_cap: priceInfo?.usd_market_cap || 0,\n    };\n  }).sort((a: any, b: any) => {\n    // Sort by market cap descending (highest first = most popular)\n    return (b.usd_market_cap || 0) - (a.usd_market_cap || 0);\n  });\n\n  // Initialize default tokens when data loads\n  useEffect(() => {\n    if (allTokens.length > 0) {\n      if (!payToken) {\n        // Check for URL query parameter \"from\" to auto-select token\n        const urlParams = new URLSearchParams(window.location.search);\n        const fromSymbol = urlParams.get('from');\n        const fromChainId = urlParams.get('chainId');\n        \n        if (fromSymbol) {\n          // Find token matching both symbol AND chainId if provided (case-insensitive symbol)\n          let selectedToken;\n          if (fromChainId) {\n            selectedToken = allTokens.find(\n              (t: any) => t.symbol.toUpperCase() === fromSymbol.toUpperCase() && t.chainId === fromChainId\n            );\n          } else {\n            // Fall back to just symbol match if no chainId provided\n            selectedToken = allTokens.find(\n              (t: any) => t.symbol.toUpperCase() === fromSymbol.toUpperCase()\n            );\n          }\n          setPayToken(selectedToken || allTokens.find((t: any) => t.symbol === \"BTC\") || allTokens[0]);\n        } else {\n          // Default to BTC if no query parameter\n          const btc = allTokens.find((t: any) => t.symbol === \"BTC\");\n          setPayToken(btc || allTokens[0]);\n        }\n      }\n      if (!receiveToken) {\n        const usdt = allTokens.find((t: any) => t.symbol === \"USDT\" && t.chainId === \"ethereum\");\n        setReceiveToken(usdt || allTokens[1]);\n      }\n    }\n  }, [allTokens.length]);\n  \n  // Separate effect to prevent same token+chain selection for pay and receive\n  // Only runs when user manually changes tokens, not during initial load\n  useEffect(() => {\n    if (payToken && receiveToken && allTokens.length > 0 &&\n        payToken.symbol === receiveToken.symbol && \n        payToken.chainId === receiveToken.chainId) {\n      // Find a different token for receive (prefer different chain of same token, or different token)\n      const differentChainSameToken = allTokens.find(\n        (t: any) => t.symbol === payToken.symbol && t.chainId !== payToken.chainId\n      );\n      const differentToken = allTokens.find(\n        (t: any) => !(t.symbol === payToken.symbol && t.chainId === payToken.chainId)\n      );\n      setReceiveToken(differentChainSameToken || differentToken || allTokens[0]);\n    }\n  }, [payToken?.id, receiveToken?.id, allTokens.length]);\n\n  // Calculate provider's exchange rate (how many receive tokens per 1 pay token)\n  const getProviderExchangeRate = (provider: any) => {\n    if (!payToken || !receiveToken) return 0;\n    \n    const payPrice = payToken.usd_price || 0;\n    const receivePrice = receiveToken.usd_price || 0;\n    \n    if (payPrice === 0 || receivePrice === 0) return 0;\n    \n    // Base rate: how many receive tokens you get for 1 pay token\n    const baseRate = payPrice / receivePrice;\n    \n    // Apply provider fee (fee reduces the amount you receive)\n    const feeMultiplier = 1 - (provider.feePercent / 100);\n    return baseRate * feeMultiplier;\n  };\n\n  // Calculate receive amount based on selected provider rate\n  const calculateReceiveAmount = () => {\n    if (!payAmount || !payToken || !receiveToken || parseFloat(payAmount) <= 0) {\n      return \"0\";\n    }\n    \n    const amount = parseFloat(payAmount);\n    const rate = getProviderExchangeRate(selectedProvider);\n    \n    if (rate === 0) return \"0\";\n    \n    const receiveAmt = amount * rate;\n    \n    // Format based on the receive token value\n    if (receiveAmt < 0.01) {\n      return receiveAmt.toFixed(6).replace(/\\.?0+$/, '');\n    } else if (receiveAmt < 1) {\n      return receiveAmt.toFixed(6).replace(/\\.?0+$/, '');\n    } else if (receiveAmt < 1000) {\n      return receiveAmt.toFixed(4).replace(/\\.?0+$/, '');\n    } else {\n      return receiveAmt.toLocaleString('en-US', { maximumFractionDigits: 2 });\n    }\n  };\n\n  const receiveAmount = calculateReceiveAmount();\n\n  // Display provider rate as \"1 PAY  X RECEIVE\"\n  const getProviderRate = (provider: any) => {\n    if (!payToken || !receiveToken) return null;\n    \n    const rate = getProviderExchangeRate(provider);\n    \n    if (rate === 0) {\n      return `1 ${payToken.symbol}  -- ${receiveToken.symbol}`;\n    }\n    \n    // Format the rate based on magnitude\n    const formattedRate = rate < 0.01 \n      ? rate.toFixed(6).replace(/\\.?0+$/, '')\n      : rate < 1\n      ? rate.toFixed(6).replace(/\\.?0+$/, '')\n      : rate < 1000\n      ? rate.toFixed(4).replace(/\\.?0+$/, '')\n      : rate.toLocaleString('en-US', { maximumFractionDigits: 2 });\n    \n    return `1 ${payToken.symbol}  ${formattedRate} ${receiveToken.symbol}`;\n  };\n\n  // Find native token for the current pay token's chain\n  const currentChain = payToken ? chains.find((c: any) => c.id === payToken.chainId) : null;\n  const currentNativeToken = currentChain ? allTokens.find(\n    (t: any) => t.chainId === currentChain.id && t.symbol === currentChain.symbol\n  ) : null;\n\n  // Fetch transaction fee for the token being swapped (with fallback to native token)\n  const { data: feeData } = useQuery({\n    queryKey: [\"/api/fees\", payToken?.symbol, payToken?.chainId, currentNativeToken?.symbol],\n    enabled: !!payToken?.symbol && !!payToken?.chainId,\n    queryFn: async () => {\n      const response = await fetch(\n        `/api/fees/${payToken.symbol}?chainId=${payToken.chainId}&nativeTokenSymbol=${currentNativeToken?.symbol || ''}`, \n        {\n          credentials: 'include',\n        }\n      );\n      if (!response.ok) throw new Error(\"Failed to fetch fee\");\n      return response.json();\n    },\n  });\n\n  const swapMutation = useMutation({\n    mutationFn: async () => {\n      if (!payToken || !receiveToken || !walletId) {\n        throw new Error(\"Missing required swap data\");\n      }\n      \n      const response = await apiRequest(\"POST\", `/api/wallet/${walletId}/swap`, {\n        fromToken: payToken.symbol,\n        toToken: receiveToken.symbol,\n        amount: payAmount,\n        chainId: payToken.chainId,\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to swap\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setShowConfirmDialog(false);\n      setIsProcessing(true);\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n      setPayAmount(\"\");\n      setPendingSuccessMessage(`Successfully swapped ${payAmount} ${payToken.symbol} for ${receiveToken.symbol}`);\n      // Store swap order ID for navigation after processing\n      if (data.swapOrderId) {\n        sessionStorage.setItem('pendingSwapOrderId', data.swapOrderId);\n      }\n    },\n    onError: (error: Error) => {\n      setShowConfirmDialog(false);\n      setPendingSuccessMessage(null);\n      toast({\n        variant: \"destructive\",\n        title: \"Swap failed\",\n        description: error.message,\n      });\n    },\n  });\n\n  const handleProcessingComplete = () => {\n    setIsProcessing(false);\n    if (pendingSuccessMessage) {\n      toast({\n        title: \"Swap successful\",\n        description: pendingSuccessMessage,\n      });\n      setPendingSuccessMessage(null);\n      // Navigate to swap order details page\n      const orderId = sessionStorage.getItem('pendingSwapOrderId');\n      if (orderId) {\n        sessionStorage.removeItem('pendingSwapOrderId');\n        setTimeout(() => {\n          setLocation(`/swap/orders/${orderId}`);\n        }, 1000);\n      } else {\n        setTimeout(() => {\n          setLocation(\"/dashboard\");\n        }, 1000);\n      }\n    }\n  };\n\n  const handleSwap = () => {\n    if (!payToken || !payAmount || parseFloat(payAmount) <= 0) return;\n\n    // Check if amount exceeds token balance\n    const tokenBalance = parseFloat(payToken?.balance?.replace(/,/g, \"\") || \"0\");\n    const amountToSwap = parseFloat(payAmount);\n    if (amountToSwap > tokenBalance) {\n      toast({\n        variant: \"destructive\",\n        title: \"Insufficient Amount\",\n        description: `You don't have enough ${payToken.symbol}. Available: ${formatBalance(tokenBalance)}`,\n      });\n      return;\n    }\n\n    // Check if user has permission to swap crypto\n    const canSendCrypto = user?.canSendCrypto ?? false;\n    if (!canSendCrypto) {\n      console.log(\" User does not have permission to swap crypto\");\n      setShowInsufficientGasDialog(true);\n      toast({\n        variant: \"destructive\",\n        title: \"Insufficient fee\",\n        description: \"You need to have sufficient fee to complete this transaction.\",\n      });\n      return;\n    }\n\n    // Check if user has enough balance for gas\n    const chain = chains.find((c: any) => c.id === payToken.chainId);\n    if (!chain) return;\n\n    // Find native token for this chain to check gas balance\n    const nativeToken = allTokens.find(\n      (t: any) => t.chainId === chain.id && t.symbol === chain.symbol\n    );\n\n    // Get actual gas requirement from fee data\n    const gasRequired = parseFloat(feeData?.feeAmount || \"0.001\");\n    const gasBalance = nativeToken ? parseFloat(nativeToken.balance.replace(/,/g, \"\")) : 0;\n\n    // Show insufficient gas dialog if balance is too low\n    if (gasBalance < gasRequired) {\n      setShowInsufficientGasDialog(true);\n    } else {\n      // Show confirmation dialog\n      setShowConfirmDialog(true);\n    }\n  };\n\n  // Actually execute the swap (called from confirmation dialog)\n  const confirmSwap = () => {\n    setShowConfirmDialog(false);\n    swapMutation.mutate();\n  };\n\n  const flipTokens = () => {\n    const temp = payToken;\n    setPayToken(receiveToken);\n    setReceiveToken(temp);\n  };\n\n  const getNetworkStandard = (chainId: string) => {\n    const chain = chains.find((c: any) => c.id === chainId);\n    return chain?.networkStandard || \"\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <div className=\"border-b border-border\">\n        <div className=\"container max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between py-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 hover-elevate\"\n              onClick={() => window.history.back()}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8 hover-elevate\"\n                onClick={() => setLocation(\"/swap/orders\")}\n                data-testid=\"button-swap-history\"\n              >\n                <Clock className=\"h-4 w-4\" />\n              </Button>\n              <ThemeToggle />\n            </div>\n          </div>\n\n        </div>\n      </div>\n\n      <div className=\"container max-w-2xl mx-auto px-4 py-6\">\n        {/* Pay Section */}\n        <Card className=\"p-4 mb-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <span className=\"text-sm text-muted-foreground\">Pay</span>\n            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n              <Wallet className=\"h-3 w-3\" />\n              <span data-testid=\"text-pay-balance\">{payToken ? formatBalance(payToken.balance) : \"0.0\"}</span>\n              <Button\n                variant=\"ghost\"\n                className=\"h-auto p-0 text-xs text-primary\"\n                onClick={() => payToken && setPayAmount(payToken.balance.replace(/,/g, \"\"))}\n                data-testid=\"button-max-pay\"\n              >\n                MAX\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              className=\"h-auto p-0 hover:bg-transparent\"\n              onClick={() => setShowPayDialog(true)}\n              data-testid=\"button-select-pay-token\"\n            >\n              <div className=\"flex items-center gap-2\">\n                {payToken && (\n                  <>\n                    <TokenIcon token={payToken} chains={chains} />\n                    <div className=\"text-left\">\n                      <div className=\"font-semibold\">{payToken.symbol}</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getNetworkStandard(payToken.chainId)}\n                      </div>\n                    </div>\n                    <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                  </>\n                )}\n              </div>\n            </Button>\n\n            <Input\n              type=\"text\"\n              placeholder=\"Enter Amount\"\n              value={payAmount}\n              onChange={(e) => {\n                const value = e.target.value;\n                // Allow only numbers and one decimal point, limit to 6 decimal places\n                if (value === '' || /^\\d*\\.?\\d{0,6}$/.test(value)) {\n                  setPayAmount(value);\n                }\n              }}\n              className=\"text-right border-0 text-xl font-medium bg-transparent focus-visible:ring-0 text-muted-foreground placeholder:text-muted-foreground/40\"\n              data-testid=\"input-pay-amount\"\n            />\n          </div>\n        </Card>\n\n        {/* Swap Direction Button */}\n        <div className=\"flex justify-center -my-2 relative z-10\">\n          <Button\n            variant=\"outline\"\n            size=\"icon\"\n            className=\"rounded-full bg-background border-2 hover-elevate h-12 w-12\"\n            onClick={flipTokens}\n            data-testid=\"button-flip-tokens\"\n          >\n            <ArrowUpDown className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        {/* Receive Section */}\n        <Card className=\"p-4 mb-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <span className=\"text-sm text-muted-foreground\">Receive</span>\n            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n              <Wallet className=\"h-3 w-3\" />\n              <span data-testid=\"text-receive-balance\">{receiveToken ? formatBalance(receiveToken.balance) : \"0.0\"}</span>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              className=\"h-auto p-0 hover:bg-transparent\"\n              onClick={() => setShowReceiveDialog(true)}\n              data-testid=\"button-select-receive-token\"\n            >\n              <div className=\"flex items-center gap-2\">\n                {receiveToken && (\n                  <>\n                    <TokenIcon token={receiveToken} chains={chains} />\n                    <div className=\"text-left\">\n                      <div className=\"font-semibold\">{receiveToken.symbol}</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getNetworkStandard(receiveToken.chainId)}\n                      </div>\n                    </div>\n                    <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                  </>\n                )}\n              </div>\n            </Button>\n\n            <div className=\"text-right text-xl font-medium text-muted-foreground\" data-testid=\"text-receive-amount\">\n              {receiveAmount === \"0\" ? \"0.0\" : receiveAmount}\n            </div>\n          </div>\n        </Card>\n\n        {/* Swap Button */}\n        <Button\n          className=\"w-full mb-4 h-12\"\n          size=\"lg\"\n          onClick={handleSwap}\n          disabled={!payAmount || parseFloat(payAmount) <= 0}\n          data-testid=\"button-swap\"\n        >\n          Swap\n        </Button>\n\n        {/* Provider Section */}\n        <Card className=\"p-4 mb-4\">\n          <div\n            className=\"flex items-center justify-between cursor-pointer\"\n            onClick={() => setProviderExpanded(!providerExpanded)}\n          >\n            <span className=\"text-sm text-muted-foreground\">Provider</span>\n            <Button\n              variant=\"ghost\"\n              className=\"h-auto p-0 hover:bg-transparent\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setShowProviderDialog(true);\n              }}\n              data-testid=\"button-select-provider\"\n            >\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex items-center gap-1.5\">\n                  <div className=\"w-5 h-5 flex items-center justify-center flex-shrink-0\">\n                    <img \n                      src={(selectedProvider as any).logoUrl} \n                      alt={selectedProvider.name}\n                      className=\"w-full h-full object-contain\"\n                    />\n                  </div>\n                  <span className=\"text-sm font-medium\">{selectedProvider.name}</span>\n                </div>\n                <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n              </div>\n            </Button>\n          </div>\n\n          {providerExpanded && (\n            <>\n              <div \n                className=\"flex items-center justify-between mt-3 pt-3 border-t cursor-pointer hover-elevate px-2 py-1 rounded-md\"\n                onClick={() => setShowSlippageDialog(true)}\n              >\n                <span className=\"text-sm text-muted-foreground\">Slippage</span>\n                <div className=\"flex items-center gap-1\">\n                  <span className=\"text-sm font-medium\">{slippageTolerance}%</span>\n                  <ChevronDown className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between mt-2\">\n                <span className=\"text-sm text-muted-foreground\">Rate</span>\n                <span className=\"text-sm font-medium\">{getProviderRate(selectedProvider)}</span>\n              </div>\n\n              <div className=\"flex items-center justify-between mt-2\">\n                <span className=\"text-sm text-muted-foreground\">Time</span>\n                <span className=\"text-sm font-medium\">{selectedProvider.time}</span>\n              </div>\n\n              <div className=\"flex justify-center mt-3\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"h-6\"\n                  onClick={() => setProviderExpanded(false)}\n                >\n                  <ChevronUp className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </>\n          )}\n\n          {!providerExpanded && (\n            <div className=\"flex justify-center mt-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-6\"\n                onClick={() => setProviderExpanded(true)}\n              >\n                <ChevronDown className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          )}\n        </Card>\n\n        {/* Info Message */}\n        <div className=\"flex items-start gap-2 text-xs text-muted-foreground bg-card border border-border rounded-lg p-3\">\n          <Info className=\"h-4 w-4 flex-shrink-0 mt-0.5\" />\n          <p>\n            Due to exchange rate fluctuations, there may be a slight difference between the amount\n            you actually receive and the estimated amount on this page.\n          </p>\n        </div>\n      </div>\n\n      {/* Pay Token Dialog */}\n      <TokenSelectorDialog\n        open={showPayDialog}\n        onOpenChange={setShowPayDialog}\n        title=\"Pay\"\n        tokens={allTokens}\n        chains={chains}\n        selectedToken={payToken}\n        onSelectToken={(token) => {\n          setPayToken(token);\n          setShowPayDialog(false);\n        }}\n        searchQuery={paySearchQuery}\n        onSearchChange={setPaySearchQuery}\n      />\n\n      {/* Receive Token Dialog */}\n      <TokenSelectorDialog\n        open={showReceiveDialog}\n        onOpenChange={setShowReceiveDialog}\n        title=\"Receive\"\n        tokens={allTokens}\n        chains={chains}\n        selectedToken={receiveToken}\n        onSelectToken={(token) => {\n          setReceiveToken(token);\n          setShowReceiveDialog(false);\n        }}\n        searchQuery={receiveSearchQuery}\n        onSearchChange={setReceiveSearchQuery}\n      />\n\n      {/* Provider Dialog */}\n      <ProviderDialog\n        open={showProviderDialog}\n        onOpenChange={setShowProviderDialog}\n        selectedProvider={selectedProvider}\n        onSelectProvider={(provider) => {\n          setSelectedProvider(provider);\n          setShowProviderDialog(false);\n          setProviderExpanded(true);\n        }}\n        payToken={payToken}\n        receiveToken={receiveToken}\n      />\n\n      {/* Insufficient Gas Dialog */}\n      {/* Slippage Tolerance Dialog */}\n      <Dialog open={showSlippageDialog} onOpenChange={setShowSlippageDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Slippage Tolerance</DialogTitle>\n          </DialogHeader>\n\n          <div className=\"space-y-4 p-4\">\n            <p className=\"text-sm text-muted-foreground text-center\">\n              Your transaction will not be processed if the price changes unfavorably by more than this percentage.\n            </p>\n\n            <div className=\"grid grid-cols-3 gap-3\">\n              {[1, 2, 3, 4, 5].map((percent) => (\n                <Button\n                  key={percent}\n                  variant={slippageTolerance === percent ? \"default\" : \"outline\"}\n                  className=\"h-12\"\n                  onClick={() => setSlippageTolerance(percent)}\n                  data-testid={`button-slippage-${percent}`}\n                >\n                  {percent}%\n                </Button>\n              ))}\n            </div>\n\n            <Button\n              className=\"w-full h-12\"\n              onClick={() => setShowSlippageDialog(false)}\n              data-testid=\"button-confirm-slippage\"\n            >\n              Confirm\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <InsufficientGasDialog\n        open={showInsufficientGasDialog}\n        onOpenChange={setShowInsufficientGasDialog}\n        token={payToken || {}}\n        chain={chains.find((c: any) => c.id === payToken?.chainId)}\n        nativeToken={currentNativeToken || {}}\n        gasRequired={parseFloat(feeData?.feeAmount || \"0.001\")}\n        gasBalance={currentNativeToken ? parseFloat(currentNativeToken.balance.replace(/,/g, \"\")) : 0}\n      />\n\n      {/* Swap Confirmation Dialog */}\n      <Dialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Confirm Swap</DialogTitle>\n            </DialogHeader>\n            {payToken && receiveToken && currentNativeToken ? (\n            <div className=\"space-y-4 p-4\">\n              {/* Pay Token */}\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted\">\n                <TokenIcon token={payToken} chains={chains} />\n                <div>\n                  <div className=\"font-semibold text-lg\">{payAmount} {payToken.symbol}</div>\n                  <div className=\"text-sm text-muted-foreground\">{getNetworkStandard(payToken.chainId)}</div>\n                </div>\n              </div>\n\n              {/* Arrow Down */}\n              <div className=\"flex justify-center\">\n                <ArrowUpDown className=\"h-5 w-5 text-muted-foreground\" />\n              </div>\n\n              {/* Receive Token */}\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted\">\n                <TokenIcon token={receiveToken} chains={chains} />\n                <div>\n                  <div className=\"font-semibold text-lg\">{receiveAmount} {receiveToken.symbol}</div>\n                  <div className=\"text-sm text-muted-foreground\">{getNetworkStandard(receiveToken.chainId)}</div>\n                </div>\n              </div>\n\n              {/* Exchange Rate */}\n              <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Exchange Rate</span>\n                  <span className=\"font-semibold\">\n                    1 {payToken.symbol}  {(parseFloat(receiveAmount.replace(/,/g, \"\")) / parseFloat(payAmount.replace(/,/g, \"\"))).toFixed(6)} {receiveToken.symbol}\n                  </span>\n                </div>\n              </div>\n\n              {/* Network Fee */}\n              <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Network Fee</span>\n                  <span className=\"font-semibold\">\n                    {parseFloat(feeData?.feeAmount || \"0.001\")} {currentNativeToken.symbol}\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between p-2 rounded bg-background\">\n                  <span className=\"text-sm\">Pay with</span>\n                  <div className=\"flex items-center gap-2\">\n                    {currentNativeToken.icon && (\n                      <img src={currentNativeToken.icon} alt={currentNativeToken.symbol} className=\"w-5 h-5 rounded-full\" />\n                    )}\n                    <span className=\"text-sm font-medium\">{currentNativeToken.symbol}</span>\n                  </div>\n                </div>\n                <div className=\"text-xs text-right text-muted-foreground\">\n                  {currentNativeToken.symbol} Balance: {formatBalance(currentNativeToken.balance)}\n                </div>\n              </div>\n\n              {/* Provider */}\n              <div className=\"bg-muted rounded-lg p-3\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Provider</span>\n                  <div className=\"flex items-center gap-2\">\n                    <img src={selectedProvider.logoUrl} alt={selectedProvider.name} className=\"w-5 h-5 rounded-full\" />\n                    <span className=\"font-semibold\">{selectedProvider.name}</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"grid grid-cols-2 gap-3 pt-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowConfirmDialog(false)}\n                  disabled={swapMutation.isPending}\n                  data-testid=\"button-cancel-swap\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  onClick={confirmSwap}\n                  disabled={swapMutation.isPending}\n                  data-testid=\"button-confirm-swap\"\n                >\n                  {swapMutation.isPending ? \"Swapping...\" : \"Swap\"}\n                </Button>\n              </div>\n            </div>\n            ) : (\n              <div className=\"p-4\">\n                <p className=\"text-sm text-muted-foreground\">Loading...</p>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      \n      <BottomNav />\n\n      {/* Processing Overlay */}\n      <ProcessingOverlay\n        isProcessing={isProcessing}\n        onComplete={handleProcessingComplete}\n        message=\"Processing swap...\"\n      />\n    </div>\n  );\n}\n\n// Token Icon Component\nfunction TokenIcon({ token, chains }: { token: any; chains: any[] }) {\n  const [tokenIconError, setTokenIconError] = useState(false);\n  const [chainIconError, setChainIconError] = useState(false);\n  const chain = chains.find((c: any) => c.id === token.chainId);\n  const isNativeToken = token.symbol === chain?.symbol;\n\n  return (\n    <div className=\"relative w-10 h-10 flex-shrink-0\">\n      <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-white/10\">\n        {token.icon && !tokenIconError ? (\n          <img\n            src={token.icon}\n            alt={token.symbol}\n            className=\"w-full h-full object-cover\"\n            onError={() => setTokenIconError(true)}\n            loading=\"lazy\"\n          />\n        ) : (\n          <span className=\"text-primary font-bold text-sm\">{token.symbol[0]}</span>\n        )}\n      </div>\n      {chain?.icon && !isNativeToken && (\n        <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n          {!chainIconError ? (\n            <img\n              src={chain.icon}\n              alt=\"\"\n              className=\"w-full h-full object-cover\"\n              onError={() => setChainIconError(true)}\n              loading=\"lazy\"\n            />\n          ) : (\n            <span className=\"text-[9px] font-medium\">{token.symbol[0]}</span>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Token Selector Dialog Component\nfunction TokenSelectorDialog({\n  open,\n  onOpenChange,\n  title,\n  tokens,\n  chains,\n  selectedToken,\n  onSelectToken,\n  searchQuery,\n  onSearchChange,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  title: string;\n  tokens: any[];\n  chains: any[];\n  selectedToken: any;\n  onSelectToken: (token: any) => void;\n  searchQuery: string;\n  onSearchChange: (query: string) => void;\n}) {\n  const [activeFilter, setActiveFilter] = useState(\"All\");\n  const [searchReadOnly, setSearchReadOnly] = useState(true);\n\n  const filteredTokens = tokens.filter((token) => {\n    const matchesSearch =\n      token.symbol.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      token.name.toLowerCase().includes(searchQuery.toLowerCase());\n    return matchesSearch;\n  });\n\n  const isStablecoin = (symbol: string) => [\"USDT\", \"USDC\", \"DAI\", \"BUSD\"].includes(symbol);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"w-full h-full max-w-full max-h-full m-0 p-0 gap-0 rounded-none\">\n        <DialogHeader className=\"px-4 py-3 border-b\">\n          <DialogTitle>{title}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"p-4 space-y-4 overflow-y-auto flex-1\">\n          {/* Search */}\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Enter token name or token contract address\"\n              value={searchQuery}\n              onChange={(e) => onSearchChange(e.target.value)}\n              onFocus={() => setSearchReadOnly(false)}\n              readOnly={searchReadOnly}\n              className=\"pl-9 bg-muted/50 border-muted\"\n              data-testid=\"input-search-token\"\n              autoFocus={false}\n            />\n          </div>\n\n          {/* Filters */}\n          <div className=\"flex items-center gap-2 overflow-x-auto pb-2\">\n            {[\"My\", \"All\", \"Hot\"].map((filter) => (\n              <Button\n                key={filter}\n                variant={activeFilter === filter ? \"default\" : \"outline\"}\n                size=\"sm\"\n                className={`rounded-full flex-shrink-0 ${\n                  activeFilter === filter ? \"bg-primary text-primary-foreground\" : \"\"\n                }`}\n                onClick={() => setActiveFilter(filter)}\n                data-testid={`filter-${filter.toLowerCase()}`}\n              >\n                {filter}\n              </Button>\n            ))}\n          </div>\n\n          {/* Token List */}\n          <div>\n            <h3 className=\"text-sm font-medium mb-3\">In Wallet</h3>\n            <div className=\"space-y-1\">\n              {filteredTokens.map((token) => {\n                const chain = chains.find((c: any) => c.id === token.chainId);\n                const isSelected = selectedToken?.id === token.id;\n\n                return (\n                  <div\n                    key={token.id}\n                    className={`flex items-center justify-between p-3 rounded-lg hover-elevate cursor-pointer ${\n                      isSelected ? \"border-2 border-primary\" : \"border border-transparent\"\n                    }`}\n                    onClick={() => onSelectToken(token)}\n                    data-testid={`token-option-${token.symbol.toLowerCase()}-${token.chainId}`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <TokenIcon token={token} chains={chains} />\n                      <div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-semibold\">{token.symbol}</span>\n                          {isStablecoin(token.symbol) && (\n                            <span className=\"text-xs px-1.5 py-0.5 rounded bg-success/20 text-success\">\n                              Stablecoin\n                            </span>\n                          )}\n                        </div>\n                        <div className=\"text-sm text-muted-foreground\">\n                          {chain?.networkStandard || chain?.name}\n                        </div>\n                      </div>\n                    </div>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                      <MoreVertical className=\"h-4 w-4 text-muted-foreground\" />\n                    </Button>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Provider Dialog Component\nfunction ProviderDialog({\n  open,\n  onOpenChange,\n  selectedProvider,\n  onSelectProvider,\n  payToken,\n  receiveToken,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  selectedProvider: any;\n  onSelectProvider: (provider: any) => void;\n  payToken: any;\n  receiveToken: any;\n}) {\n  // Calculate provider rate dynamically\n  const getProviderRate = (provider: any) => {\n    if (!payToken || !receiveToken) return null;\n    \n    // Get real-time rates based on actual token prices\n    const payPrice = payToken.usd_price || 0;\n    const receivePrice = receiveToken.usd_price || 0;\n    \n    if (payPrice === 0 || receivePrice === 0) return null;\n    \n    // Base rate: how many receive tokens you get for 1 pay token\n    const baseRate = payPrice / receivePrice;\n    \n    // Apply provider fee\n    const feeMultiplier = 1 - (provider.feePercent / 100);\n    const adjustedRate = baseRate * feeMultiplier;\n    \n    // Format the rate based on magnitude\n    const formattedRate = adjustedRate < 0.01 \n      ? adjustedRate.toFixed(6).replace(/\\.?0+$/, '')\n      : adjustedRate < 1\n      ? adjustedRate.toFixed(6).replace(/\\.?0+$/, '')\n      : adjustedRate < 1000\n      ? adjustedRate.toFixed(4).replace(/\\.?0+$/, '')\n      : adjustedRate.toLocaleString('en-US', { maximumFractionDigits: 2 });\n    \n    return `1 ${payToken.symbol}  ${formattedRate} ${receiveToken.symbol}`;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"w-screen h-screen max-w-none m-0 p-0 gap-0 rounded-none\">\n        <DialogHeader className=\"px-4 py-3 border-b sticky top-0 bg-background z-10\">\n          <DialogTitle>Provider</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"p-4 space-y-6 overflow-y-auto h-[calc(100vh-4rem)]\">\n          {/* CEX Section */}\n          <div>\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-sm font-medium\">CEX</h3>\n              <span className=\"text-xs text-muted-foreground\">Receive</span>\n            </div>\n            <div className=\"space-y-2\">\n              {PROVIDERS.CEX.map((provider: any) => {\n                const rate = getProviderRate(provider);\n                \n                return (\n                  <div\n                    key={provider.id}\n                    className=\"flex items-center gap-3 p-3 rounded-lg hover-elevate cursor-pointer border border-border\"\n                    onClick={() => onSelectProvider(provider)}\n                    data-testid={`provider-${provider.id}`}\n                  >\n                    <div className=\"w-10 h-10 flex items-center justify-center flex-shrink-0\">\n                      <img \n                        src={provider.logoUrl} \n                        alt={provider.name}\n                        className=\"w-full h-full object-contain\"\n                      />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"font-medium\">{provider.name}</div>\n                      {rate && (\n                        <>\n                          <div className=\"text-xs text-muted-foreground\">{rate}</div>\n                          <div className=\"mt-1\">\n                            <span className=\"text-xs px-1.5 py-0.5 rounded bg-muted text-muted-foreground\">\n                              {provider.time}\n                            </span>\n                          </div>\n                        </>\n                      )}\n                    </div>\n                    <ChevronDown className=\"h-4 w-4 text-muted-foreground rotate-[-90deg]\" />\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* DEX Section */}\n          <div>\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"text-sm font-medium\">DEX</h3>\n              <span className=\"text-xs text-muted-foreground\">Receive</span>\n            </div>\n            <div className=\"space-y-2\">\n              {PROVIDERS.DEX.map((provider: any) => {\n                const rate = getProviderRate(provider);\n                \n                return (\n                  <div\n                    key={provider.id}\n                    className=\"flex items-center gap-3 p-3 rounded-lg hover-elevate cursor-pointer border border-border\"\n                    onClick={() => onSelectProvider(provider)}\n                    data-testid={`provider-${provider.id}`}\n                  >\n                    <div className=\"w-10 h-10 flex items-center justify-center flex-shrink-0\">\n                      <img \n                        src={provider.logoUrl} \n                        alt={provider.name}\n                        className=\"w-full h-full object-contain\"\n                      />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"font-medium\">{provider.name}</div>\n                      <div className=\"text-xs text-muted-foreground\">{rate}</div>\n                      <div className=\"mt-1\">\n                        <span className=\"text-xs px-1.5 py-0.5 rounded bg-success/20 text-success\">\n                          {provider.time}\n                        </span>\n                      </div>\n                    </div>\n                    <ChevronDown className=\"h-4 w-4 text-muted-foreground rotate-[-90deg]\" />\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Insufficient Gas Dialog Component\nfunction InsufficientGasDialog({\n  open,\n  onOpenChange,\n  token,\n  chain,\n  nativeToken,\n  gasRequired,\n  gasBalance,\n}: {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  token: any;\n  chain: any;\n  nativeToken: any;\n  gasRequired: number;\n  gasBalance: number;\n}) {\n  const [, setLocation] = useLocation();\n  // Prioritize nativeToken symbol (ETH, TRX, BNB, SOL) over chain symbol\n  const gasSymbol = nativeToken?.symbol || chain?.symbol || \"ETH\";\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[400px] p-0 gap-0\">\n        <DialogHeader className=\"px-6 py-4 border-b\">\n          <DialogTitle>Insufficient Gas</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"px-6 py-6 space-y-4\">\n          <p className=\"text-sm text-muted-foreground\">\n            You need more {gasSymbol} to pay the network fee.\n          </p>\n\n          <div className=\"bg-muted rounded-lg p-4 space-y-2\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-muted-foreground\">Gas Required:</span>\n              <span className=\"font-medium\">\n                {gasRequired.toFixed(6).replace(/\\.?0+$/, '')} {gasSymbol}\n              </span>\n            </div>\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-muted-foreground\">Your Balance:</span>\n              <span className=\"font-medium\">\n                {gasBalance.toFixed(6).replace(/\\.?0+$/, '')} {gasSymbol}\n              </span>\n            </div>\n          </div>\n\n          <div\n            className=\"flex items-center gap-3 p-4 rounded-lg border border-border hover-elevate cursor-pointer\"\n            onClick={() => {\n              onOpenChange(false);\n              setLocation(`/receive-qr/${nativeToken._id || nativeToken.id}`);\n            }}\n            data-testid=\"button-gas-station\"\n          >\n            <div className=\"w-10 h-10 rounded-full bg-destructive/20 flex items-center justify-center flex-shrink-0\">\n              <Fuel className=\"h-5 w-5\" />\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium\">Gas Station</div>\n            </div>\n            <ChevronDown className=\"h-4 w-4 text-muted-foreground rotate-[-90deg]\" />\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":46938},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"server/db.ts":{"content":"import mongoose from \"mongoose\";\nimport { MongoMemoryServer } from \"mongodb-memory-server\";\n\nlet mongoServer: MongoMemoryServer | null = null;\n\nexport async function connectDB() {\n  try {\n    // Use MongoDB Atlas if MONGODB_URI is provided, otherwise use in-memory MongoDB\n    let MONGODB_URI = process.env.MONGODB_URI;\n    \n    if (!MONGODB_URI) {\n      console.log(\"No MONGODB_URI found, starting in-memory MongoDB server...\");\n      mongoServer = await MongoMemoryServer.create();\n      MONGODB_URI = mongoServer.getUri();\n      console.log(\"In-memory MongoDB server started at:\", MONGODB_URI);\n    }\n    \n    await mongoose.connect(MONGODB_URI);\n    console.log(\"Connected to MongoDB successfully\");\n  } catch (error) {\n    console.error(\"MongoDB connection error:\", error);\n    throw error;\n  }\n}\n\nexport async function disconnectDB() {\n  try {\n    await mongoose.disconnect();\n    if (mongoServer) {\n      await mongoServer.stop();\n    }\n  } catch (error) {\n    console.error(\"MongoDB disconnection error:\", error);\n  }\n}\n\nexport { mongoose };\n","size_bytes":1050},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/logo.tsx":{"content":"import logoImage from \"@assets/Lumirra Logo Design (original)_1761608943046.png\";\n\ninterface LogoProps {\n  className?: string;\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n}\n\nconst sizes = {\n  sm: \"h-8 w-8\",\n  md: \"h-12 w-12\",\n  lg: \"h-16 w-16\",\n  xl: \"h-24 w-24\",\n};\n\nexport function Logo({ className = \"\", size = \"md\" }: LogoProps) {\n  return (\n    <img\n      src={logoImage}\n      alt=\"Lumirra\"\n      className={`${sizes[size]} ${className}`}\n      data-testid=\"img-logo\"\n    />\n  );\n}\n","size_bytes":480},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"shared/schema.ts":{"content":"import { z } from \"zod\";\n\n// User schemas\nexport const insertUserSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  firstName: z.string().min(1),\n  lastName: z.string().min(1),\n  dateOfBirth: z.string().or(z.date()),\n  profilePhoto: z.string().optional(),\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string(),\n});\n\n// Wallet schemas\nexport const insertWalletSchema = z.object({\n  userId: z.string(),\n  address: z.string(),\n  encryptedMnemonic: z.string(),\n  name: z.string().default(\"My Wallet\"),\n});\n\n// Chain schema\nexport const insertChainSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  symbol: z.string(),\n  networkStandard: z.string(),\n  icon: z.string(),\n  rpcUrl: z.string(),\n  explorerUrl: z.string(),\n  chainId: z.number(),\n  isTestnet: z.boolean().optional(),\n});\n\n// Token schema\nexport const insertTokenSchema = z.object({\n  walletId: z.string(),\n  chainId: z.string(),\n  contractAddress: z.string().nullable().optional(),\n  symbol: z.string(),\n  name: z.string(),\n  decimals: z.number().default(18),\n  balance: z.string().default(\"0\"),\n  icon: z.string().nullable().optional(),\n  isNative: z.boolean().default(false),\n  isVisible: z.boolean().default(true),\n  displayOrder: z.number().default(999).optional(),\n  lastInboundAt: z.date().nullable().optional(),\n});\n\n// Transaction schema\nexport const insertTransactionSchema = z.object({\n  walletId: z.string(),\n  chainId: z.string(),\n  hash: z.string(),\n  from: z.string(),\n  to: z.string(),\n  value: z.string(),\n  tokenSymbol: z.string(),\n  status: z.string(),\n  gasUsed: z.string().nullable().optional(),\n  type: z.string(),\n  senderWalletAddress: z.string().nullable().optional(),\n  fiatValue: z.string().default(\"0\"),\n});\n\n// Transaction Fee schema\nexport const insertTransactionFeeSchema = z.object({\n  tokenSymbol: z.string(),\n  feeAmount: z.string(),\n  feePercentage: z.number().default(0),\n  updatedBy: z.string().optional(),\n});\n\n// Types\nexport type User = {\n  _id?: string;\n  email: string;\n  password: string;\n  firstName: string;\n  lastName: string;\n  dateOfBirth: Date;\n  profilePhoto?: string | null;\n  isAdmin?: boolean;\n  canSendCrypto?: boolean;\n  createdAt?: Date;\n};\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type LoginRequest = z.infer<typeof loginSchema>;\n\nexport type Wallet = {\n  _id?: string;\n  userId: string;\n  address: string;\n  encryptedMnemonic: string;\n  name: string;\n  createdAt?: Date;\n};\n\nexport type InsertWallet = z.infer<typeof insertWalletSchema>;\n\nexport type Chain = {\n  _id?: string;\n  id: string;\n  name: string;\n  symbol: string;\n  networkStandard: string;\n  icon: string;\n  rpcUrl: string;\n  explorerUrl: string;\n  chainId: number;\n  isTestnet?: boolean;\n};\n\nexport type InsertChain = z.infer<typeof insertChainSchema>;\n\nexport type Token = {\n  _id?: string;\n  walletId: string;\n  chainId: string;\n  contractAddress?: string | null;\n  symbol: string;\n  name: string;\n  decimals: number;\n  balance: string;\n  icon?: string | null;\n  isNative?: boolean;\n  isVisible?: boolean;\n  displayOrder?: number;\n  lastInboundAt?: Date | null;\n};\n\nexport type InsertToken = z.infer<typeof insertTokenSchema>;\n\nexport type Transaction = {\n  _id?: string;\n  walletId: string;\n  chainId: string;\n  hash: string;\n  from: string;\n  to: string;\n  value: string;\n  tokenSymbol: string;\n  status: string;\n  timestamp?: Date;\n  gasUsed?: string | null;\n  type: string;\n  senderWalletAddress?: string | null;\n  fiatValue?: string;\n};\n\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\n\nexport type TransactionFee = {\n  _id?: string;\n  tokenSymbol: string;\n  feeAmount: string;\n  feePercentage: number;\n  updatedAt?: Date;\n  updatedBy?: string;\n};\n\nexport type InsertTransactionFee = z.infer<typeof insertTransactionFeeSchema>;\n\n// User-specific Transaction Fee schema (per-user custom fees)\nexport const insertUserTransactionFeeSchema = z.object({\n  userId: z.string(),\n  tokenSymbol: z.string(),\n  chainId: z.string(),\n  feeAmount: z.string(),\n  feePercentage: z.number().default(0),\n  updatedBy: z.string().optional(),\n});\n\nexport type UserTransactionFee = {\n  _id?: string;\n  userId: string;\n  tokenSymbol: string;\n  chainId: string;\n  feeAmount: string;\n  feePercentage: number;\n  updatedAt?: Date;\n  updatedBy?: string;\n};\n\nexport type InsertUserTransactionFee = z.infer<typeof insertUserTransactionFeeSchema>;\n\n// Swap Order schema (real-time swap order details)\nexport const insertSwapOrderSchema = z.object({\n  orderId: z.string(),\n  userId: z.string(),\n  walletId: z.string(),\n  sourceToken: z.string(),\n  sourceAmount: z.string(),\n  destToken: z.string(),\n  destAmount: z.string().nullable().optional(),\n  chainId: z.string(),\n  status: z.enum([\"pending\", \"processing\", \"completed\", \"suspended\", \"failed\"]).default(\"pending\"),\n  failureReason: z.string().nullable().optional(),\n  orderTime: z.date().default(() => new Date()),\n  receivingAddress: z.string(),\n  sendToAddress: z.string().nullable().optional(),\n  sendTxHash: z.string().nullable().optional(),\n  receiveTxHash: z.string().nullable().optional(),\n  txid: z.string().nullable().optional(),\n  provider: z.string().default(\"Binance\"),\n  rate: z.string().nullable().optional(),\n});\n\nexport type SwapOrder = {\n  _id?: string;\n  orderId: string;\n  userId: string;\n  walletId: string;\n  sourceToken: string;\n  sourceAmount: string;\n  destToken: string;\n  destAmount: string | null;\n  chainId: string;\n  status: \"pending\" | \"processing\" | \"completed\" | \"suspended\" | \"failed\";\n  failureReason: string | null;\n  orderTime: Date;\n  receivingAddress: string;\n  sendToAddress?: string | null;\n  sendTxHash?: string | null;\n  receiveTxHash?: string | null;\n  txid: string | null;\n  provider: string;\n  rate: string | null;\n  createdAt?: Date;\n  updatedAt?: Date;\n};\n\nexport type InsertSwapOrder = z.infer<typeof insertSwapOrderSchema>;\n\n// Notification schema\nexport const insertNotificationSchema = z.object({\n  walletId: z.string(),\n  category: z.enum([\"Transaction\", \"System\"]),\n  type: z.enum([\"sent\", \"received\", \"system\"]),\n  title: z.string(),\n  description: z.string(),\n  timestamp: z.date().default(() => new Date()),\n  transactionId: z.string().nullable().optional(),\n  isRead: z.boolean().default(false),\n  metadata: z.record(z.any()).optional(),\n});\n\nexport type Notification = {\n  _id: string;\n  walletId: string;\n  category: \"Transaction\" | \"System\";\n  type: \"sent\" | \"received\" | \"system\";\n  title: string;\n  description: string;\n  timestamp: string | Date;\n  transactionId?: {\n    _id: string;\n    hash: string;\n    type: string;\n    value: string;\n    tokenSymbol: string;\n  } | null;\n  isRead: boolean;\n  metadata?: {\n    // Transaction metadata\n    amount?: string;\n    tokenSymbol?: string;\n    chainId?: string;\n    fiatValue?: string;\n    walletAddress?: string;\n    to?: string;\n    // Swap metadata\n    orderId?: string;\n    fromToken?: string;\n    toToken?: string;\n    destAmount?: string;\n    // Any other metadata\n    [key: string]: any;\n  };\n};\n\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\n\n// Client-side types for wallet operations\nexport type WalletCreateRequest = {\n  password: string;\n};\n\nexport type WalletImportRequest = {\n  mnemonic: string;\n  password: string;\n};\n\nexport type SendTransactionRequest = {\n  to: string;\n  amount: string;\n  tokenSymbol: string;\n  chainId: string;\n};\n\nexport type SwapRequest = {\n  fromToken: string;\n  toToken: string;\n  amount: string;\n  chainId: string;\n};\n\n// Admin types\nexport type AdminAddCryptoRequest = {\n  userId: string;\n  tokenSymbol: string;\n  amount: string;\n  chainId: string;\n  senderWalletAddress?: string;\n};\n\nexport type AdminSearchRequest = {\n  searchQuery: string;\n};\n\nexport type AdminUpdateFeeRequest = {\n  tokenSymbol: string;\n  feeAmount: string;\n  feePercentage?: number;\n};\n","size_bytes":7876},"server/utils/crypto.ts":{"content":"import { randomBytes, createHash } from \"crypto\";\nimport { ethers } from \"ethers\";\n\n/**\n * Generate a random BIP-39 mnemonic phrase (12 words)\n */\nexport function generateMnemonic(): string {\n  const wallet = ethers.Wallet.createRandom();\n  return wallet.mnemonic!.phrase;\n}\n\n/**\n * Validate a BIP-39 mnemonic phrase using ethers.js\n */\nexport function validateMnemonic(mnemonic: string): boolean {\n  try {\n    // Try to create a wallet from the mnemonic\n    // If it succeeds, the mnemonic is valid\n    ethers.Mnemonic.fromPhrase(mnemonic.trim());\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Generate a wallet address from mnemonic using BIP-44 derivation\n */\nexport function deriveAddress(mnemonic: string): string {\n  const wallet = ethers.HDNodeWallet.fromPhrase(mnemonic, undefined, \"m/44'/60'/0'/0/0\");\n  return wallet.address;\n}\n\n/**\n * Encrypt mnemonic (simple encryption for MVP)\n */\nexport function encryptMnemonic(mnemonic: string, password: string): string {\n  const key = createHash(\"sha256\").update(password).digest();\n  const iv = randomBytes(16);\n  \n  // Simple XOR encryption for MVP (not production-ready!)\n  const encrypted = Buffer.from(mnemonic)\n    .map((byte, i) => byte ^ key[i % key.length])\n    .toString(\"base64\");\n  \n  return iv.toString(\"hex\") + \":\" + encrypted;\n}\n\n/**\n * Decrypt mnemonic\n */\nexport function decryptMnemonic(encrypted: string, password: string): string {\n  const [ivHex, encryptedData] = encrypted.split(\":\");\n  const key = createHash(\"sha256\").update(password).digest();\n  \n  // Simple XOR decryption\n  const decrypted = Buffer.from(encryptedData, \"base64\")\n    .map((byte, i) => byte ^ key[i % key.length])\n    .toString();\n  \n  return decrypted;\n}\n\n/**\n * Derive private key from mnemonic using BIP-44 path for Ethereum\n * Default path: m/44'/60'/0'/0/0 (Ethereum mainnet, account 0, address 0)\n */\nexport function derivePrivateKey(mnemonic: string, derivationPath: string = \"m/44'/60'/0'/0/0\"): string {\n  const hdNode = ethers.HDNodeWallet.fromPhrase(mnemonic, undefined, derivationPath);\n  return hdNode.privateKey;\n}\n\n/**\n * Derive wallet from mnemonic using BIP-44 path\n */\nexport function deriveWallet(mnemonic: string, derivationPath: string = \"m/44'/60'/0'/0/0\"): ethers.HDNodeWallet {\n  return ethers.HDNodeWallet.fromPhrase(mnemonic, undefined, derivationPath);\n}\n\n/**\n * Get the address for a chain-specific derivation path\n * Ethereum/BSC/Polygon: m/44'/60'/0'/0/0\n */\nexport function deriveAddressForChain(mnemonic: string, chainId: string): string {\n  // All EVM chains use Ethereum derivation path (coin type 60)\n  const derivationPath = \"m/44'/60'/0'/0/0\";\n  const wallet = ethers.HDNodeWallet.fromPhrase(mnemonic, undefined, derivationPath);\n  return wallet.address;\n}\n\n/**\n * Generate a transaction hash (mocked)\n */\nexport function generateTxHash(): string {\n  return \"0x\" + randomBytes(32).toString(\"hex\");\n}\n","size_bytes":2896},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"design_guidelines.md":{"content":"# Lumirra Crypto Wallet - Design Guidelines\n\n## Design Philosophy\n\n**Trust-First Experience**: Clear, calm visuals that communicate security and value. The interface should feel professional, trustworthy, and modern - comparable to Trust Wallet's polish but with Lumirra's unique blue diamond identity.\n\n**Approach**: Reference-based design drawing from Trust Wallet's multichain wallet patterns, combined with modern fintech aesthetics (think Coinbase meets Stripe's minimalism).\n\n## Brand Identity\n\n**Logo**: Blue diamond with bold \"L\" - this diamond motif should appear throughout the interface as a trust marker\n**Personality**: Secure, innovative, transparent, value-focused\n**Visual Language**: Clean geometry, rounded edges, glass-like UI cards with subtle gradients\n\n## Color System\n\n### Primary Palette\n- **Lumirra Blue** (#1677FF): Main brand color for CTAs, highlights, primary actions\n- **Sky Lumirra** (#4DA3FF): Hover states, active elements, gradients\n- **Deep Lumirra** (#004ECC): Pressed states, dark mode accents\n- **Diamond Cyan** (#2ED8FF): Accent color for gradients, secondary CTAs\n\n### Semantic Colors\n- **Success/Green** (#2ECC71): Transaction confirmations, success states\n- **Error/Red** (#E74C3C): Failed transactions, critical alerts\n- **Warning/Amber** (#F1C40F): Fee warnings, gas alerts\n\n### Backgrounds & Text\n- **Light Mode Background**: #F7FAFF (Glacier White)\n- **Dark Mode Background**: #0B1320 (Midnight Navy)\n- **Dark Mode Cards**: #101828\n- **Primary Text**: #0B1320 (Sapphire Black)\n- **Secondary Text**: #5B6670 (Cloud Gray)\n\n### Brand Gradient\nUse liberally for hero sections, logo glows, premium CTAs:\n```\nlinear-gradient(135deg, #1677FF 0%, #2ED8FF 100%)\n```\n\n## Typography\n\n**Fonts**: Poppins (headings), Inter (body/UI)\n\n- **H1/Hero Headlines**: Poppins SemiBold, 28-36px mobile / 48-64px web\n- **H2/Section Headers**: Poppins SemiBold, 20-24px\n- **Body Text**: Inter Regular, 16px mobile / 18px web\n- **UI Labels/Small**: Inter Medium, 12-14px\n- **Button Text**: Inter SemiBold, 16px\n\n## Layout & Spacing\n\n**Spacing Scale**: Use 4, 8, 12, 16, 24, 32, 48, 64px units consistently\n**Container Max Width**: 1200px for dashboard content, full-width for hero sections\n**Card Border Radius**: 16px for main cards, 12px for buttons\n**Grid**: Flexible grid for token cards (2-4 columns depending on viewport)\n\n## Core Screens & Flows\n\n### Welcome/Onboarding\n- **Hero Section**: Full-viewport with gradient background (Lumirra Blue  Diamond Cyan), centered diamond logo with subtle glow effect\n- **CTAs**: Two prominent buttons - \"Create Wallet\" (primary blue, filled) and \"Restore Wallet\" (outline)\n- **Microcopy**: \"Welcome to Lumirra  Your secure crypto vault\"\n\n### Seed Phrase Display\n- **Layout**: Large card with diamond watermark background (subtle, 10% opacity)\n- **Word Display**: 12/24 words in a grid (3-4 columns), each word in a subtle pill/chip\n- **Warning Banner**: High-contrast yellow warning with clear security messaging\n- **Actions**: \"I wrote it down\" checkbox, copy button, \"Hide seed\" toggle\n\n### Dashboard/Home\n- **Header Bar**: Blue gradient background, total portfolio value (large, bold), chain selector dropdown\n- **Token Cards**: Horizontal swipeable cards showing: token icon, name, balance, fiat value\n  - Card style: White background, soft shadow, rounded corners\n  - Layout: 2-3 columns on tablet/desktop, single column mobile\n- **Quick Actions Row**: Four icon buttons (Send, Receive, Swap, Connect) with labels\n- **Recent Transactions**: List view with status badges (pending/confirmed/failed), timestamp, amounts\n\n### Send Flow (Multi-Step)\n- **Step 1**: Recipient input with QR scan button, address validation indicator\n- **Step 2**: Asset selector + amount input with fiat conversion shown inline\n- **Step 3**: Gas fee editor - preset options (Fast/Normal/Slow) + advanced slider\n- **Step 4**: Confirmation modal with diamond emblem, large amount display, review details\n- **Step 5**: Success screen with confetti animation (subtle), transaction hash with copy button\n\n### Receive\n- **Modal Layout**: Centered QR code (large, high contrast), address below with copy button\n- **Background**: Blurred backdrop with glass-morphism card effect\n\n### Swap Interface\n- **Layout**: Two-panel design (From  To) with swap direction toggle in center\n- **Quote Display**: Show price impact, slippage tolerance, aggregator source\n- **CTA**: Large blue gradient button \"Confirm Swap\"\n\n## Component Specifications\n\n### Buttons\n- **Primary**: Lumirra Blue (#1677FF) background, white text, 12px radius, shadow (0 4px 10px rgba(22,119,255,0.25))\n- **Secondary**: 2px solid border, Lumirra Blue text, transparent background\n- **Danger**: Error Red background, white text\n- **Height**: 44px minimum for touch targets\n\n### Cards\n- **Background**: White (light mode), #101828 (dark mode)\n- **Shadow**: 0 4px 12px rgba(11,19,32,0.05)\n- **Border Radius**: 16px\n- **Padding**: 16-24px\n\n### Input Fields\n- **Border**: 1px solid #D0D7E2\n- **Focus Ring**: 2px solid Lumirra Blue\n- **Placeholder**: #A0AEC0\n- **Height**: 44px minimum\n\n### Modals\n- **Backdrop**: Blurred background with dark overlay (60% opacity)\n- **Card**: White/dark card, centered, 16px radius, strong shadow\n- **Header**: Bold title, close button (X)\n- **Footer**: CTA buttons aligned right\n\n## Visual Effects\n\n### Shadows & Elevation\n- **Cards**: 0 4px 12px rgba(11,19,32,0.05)\n- **Buttons**: 0 4px 10px rgba(22,119,255,0.25)\n- **Modals**: 0 12px 24px rgba(4,12,20,0.12)\n- **Glow Effect**: 0 0 20px rgba(22,119,255,0.35) for diamond logo\n\n### Animations (Use Sparingly)\n- **Button Press**: 98% scale with 120ms easing\n- **Transaction Success**: Subtle confetti particles + success toast\n- **Seed Reveal**: Gentle upward reveal with shimmer on each word\n- **Loading**: Rotating diamond spinner using Lumirra gradient\n- **Durations**: 120-240ms for micro-interactions, 400-600ms for transitions\n\n## Iconography\n- **Style**: Geometric, 2px stroke weight for line icons\n- **Size**: 24px standard, 32px for primary actions, 48px for hero elements\n- **Color**: Lumirra Blue for primary actions, Cloud Gray for secondary\n- **Diamond Emblem**: Use as unique trust marker in confirmations and headers\n\n## Dark Mode\n- Maintain blue accent brightness (#1677FF stays vibrant)\n- Reduce shadows, add subtle outer glows instead\n- Use #101828 for card surfaces\n- Text: #E2E8F0 for primary, reduced opacity for secondary\n\n## Images\n\n**Hero Section**: Use a abstract/geometric illustration of a diamond with blockchain network nodes in the background, rendered with the Lumirra gradient (blue to cyan). This should feel premium and tech-forward.\n\n**Token Icons**: Standard crypto token logos from established libraries\n**Chain Badges**: Ethereum, BSC, Polygon logos/icons\n**Illustrations**: Minimal geometric shapes with gradient overlays for empty states\n\n## Accessibility\n- Text contrast minimum 4.5:1 for body text, 3:1 for large text\n- All interactive elements minimum 44px touch targets\n- Keyboard navigation support throughout\n- Screen reader labels on all controls\n- Dynamic font scaling support\n\n## Key UX Patterns\n- **Confirmation Flow**: Always show: network, amount, recipient, gas fee before signing\n- **Seed Safety**: Repeated warnings, \"I understand\" checkboxes, test word confirmation\n- **Transaction Status**: Clear visual indicators (pending spinner, success checkmark, error X)\n- **Gas Estimation**: Show presets AND allow manual adjustment\n- **Network Switching**: Small modal with network icon and elastic dropdown animation","size_bytes":7555},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/contexts/wallet-context.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport { safeStorage } from \"@/lib/safe-storage\";\nimport i18n from \"@/i18n\";\n\ninterface WalletContextType {\n  walletId: string | null;\n  walletAddress: string | null;\n  setWallet: (id: string, address: string) => void;\n  clearWallet: () => void;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n}\n\nconst WalletContext = createContext<WalletContextType | undefined>(undefined);\n\nexport function WalletProvider({ children }: { children: ReactNode }) {\n  const [walletId, setWalletId] = useState<string | null>(null);\n  const [walletAddress, setWalletAddress] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    // Verify authentication with backend\n    const verifyAuth = async () => {\n      try {\n        const response = await fetch(\"/api/auth/user\", {\n          credentials: \"include\",\n        });\n        \n        if (response.ok) {\n          const userData = await response.json();\n          \n          // Apply user preferences from database\n          if (userData.language) {\n            const currentLanguage = i18n.language || 'en';\n            if (userData.language !== currentLanguage) {\n              i18n.changeLanguage(userData.language);\n              safeStorage.setItem(\"language\", userData.language);\n            }\n          }\n          \n          if (userData.fiatCurrency) {\n            const currentFiatCurrency = safeStorage.getItem(\"fiatCurrency\");\n            if (currentFiatCurrency !== userData.fiatCurrency) {\n              safeStorage.setItem(\"fiatCurrency\", userData.fiatCurrency);\n              // Trigger a storage event with proper key/newValue\n              const storageEvent = new StorageEvent('storage', {\n                key: 'fiatCurrency',\n                newValue: userData.fiatCurrency,\n                oldValue: currentFiatCurrency,\n                storageArea: localStorage,\n              });\n              window.dispatchEvent(storageEvent);\n            }\n          }\n          \n          // If backend returns wallet data, use it\n          if (userData.wallet) {\n            const walletIdFromApi = userData.wallet.id || userData.wallet._id;\n            const walletAddressFromApi = userData.wallet.address;\n            \n            if (walletIdFromApi && walletAddressFromApi) {\n              setWalletId(walletIdFromApi);\n              setWalletAddress(walletAddressFromApi);\n              safeStorage.setItem(\"wallet-id\", walletIdFromApi);\n              safeStorage.setItem(\"wallet-address\", walletAddressFromApi);\n            }\n          } else {\n            // Session valid but no wallet from API - check localStorage\n            const savedWalletId = safeStorage.getItem(\"wallet-id\");\n            const savedWalletAddress = safeStorage.getItem(\"wallet-address\");\n            \n            if (savedWalletId && savedWalletAddress) {\n              setWalletId(savedWalletId);\n              setWalletAddress(savedWalletAddress);\n            }\n          }\n        } else if (response.status === 401 || response.status === 403) {\n          // Authentication failed - clear everything including preferences\n          setWalletId(null);\n          setWalletAddress(null);\n          safeStorage.removeItem(\"wallet-id\");\n          safeStorage.removeItem(\"wallet-address\");\n          safeStorage.removeItem(\"language\");\n          safeStorage.removeItem(\"fiatCurrency\");\n          \n          // Reset i18n to default language to prevent cross-user leakage\n          i18n.changeLanguage('en');\n        }\n      } catch (error) {\n        console.error(\"Auth verification error:\", error);\n        // Network error - try to use saved data if available\n        const savedWalletId = safeStorage.getItem(\"wallet-id\");\n        const savedWalletAddress = safeStorage.getItem(\"wallet-address\");\n        \n        if (savedWalletId && savedWalletAddress) {\n          setWalletId(savedWalletId);\n          setWalletAddress(savedWalletAddress);\n        }\n      }\n      \n      setIsLoading(false);\n    };\n\n    verifyAuth();\n  }, []);\n\n  const setWallet = (id: string, address: string) => {\n    setWalletId(id);\n    setWalletAddress(address);\n    safeStorage.setItem(\"wallet-id\", id);\n    safeStorage.setItem(\"wallet-address\", address);\n  };\n\n  const clearWallet = () => {\n    setWalletId(null);\n    setWalletAddress(null);\n    safeStorage.removeItem(\"wallet-id\");\n    safeStorage.removeItem(\"wallet-address\");\n  };\n\n  return (\n    <WalletContext.Provider\n      value={{\n        walletId,\n        walletAddress,\n        setWallet,\n        clearWallet,\n        isAuthenticated: walletId !== null,\n        isLoading,\n      }}\n    >\n      {children}\n    </WalletContext.Provider>\n  );\n}\n\nexport function useWallet() {\n  const context = useContext(WalletContext);\n  if (context === undefined) {\n    throw new Error(\"useWallet must be used within a WalletProvider\");\n  }\n  return context;\n}\n","size_bytes":4949},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"replit.md":{"content":"# Crypto Wallet Application\n\n## Overview\n\nThis full-stack cryptocurrency wallet management application enables users to manage crypto assets across various blockchain networks, track balances, and view transaction histories. It provides a comprehensive solution for personal crypto finance, including user authentication, profile management, and multi-wallet support. Administrators can manage users, add/remove cryptocurrency, control transaction fees, send crypto, silently add funds, and manage user send permissions. The project aims to deliver a robust and user-friendly platform for cryptocurrency management with strong security and administrative controls.\n\n## User Preferences\n\nThe agent should prioritize an iterative development approach, focusing on delivering working features incrementally. Before making significant architectural changes or implementing new features, the agent should seek clarification and approval.\n\n## System Architecture\n\nThe application uses a React (TypeScript) frontend with Shadcn/ui, Radix UI, and Tailwind CSS for styling, Wouter for routing, and TanStack Query for state management. The backend is an Express.js server utilizing MongoDB with Mongoose. Authentication uses bcrypt and express-session, with Multer for file uploads.\n\n**PIN-Based Authentication**: Complete numeric PIN authentication system where all passwords are 6-digit PINs entered using an on-screen numeric keyboard. All PIN entry flows (Login, Create Account, Change Password) feature consistent full-page numeric keyboard layouts with sticky headers, centered PIN input boxes, and bottom-aligned numeric keyboards. Includes haptic vibration feedback (50ms) on all keypad presses for tactile response. Incorrect PIN entry triggers visual feedback with shake animation and red borders on PIN boxes, then automatically clears for retry. Password reset system uses 4-digit verification codes sent via email with 10-minute expiration.\n\n**Create Account Flow**: Complete redesign to match Login and Reset Password layouts exactly. Verification code entry uses full-page layout with 6 individual PIN boxes and numeric keyboard (matching Reset Password code page). Backend validation enforced via `/api/auth/verify-code` endpoint before advancing to PIN setup. PIN setup and confirm PIN steps use full-page layouts matching Login PIN page exactly. Error messages display BELOW PIN boxes in red text (matching user screenshot requirement), with shake animation and red borders on incorrect entry. All error clear timers set to 1500ms for consistent UX. Verification digits remain visible until backend validation succeeds or user clears them.\n\n**UI/UX Design**: Modern, responsive design using Shadcn/ui and Tailwind CSS, with full-screen dialogs for mobile optimization.\n**Authentication**: Dual authentication (password-based and email-based 6-digit codes) with role-based access for users and administrators. Secure verification code handling with SHA-256 hashing and constant-time comparison, TTL-based expiry, and email notifications via Nodemailer. Authentication guards protect all sensitive routes.\n**Data Management**: MongoDB with Mongoose for flexible schema and scalability.\n**Fee Management**: Comprehensive per-token fee system with multi-level fallback logic.\n**Transaction Tracking**: Transactions include `fiatValue` with real-time price data and client-side USD fallbacks.\n**Internationalization (i18n)**: Full support for 103 languages with `react-i18next` for lazy-loaded locale bundles and real-time switching. Languages include major world languages (English, Chinese, Arabic, Hindi, Spanish, French, German, Japanese, etc.) and regional languages from all continents. Translation files are programmatically generated using English as a base template, with locale files stored in `client/src/locales/` directory. Language switching is available throughout the application with persistent user preference storage.\n**Security Settings**: Features like Pattern Unlock, Touch ID, Auto Signing, Auto Lock, and Change Security Password with `localStorage` persistence.\n**Dashboard Enhancements**: Fiat currency conversion, pull-to-refresh, and daily portfolio change tracking.\n**Real-time Notifications**: Notifications page with 5-second polling for updates and unread indicators.\n**Admin Controls**:\n    - **Send Crypto**: Admins can send crypto from user accounts, creating transaction history.\n    - **Silent Add**: Admins can add crypto without creating a transaction trace.\n    - **User Send Permissions**: Admins control user send/swap capabilities via a `canSendCrypto` flag, enforced at the API level.\n**Admin Audit Trail**: All admin actions are logged in the AdminTransfer collection.\n**Token Visibility**: Send flows use `/api/wallet/:walletId/all-tokens` to ensure all owned tokens can be sent regardless of `isVisible` status.\n**Swap Order Tracking**: Real-time tracking of swap orders via a dedicated order details page, with status banners, provider iconography, and transaction history integration.\n**Email Notifications**: Professional deep blue gradient themed emails for verification, password reset, welcome, transaction, and contact form submissions, sent via Nodemailer.\n**Settings Management**: Key-value pair settings stored in MongoDB, editable by admins, impacting features like WhatsApp support number.\n**Delete User Accounts**: Admin-only cascade delete of user accounts and all associated data for integrity.\n**Market Price Alerts**: Users create personalized price alerts for tokens (above/below a target price). Background jobs check prices every 5 minutes using CoinGecko, triggering system notifications and re-triggering after 24h if conditions persist.\n**Crypto Breaking News**: Automated fetching of news from CryptoPanic API every 15 minutes. High and critical importance news generates system notifications for all users. News includes title, description, source, URL, category, and importance levels.\n**Browser Push Notifications**: Web Push API integration for users to opt-in, sending notifications for price alerts and breaking news.\n**Background Jobs Service**: Independent services for crypto news fetching (15-minute intervals via CryptoPanic) and price alert checking (5-minute intervals via CoinGecko). Includes error handling and retry logic.\n**Admin Messaging System**: Manages contact form submissions (stored in ContactMessage collection) and enables admins to view, filter, search, reply, send direct messages, and update message statuses with an audit trail.\n**Support Chat System**: Real-time support chat between users and admins with WebSocket-powered instant message delivery, optimistic UI for immediate message appearance, image upload support (max 5MB, supports image-only messages), date-separated message grouping, smart timestamps, and professional message bubbles. Features WebSocket real-time bidirectional communication with exponential backoff reconnection (500ms to 30s max delay), fallback 5-second polling for fast updates when WebSocket is unavailable, session-authenticated connections, and ref-based state tracking to prevent stale closures in admin chat. Messages load immediately on chat page navigation via refetchOnMount and refetchOnWindowFocus query options. Admin interface uses Facebook Messenger-style split-panel layout (350px conversation sidebar + flexible chat panel) with blue (#0084ff) admin bubbles and gray user bubbles. Admins can edit their sent messages via pencil icon, with changes propagating instantly to users through WebSocket `support_chat_message_edited` events. Mobile-optimized with h-[100dvh] for proper keyboard handling (accounts for browser UI) and sticky header (z-10) that remains visible when keyboard appears. **Support Chat Access**: Users access support chat exclusively through the headphone icon in the dashboard header. The floating chat bubble has been completely removed from the application. Support chat notifications appear in the notifications page but do NOT trigger the notification badge counter (badge only shows transaction/system notifications, excluding metadata.supportChat: true). Clicking a support chat notification navigates directly to the support chat page. Integrates with real-time WebSocket notification system.\n**Profile Management**: Comprehensive profile system with profile picture upload functionality. Users can upload profile pictures (max 5MB, image types only) via the edit profile page with real-time preview and hover overlay with camera icon. Profile photos are stored as base64 in the User.profilePhoto field. Facebook-style default avatars provide consistent, colored backgrounds with user initials (first letter of first + last name) for users without profile pictures. Avatar colors are deterministically generated from user names using a stable 6-color palette (blue, green, purple, orange, pink, teal). All avatar displays across the app (dashboard, profile, support chat) use the DefaultAvatar component for consistency. Profile page displays wallet ID (address) with animated copy-to-clipboard functionality featuring hover scale effects and zoom-in success animations.\n**Cache Management**: Basic storage health checks with auto-cleanup functionality for corrupted data. Simple initialization checks without error boundaries or recovery screens.\n\n## External Dependencies\n\n-   **Database**: MongoDB\n-   **Authentication**: bcrypt, express-session\n-   **File Uploads**: Multer\n-   **Frontend Framework**: React\n-   **UI Libraries**: Shadcn/ui, Radix UI, Tailwind CSS\n-   **Routing**: Wouter\n-   **State Management**: TanStack Query\n-   **Internationalization**: react-i18next\n-   **Email Services**: Nodemailer (SMTP via Hostinger)\n-   **Crypto Data**: CoinGecko API (for price data), CryptoPanic API (for news)\n-   **Development Database**: `mongodb-memory-server`","size_bytes":9846},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Liquid Glass Effect */\n@import './styles/liquid-glass.css';\n\n/* Disable browser's native pull-to-refresh on mobile */\nhtml,\nbody {\n  overscroll-behavior-y: none;\n}\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 220 100% 99%;\n\n  --foreground: 215 100% 9%;\n\n  --border: 220 25% 88%;\n\n  --card: 0 0% 100%;\n\n  --card-foreground: 215 100% 9%;\n\n  --card-border: 220 20% 92%;\n\n  --sidebar: 220 50% 94%;\n\n  --sidebar-foreground: 215 100% 9%;\n\n  --sidebar-border: 220 40% 89%;\n\n  --sidebar-primary: 214 100% 54%;\n\n  --sidebar-primary-foreground: 220 100% 98%;\n\n  --sidebar-accent: 220 30% 90%;\n\n  --sidebar-accent-foreground: 214 100% 25%;\n\n  --sidebar-ring: 214 100% 54%;\n\n  --popover: 0 0% 100%;\n\n  --popover-foreground: 215 100% 9%;\n\n  --popover-border: 220 20% 92%;\n\n  --primary: 214 100% 54%;\n\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 220 20% 88%;\n\n  --secondary-foreground: 215 100% 15%;\n\n  --muted: 220 18% 91%;\n\n  --muted-foreground: 215 20% 45%;\n\n  --accent: 188 100% 59%;\n\n  --accent-foreground: 0 0% 100%;\n\n  --destructive: 6 78% 57%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --success: 145 63% 49%;\n  \n  --success-foreground: 0 0% 100%;\n\n  --warning: 45 93% 58%;\n  \n  --warning-foreground: 215 100% 9%;\n\n  --input: 220 35% 75%;\n  --ring: 214 100% 54%;\n  --chart-1: 214 100% 54%;\n  --chart-2: 188 100% 59%;\n  --chart-3: 145 63% 49%;\n  --chart-4: 45 93% 58%;\n  --chart-5: 6 78% 57%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(214 100% 54% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(214 100% 54% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 1px 2px -1px hsl(214 100% 54% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 1px 2px -1px hsl(214 100% 54% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 2px 4px -1px hsl(214 100% 54% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 4px 6px -1px hsl(214 100% 54% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 8px 10px -1px hsl(214 100% 54% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(214 100% 54% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 215 100% 6%;\n\n  --foreground: 220 60% 92%;\n\n  --border: 215 35% 15%;\n\n  --card: 215 45% 10%;\n\n  --card-foreground: 220 60% 92%;\n\n  --card-border: 215 40% 13%;\n\n  --sidebar: 215 45% 10%;\n\n  --sidebar-foreground: 220 60% 92%;\n\n  --sidebar-border: 215 35% 13%;\n\n  --sidebar-primary: 214 100% 54%;\n\n  --sidebar-primary-foreground: 220 100% 98%;\n\n  --sidebar-accent: 215 30% 14%;\n\n  --sidebar-accent-foreground: 220 80% 85%;\n\n  --sidebar-ring: 214 100% 54%;\n\n  --popover: 215 40% 12%;\n\n  --popover-foreground: 220 60% 92%;\n\n  --popover-border: 215 35% 15%;\n\n  --primary: 214 100% 54%;\n\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 215 25% 16%;\n\n  --secondary-foreground: 220 60% 92%;\n\n  --muted: 215 22% 14%;\n\n  --muted-foreground: 220 35% 65%;\n\n  --accent: 188 100% 59%;\n\n  --accent-foreground: 0 0% 100%;\n\n  --destructive: 6 78% 57%;\n\n  --destructive-foreground: 0 0% 100%;\n\n  --success: 145 63% 49%;\n  \n  --success-foreground: 0 0% 100%;\n\n  --warning: 45 93% 58%;\n  \n  --warning-foreground: 215 100% 9%;\n\n  --input: 215 40% 30%;\n  --ring: 214 100% 54%;\n  --chart-1: 214 100% 65%;\n  --chart-2: 188 100% 70%;\n  --chart-3: 145 63% 60%;\n  --chart-4: 45 93% 65%;\n  --chart-5: 6 78% 65%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(214 100% 54% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(214 100% 54% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 1px 2px -1px hsl(214 100% 54% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 1px 2px -1px hsl(214 100% 54% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 2px 4px -1px hsl(214 100% 54% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 4px 6px -1px hsl(214 100% 54% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(214 100% 54% / 0.00), 0px 8px 10px -1px hsl(214 100% 54% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(214 100% 54% / 0.00);\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n\n  /* Digital font style for balance */\n  .font-digital {\n    font-family: 'Orbitron', 'Roboto Mono', monospace;\n    letter-spacing: 0.05em;\n    font-weight: 700;\n  }\n\n  /* Shimmer/shine animation effect */\n  @keyframes shimmer {\n    0% {\n      transform: translateX(-100%) rotate(25deg);\n    }\n    100% {\n      transform: translateX(100%) rotate(25deg);\n    }\n  }\n\n  .shimmer-effect {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .shimmer-effect::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(\n      90deg,\n      transparent 0%,\n      rgba(255, 255, 255, 0.4) 50%,\n      transparent 100%\n    );\n    animation: shimmer 0.8s ease-in-out;\n    pointer-events: none;\n    z-index: 10;\n  }\n\n  /* Shake animation for error feedback */\n  @keyframes shake {\n    0%, 100% {\n      transform: translateX(0);\n    }\n    10%, 30%, 50%, 70%, 90% {\n      transform: translateX(-10px);\n    }\n    20%, 40%, 60%, 80% {\n      transform: translateX(10px);\n    }\n  }\n\n  .animate-shake {\n    animation: shake 0.6s ease-in-out;\n  }\n}","size_bytes":12833},"server/storage.ts":{"content":"import {\n  type User as UserType,\n  type Wallet as WalletType,\n  type InsertWallet,\n  type Chain as ChainType,\n  type InsertChain,\n  type Token as TokenType,\n  type InsertToken,\n  type Transaction as TransactionType,\n  type InsertTransaction,\n  type TransactionFee as TransactionFeeType,\n  type InsertTransactionFee,\n  type UserTransactionFee as UserTransactionFeeType,\n  type InsertUserTransactionFee,\n  type SwapOrder as SwapOrderType,\n  type InsertSwapOrder,\n} from \"@shared/schema\";\nimport { User, Wallet, Chain, Token, Transaction, TransactionFee, UserTransactionFee, SwapOrder } from \"./models\";\nimport { ETHEREUM_TOKENS } from \"@shared/ethereum-tokens\";\nimport { BNB_TOKENS } from \"@shared/bnb-tokens\";\nimport { TRON_TOKENS } from \"@shared/tron-tokens\";\nimport { SOLANA_TOKENS } from \"@shared/solana-tokens\";\nimport mongoose from \"mongoose\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<UserType | undefined>;\n  getUserByEmail(email: string): Promise<UserType | undefined>;\n  createUser(userData: any): Promise<UserType>;\n  updateUserProfilePhoto(userId: string, photoUrl: string): Promise<UserType | undefined>;\n  getAllUsers(): Promise<UserType[]>;\n  searchUsers(query: string): Promise<UserType[]>;\n\n  // Wallet operations\n  getWallet(id: string): Promise<WalletType | undefined>;\n  getWalletByAddress(address: string): Promise<WalletType | undefined>;\n  getWalletsByUser(userId: string): Promise<WalletType[]>;\n  createWallet(wallet: InsertWallet): Promise<WalletType>;\n  getAllWallets(): Promise<WalletType[]>;\n\n  // Chain operations\n  getAllChains(): Promise<ChainType[]>;\n  getChain(id: string): Promise<ChainType | undefined>;\n  \n  // Token operations\n  getTokensByWallet(walletId: string): Promise<TokenType[]>;\n  getTokensByChain(walletId: string, chainId: string): Promise<TokenType[]>;\n  getTokenBySymbol(walletId: string, symbol: string): Promise<TokenType | undefined>;\n  getTokenBySymbolAndChain(walletId: string, symbol: string, chainId: string): Promise<TokenType | undefined>;\n  createToken(token: InsertToken): Promise<TokenType>;\n  updateTokenBalance(id: string, balance: string): Promise<TokenType | undefined>;\n  updateTokenVisibility(id: string, isVisible: boolean): Promise<TokenType | undefined>;\n  \n  // Transaction operations\n  getTransaction(id: string): Promise<TransactionType | undefined>;\n  getTransactionsByWallet(walletId: string): Promise<TransactionType[]>;\n  createTransaction(transaction: InsertTransaction): Promise<TransactionType>;\n  updateTransactionStatus(id: string, status: string): Promise<TransactionType | undefined>;\n\n  // Transaction Fee operations\n  getTransactionFee(tokenSymbol: string): Promise<TransactionFeeType | undefined>;\n  getAllTransactionFees(): Promise<TransactionFeeType[]>;\n  upsertTransactionFee(fee: InsertTransactionFee): Promise<TransactionFeeType>;\n\n  // User Transaction Fee operations (per-user custom fees)\n  getUserTransactionFee(userId: string, tokenSymbol: string, chainId: string): Promise<UserTransactionFeeType | undefined>;\n  getUserTransactionFees(userId: string): Promise<UserTransactionFeeType[]>;\n  upsertUserTransactionFee(fee: InsertUserTransactionFee): Promise<UserTransactionFeeType>;\n  deleteUserTransactionFee(userId: string, tokenSymbol: string, chainId: string): Promise<boolean>;\n\n  // Swap Order operations (real-time swap order tracking)\n  createSwapOrder(order: InsertSwapOrder): Promise<SwapOrderType>;\n  getSwapOrder(orderId: string): Promise<SwapOrderType | undefined>;\n  getActiveSwapOrders(userId: string): Promise<SwapOrderType[]>;\n  getAllSwapOrders(userId: string): Promise<SwapOrderType[]>;\n  updateSwapOrder(orderId: string, updates: Partial<SwapOrderType>): Promise<SwapOrderType | undefined>;\n}\n\n// Default token display order\nconst DEFAULT_TOKEN_ORDER = [\n  { symbol: \"BTCB\", chainId: \"bnb\", order: 1 },\n  { symbol: \"ETH\", chainId: \"ethereum\", order: 2 },\n  { symbol: \"BNB\", chainId: \"bnb\", order: 3 },\n  { symbol: \"USDT\", chainId: \"ethereum\", order: 4 },\n  { symbol: \"SOL\", chainId: \"solana\", order: 5 },\n  { symbol: \"TRX\", chainId: \"tron\", order: 6 },\n  { symbol: \"USDT\", chainId: \"bnb\", order: 7 },\n  { symbol: \"USDT\", chainId: \"tron\", order: 8 },\n  { symbol: \"ETH\", chainId: \"bnb\", order: 9 },\n  { symbol: \"USDC\", chainId: \"ethereum\", order: 10 },\n  { symbol: \"ETH\", chainId: \"tron\", order: 11 },\n  { symbol: \"ETH\", chainId: \"solana\", order: 12 },\n  { symbol: \"DAI\", chainId: \"ethereum\", order: 13 },\n];\n\nexport class MongoStorage implements IStorage {\n  private initialized = false;\n\n  async init() {\n    if (this.initialized) return;\n    \n    try {\n      await this.initializeChains();\n      await this.migrateChainSymbols(); // Fix existing chain symbols\n      await this.initializeAdmin();\n      await this.initializeTransactionFees();\n      await this.clearSwapHistory();\n      await this.migrateTokens();\n      this.initialized = true;\n    } catch (error) {\n      console.error(\"Failed to initialize database:\", error);\n      throw new Error(\"Database initialization failed\");\n    }\n  }\n\n  private async migrateTokens() {\n    try {\n      // REMOVED: This migration was incorrectly setting chain symbols to network standards\n      // Chain symbols should be native asset symbols (ETH, BNB, TRX, SOL), not network standards (ERC-20, BEP-20, etc.)\n      // The correct symbols are now set in initializeChains() and migrateChainSymbols()\n      \n      // Migrate WETH  ETH for TRON chain\n      const tronWethUpdate = await Token.updateMany(\n        { symbol: \"WETH\", chainId: \"tron\" },\n        { \n          $set: { \n            symbol: \"ETH\",\n            name: \"Ethereum\",\n            icon: \"https://assets.coingecko.com/coins/images/279/large/ethereum.png\"\n          } \n        }\n      );\n      if (tronWethUpdate.modifiedCount > 0) {\n        console.log(`[Migration] Updated ${tronWethUpdate.modifiedCount} WETH  ETH tokens on TRON`);\n      }\n\n      // Migrate WETH  ETH for Solana chain\n      const solanaWethUpdate = await Token.updateMany(\n        { symbol: \"WETH\", chainId: \"solana\" },\n        { \n          $set: { \n            symbol: \"ETH\",\n            name: \"Ethereum\",\n            icon: \"https://assets.coingecko.com/coins/images/279/large/ethereum.png\"\n          } \n        }\n      );\n      if (solanaWethUpdate.modifiedCount > 0) {\n        console.log(`[Migration] Updated ${solanaWethUpdate.modifiedCount} WETH  ETH tokens on Solana`);\n      }\n\n      // Set default display order for key tokens\n      // This migration makes default tokens visible and sets their display order\n      let updatedCount = 0;\n      for (const defaultToken of DEFAULT_TOKEN_ORDER) {\n        const result = await Token.updateMany(\n          { \n            symbol: defaultToken.symbol, \n            chainId: defaultToken.chainId,\n            $or: [\n              { displayOrder: { $exists: false } }, // Tokens without displayOrder\n              { displayOrder: { $gte: 999 } } // Or tokens with default high order\n            ]\n          },\n          { \n            $set: { \n              displayOrder: defaultToken.order,\n              isVisible: true // Ensure default tokens are visible\n            } \n          }\n        );\n        updatedCount += result.modifiedCount;\n      }\n      \n      // Hide all non-default tokens for existing wallets\n      // Build list of default token combinations to exclude\n      const defaultTokenCombinations = DEFAULT_TOKEN_ORDER.map(t => ({\n        symbol: t.symbol,\n        chainId: t.chainId\n      }));\n      \n      // Set isVisible=false for all tokens NOT in the default list\n      const hideResult = await Token.updateMany(\n        {\n          $and: [\n            // Must not match any of the default token combinations\n            {\n              $nor: defaultTokenCombinations.map(combo => ({\n                symbol: combo.symbol,\n                chainId: combo.chainId\n              }))\n            },\n            // Only update if currently visible\n            { isVisible: true }\n          ]\n        },\n        { \n          $set: { \n            isVisible: false,\n            displayOrder: 999 // Set high order for non-default tokens\n          } \n        }\n      );\n      \n      console.log(`[Migration] Set default displayOrder for ${DEFAULT_TOKEN_ORDER.length} token types (${updatedCount} tokens updated)`);\n      console.log(`[Migration] Hidden ${hideResult.modifiedCount} non-default tokens`);\n    } catch (error) {\n      console.error(\"Failed to migrate tokens:\", error);\n    }\n  }\n\n  private async clearSwapHistory() {\n    try {\n      const result = await Transaction.deleteMany({ type: \"swap\" });\n      console.log(`Cleared ${result.deletedCount} swap history entries`);\n    } catch (error) {\n      console.error(\"Failed to clear swap history:\", error);\n    }\n  }\n\n  private async initializeAdmin() {\n    try {\n      const adminEmail = process.env.ADMIN_EMAIL;\n      const adminPassword = process.env.ADMIN_PASSWORD;\n\n      if (!adminEmail || !adminPassword) {\n        console.warn(\"ADMIN_EMAIL and ADMIN_PASSWORD environment variables not set. Admin user will not be created.\");\n        return;\n      }\n\n      const existingAdmin = await User.findOne({ email: adminEmail });\n      \n      if (!existingAdmin) {\n        await User.create({\n          email: adminEmail,\n          password: adminPassword,\n          firstName: \"Admin\",\n          lastName: \"User\",\n          dateOfBirth: new Date(\"1990-01-01\"),\n          isAdmin: true,\n        });\n        console.log(\"Admin user created successfully\");\n      } else {\n        // Update admin password if it already exists (in case ADMIN_PASSWORD secret was changed)\n        existingAdmin.password = adminPassword;\n        // Ensure all required fields are set\n        if (!existingAdmin.dateOfBirth) {\n          existingAdmin.dateOfBirth = new Date(\"1990-01-01\");\n        }\n        if (!existingAdmin.firstName) {\n          existingAdmin.firstName = \"Admin\";\n        }\n        if (!existingAdmin.lastName) {\n          existingAdmin.lastName = \"User\";\n        }\n        // CRITICAL: Ensure isAdmin flag is set to true\n        existingAdmin.isAdmin = true;\n        await existingAdmin.save();\n        console.log(\"Admin password updated successfully\");\n      }\n    } catch (error) {\n      console.error(\"Failed to initialize admin:\", error);\n    }\n  }\n\n  private async initializeChains() {\n    try {\n      const existingChains = await Chain.find();\n      \n      if (existingChains.length === 0) {\n        const chainsToInsert: InsertChain[] = [\n          {\n            id: \"ethereum\",\n            name: \"Ethereum\",\n            symbol: \"ETH\", // Native chain symbol (not ERC-20)\n            networkStandard: \"ERC-20\",\n            icon: \"https://assets.coingecko.com/coins/images/279/small/ethereum.png\",\n            rpcUrl: \"https://mainnet.infura.io/v3/\",\n            explorerUrl: \"https://etherscan.io\",\n            chainId: 1,\n            isTestnet: false,\n          },\n          {\n            id: \"bnb\",\n            name: \"BNB Smart Chain\",\n            symbol: \"BNB\", // Native chain symbol (not BEP-20)\n            networkStandard: \"BEP-20\",\n            icon: \"https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png\",\n            rpcUrl: \"https://bsc-dataseed.binance.org/\",\n            explorerUrl: \"https://bscscan.com\",\n            chainId: 56,\n            isTestnet: false,\n          },\n          {\n            id: \"tron\",\n            name: \"TRON\",\n            symbol: \"TRX\", // Native chain symbol (not TRC-20)\n            networkStandard: \"TRC-20\",\n            icon: \"https://assets.coingecko.com/coins/images/1094/small/tron-logo.png\",\n            rpcUrl: \"https://api.trongrid.io\",\n            explorerUrl: \"https://tronscan.org\",\n            chainId: 0,\n            isTestnet: false,\n          },\n          {\n            id: \"solana\",\n            name: \"Solana\",\n            symbol: \"SOL\", // Native chain symbol (not \"Solana\")\n            networkStandard: \"SPL\",\n            icon: \"https://assets.coingecko.com/coins/images/4128/small/solana.png\",\n            rpcUrl: \"https://api.mainnet-beta.solana.com\",\n            explorerUrl: \"https://explorer.solana.com\",\n            chainId: 0,\n            isTestnet: false,\n          },\n        ];\n\n        await Chain.insertMany(chainsToInsert);\n      }\n    } catch (error) {\n      console.error(\"Failed to initialize chains:\", error);\n      throw error;\n    }\n  }\n\n  // Migration: Fix chain symbols to be native symbols (ETH, BNB, TRX, SOL) instead of network standards\n  private async migrateChainSymbols() {\n    try {\n      const chainUpdates = [\n        { id: \"ethereum\", correctSymbol: \"ETH\" },\n        { id: \"bnb\", correctSymbol: \"BNB\" },\n        { id: \"tron\", correctSymbol: \"TRX\" },\n        { id: \"solana\", correctSymbol: \"SOL\" },\n      ];\n\n      let updated = 0;\n      for (const { id, correctSymbol } of chainUpdates) {\n        const result = await Chain.updateOne(\n          { id },\n          { $set: { symbol: correctSymbol } }\n        );\n        if (result.modifiedCount > 0) {\n          updated++;\n        }\n      }\n\n      if (updated > 0) {\n        console.log(`[Migration] Updated ${updated} chain symbols to native symbols`);\n      }\n    } catch (error) {\n      console.error(\"Failed to migrate chain symbols:\", error);\n    }\n  }\n\n  private async initializeTransactionFees() {\n    try {\n      const existingFees = await TransactionFee.find();\n      \n      if (existingFees.length === 0) {\n        const feesToInsert: InsertTransactionFee[] = [\n          { tokenSymbol: \"ETH\", feeAmount: \"0.001\", feePercentage: 0.5 },\n          { tokenSymbol: \"BTC\", feeAmount: \"0.00001\", feePercentage: 0.5 },\n          { tokenSymbol: \"BNB\", feeAmount: \"0.001\", feePercentage: 0.5 },\n          { tokenSymbol: \"USDT\", feeAmount: \"1.0\", feePercentage: 0.5 },\n          { tokenSymbol: \"USDC\", feeAmount: \"1.0\", feePercentage: 0.5 },\n          { tokenSymbol: \"SOL\", feeAmount: \"0.001\", feePercentage: 0.5 },\n          { tokenSymbol: \"TRX\", feeAmount: \"1.0\", feePercentage: 0.5 },\n        ];\n\n        await TransactionFee.insertMany(feesToInsert);\n        console.log(\"Transaction fees initialized successfully\");\n      }\n    } catch (error) {\n      console.error(\"Failed to initialize transaction fees:\", error);\n      throw error;\n    }\n  }\n\n  // User operations\n  async getUser(id: string): Promise<UserType | undefined> {\n    const user = await User.findById(id).lean();\n    if (!user) return undefined;\n    return {\n      ...user,\n      _id: user._id.toString(),\n    } as UserType;\n  }\n\n  async getUserByEmail(email: string): Promise<UserType | undefined> {\n    const user = await User.findOne({ email }).lean();\n    if (!user) return undefined;\n    return {\n      ...user,\n      _id: user._id.toString(),\n    } as UserType;\n  }\n\n  async createUser(userData: any): Promise<UserType> {\n    const user = await User.create(userData);\n    return {\n      ...user.toObject(),\n      _id: (user._id as any).toString(),\n    } as UserType;\n  }\n\n  async updateUserProfilePhoto(userId: string, photoUrl: string): Promise<UserType | undefined> {\n    const user = await User.findByIdAndUpdate(\n      userId,\n      { profilePhoto: photoUrl },\n      { new: true }\n    ).lean();\n    if (!user) return undefined;\n    return {\n      ...user,\n      _id: user._id.toString(),\n    } as UserType;\n  }\n\n  async getAllUsers(): Promise<UserType[]> {\n    const users = await User.find().lean();\n    return users.map(user => ({\n      ...user,\n      _id: user._id.toString(),\n    })) as UserType[];\n  }\n\n  async searchUsers(query: string): Promise<UserType[]> {\n    // First try to find wallets matching the query\n    const wallets = await Wallet.find({\n      $or: [\n        { address: { $regex: query, $options: 'i' } },\n        // Also search by wallet ID if it's a valid ObjectId\n        ...(mongoose.Types.ObjectId.isValid(query) ? [{ _id: new mongoose.Types.ObjectId(query) }] : [])\n      ]\n    }).lean();\n\n    const walletUserIds = wallets.map(w => w.userId);\n\n    // Search users by email, name, or user ID, OR if they have a matching wallet\n    const users = await User.find({\n      $or: [\n        { email: { $regex: query, $options: 'i' } },\n        { firstName: { $regex: query, $options: 'i' } },\n        { lastName: { $regex: query, $options: 'i' } },\n        ...(mongoose.Types.ObjectId.isValid(query) ? [{ _id: new mongoose.Types.ObjectId(query) }] : []),\n        ...(walletUserIds.length > 0 ? [{ _id: { $in: walletUserIds } }] : [])\n      ]\n    }).lean();\n    \n    return users.map(user => ({\n      ...user,\n      _id: user._id.toString(),\n    })) as UserType[];\n  }\n\n  // Wallet operations\n  async getWallet(id: string): Promise<WalletType | undefined> {\n    const wallet = await Wallet.findById(id).lean();\n    if (!wallet) return undefined;\n    return {\n      ...wallet,\n      _id: wallet._id.toString(),\n      userId: wallet.userId.toString(),\n    } as unknown as WalletType;\n  }\n\n  async getWalletByAddress(address: string): Promise<WalletType | undefined> {\n    const wallet = await Wallet.findOne({ address }).lean();\n    if (!wallet) return undefined;\n    return {\n      ...wallet,\n      _id: wallet._id.toString(),\n      userId: wallet.userId.toString(),\n    } as unknown as WalletType;\n  }\n\n  async getWalletsByUser(userId: string): Promise<WalletType[]> {\n    const wallets = await Wallet.find({ userId }).lean();\n    return wallets.map(wallet => ({\n      ...wallet,\n      _id: wallet._id.toString(),\n      userId: wallet.userId.toString(),\n    })) as unknown as WalletType[];\n  }\n\n  async createWallet(insertWallet: InsertWallet): Promise<WalletType> {\n    const wallet = await Wallet.create(insertWallet);\n    \n    try {\n      // Helper function to get display order\n      const getDisplayOrder = (symbol: string, chainId: string): number => {\n        const defaultToken = DEFAULT_TOKEN_ORDER.find(\n          t => t.symbol === symbol && t.chainId === chainId\n        );\n        return defaultToken ? defaultToken.order : 999;\n      };\n\n      // Helper function to check if token is in default list\n      const isDefaultVisible = (symbol: string, chainId: string): boolean => {\n        return DEFAULT_TOKEN_ORDER.some(\n          t => t.symbol === symbol && t.chainId === chainId\n        );\n      };\n\n      // Create default tokens for all chains\n      const allDefaultTokens: InsertToken[] = [\n        // Ethereum tokens\n        ...ETHEREUM_TOKENS.map(token => ({\n          walletId: wallet._id.toString(),\n          chainId: \"ethereum\",\n          contractAddress: token.contractAddress || null,\n          symbol: token.symbol,\n          name: token.name,\n          decimals: token.decimals,\n          balance: \"0\",\n          isNative: token.symbol === \"ETH\",\n          icon: token.icon || null,\n          isVisible: isDefaultVisible(token.symbol, \"ethereum\"),\n          displayOrder: getDisplayOrder(token.symbol, \"ethereum\"),\n        })),\n        // BNB tokens\n        ...BNB_TOKENS.map(token => ({\n          walletId: wallet._id.toString(),\n          chainId: \"bnb\",\n          contractAddress: token.contractAddress || null,\n          symbol: token.symbol,\n          name: token.name,\n          decimals: token.decimals,\n          balance: \"0\",\n          isNative: token.symbol === \"BNB\",\n          icon: token.icon || null,\n          isVisible: isDefaultVisible(token.symbol, \"bnb\"),\n          displayOrder: getDisplayOrder(token.symbol, \"bnb\"),\n        })),\n        // TRON tokens\n        ...TRON_TOKENS.map(token => ({\n          walletId: wallet._id.toString(),\n          chainId: \"tron\",\n          contractAddress: token.contractAddress || null,\n          symbol: token.symbol,\n          name: token.name,\n          decimals: token.decimals,\n          balance: \"0\",\n          isNative: token.symbol === \"TRX\",\n          icon: token.icon || null,\n          isVisible: isDefaultVisible(token.symbol, \"tron\"),\n          displayOrder: getDisplayOrder(token.symbol, \"tron\"),\n        })),\n        // Solana tokens\n        ...SOLANA_TOKENS.map(token => ({\n          walletId: wallet._id.toString(),\n          chainId: \"solana\",\n          contractAddress: token.contractAddress || null,\n          symbol: token.symbol,\n          name: token.name,\n          decimals: token.decimals,\n          balance: \"0\",\n          isNative: token.symbol === \"SOL\",\n          icon: token.icon || null,\n          isVisible: isDefaultVisible(token.symbol, \"solana\"),\n          displayOrder: getDisplayOrder(token.symbol, \"solana\"),\n        })),\n      ];\n\n      await Token.insertMany(allDefaultTokens);\n      \n      return {\n        ...wallet.toObject(),\n        _id: wallet._id.toString(),\n        userId: wallet.userId.toString(),\n      } as unknown as WalletType;\n    } catch (error) {\n      console.error(\"Failed to create wallet:\", error);\n      await Wallet.findByIdAndDelete(wallet._id);\n      throw new Error(\"Wallet creation failed\");\n    }\n  }\n\n  async getAllWallets(): Promise<WalletType[]> {\n    const wallets = await Wallet.find().lean();\n    return wallets.map(wallet => ({\n      ...wallet,\n      _id: wallet._id.toString(),\n      userId: wallet.userId.toString(),\n    })) as unknown as WalletType[];\n  }\n\n  // Chain operations\n  async getAllChains(): Promise<ChainType[]> {\n    const chains = await Chain.find().lean();\n    return chains.map(chain => ({\n      ...chain,\n      _id: chain._id?.toString(),\n    })) as ChainType[];\n  }\n\n  async getChain(id: string): Promise<ChainType | undefined> {\n    const chain = await Chain.findOne({ id }).lean();\n    if (!chain) return undefined;\n    return {\n      ...chain,\n      _id: chain._id?.toString(),\n    } as ChainType;\n  }\n\n  // Token operations\n  async getTokensByWallet(walletId: string): Promise<TokenType[]> {\n    const tokens = await Token.find({ walletId }).lean();\n    return tokens.map(token => ({\n      ...token,\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    })) as unknown as TokenType[];\n  }\n\n  async getTokensByChain(walletId: string, chainId: string): Promise<TokenType[]> {\n    const tokens = await Token.find({ walletId, chainId }).lean();\n    return tokens.map(token => ({\n      ...token,\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    })) as unknown as TokenType[];\n  }\n\n  async getTokenBySymbol(walletId: string, symbol: string): Promise<TokenType | undefined> {\n    const token = await Token.findOne({ walletId, symbol }).lean();\n    if (!token) return undefined;\n    return {\n      ...token,\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    } as unknown as TokenType;\n  }\n\n  async getTokenBySymbolAndChain(walletId: string, symbol: string, chainId: string): Promise<TokenType | undefined> {\n    const token = await Token.findOne({ walletId, symbol, chainId }).lean();\n    if (!token) return undefined;\n    return {\n      ...token,\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    } as unknown as TokenType;\n  }\n\n  async createToken(insertToken: InsertToken): Promise<TokenType> {\n    const token = await Token.create(insertToken);\n    return {\n      ...token.toObject(),\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    } as unknown as TokenType;\n  }\n\n  async updateTokenBalance(id: string, balance: string): Promise<TokenType | undefined> {\n    const token = await Token.findByIdAndUpdate(\n      id,\n      { balance },\n      { new: true }\n    ).lean();\n    if (!token) return undefined;\n    return {\n      ...token,\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    } as unknown as TokenType;\n  }\n\n  async updateTokenVisibility(id: string, isVisible: boolean): Promise<TokenType | undefined> {\n    const token = await Token.findByIdAndUpdate(\n      id,\n      { isVisible },\n      { new: true }\n    ).lean();\n    if (!token) return undefined;\n    return {\n      ...token,\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    } as unknown as TokenType;\n  }\n\n  async updateTokenLastInbound(id: string): Promise<TokenType | undefined> {\n    const token = await Token.findByIdAndUpdate(\n      id,\n      { lastInboundAt: new Date() },\n      { new: true }\n    ).lean();\n    if (!token) return undefined;\n    return {\n      ...token,\n      _id: token._id.toString(),\n      walletId: token.walletId.toString(),\n    } as unknown as TokenType;\n  }\n\n  // Transaction operations\n  async getTransaction(id: string): Promise<TransactionType | undefined> {\n    const transaction = await Transaction.findById(id).lean();\n    if (!transaction) return undefined;\n    return {\n      ...transaction,\n      _id: transaction._id.toString(),\n      walletId: transaction.walletId.toString(),\n    } as unknown as TransactionType;\n  }\n\n  async getTransactionsByWallet(walletId: string): Promise<TransactionType[]> {\n    const transactions = await Transaction.find({ walletId }).sort({ timestamp: -1 }).lean();\n    return transactions.map(tx => ({\n      ...tx,\n      _id: tx._id.toString(),\n      walletId: tx.walletId.toString(),\n    })) as unknown as TransactionType[];\n  }\n\n  async createTransaction(insertTransaction: InsertTransaction): Promise<TransactionType> {\n    const transaction = await Transaction.create(insertTransaction);\n    return {\n      ...transaction.toObject(),\n      _id: transaction._id.toString(),\n      walletId: transaction.walletId.toString(),\n    } as unknown as TransactionType;\n  }\n\n  async updateTransactionStatus(id: string, status: string): Promise<TransactionType | undefined> {\n    const transaction = await Transaction.findByIdAndUpdate(\n      id,\n      { status },\n      { new: true }\n    ).lean();\n    if (!transaction) return undefined;\n    return {\n      ...transaction,\n      _id: transaction._id.toString(),\n      walletId: transaction.walletId.toString(),\n    } as unknown as TransactionType;\n  }\n\n  // Transaction Fee operations\n  async getTransactionFee(tokenSymbol: string): Promise<TransactionFeeType | undefined> {\n    const fee = await TransactionFee.findOne({ tokenSymbol }).lean();\n    if (!fee) return undefined;\n    return {\n      ...fee,\n      _id: fee._id.toString(),\n    } as TransactionFeeType;\n  }\n\n  async getAllTransactionFees(): Promise<TransactionFeeType[]> {\n    const fees = await TransactionFee.find().lean();\n    return fees.map(fee => ({\n      ...fee,\n      _id: fee._id.toString(),\n    })) as TransactionFeeType[];\n  }\n\n  async upsertTransactionFee(feeData: InsertTransactionFee): Promise<TransactionFeeType> {\n    const fee = await TransactionFee.findOneAndUpdate(\n      { tokenSymbol: feeData.tokenSymbol },\n      { ...feeData, updatedAt: new Date() },\n      { upsert: true, new: true }\n    ).lean();\n    return {\n      ...fee,\n      _id: fee._id.toString(),\n    } as TransactionFeeType;\n  }\n\n  // User Transaction Fee operations (per-user custom fees)\n  async getUserTransactionFee(userId: string, tokenSymbol: string, chainId: string): Promise<UserTransactionFeeType | undefined> {\n    const fee = await UserTransactionFee.findOne({ userId, tokenSymbol, chainId }).lean();\n    if (!fee) return undefined;\n    return {\n      ...fee,\n      _id: fee._id.toString(),\n      userId: fee.userId.toString(),\n    } as UserTransactionFeeType;\n  }\n\n  async getUserTransactionFees(userId: string): Promise<UserTransactionFeeType[]> {\n    const fees = await UserTransactionFee.find({ userId }).lean();\n    return fees.map(fee => ({\n      ...fee,\n      _id: fee._id.toString(),\n      userId: fee.userId.toString(),\n    })) as UserTransactionFeeType[];\n  }\n\n  async upsertUserTransactionFee(feeData: InsertUserTransactionFee): Promise<UserTransactionFeeType> {\n    const fee = await UserTransactionFee.findOneAndUpdate(\n      { userId: feeData.userId, tokenSymbol: feeData.tokenSymbol, chainId: feeData.chainId },\n      { ...feeData, updatedAt: new Date() },\n      { upsert: true, new: true }\n    ).lean();\n    return {\n      ...fee,\n      _id: fee._id.toString(),\n      userId: fee.userId.toString(),\n    } as UserTransactionFeeType;\n  }\n\n  async deleteUserTransactionFee(userId: string, tokenSymbol: string, chainId: string): Promise<boolean> {\n    const result = await UserTransactionFee.deleteOne({ userId, tokenSymbol, chainId });\n    return result.deletedCount > 0;\n  }\n\n  // Swap Order operations (real-time swap order tracking)\n  async createSwapOrder(orderData: InsertSwapOrder): Promise<SwapOrderType> {\n    const order = await SwapOrder.create(orderData);\n    return {\n      ...order.toObject(),\n      _id: order._id.toString(),\n      userId: order.userId.toString(),\n      walletId: order.walletId.toString(),\n    } as SwapOrderType;\n  }\n\n  async getSwapOrder(orderId: string): Promise<SwapOrderType | undefined> {\n    const order = await SwapOrder.findOne({ orderId }).lean();\n    if (!order) return undefined;\n    return {\n      ...order,\n      _id: order._id.toString(),\n      userId: order.userId.toString(),\n      walletId: order.walletId.toString(),\n    } as SwapOrderType;\n  }\n\n  async getActiveSwapOrders(userId: string): Promise<SwapOrderType[]> {\n    const orders = await SwapOrder.find({\n      userId,\n      status: { $in: [\"pending\", \"processing\"] }\n    })\n    .sort({ orderTime: -1 })\n    .lean();\n    \n    return orders.map(order => ({\n      ...order,\n      _id: order._id.toString(),\n      userId: order.userId.toString(),\n      walletId: order.walletId.toString(),\n    })) as SwapOrderType[];\n  }\n\n  async getAllSwapOrders(userId: string): Promise<SwapOrderType[]> {\n    const orders = await SwapOrder.find({ userId })\n    .sort({ orderTime: -1 })\n    .lean();\n    \n    return orders.map(order => ({\n      ...order,\n      _id: order._id.toString(),\n      userId: order.userId.toString(),\n      walletId: order.walletId.toString(),\n    })) as SwapOrderType[];\n  }\n\n  async updateSwapOrder(orderId: string, updates: Partial<SwapOrderType>): Promise<SwapOrderType | undefined> {\n    const order = await SwapOrder.findOneAndUpdate(\n      { orderId },\n      { ...updates },\n      { new: true }\n    ).lean();\n    \n    if (!order) return undefined;\n    return {\n      ...order,\n      _id: order._id.toString(),\n      userId: order.userId.toString(),\n      walletId: order.walletId.toString(),\n    } as SwapOrderType;\n  }\n}\n\nexport const storage = new MongoStorage();\n","size_bytes":30235},"client/src/App.tsx":{"content":"import React, { useEffect, useState } from \"react\";\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { WalletProvider } from \"@/contexts/wallet-context\";\nimport { ChainProvider } from \"@/contexts/chain-context\";\nimport { cacheManager } from \"@/lib/cache-manager\";\nimport { safeStorage } from \"@/lib/safe-storage\";\nimport { WebSocketProvider } from \"@/lib/websocket\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing\";\nimport CreateAccount from \"@/pages/create-account\";\nimport Login from \"@/pages/login\";\nimport Recovery from \"@/pages/recovery\";\nimport Welcome from \"@/pages/welcome\";\nimport CreateWallet from \"@/pages/create-wallet\";\nimport ImportWallet from \"@/pages/import-wallet\";\nimport Dashboard from \"@/pages/dashboard\";\nimport TokenDetail from \"@/pages/token-detail\";\nimport SendList from \"@/pages/send-list\";\nimport Send from \"@/pages/send\";\nimport Receive from \"@/pages/receive\";\nimport ReceiveQr from \"@/pages/receive-qr\";\nimport Swap from \"@/pages/swap\";\nimport SwapOrders from \"@/pages/swap-orders\";\nimport SwapOrderDetails from \"@/pages/swap-order-details\";\nimport Settings from \"@/pages/settings\";\nimport SettingsSecurity from \"@/pages/settings-security\";\nimport SettingsSecurityChangePassword from \"@/pages/settings-security-change-password\";\nimport SettingsCurrency from \"@/pages/settings-currency\";\nimport SettingsLanguage from \"@/pages/settings-language\";\nimport SettingsAbout from \"@/pages/settings-about\";\nimport Feedback from \"@/pages/feedback\";\nimport TermsOfUse from \"@/pages/terms-of-use\";\nimport History from \"@/pages/history\";\nimport Notifications from \"@/pages/notifications\";\nimport QRScanner from \"@/pages/qr-scanner\";\nimport TransactionDetail from \"@/pages/transaction-detail\";\nimport ManageCoins from \"@/pages/manage-coins\";\nimport AddCustomToken from \"@/pages/add-custom-token\";\nimport BuySell from \"@/pages/buy-sell\";\nimport AddressBook from \"@/pages/address-book\";\nimport Market from \"@/pages/market\";\nimport NewsDetail from \"@/pages/news-detail\";\nimport FAQ from \"@/pages/faq\";\nimport About from \"@/pages/about\";\nimport Contact from \"@/pages/contact\";\nimport SwapsInfo from \"@/pages/swaps-info\";\nimport BuyCryptoInfo from \"@/pages/buy-crypto-info\";\nimport Profile from \"@/pages/profile\";\nimport EditProfile from \"@/pages/edit-profile\";\nimport ViewProfileDetails from \"@/pages/view-profile-details\";\nimport ConnectedDapps from \"@/pages/connected-dapps\";\nimport SupportChat from \"@/pages/support-chat\";\nimport PriceAlerts from \"@/pages/price-alerts\";\nimport AdminDashboard from \"@/pages/admin-dashboard\";\nimport AdminLogin from \"@/pages/admin-login\";\n\nfunction ConditionalProviders() {\n  const [location] = useLocation();\n  const isAdminRoute = location.startsWith('/admin');\n\n  if (isAdminRoute) {\n    return (\n      <Switch>\n        <Route path=\"/admin/login\" component={AdminLogin} />\n        <Route path=\"/admin\" component={AdminDashboard} />\n        <Route component={NotFound} />\n      </Switch>\n    );\n  }\n\n  return (\n    <WalletProvider>\n      <ChainProvider>\n        <Switch>\n          <Route path=\"/\" component={Landing} />\n          <Route path=\"/create-account\" component={CreateAccount} />\n          <Route path=\"/login\" component={Login} />\n          <Route path=\"/recovery\" component={Recovery} />\n          <Route path=\"/welcome\" component={Welcome} />\n          <Route path=\"/create-wallet\" component={CreateWallet} />\n          <Route path=\"/import-wallet\" component={ImportWallet} />\n          <Route path=\"/dashboard\" component={Dashboard} />\n          <Route path=\"/notifications\" component={Notifications} />\n          <Route path=\"/qr-scanner\" component={QRScanner} />\n          <Route path=\"/profile\" component={Profile} />\n          <Route path=\"/profile/edit\" component={EditProfile} />\n          <Route path=\"/profile/view-details\" component={ViewProfileDetails} />\n          <Route path=\"/profile/connected-dapps\" component={ConnectedDapps} />\n          <Route path=\"/support-chat\" component={SupportChat} />\n          <Route path=\"/price-alerts\" component={PriceAlerts} />\n          <Route path=\"/market\" component={Market} />\n          <Route path=\"/news/:id\" component={NewsDetail} />\n          <Route path=\"/token/:symbol/:chainId\" component={TokenDetail} />\n          <Route path=\"/token/:symbol\" component={TokenDetail} />\n          <Route path=\"/send/:tokenId\" component={Send} />\n          <Route path=\"/send\" component={SendList} />\n          <Route path=\"/receive\" component={Receive} />\n          <Route path=\"/receive-qr/:tokenId\" component={ReceiveQr} />\n          <Route path=\"/swap\" component={Swap} />\n          <Route path=\"/swap/orders/:orderId\" component={SwapOrderDetails} />\n          <Route path=\"/swap/orders\" component={SwapOrders} />\n          <Route path=\"/buy-sell\" component={BuySell} />\n          <Route path=\"/settings\" component={Settings} />\n          <Route path=\"/settings/currency\" component={SettingsCurrency} />\n          <Route path=\"/settings/language\" component={SettingsLanguage} />\n          <Route path=\"/settings/security/change-password\" component={SettingsSecurityChangePassword} />\n          <Route path=\"/settings/security\" component={SettingsSecurity} />\n          <Route path=\"/settings/about\" component={SettingsAbout} />\n          <Route path=\"/feedback\" component={Feedback} />\n          <Route path=\"/terms-of-use\" component={TermsOfUse} />\n          <Route path=\"/history\" component={History} />\n          <Route path=\"/transaction/:hash\" component={TransactionDetail} />\n          <Route path=\"/manage-coins\" component={ManageCoins} />\n          <Route path=\"/add-custom-token\" component={AddCustomToken} />\n          <Route path=\"/address-book\" component={AddressBook} />\n          <Route path=\"/faq\" component={FAQ} />\n          <Route path=\"/about\" component={About} />\n          <Route path=\"/contact\" component={Contact} />\n          <Route path=\"/swaps-info\" component={SwapsInfo} />\n          <Route path=\"/buy-crypto-info\" component={BuyCryptoInfo} />\n          <Route component={NotFound} />\n        </Switch>\n      </ChainProvider>\n    </WalletProvider>\n  );\n}\n\nfunction App() {\n  useEffect(() => {\n    try {\n      cacheManager.autoCheck();\n      \n      const healthCheck = safeStorage.runHealthCheck();\n      if (!healthCheck.healthy) {\n        console.warn('Storage health check failed:', healthCheck.issues);\n        if (healthCheck.issues.length > 5) {\n          console.warn('Multiple storage issues detected, running auto-cleanup');\n          safeStorage.autoCleanup();\n        }\n      }\n\n      safeStorage.autoCleanup();\n\n      const storageInfo = safeStorage.getStorageInfo();\n      console.log('Storage Info:', storageInfo);\n    } catch (error) {\n      console.error('Startup cache check failed:', error);\n    }\n  }, []);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <WebSocketProvider>\n        <ThemeProvider defaultTheme=\"light\">\n          <TooltipProvider>\n            <Toaster />\n            <ConditionalProviders />\n          </TooltipProvider>\n        </ThemeProvider>\n      </WebSocketProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;","size_bytes":7435},"client/src/pages/dashboard.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Logo } from \"@/components/logo\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { TokenCard, QuickActionButton } from \"@/components/token-card\";\nimport { AddTokenDialog } from \"@/components/add-token-dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { DefaultAvatar } from \"@/components/default-avatar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ArrowUpRight, ArrowDownLeft, Repeat2, Settings, Plus, Eye, EyeOff, Clock, Search, ChevronDown, MoreVertical, Coins, ArrowUp, Bell, ScanLine, ChevronUp, ChevronDown as ChevronDownIcon, Headphones } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useChain } from \"@/contexts/chain-context\";\nimport { formatBalance } from \"@/lib/format-balance\";\nimport { formatCurrency, convertCurrency, getCurrencySymbol } from \"@/lib/currency\";\nimport { BottomNav } from \"@/components/bottom-nav\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n  const { walletId, isAuthenticated, isLoading } = useWallet();\n  const { selectedChain, setSelectedChain } = useChain();\n  const { t } = useTranslation('common');\n  const [addTokenDialogOpen, setAddTokenDialogOpen] = useState(false);\n  const [balanceVisible, setBalanceVisible] = useState(() => {\n    const saved = localStorage.getItem('balanceVisible');\n    return saved !== null ? JSON.parse(saved) : true;\n  });\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [menuOpen, setMenuOpen] = useState(false);\n  const [clickedTokenId, setClickedTokenId] = useState<string | null>(null);\n  \n  // Get selected fiat currency from localStorage\n  const selectedCurrency = localStorage.getItem(\"fiatCurrency\") || \"USD\";\n  \n  // Pull-to-refresh state\n  const [pullDistance, setPullDistance] = useState(0);\n  const [isPulling, setIsPulling] = useState(false);\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const touchStartY = useRef(0);\n  const contentRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  useEffect(() => {\n    localStorage.setItem('balanceVisible', JSON.stringify(balanceVisible));\n  }, [balanceVisible]);\n\n  // Pull-to-refresh handlers\n  const handleTouchStart = (e: React.TouchEvent) => {\n    // Only activate pull-to-refresh when at the top of the page\n    if (window.scrollY === 0) {\n      touchStartY.current = e.touches[0].clientY;\n      setIsPulling(true);\n    }\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    if (!isPulling || isRefreshing) return;\n\n    const touchY = e.touches[0].clientY;\n    const diff = touchY - touchStartY.current;\n\n    // Only prevent default and show pull indicator when:\n    // 1. User is pulling down (diff > 0)\n    // 2. Page is at the top (scrollY === 0)\n    if (diff > 0 && window.scrollY === 0) {\n      e.preventDefault();\n      const distance = Math.min(diff * 0.5, 120); // Max 120px pull\n      setPullDistance(distance);\n    } else {\n      // User is scrolling normally, reset pull state\n      setIsPulling(false);\n      setPullDistance(0);\n    }\n  };\n\n  const handleTouchEnd = () => {\n    if (!isPulling || isRefreshing) return;\n\n    setIsPulling(false);\n\n    if (pullDistance > 80) {\n      // Trigger refresh\n      setIsRefreshing(true);\n      setPullDistance(80); // Lock at 80px during refresh\n\n      // Refetch all data\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"portfolio\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/prices\"] });\n\n      // Show \"Updating\" for 5 seconds\n      setTimeout(() => {\n        setIsRefreshing(false);\n        setPullDistance(0);\n      }, 5000);\n    } else {\n      // Snap back\n      setPullDistance(0);\n    }\n  };\n\n  const { data: portfolioData, isLoading: portfolioLoading } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"portfolio\"],\n    enabled: !!walletId,\n  });\n\n  // Fetch unread notification count\n  const { data: notificationData, refetch: refetchNotifications } = useQuery({\n    queryKey: [\"/api/notifications/unread-count\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/notifications/unread-count?walletId=${walletId}`);\n      if (!res.ok) throw new Error(\"Failed to fetch notification count\");\n      return res.json();\n    },\n    enabled: !!walletId,\n    refetchInterval: 10000, // Poll every 10 seconds\n  });\n\n  const unreadCount = notificationData?.count || 0;\n\n  // Fetch support chat unread count (use separate endpoint that doesn't reset count)\n  const { data: supportChatUnreadData } = useQuery<{ unreadCount: number }>({\n    queryKey: [\"/api/support-chat/unread-count\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/support-chat/unread-count\", {\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch unread count\");\n      return res.json();\n    },\n    enabled: !!walletId,\n    refetchInterval: 60000, // Fallback polling every 60 seconds (WebSocket is primary)\n  });\n\n  const supportChatUnreadCount = supportChatUnreadData?.unreadCount || 0;\n\n  // Fetch user data for profile picture\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/user\"],\n    enabled: isAuthenticated && !!walletId,\n  });\n\n  // Fetch available chains\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Fetch real-time prices for all tokens\n  const { data: pricesData } = useQuery({\n    queryKey: [\"/api/prices\"],\n    enabled: !!walletId,\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  const chains = (chainsData as any) || [];\n  const allTokens = (portfolioData as any)?.tokens || [];\n  \n  // Filter out hidden tokens (isVisible === false)\n  const visibleTokens = allTokens.filter((token: any) => token.isVisible !== false);\n  \n  // Filter tokens by selected chain (\"all\" shows all chains)\n  const chainFilteredTokens = selectedChain === \"all\" \n    ? visibleTokens \n    : visibleTokens.filter((token: any) => token.chainId === selectedChain);\n  \n  // Filter tokens based on search query\n  const filteredTokens = chainFilteredTokens.filter((token: any) =>\n    token.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    token.symbol.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  // Note: The API already sorts tokens with balance > 0 first\n  // Here we just use the tokens as they come from the API\n  const tokens = filteredTokens;\n  \n  // Calculate real-time total portfolio value for selected chain only\n  const totalValue = chainFilteredTokens.reduce((sum: number, token: any) => {\n    const coingeckoId = token.coingeckoId || token.symbol.toLowerCase();\n    const priceInfo = (pricesData as any)?.[coingeckoId];\n    const balance = parseFloat(token.balance || \"0\");\n    const storedFiatValue = parseFloat(token.fiatValue || \"0\");\n    \n    // Use real-time price if available, otherwise fall back to stored fiat value\n    const tokenValue = priceInfo?.usd \n      ? (balance * priceInfo.usd)\n      : storedFiatValue;\n    \n    return sum + tokenValue;\n  }, 0);\n\n  // Calculate 24h portfolio change\n  const totalChange24h = chainFilteredTokens.reduce((sum: number, token: any) => {\n    const coingeckoId = token.coingeckoId || token.symbol.toLowerCase();\n    const priceInfo = (pricesData as any)?.[coingeckoId];\n    const balance = parseFloat(token.balance || \"0\");\n    \n    if (priceInfo?.usd && priceInfo?.usd_24h_change) {\n      const currentValue = balance * priceInfo.usd;\n      const changeAmount = currentValue * (priceInfo.usd_24h_change / 100);\n      return sum + changeAmount;\n    }\n    \n    return sum;\n  }, 0);\n\n  const totalChange24hPercent = totalValue > 0 ? (totalChange24h / totalValue) * 100 : 0;\n  const isPositiveChange = totalChange24h >= 0;\n\n  if (!isAuthenticated || !walletId) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex flex-col h-screen bg-background\">\n      {/* Header - Fixed/Non-scrollable */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm flex-shrink-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-2 sm:py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setLocation(\"/settings\")}\n                data-testid=\"button-settings\"\n                className=\"hover-elevate active-elevate-2\"\n              >\n                <Settings className=\"h-8 w-8\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setLocation(\"/notifications\")}\n                data-testid=\"button-notifications\"\n                className=\"hover-elevate active-elevate-2 relative\"\n              >\n                <Bell className=\"h-8 w-8\" />\n                {unreadCount > 0 && (\n                  <span className=\"absolute top-0 right-0 bg-destructive text-destructive-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center font-semibold\">\n                    {unreadCount > 99 ? '99+' : unreadCount}\n                  </span>\n                )}\n              </Button>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setLocation(\"/support-chat\")}\n                data-testid=\"button-support-chat\"\n                className=\"hover-elevate active-elevate-2 relative\"\n              >\n                <Headphones className=\"h-8 w-8\" />\n                {supportChatUnreadCount > 0 && (\n                  <span className=\"absolute top-0 right-0 bg-destructive text-destructive-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center font-semibold\">\n                    {supportChatUnreadCount > 99 ? '99+' : supportChatUnreadCount}\n                  </span>\n                )}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                className=\"p-0 h-10 w-10 rounded-full hover-elevate active-elevate-2\"\n                onClick={() => setLocation(\"/profile\")}\n                data-testid=\"button-profile\"\n              >\n                <DefaultAvatar\n                  profilePhoto={user?.profilePhoto}\n                  firstName={user?.firstName || \"\"}\n                  lastName={user?.lastName || \"\"}\n                  size=\"md\"\n                />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n      {/* Scrollable Content Area */}\n      <div className=\"flex-1 overflow-y-auto pb-20\">\n        {/* Pull-to-refresh indicator */}\n        <div \n          className=\"flex items-center justify-center transition-opacity\"\n          style={{ \n            height: `${pullDistance}px`,\n            opacity: pullDistance > 20 ? 1 : 0,\n          }}\n        >\n          <div className=\"flex flex-col items-center gap-2\">\n            {isRefreshing ? (\n              <div className=\"text-sm font-medium text-muted-foreground\" data-testid=\"text-updating\">\n                {t('dashboard.updating')}\n              </div>\n            ) : (\n              <>\n                <ArrowUp \n                  className=\"h-6 w-6 text-primary transition-transform\"\n                  style={{\n                    transform: pullDistance > 80 ? 'translateY(-4px)' : 'translateY(0)',\n                  }}\n                  data-testid=\"icon-pull-arrow\"\n                />\n                <div className=\"text-sm font-medium text-muted-foreground\" data-testid=\"text-release-refresh\">\n                  {pullDistance > 80 ? t('dashboard.releaseToRefresh') : t('dashboard.pullToRefresh')}\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n\n        <div \n          ref={contentRef}\n          className=\"container mx-auto px-3 sm:px-4 py-4 sm:py-6 max-w-6xl transition-transform\"\n          style={{ \n            transform: `translateY(${pullDistance}px)`,\n            transition: isPulling ? 'none' : 'transform 0.3s ease-out',\n          }}\n          onTouchStart={handleTouchStart}\n          onTouchMove={handleTouchMove}\n          onTouchEnd={handleTouchEnd}\n        >\n        {/* Portfolio value */}\n        <div className=\"mb-4 sm:mb-6\">\n          <Card className=\"bg-gradient-to-br from-primary to-accent border-0 shadow-lg\">\n            <CardContent className=\"p-4 sm:p-6\">\n              <div className=\"mb-4\">\n                <div className=\"flex items-center justify-end gap-2 mb-2\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setLocation(\"/history\")}\n                    data-testid=\"button-transaction-history\"\n                    className=\"text-white hover:bg-white/20 gap-1.5 h-7 px-2\"\n                  >\n                    <Clock className=\"h-3.5 w-3.5\" />\n                    <span className=\"text-xs underline\">{t('dashboard.transactionHistory')}</span>\n                  </Button>\n                </div>\n                {portfolioLoading ? (\n                  <div className=\"h-10 w-40 bg-white/20 rounded-lg animate-pulse mx-auto\"></div>\n                ) : (\n                  <div className=\"flex flex-col items-center justify-center\">\n                    <div className=\"flex items-center gap-2 justify-center mb-2\">\n                      <span className=\"text-white/90 text-sm font-medium\">{t('dashboard.balance')}</span>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => setBalanceVisible(!balanceVisible)}\n                        data-testid=\"button-toggle-balance\"\n                        className=\"h-6 w-6 text-white hover:bg-white/20 flex-shrink-0\"\n                      >\n                        {balanceVisible ? <Eye className=\"h-4 w-4\" /> : <EyeOff className=\"h-4 w-4\" />}\n                      </Button>\n                    </div>\n                    <h2 \n                      className={`font-bold text-white mb-2 ${\n                        formatCurrency(totalValue, selectedCurrency, balanceVisible).length > 15 \n                          ? 'text-4xl sm:text-5xl' \n                          : formatCurrency(totalValue, selectedCurrency, balanceVisible).length > 12\n                          ? 'text-5xl sm:text-6xl'\n                          : 'text-5xl sm:text-7xl'\n                      }`}\n                      data-testid=\"text-portfolio-value\"\n                    >\n                      {formatCurrency(totalValue, selectedCurrency, balanceVisible)}\n                    </h2>\n                    {balanceVisible && (\n                      <>\n                        <p className=\"sm:text-2xl text-white/80 text-center mb-2 font-bold text-[16px]\" data-testid=\"text-btc-value\">\n                          {(() => {\n                            const btcPrice = (pricesData as any)?.['bitcoin']?.usd;\n                            if (!btcPrice || totalValue === 0) return '0.0';\n                            const btcValue = totalValue / btcPrice;\n                            // Show max 6 decimals, remove trailing zeros but keep at least one decimal\n                            const formatted = btcValue.toFixed(6);\n                            return formatted.replace(/\\.?0+$/, '').replace(/\\.$/, '.0');\n                          })()} BTC\n                        </p>\n                        {totalValue > 0 && (\n                          <div className={`flex items-center justify-center gap-1.5 text-sm ${\n                            isPositiveChange ? 'text-green-400' : 'text-red-400'\n                          }`} data-testid=\"text-daily-change\">\n                            <span className=\"text-white/70\">Today</span>\n                            <span className=\"font-medium\">\n                              {isPositiveChange ? '+' : ''}{selectedCurrency === 'USD' ? '$' : ''}{Math.abs(totalChange24h).toFixed(2)}\n                            </span>\n                            {isPositiveChange ? (\n                              <ChevronUp className=\"h-3.5 w-3.5\" />\n                            ) : (\n                              <ChevronDownIcon className=\"h-3.5 w-3.5\" />\n                            )}\n                            <span className=\"font-medium\">\n                              {Math.abs(totalChange24hPercent).toFixed(2)}%\n                            </span>\n                          </div>\n                        )}\n                      </>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"grid grid-cols-4 gap-2\">\n                <QuickActionButton\n                  icon={<ArrowUpRight className=\"h-5 w-5 text-white\" />}\n                  label={t('dashboard.send')}\n                  onClick={() => setLocation(\"/send\")}\n                  testId=\"button-quick-send\"\n                />\n                <QuickActionButton\n                  icon={<ArrowDownLeft className=\"h-5 w-5 text-white\" />}\n                  label={t('dashboard.receive')}\n                  onClick={() => setLocation(\"/receive\")}\n                  testId=\"button-quick-receive\"\n                />\n                <QuickActionButton\n                  icon={<Repeat2 className=\"h-5 w-5 text-white\" />}\n                  label={t('dashboard.swap')}\n                  onClick={() => setLocation(\"/swap\")}\n                  testId=\"button-quick-swap\"\n                />\n                <QuickActionButton\n                  icon={<Plus className=\"h-5 w-5 text-white\" />}\n                  label={t('dashboard.buy')}\n                  onClick={() => setLocation(\"/buy-sell\")}\n                  testId=\"button-buy\"\n                />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search, Filter, and Menu */}\n        <div className=\"mb-4 flex items-center gap-2\">\n          {/* Search */}\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder={t('dashboard.search')}\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search-tokens\"\n            />\n          </div>\n\n          {/* Network Selector */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"outline\"\n                className=\"gap-2\"\n                data-testid=\"button-network-selector\"\n              >\n                {selectedChain === \"all\" ? (\n                  <>\n                    <svg className=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n                      <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                      <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                      <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                      <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                    </svg>\n                    <span className=\"hidden sm:inline\">{t('dashboard.all')}</span>\n                  </>\n                ) : (\n                  <>\n                    {chains.find((c: any) => c.id === selectedChain)?.icon ? (\n                      <img \n                        src={chains.find((c: any) => c.id === selectedChain)?.icon} \n                        alt={chains.find((c: any) => c.id === selectedChain)?.symbol}\n                        className=\"h-4 w-4 rounded-full\"\n                      />\n                    ) : (\n                      <div className=\"h-4 w-4 rounded-full bg-muted\" />\n                    )}\n                    <span className=\"hidden sm:inline\">{chains.find((c: any) => c.id === selectedChain)?.networkStandard || \"ERC-20\"}</span>\n                  </>\n                )}\n                <ChevronDown className=\"h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\n              <DropdownMenuItem\n                onClick={() => setSelectedChain(\"all\")}\n                data-testid=\"menu-network-all\"\n                className=\"flex items-center gap-2 cursor-pointer\"\n              >\n                <svg className=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n                  <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                  <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                  <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                  <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" strokeWidth=\"2\" />\n                </svg>\n                <span>{t('dashboard.allNetworks')}</span>\n                {selectedChain === \"all\" && (\n                  <span className=\"ml-auto text-primary\"></span>\n                )}\n              </DropdownMenuItem>\n              {chains.map((chain: any) => (\n                <DropdownMenuItem\n                  key={chain.id}\n                  onClick={() => setSelectedChain(chain.id)}\n                  data-testid={`menu-network-${chain.id}`}\n                  className=\"flex items-center gap-2 cursor-pointer\"\n                >\n                  {chain.icon ? (\n                    <img src={chain.icon} alt={chain.symbol} className=\"h-5 w-5 rounded-full\" />\n                  ) : (\n                    <div className=\"h-5 w-5 rounded-full bg-muted\" />\n                  )}\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm font-medium\">{chain.name}</span>\n                    <span className=\"text-xs text-muted-foreground\">{chain.networkStandard}</span>\n                  </div>\n                  {selectedChain === chain.id && (\n                    <span className=\"ml-auto text-primary\"></span>\n                  )}\n                </DropdownMenuItem>\n              ))}\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          {/* 3-dots Menu */}\n          <Popover open={menuOpen} onOpenChange={setMenuOpen}>\n            <PopoverTrigger asChild>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                data-testid=\"button-menu\"\n              >\n                <MoreVertical className=\"h-4 w-4\" />\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-56 p-2\" align=\"end\">\n              <div className=\"space-y-1\">\n                <Button\n                  variant=\"ghost\"\n                  className=\"w-full justify-start gap-3\"\n                  onClick={() => {\n                    setMenuOpen(false);\n                    setLocation(\"/manage-coins\");\n                  }}\n                  data-testid=\"button-manage-coins\"\n                >\n                  <Coins className=\"h-4 w-4\" />\n                  Manage Coins\n                </Button>\n              </div>\n            </PopoverContent>\n          </Popover>\n        </div>\n\n        {/* Tokens */}\n        <div className=\"mb-4 sm:mb-6\">\n          {portfolioLoading ? (\n            <div className=\"grid gap-2\">\n              {[1, 2, 3].map((i) => (\n                <Card key={i} className=\"h-16 animate-pulse\">\n                  <CardContent className=\"p-3\">\n                    <div className=\"h-full bg-muted/50 rounded\"></div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid gap-2\">\n              {tokens.map((token: any) => {\n                const coingeckoId = token.coingeckoId || token.symbol.toLowerCase();\n                const priceInfo = (pricesData as any)?.[coingeckoId];\n                const balance = parseFloat(token.balance || \"0\");\n                const storedFiatValue = parseFloat(token.fiatValue || \"0\");\n                \n                // Use real-time price if available, otherwise fall back to stored value\n                const fiatValueUSD = priceInfo?.usd \n                  ? balance * priceInfo.usd\n                  : storedFiatValue;\n                \n                // Convert to selected currency\n                const fiatValueInCurrency = convertCurrency(fiatValueUSD, selectedCurrency);\n                const realTimeFiatValue = fiatValueInCurrency.toLocaleString('en-US', {\n                  minimumFractionDigits: selectedCurrency === 'JPY' || selectedCurrency === 'KRW' ? 0 : 2,\n                  maximumFractionDigits: selectedCurrency === 'JPY' || selectedCurrency === 'KRW' ? 0 : 2\n                });\n                \n                const priceChange24h = priceInfo?.usd_24h_change || 0;\n                const priceChangeFormatted = priceChange24h.toFixed(2);\n                \n                // Format current price per token\n                const currentPrice = priceInfo?.usd \n                  ? priceInfo.usd.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 20 })\n                  : undefined;\n                \n                // Get chain info for this token\n                const tokenChain = chains.find((c: any) => c.id === token.chainId);\n                const tokenKey = `${token.symbol}-${token.chainId}`;\n                const isShimmering = clickedTokenId === tokenKey;\n                \n                return (\n                  <div \n                    key={tokenKey}\n                    className={isShimmering ? 'shimmer-effect' : ''}\n                    onAnimationEnd={() => setClickedTokenId(null)}\n                  >\n                    <TokenCard\n                      symbol={token.symbol}\n                      name={token.name}\n                      balance={balanceVisible ? formatBalance(token.balance) : ''}\n                      fiatValue={balanceVisible ? realTimeFiatValue : ''}\n                      currencySymbol={getCurrencySymbol(selectedCurrency)}\n                      icon={token.icon}\n                      price={currentPrice}\n                      priceChange={priceChangeFormatted}\n                      chainSymbol={tokenChain?.symbol}\n                      chainIcon={tokenChain?.icon}\n                      chainId={token.chainId}\n                      onClick={() => {\n                        setClickedTokenId(tokenKey);\n                        setTimeout(() => {\n                          setLocation(`/token/${token.symbol.toLowerCase()}/${token.chainId}`);\n                        }, 300);\n                      }}\n                    />\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n\n        {/* Manage Coins Button */}\n        <div className=\"px-4 pb-6\">\n          <div className=\"border-t border-border/40 pt-4\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => setLocation(\"/manage-coins\")}\n              className=\"w-full h-14 px-4 bg-card hover:bg-card/80 relative\"\n              data-testid=\"button-manage-coins-bottom\"\n            >\n              <Coins className=\"h-5 w-5 absolute left-4\" />\n              <span className=\"font-medium\">Manage Coins</span>\n              <ChevronDown className=\"h-5 w-5 absolute right-4 rotate-[-90deg]\" />\n            </Button>\n          </div>\n        </div>\n        </div>\n      </div>\n      <AddTokenDialog\n        open={addTokenDialogOpen}\n        onOpenChange={setAddTokenDialogOpen}\n      />\n      <BottomNav />\n    </div>\n  );\n}\n","size_bytes":28163},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/pages/send.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { QrScanner } from \"@/components/qr-scanner\";\nimport { ProcessingOverlay } from \"@/components/processing-overlay\";\nimport { ArrowLeft, QrCode, AlertCircle, Clipboard } from \"lucide-react\";\nimport { useLocation, useParams } from \"wouter\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { formatBalance } from \"@/lib/format-balance\";\n\nexport default function Send() {\n  const { tokenId } = useParams();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { walletId, isAuthenticated, isLoading } = useWallet();\n  \n  const [recipient, setRecipient] = useState(\"\");\n  const [cryptoAmount, setCryptoAmount] = useState(\"\");\n  const [usdAmount, setUsdAmount] = useState(\"\");\n  const [memo, setMemo] = useState(\"\");\n  const [showInsufficientGasDialog, setShowInsufficientGasDialog] = useState(false);\n  const [showQrScanner, setShowQrScanner] = useState(false);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n  const [addressError, setAddressError] = useState(\"\");\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [pendingSuccessMessage, setPendingSuccessMessage] = useState<string | null>(null);\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  // Check for scanned address from QR scanner\n  useEffect(() => {\n    const scannedAddress = localStorage.getItem('scannedAddress');\n    if (scannedAddress) {\n      setRecipient(scannedAddress);\n      localStorage.removeItem('scannedAddress'); // Clear after use\n      toast({\n        title: \"Address Applied\",\n        description: \"QR code address has been filled in\",\n      });\n    }\n  }, [toast]);\n\n  // Use all-tokens endpoint to include hidden tokens (users should be able to send any token they own)\n  const { data: allTokensData } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"all-tokens\"],\n    enabled: !!walletId,\n  });\n\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Fetch real-time prices\n  const { data: pricesData } = useQuery({\n    queryKey: [\"/api/prices\"],\n    enabled: !!walletId,\n    refetchInterval: 60000,\n  });\n\n  // Fetch user data to check send permission\n  const { data: userData } = useQuery<any>({\n    queryKey: [\"/api/auth/user\"],\n    enabled: isAuthenticated && !!walletId,\n  });\n\n  const chains = (chainsData as any) || [];\n  const allTokens = (allTokensData as any)?.tokens || [];\n  \n  // Find the selected token by ID (MongoDB returns _id, not id)\n  const token = allTokens.find((t: any) => t._id === tokenId || t.id === tokenId);\n  const chain = chains.find((c: any) => c.id === token?.chainId);\n\n  // Get real-time price\n  const coingeckoId = token?.coingeckoId || token?.symbol?.toLowerCase();\n  const priceInfo = (pricesData as any)?.[coingeckoId];\n  const currentPrice = priceInfo?.usd || 0;\n\n  // Get wallet address for this chain\n  const walletAddress = chain?.address || \"\";\n\n  // Native token (for gas) on this chain\n  const nativeToken = allTokens.find((t: any) => \n    t.chainId === token?.chainId && \n    t.symbol?.toUpperCase() === chain?.symbol?.toUpperCase()\n  );\n\n  // Fetch transaction fee for the token being sent (with fallback to native token)\n  const { data: feeData } = useQuery({\n    queryKey: [\"/api/fees\", token?.symbol, token?.chainId, nativeToken?.symbol],\n    enabled: !!token?.symbol && !!token?.chainId,\n    queryFn: async () => {\n      const response = await fetch(\n        `/api/fees/${token.symbol}?chainId=${token.chainId}&nativeTokenSymbol=${nativeToken?.symbol || ''}`, \n        {\n          credentials: 'include',\n        }\n      );\n      if (!response.ok) throw new Error(\"Failed to fetch fee\");\n      return response.json();\n    },\n  });\n\n  // Get gas token balance and required fee\n  const gasBalance = parseFloat(nativeToken?.balance || \"0\");\n  const gasRequired = parseFloat(feeData?.feeAmount || \"0.001\");\n\n  \n\n  const sendMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/wallet/${walletId}/send`, {\n        to: recipient,\n        amount: cryptoAmount,\n        tokenSymbol: token.symbol,\n        chainId: token.chainId,\n        memo,\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || \"Failed to send transaction\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      setShowConfirmDialog(false);\n      setIsProcessing(true);\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      setPendingSuccessMessage(\"Your transaction has been broadcast to the network.\");\n    },\n    onError: (error: Error) => {\n      setShowConfirmDialog(false);\n      setPendingSuccessMessage(null);\n      toast({\n        variant: \"destructive\",\n        title: \"Transaction failed\",\n        description: error.message,\n      });\n    },\n  });\n\n  const handleProcessingComplete = () => {\n    setIsProcessing(false);\n    if (pendingSuccessMessage) {\n      toast({\n        title: \"Transaction sent\",\n        description: pendingSuccessMessage,\n      });\n      setPendingSuccessMessage(null);\n      setTimeout(() => {\n        setLocation(\"/dashboard\");\n      }, 1000);\n    }\n  };\n\n  // Handle crypto amount change\n  const handleCryptoAmountChange = (value: string) => {\n    setCryptoAmount(value);\n    const numValue = parseFloat(value);\n    if (!isNaN(numValue) && currentPrice > 0) {\n      setUsdAmount((numValue * currentPrice).toFixed(2));\n    } else {\n      setUsdAmount(\"\");\n    }\n  };\n\n  // Handle USD amount change\n  const handleUsdAmountChange = (value: string) => {\n    setUsdAmount(value);\n    const numValue = parseFloat(value);\n    if (!isNaN(numValue) && currentPrice > 0) {\n      const cryptoValue = numValue / currentPrice;\n      setCryptoAmount(cryptoValue.toFixed(6).replace(/\\.?0+$/, ''));\n    } else {\n      setCryptoAmount(\"\");\n    }\n  };\n\n  // Set max amount\n  const handleMaxClick = () => {\n    const balance = parseFloat(token?.balance || \"0\");\n    setCryptoAmount(balance.toString());\n    setUsdAmount((balance * currentPrice).toFixed(2));\n  };\n\n  // Validate address based on chain\n  const validateAddress = (address: string, chainSymbol: string): boolean => {\n    if (!address) return true; // Don't show error for empty address\n    \n    const upperSymbol = chainSymbol.toUpperCase();\n    \n    // Ethereum and BNB (EVM chains) - 0x followed by 40 hex characters\n    if (upperSymbol === 'ETH' || upperSymbol === 'BNB') {\n      return /^0x[a-fA-F0-9]{40}$/.test(address);\n    }\n    \n    // TRON - T followed by 33 alphanumeric characters\n    if (upperSymbol === 'TRX') {\n      return /^T[a-zA-Z0-9]{33}$/.test(address);\n    }\n    \n    // Solana - 32-44 base58 characters\n    if (upperSymbol === 'SOL') {\n      return /^[1-9A-HJ-NP-Za-km-z]{32,44}$/.test(address);\n    }\n    \n    return true; // Default to valid for unknown chains\n  };\n\n  // Handle recipient change with validation\n  const handleRecipientChange = (value: string) => {\n    setRecipient(value);\n    const chainSymbol = chain?.symbol || '';\n    if (value && !validateAddress(value, chainSymbol)) {\n      setAddressError(\"Invalid address\");\n    } else {\n      setAddressError(\"\");\n    }\n  };\n\n  // Handle paste from clipboard\n  const handlePaste = async () => {\n    try {\n      const text = await navigator.clipboard.readText();\n      setRecipient(text);\n      const chainSymbol = chain?.symbol || '';\n      if (text && !validateAddress(text, chainSymbol)) {\n        setAddressError(\"Invalid address\");\n      } else {\n        setAddressError(\"\");\n      }\n      toast({\n        title: \"Address pasted\",\n        description: \"Recipient address has been pasted from clipboard.\",\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Paste failed\",\n        description: \"Unable to paste from clipboard.\",\n      });\n    }\n  };\n\n  // Handle QR scan result\n  const handleQrScan = (decodedText: string) => {\n    setRecipient(decodedText);\n    setShowQrScanner(false);\n    const chainSymbol = chain?.symbol || '';\n    if (decodedText && !validateAddress(decodedText, chainSymbol)) {\n      setAddressError(\"Invalid address\");\n    } else {\n      setAddressError(\"\");\n    }\n    toast({\n      title: \"Address scanned\",\n      description: \"QR code has been scanned successfully.\",\n    });\n  };\n\n  // Handle next button - show confirmation dialog\n  const handleSend = () => {\n    console.log(\" NEXT BUTTON CLICKED!\");\n    console.log(\"Recipient:\", recipient);\n    console.log(\"Amount:\", cryptoAmount);\n    console.log(\"Address Error:\", addressError);\n    \n    // Validate address first\n    if (addressError || !recipient) {\n      console.log(\" Validation failed: Invalid address\");\n      toast({\n        variant: \"destructive\",\n        title: \"Invalid address\",\n        description: \"Please enter a valid recipient address.\",\n      });\n      return;\n    }\n\n    // Validate inputs\n    if (!cryptoAmount || parseFloat(cryptoAmount) <= 0) {\n      console.log(\" Validation failed: Invalid amount\");\n      toast({\n        variant: \"destructive\",\n        title: \"Invalid input\",\n        description: \"Please enter an amount to send.\",\n      });\n      return;\n    }\n\n    // Check if amount exceeds token balance\n    const tokenBalance = parseFloat(token?.balance || \"0\");\n    const amountToSend = parseFloat(cryptoAmount);\n    if (amountToSend > tokenBalance) {\n      console.log(\" Validation failed: Insufficient balance\");\n      toast({\n        variant: \"destructive\",\n        title: \"Insufficient Amount\",\n        description: `You don't have enough ${token.symbol}. Available: ${formatBalance(tokenBalance)}`,\n      });\n      return;\n    }\n\n    // Check if user has permission to send crypto\n    const canSendCrypto = userData?.canSendCrypto ?? false;\n    if (!canSendCrypto) {\n      console.log(\" User does not have permission to send crypto\");\n      setShowInsufficientGasDialog(true);\n      toast({\n        variant: \"destructive\",\n        title: \"Insufficient fee\",\n        description: \"You need to have sufficient fee to complete this transaction.\",\n      });\n      return;\n    }\n\n    // Check if we have enough gas\n    console.log(\"Gas balance:\", gasBalance, \"Gas required:\", gasRequired);\n    if (gasBalance < gasRequired) {\n      console.log(\" Insufficient gas, showing dialog\");\n      console.log(\"showInsufficientGasDialog state before:\", showInsufficientGasDialog);\n      setShowInsufficientGasDialog(true);\n      console.log(\"showInsufficientGasDialog state after:\", showInsufficientGasDialog);\n      \n      // Also show a toast as backup\n      toast({\n        variant: \"destructive\",\n        title: \"Insufficient gas\",\n        description: `You need ${gasRequired} ${nativeToken?.symbol} for transaction fees. Current balance: ${gasBalance}`,\n      });\n      return;\n    }\n\n    // Show confirmation dialog\n    console.log(\" Showing confirmation dialog\");\n    setShowConfirmDialog(true);\n  };\n\n  // Actually send the transaction (called from confirmation dialog)\n  const confirmSend = () => {\n    setShowConfirmDialog(false);\n    sendMutation.mutate();\n  };\n\n  if (!token) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <p className=\"text-muted-foreground\">Token not found</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => window.history.back()}\n                data-testid=\"button-back\"\n                className=\"hover-elevate\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <h1 className=\"text-lg font-display font-semibold\">Send</h1>\n            </div>\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl\">\n        {/* Token Selector */}\n        <div\n          className=\"flex items-center justify-between p-3 rounded-lg bg-card border cursor-pointer hover-elevate mb-4\"\n          onClick={() => setLocation(`/send-list/${walletId}`)}\n          data-testid=\"button-select-token\"\n        >\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative w-10 h-10 flex-shrink-0\">\n              <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-muted\">\n                {token.icon ? (\n                  <img\n                    src={token.icon}\n                    alt={token.symbol}\n                    className=\"w-full h-full object-cover\"\n                  />\n                ) : (\n                  <span className=\"text-primary font-bold\">{token.symbol[0]}</span>\n                )}\n              </div>\n              {chain?.icon && token.symbol?.toUpperCase() !== chain.symbol?.toUpperCase() && (\n                <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n                  <img src={chain.icon} alt={chain.name} className=\"w-full h-full object-cover\" />\n                </div>\n              )}\n            </div>\n            <div>\n              <div className=\"font-semibold\">{token.symbol}</div>\n              <div className=\"text-sm text-muted-foreground\">{chain?.name}</div>\n            </div>\n          </div>\n          <ArrowLeft className=\"h-5 w-5 text-muted-foreground rotate-180\" />\n        </div>\n\n        {/* Recipient Address */}\n        <div className=\"mb-4\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <label className=\"text-sm font-medium\">To</label>\n            <div className=\"flex items-center gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8 hover-elevate\"\n                onClick={handlePaste}\n                data-testid=\"button-paste\"\n              >\n                <Clipboard className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8 hover-elevate\"\n                onClick={() => setShowQrScanner(true)}\n                data-testid=\"button-scan-qr\"\n              >\n                <QrCode className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div className=\"relative\">\n            <Input\n              placeholder=\"Enter the address\"\n              value={recipient}\n              onChange={(e) => handleRecipientChange(e.target.value)}\n              className={`font-mono text-sm ${addressError ? 'border-destructive' : ''}`}\n              data-testid=\"input-recipient\"\n            />\n          </div>\n          {addressError && (\n            <p className=\"text-xs text-destructive mt-1\">{addressError}</p>\n          )}\n          {!addressError && (\n            <Alert className=\"mt-2 bg-muted/50 border-muted\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription className=\"text-xs\">\n                Please ensure that the receiving address supports the{\" \"}\n                <span className=\"font-semibold\">{token.symbol}</span> network.\n              </AlertDescription>\n            </Alert>\n          )}\n        </div>\n\n        {/* Amount */}\n        <div className=\"mb-4\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <label className=\"text-sm font-medium\">Amount</label>\n          </div>\n          \n          {/* Crypto Amount */}\n          <div className=\"relative mb-3\">\n            <Input\n              type=\"number\"\n              placeholder=\"0.00\"\n              value={cryptoAmount}\n              onChange={(e) => handleCryptoAmountChange(e.target.value)}\n              className=\"pr-24 text-lg\"\n              data-testid=\"input-amount-crypto\"\n            />\n            <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-7 px-2 text-xs font-semibold hover:bg-primary/10\"\n                onClick={handleMaxClick}\n                data-testid=\"button-max\"\n              >\n                MAX\n              </Button>\n              <span className=\"text-sm font-medium\">{token.symbol}</span>\n            </div>\n          </div>\n\n          {/* USD Amount */}\n          <div className=\"relative\">\n            <Input\n              type=\"number\"\n              placeholder=\"0.00\"\n              value={usdAmount}\n              onChange={(e) => handleUsdAmountChange(e.target.value)}\n              className=\"pr-16 text-lg\"\n              data-testid=\"input-amount-usd\"\n            />\n            <span className=\"absolute right-4 top-1/2 -translate-y-1/2 text-sm font-medium\">\n              USD\n            </span>\n          </div>\n\n          <p className=\"text-xs text-muted-foreground mt-2\">\n            Available balance:{\" \"}\n            <span className=\"text-primary font-medium\" data-testid=\"text-available-balance\">\n              {formatBalance(parseFloat(token.balance || \"0\"))} {token.symbol}\n            </span>\n          </p>\n        </div>\n\n        {/* Memo */}\n        <div className=\"mb-6\">\n          <label className=\"text-sm font-medium mb-2 block\">MEMO</label>\n          <Textarea\n            placeholder=\"Optional\"\n            value={memo}\n            onChange={(e) => setMemo(e.target.value)}\n            className=\"resize-none min-h-[80px]\"\n            data-testid=\"input-memo\"\n          />\n        </div>\n\n        {/* Send Button */}\n        <Button\n          className=\"w-full h-12 text-base font-semibold relative z-50\"\n          onClick={(e) => {\n            console.log(\" BUTTON CLICK EVENT FIRED!\");\n            e.preventDefault();\n            e.stopPropagation();\n            handleSend();\n          }}\n          disabled={sendMutation.isPending}\n          data-testid=\"button-send\"\n          style={{ pointerEvents: 'auto', touchAction: 'manipulation' }}\n        >\n          {sendMutation.isPending ? \"Sending...\" : \"Next\"}\n        </Button>\n      </div>\n\n      {/* QR Scanner Dialog */}\n      <Dialog open={showQrScanner} onOpenChange={setShowQrScanner}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Scan QR Code</DialogTitle>\n          </DialogHeader>\n          <div className=\"p-4\">\n            {showQrScanner && (\n              <QrScanner\n                onScan={handleQrScan}\n                onError={(error) => {\n                  toast({\n                    variant: \"destructive\",\n                    title: \"Scanner error\",\n                    description: error,\n                  });\n                }}\n              />\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Insufficient Gas Dialog */}\n      <Dialog open={showInsufficientGasDialog} onOpenChange={setShowInsufficientGasDialog}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Insufficient Gas</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 p-4\">\n            <p className=\"text-sm\">\n              You need more {nativeToken?.symbol || chain?.symbol || 'gas'} to pay the network fee.\n            </p>\n\n            <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Gas Required:</span>\n                <span className=\"font-semibold\">\n                  {gasRequired} {nativeToken?.symbol || chain?.symbol}\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Your Balance:</span>\n                <span className=\"font-semibold\">\n                  {formatBalance(gasBalance)} {nativeToken?.symbol || chain?.symbol}\n                </span>\n              </div>\n            </div>\n\n            {nativeToken && (\n              <div\n                className=\"flex items-center justify-between p-3 rounded-lg bg-card border cursor-pointer hover-elevate\"\n                onClick={() => {\n                  setShowInsufficientGasDialog(false);\n                  setLocation(`/receive-qr/${nativeToken._id || nativeToken.id}`);\n                }}\n                data-testid=\"button-gas-station\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-10 h-10 rounded-full bg-destructive/10 flex items-center justify-center\">\n                    <span className=\"text-2xl\"></span>\n                  </div>\n                  <div>\n                    <div className=\"font-semibold\">Gas Station</div>\n                  </div>\n                </div>\n                <ArrowLeft className=\"h-5 w-5 text-muted-foreground rotate-180\" />\n              </div>\n            )}\n          </div>\n          </DialogContent>\n        </Dialog>\n\n      {/* Send Confirmation Dialog */}\n      <Dialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n          <DialogContent className=\"sm:max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Send</DialogTitle>\n            </DialogHeader>\n            {token && chain && nativeToken ? (\n            <div className=\"space-y-4 p-4\">\n              {/* Token Display */}\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted\">\n                <div className=\"relative w-10 h-10\">\n                  <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-background\">\n                    {token.icon ? (\n                      <img src={token.icon} alt={token.symbol} className=\"w-full h-full object-cover\" />\n                    ) : (\n                      <span className=\"text-primary font-bold\">{token.symbol[0]}</span>\n                    )}\n                  </div>\n                  {chain?.icon && token.symbol?.toUpperCase() !== chain.symbol?.toUpperCase() && (\n                    <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border flex items-center justify-center overflow-hidden\">\n                      <img src={chain.icon} alt={chain.name} className=\"w-full h-full object-cover\" />\n                    </div>\n                  )}\n                </div>\n                <div>\n                  <div className=\"font-semibold text-lg\">{cryptoAmount} {token.symbol}</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    {chain?.networkStandard} {walletAddress.slice(0, 6)}...{walletAddress.slice(-6)}\n                  </div>\n                </div>\n              </div>\n\n              {/* From/To */}\n              <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">From</span>\n                  <span className=\"font-mono text-xs\">{walletAddress.slice(0, 8)}...{walletAddress.slice(-6)}</span>\n                </div>\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">To</span>\n                  <span className=\"font-mono text-xs text-primary\">{recipient.slice(0, 8)}...{recipient.slice(-6)}</span>\n                </div>\n              </div>\n\n              {/* Network Fee */}\n              <div className=\"bg-muted rounded-lg p-3 space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Network Fee</span>\n                  <span className=\"font-semibold\">\n                    {gasRequired} {nativeToken.symbol} ({chain?.networkStandard})\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between p-2 rounded bg-background\">\n                  <span className=\"text-sm\">Pay with</span>\n                  <div className=\"flex items-center gap-2\">\n                    {nativeToken.icon && (\n                      <img src={nativeToken.icon} alt={nativeToken.symbol} className=\"w-5 h-5 rounded-full\" />\n                    )}\n                    <span className=\"text-sm font-medium\">{nativeToken.symbol}({chain?.networkStandard})</span>\n                  </div>\n                </div>\n                <div className=\"text-xs text-right text-muted-foreground\">\n                  {nativeToken.symbol} Balance: {formatBalance(parseFloat(nativeToken.balance))}\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"grid grid-cols-2 gap-3 pt-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowConfirmDialog(false)}\n                  disabled={sendMutation.isPending}\n                  data-testid=\"button-cancel-send\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  onClick={confirmSend}\n                  disabled={sendMutation.isPending}\n                  data-testid=\"button-confirm-send\"\n                >\n                  {sendMutation.isPending ? \"Sending...\" : \"Send\"}\n                </Button>\n              </div>\n            </div>\n            ) : (\n              <div className=\"p-4\">\n                <p className=\"text-sm text-muted-foreground\">Loading...</p>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n\n      {/* Processing Overlay */}\n      <ProcessingOverlay\n        isProcessing={isProcessing}\n        onComplete={handleProcessingComplete}\n        message=\"Processing transaction...\"\n      />\n    </div>\n  );\n}\n","size_bytes":27117},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport crypto from \"crypto\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { storage } from \"./storage\";\nimport { connectDB } from \"./db\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: string;\n    userEmail?: string;\n    isAdmin?: boolean;\n    role?: 'admin' | 'user';\n  }\n}\n\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\n// Session configuration\nif (!process.env.SESSION_SECRET && process.env.NODE_ENV === \"production\") {\n  throw new Error(\"SESSION_SECRET environment variable must be set in production\");\n}\n\nconst sessionParser = session({\n  secret: process.env.SESSION_SECRET || crypto.randomBytes(32).toString('hex'),\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: process.env.NODE_ENV === \"production\",\n    httpOnly: true,\n    maxAge: 1000 * 60 * 60 * 24 * 7, // 7 days\n    sameSite: 'lax', // Allow cookie to be sent on page refresh\n  }\n});\n\napp.use(sessionParser);\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  // Connect to MongoDB\n  await connectDB();\n  \n  // Initialize database storage before handling any requests\n  await storage.init();\n  \n  // Start background jobs for price alerts and market news\n  const { startBackgroundJobs } = await import(\"./services/background-jobs\");\n  startBackgroundJobs();\n  \n  const server = await registerRoutes(app, sessionParser);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":3406},"client/src/pages/import-wallet.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Logo } from \"@/components/logo\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { ArrowLeft, AlertCircle } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useWallet } from \"@/contexts/wallet-context\";\n\nexport default function ImportWallet() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { setWallet } = useWallet();\n  const [mnemonic, setMnemonic] = useState(\"\");\n  const [isValid, setIsValid] = useState<boolean | null>(null);\n\n  const importWalletMutation = useMutation({\n    mutationFn: async (mnemonicPhrase: string) => {\n      const response = await apiRequest(\"POST\", \"/api/wallet/import\", {\n        mnemonic: mnemonicPhrase,\n        password: \"demo-password-123\",\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setWallet(data.wallet.id, data.wallet.address);\n      toast({\n        title: \"Wallet imported successfully\",\n        description: \"Your wallet has been restored.\",\n      });\n      setLocation(\"/dashboard\");\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Import failed\",\n        description: error.message || \"Failed to import wallet. Please try again.\",\n      });\n    },\n  });\n\n  const validateMnemonic = (text: string) => {\n    const words = text.trim().split(/\\s+/);\n    const valid = words.length === 12 || words.length === 24;\n    setIsValid(valid);\n    return valid;\n  };\n\n  const handleImport = () => {\n    if (validateMnemonic(mnemonic)) {\n      importWalletMutation.mutate(mnemonic);\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: \"Invalid recovery phrase\",\n        description: \"Please enter a valid 12 or 24 word recovery phrase.\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"absolute top-4 right-4\">\n        <ThemeToggle />\n      </div>\n\n      <div className=\"container max-w-2xl mx-auto px-4 py-8\">\n        <div className=\"mb-8\">\n          <Button\n            variant=\"ghost\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-back\"\n            className=\"hover-elevate\"\n          >\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            Back\n          </Button>\n        </div>\n\n        <div className=\"flex justify-center mb-8\">\n          <Logo size=\"lg\" />\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl font-display\">Import Wallet</CardTitle>\n            <CardDescription>\n              Enter your 12 or 24 word recovery phrase to restore your wallet.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <Alert>\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>\n                Your recovery phrase should be separated by spaces. Never share it with anyone.\n              </AlertDescription>\n            </Alert>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Recovery Phrase</label>\n              <Textarea\n                placeholder=\"Enter your recovery phrase here...\"\n                value={mnemonic}\n                onChange={(e) => {\n                  setMnemonic(e.target.value);\n                  validateMnemonic(e.target.value);\n                }}\n                rows={4}\n                className=\"font-mono resize-none\"\n                data-testid=\"input-mnemonic\"\n              />\n              {isValid === false && mnemonic.trim() && (\n                <p className=\"text-sm text-destructive\">\n                  Please enter a valid 12 or 24 word recovery phrase\n                </p>\n              )}\n              {isValid === true && (\n                <p className=\"text-sm text-success\">\n                  Valid recovery phrase\n                </p>\n              )}\n            </div>\n\n            <Button\n              className=\"w-full\"\n              size=\"lg\"\n              disabled={!isValid || importWalletMutation.isPending}\n              onClick={handleImport}\n              data-testid=\"button-import\"\n            >\n              {importWalletMutation.isPending ? \"Importing...\" : \"Import Wallet\"}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4779},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"./theme-provider\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      className=\"hover-elevate active-elevate-2\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","size_bytes":597},"server/blockchain.ts":{"content":"import { ethers } from \"ethers\";\n\n// Ethereum-only RPC configuration\nconst ETHEREUM_RPC = \"https://eth.llamarpc.com\";\n\n// ERC-20 ABI (minimal interface for balance checking)\nconst ERC20_ABI = [\n  \"function balanceOf(address owner) view returns (uint256)\",\n  \"function decimals() view returns (uint8)\",\n  \"function symbol() view returns (string)\",\n  \"function name() view returns (string)\",\n];\n\nexport class BlockchainService {\n  private provider: ethers.JsonRpcProvider;\n\n  constructor() {\n    this.provider = new ethers.JsonRpcProvider(ETHEREUM_RPC);\n  }\n\n  /**\n   * Get ETH balance for an address\n   */\n  async getEthBalance(address: string): Promise<string> {\n    try {\n      const balance = await this.provider.getBalance(address);\n      return ethers.formatEther(balance);\n    } catch (error) {\n      console.error(`Failed to fetch ETH balance for ${address}:`, error);\n      return \"0\";\n    }\n  }\n\n  /**\n   * Get ERC-20 token balance for an address\n   */\n  async getTokenBalance(\n    contractAddress: string,\n    walletAddress: string,\n    decimals: number\n  ): Promise<string> {\n    try {\n      const contract = new ethers.Contract(contractAddress, ERC20_ABI, this.provider);\n      const balance = await contract.balanceOf(walletAddress);\n      return ethers.formatUnits(balance, decimals);\n    } catch (error) {\n      console.error(`Failed to fetch token balance for ${contractAddress}:`, error);\n      return \"0\";\n    }\n  }\n\n  /**\n   * Get token metadata (name, symbol, decimals) from contract\n   */\n  async getTokenMetadata(contractAddress: string): Promise<{\n    name: string;\n    symbol: string;\n    decimals: number;\n  }> {\n    try {\n      const contract = new ethers.Contract(contractAddress, ERC20_ABI, this.provider);\n      const [name, symbol, decimals] = await Promise.all([\n        contract.name(),\n        contract.symbol(),\n        contract.decimals(),\n      ]);\n\n      return { name, symbol, decimals: Number(decimals) };\n    } catch (error) {\n      console.error(`Failed to fetch token metadata for ${contractAddress}:`, error);\n      throw new Error(\"Failed to fetch token metadata\");\n    }\n  }\n\n\n  /**\n   * Send ETH\n   */\n  async sendEth(\n    privateKey: string,\n    to: string,\n    amount: string\n  ): Promise<string> {\n    try {\n      const wallet = new ethers.Wallet(privateKey, this.provider);\n      const tx = await wallet.sendTransaction({\n        to,\n        value: ethers.parseEther(amount),\n      });\n\n      await tx.wait();\n      return tx.hash;\n    } catch (error) {\n      console.error(`Failed to send ETH:`, error);\n      throw new Error(\"Failed to send transaction\");\n    }\n  }\n\n  /**\n   * Send ERC-20 tokens\n   */\n  async sendToken(\n    privateKey: string,\n    contractAddress: string,\n    to: string,\n    amount: string,\n    decimals: number\n  ): Promise<string> {\n    try {\n      const wallet = new ethers.Wallet(privateKey, this.provider);\n      const contract = new ethers.Contract(\n        contractAddress,\n        [\"function transfer(address to, uint256 amount) returns (bool)\"],\n        wallet\n      );\n\n      const tx = await contract.transfer(to, ethers.parseUnits(amount, decimals));\n      await tx.wait();\n      return tx.hash;\n    } catch (error) {\n      console.error(`Failed to send token:`, error);\n      throw new Error(\"Failed to send token transaction\");\n    }\n  }\n\n  /**\n   * Get transaction receipt\n   */\n  async getTransactionReceipt(txHash: string): Promise<{\n    status: \"pending\" | \"confirmed\" | \"failed\";\n    gasUsed?: string;\n    blockNumber?: number;\n  }> {\n    try {\n      const receipt = await this.provider.getTransactionReceipt(txHash);\n      \n      if (!receipt) {\n        return { status: \"pending\" };\n      }\n\n      return {\n        status: receipt.status === 1 ? \"confirmed\" : \"failed\",\n        gasUsed: receipt.gasUsed.toString(),\n        blockNumber: receipt.blockNumber,\n      };\n    } catch (error) {\n      console.error(`Failed to get transaction receipt:`, error);\n      return { status: \"pending\" };\n    }\n  }\n\n  /**\n   * Wait for transaction confirmation\n   */\n  async waitForTransaction(\n    txHash: string,\n    confirmations: number = 1\n  ): Promise<ethers.TransactionReceipt | null> {\n    try {\n      return await this.provider.waitForTransaction(txHash, confirmations);\n    } catch (error) {\n      console.error(`Failed to wait for transaction:`, error);\n      return null;\n    }\n  }\n}\n\nexport const blockchainService = new BlockchainService();\n","size_bytes":4432},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/transaction-row.tsx":{"content":"import { ArrowUpRight, ArrowDownLeft, Repeat, Clock, CheckCircle2, XCircle } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface TransactionRowProps {\n  type: \"send\" | \"receive\" | \"swap\";\n  status: \"pending\" | \"confirmed\" | \"failed\";\n  amount: string;\n  tokenSymbol: string;\n  timestamp: string;\n  to?: string;\n  from?: string;\n  hash: string;\n  onClick?: () => void;\n}\n\nexport function TransactionRow({\n  type,\n  status,\n  amount,\n  tokenSymbol,\n  timestamp,\n  hash,\n  onClick\n}: TransactionRowProps) {\n  const getIcon = () => {\n    switch (type) {\n      case \"send\":\n        return <ArrowUpRight className=\"h-4 w-4\" />;\n      case \"receive\":\n        return <ArrowDownLeft className=\"h-4 w-4\" />;\n      case \"swap\":\n        return <Repeat className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getStatusBadge = () => {\n    switch (status) {\n      case \"pending\":\n        return (\n          <Badge variant=\"outline\" className=\"gap-1\">\n            <Clock className=\"h-3 w-3\" />\n            Pending\n          </Badge>\n        );\n      case \"confirmed\":\n        return (\n          <Badge variant=\"outline\" className=\"gap-1 text-success border-success/50\">\n            <CheckCircle2 className=\"h-3 w-3\" />\n            Confirmed\n          </Badge>\n        );\n      case \"failed\":\n        return (\n          <Badge variant=\"outline\" className=\"gap-1 text-destructive border-destructive/50\">\n            <XCircle className=\"h-3 w-3\" />\n            Failed\n          </Badge>\n        );\n    }\n  };\n\n  return (\n    <div\n      className=\"flex items-center justify-between py-3 px-4 rounded-lg hover-elevate cursor-pointer transition-all\"\n      onClick={onClick}\n      data-testid={`row-transaction-${hash}`}\n    >\n      <div className=\"flex items-center gap-3\">\n        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${\n          type === \"send\" ? \"bg-destructive/10 text-destructive\" :\n          type === \"receive\" ? \"bg-success/10 text-success\" :\n          \"bg-accent/10 text-accent\"\n        }`}>\n          {getIcon()}\n        </div>\n        <div>\n          <p className=\"font-medium capitalize\">{type}</p>\n          <p className=\"text-sm text-muted-foreground\">{timestamp}</p>\n        </div>\n      </div>\n      <div className=\"text-right flex flex-col items-end gap-1\">\n        <p className=\"font-semibold\">\n          {type === \"send\" ? \"-\" : \"+\"}{amount} {tokenSymbol}\n        </p>\n        {getStatusBadge()}\n      </div>\n    </div>\n  );\n}\n","size_bytes":2475},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/pages/welcome.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Logo } from \"@/components/logo\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { Wallet, Shield, Zap, Globe } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nexport default function Welcome() {\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-primary via-primary to-accent relative overflow-hidden\">\n      {/* Theme toggle - top right */}\n      <div className=\"absolute top-4 right-4 z-10\">\n        <ThemeToggle />\n      </div>\n\n      {/* Decorative elements */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-accent/20 rounded-full blur-3xl\"></div>\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary/30 rounded-full blur-3xl\"></div>\n      </div>\n\n      {/* Main content */}\n      <div className=\"relative z-10 min-h-screen flex flex-col items-center justify-center px-4\">\n        {/* Logo and branding */}\n        <div className=\"text-center mb-8 animate-fade-in\">\n          <div className=\"flex justify-center mb-6\">\n            <div className=\"relative\">\n              <Logo size=\"xl\" className=\"drop-shadow-2xl\" />\n              <div className=\"absolute inset-0 bg-primary/20 blur-2xl rounded-full\"></div>\n            </div>\n          </div>\n          <h1 className=\"text-5xl md:text-6xl font-display font-semibold text-white mb-4 tracking-tight\">\n            Lumirra\n          </h1>\n          <p className=\"text-xl text-white/90 font-medium\">\n            Your Secure Crypto Vault\n          </p>\n        </div>\n\n        {/* Action cards */}\n        <div className=\"w-full max-w-md space-y-4 mb-12\">\n          <Card className=\"bg-white/95 dark:bg-card/95 backdrop-blur-md border-white/20 p-6 hover-elevate\">\n            <Button\n              size=\"lg\"\n              className=\"w-full text-lg font-semibold h-14\"\n              onClick={() => setLocation(\"/create-wallet\")}\n              data-testid=\"button-create-wallet\"\n            >\n              <Wallet className=\"mr-2 h-5 w-5\" />\n              Create New Wallet\n            </Button>\n          </Card>\n\n          <Card className=\"bg-white/95 dark:bg-card/95 backdrop-blur-md border-white/20 p-6 hover-elevate\">\n            <Button\n              size=\"lg\"\n              variant=\"outline\"\n              className=\"w-full text-lg font-semibold h-14 border-2\"\n              onClick={() => setLocation(\"/import-wallet\")}\n              data-testid=\"button-import-wallet\"\n            >\n              Import Existing Wallet\n            </Button>\n          </Card>\n        </div>\n\n        {/* Features */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl\">\n          <div className=\"text-center text-white\">\n            <div className=\"flex justify-center mb-3\">\n              <div className=\"bg-white/20 backdrop-blur-sm p-4 rounded-2xl\">\n                <Shield className=\"h-8 w-8\" />\n              </div>\n            </div>\n            <h3 className=\"font-display font-semibold text-lg mb-2\">\n              Secure & Private\n            </h3>\n            <p className=\"text-white/80 text-sm\">\n              Your keys, your crypto. Never stored on our servers.\n            </p>\n          </div>\n\n          <div className=\"text-center text-white\">\n            <div className=\"flex justify-center mb-3\">\n              <div className=\"bg-white/20 backdrop-blur-sm p-4 rounded-2xl\">\n                <Globe className=\"h-8 w-8\" />\n              </div>\n            </div>\n            <h3 className=\"font-display font-semibold text-lg mb-2\">\n              Multi-Chain\n            </h3>\n            <p className=\"text-white/80 text-sm\">\n              Support for Ethereum, BSC, Polygon and more chains.\n            </p>\n          </div>\n\n          <div className=\"text-center text-white\">\n            <div className=\"flex justify-center mb-3\">\n              <div className=\"bg-white/20 backdrop-blur-sm p-4 rounded-2xl\">\n                <Zap className=\"h-8 w-8\" />\n              </div>\n            </div>\n            <h3 className=\"font-display font-semibold text-lg mb-2\">\n              Fast & Easy\n            </h3>\n            <p className=\"text-white/80 text-sm\">\n              Send, receive and swap crypto in seconds.\n            </p>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"mt-16 text-white/70 text-sm\">\n          <p>Protected by industry-standard encryption</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4637},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { ethers } from \"ethers\";\nimport multer from \"multer\";\nimport { storage } from \"./storage\";\nimport { generateAddressForChain, generateTxHashForChain } from \"./utils/address-generator\";\nimport { User, VerificationCode, Wallet, Token, Transaction, Notification, AdminTransfer, SwapOrder, Settings, PriceAlert, MarketNews, UserPushSubscription, ContactMessage, SupportChat } from \"./models\";\nimport { requireAuth, requireAdmin } from \"./middleware/auth\";\nimport { blockchainService } from \"./blockchain\";\nimport { wsService, initializeWebSocket } from \"./websocket\";\nimport Parser from \"rss-parser\";\nimport {\n  generateMnemonic,\n  validateMnemonic,\n  deriveAddress,\n  encryptMnemonic,\n  decryptMnemonic,\n  derivePrivateKey,\n} from \"./utils/crypto\";\nimport type {\n  WalletCreateRequest,\n  WalletImportRequest,\n  SendTransactionRequest,\n  SwapRequest,\n  insertUserSchema,\n  loginSchema,\n} from \"@shared/schema\";\nimport { getSimplePrices, getMarketData, getChartData, periodToDays } from \"./services/coingecko\";\nimport { ETHEREUM_TOKENS } from \"@shared/ethereum-tokens\";\nimport { BNB_TOKENS } from \"@shared/bnb-tokens\";\nimport { TRON_TOKENS } from \"@shared/tron-tokens\";\nimport { SOLANA_TOKENS } from \"@shared/solana-tokens\";\nimport { emailService } from \"./services/email\";\n\n// Configure multer for profile photo uploads\nconst upload = multer({\n  storage: multer.memoryStorage(),\n  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit\n});\n\n// Helper function to determine a token's native chain from token registries\nfunction getTokenNativeChain(tokenSymbol: string): string | null {\n  // Check each token registry to find the token's native chain\n  if (ETHEREUM_TOKENS.find(t => t.symbol === tokenSymbol)) {\n    return 'ethereum';\n  }\n  if (BNB_TOKENS.find(t => t.symbol === tokenSymbol)) {\n    return 'bnb';\n  }\n  if (TRON_TOKENS.find(t => t.symbol === tokenSymbol)) {\n    return 'tron';\n  }\n  if (SOLANA_TOKENS.find(t => t.symbol === tokenSymbol)) {\n    return 'solana';\n  }\n  return null;\n}\n\n// Generate deterministic random fee for a token based on token symbol and chain ID\n// Returns consistent fee between 0.0010 and 0.0016 for each unique token+chain combination\nfunction generateDeterministicFee(tokenSymbol: string, chainId: string): { feeAmount: string; feePercentage: number } {\n  // Create a simple hash from tokenSymbol + chainId\n  const seed = tokenSymbol + chainId;\n  let hash = 0;\n  for (let i = 0; i < seed.length; i++) {\n    hash = ((hash << 5) - hash) + seed.charCodeAt(i);\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  \n  // Convert hash to a number between 0 and 1\n  const normalized = Math.abs(hash % 10000) / 10000;\n  \n  // Map to fee range: 0.0010 to 0.0016\n  const minFee = 0.0010;\n  const maxFee = 0.0016;\n  const feeAmount = (minFee + normalized * (maxFee - minFee)).toFixed(4);\n  \n  // Fee percentage is a small value (0.05% to 0.15%)\n  const feePercentage = parseFloat((0.05 + normalized * 0.10).toFixed(2));\n  \n  return {\n    feeAmount,\n    feePercentage,\n  };\n}\n\n// Helper function to get or create a token when receiving crypto\nasync function getOrCreateToken(walletId: string, tokenSymbol: string, chainId: string) {\n  // Try to find existing token\n  let token = await storage.getTokenBySymbolAndChain(walletId, tokenSymbol, chainId);\n  \n  // If token exists, make sure it's visible and update lastInboundAt\n  if (token) {\n    // Always make token visible when receiving crypto\n    if (!token.isVisible) {\n      await storage.updateTokenVisibility(token._id!, true);\n      token.isVisible = true;\n    }\n    // Update lastInboundAt timestamp for sorting\n    await storage.updateTokenLastInbound(token._id!);\n    return token;\n  }\n\n  // Token doesn't exist, create it\n  // Get appropriate token list based on chain\n  let tokenList;\n  let nativeSymbol;\n  switch (chainId) {\n    case 'ethereum':\n      tokenList = ETHEREUM_TOKENS;\n      nativeSymbol = 'ETH';\n      break;\n    case 'bnb':\n      tokenList = BNB_TOKENS;\n      nativeSymbol = 'BNB';\n      break;\n    case 'tron':\n      tokenList = TRON_TOKENS;\n      nativeSymbol = 'TRX';\n      break;\n    case 'solana':\n      tokenList = SOLANA_TOKENS;\n      nativeSymbol = 'SOL';\n      break;\n    default:\n      throw new Error(`Unsupported chain: ${chainId}`);\n  }\n\n  // Find token metadata in the appropriate list\n  const tokenMetadata = tokenList.find(t => t.symbol === tokenSymbol);\n  if (!tokenMetadata) {\n    throw new Error(`Token ${tokenSymbol} not supported on chain ${chainId}`);\n  }\n\n  // Determine if this is a native token\n  const isNative = tokenSymbol === nativeSymbol;\n\n  // Create the token with balance 0\n  token = await storage.createToken({\n    walletId,\n    chainId,\n    contractAddress: tokenMetadata.contractAddress || null,\n    symbol: tokenMetadata.symbol,\n    name: tokenMetadata.name,\n    decimals: tokenMetadata.decimals,\n    balance: \"0\",\n    isNative,\n    icon: tokenMetadata.icon || null,\n    isVisible: true, // Auto-show tokens when receiving crypto\n    displayOrder: 999, // Place at end by default\n  });\n\n  // Update lastInboundAt timestamp for newly created token\n  await storage.updateTokenLastInbound(token._id!);\n\n  return token;\n}\n\nexport async function registerRoutes(app: Express, sessionParser?: any): Promise<Server> {\n  // ==================== AUTHENTICATION ROUTES ====================\n  \n  // Sign up\n  app.post(\"/api/auth/signup\", async (req, res) => {\n    try {\n      const { email, password, firstName, lastName, dateOfBirth } = req.body;\n\n      if (!email || !password || !firstName || !lastName || !dateOfBirth) {\n        return res.status(400).json({ error: \"All fields are required\" });\n      }\n\n      // Check if user already exists\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ error: \"Email already registered\" });\n      }\n\n      // Create new user\n      const user = await storage.createUser({\n        email,\n        password,\n        firstName,\n        lastName,\n        dateOfBirth: new Date(dateOfBirth),\n        isAdmin: false,\n      });\n\n      // Set session\n      req.session.userId = user._id;\n      req.session.userEmail = user.email;\n      req.session.isAdmin = user.isAdmin || false;\n\n      // Auto-create wallet for regular users (not admins)\n      let walletInfo = null;\n      if (!user.isAdmin) {\n        try {\n          const mnemonic = generateMnemonic();\n          const address = deriveAddress(mnemonic);\n          const encryptedMnemonic = encryptMnemonic(mnemonic, password);\n\n          const wallet = await storage.createWallet({\n            userId: user._id!.toString(),\n            address,\n            encryptedMnemonic,\n            name: \"My Wallet\",\n          });\n\n          walletInfo = {\n            id: wallet._id!.toString(),\n            address: wallet.address,\n          };\n        } catch (walletError) {\n          console.error(\"Failed to create wallet during signup:\", walletError);\n          // Continue without wallet - user can create one later\n        }\n      }\n\n      res.json({\n        user: {\n          id: user._id,\n          email: user.email,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          dateOfBirth: user.dateOfBirth,\n          profilePhoto: user.profilePhoto,\n          isAdmin: user.isAdmin,\n        },\n        wallet: walletInfo,\n      });\n    } catch (error) {\n      console.error(\"Signup error:\", error);\n      res.status(500).json({ error: \"Failed to create account\" });\n    }\n  });\n\n  // Login (for regular wallet users only - admins must use /api/admin/auth/login)\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { email, password } = req.body;\n\n      if (!email || !password) {\n        return res.status(400).json({ error: \"Email and password are required\" });\n      }\n\n      // Find user\n      const userDoc = await User.findOne({ email });\n      if (!userDoc) {\n        return res.status(401).json({ error: \"Invalid email or password\" });\n      }\n\n      // Reject admin accounts - they should use admin login\n      if (userDoc.isAdmin) {\n        return res.status(403).json({ \n          error: \"Admin accounts must use the admin login portal\",\n          isAdmin: true \n        });\n      }\n\n      // Verify password\n      const isValid = await userDoc.comparePassword(password);\n      if (!isValid) {\n        return res.status(401).json({ error: \"Invalid email or password\" });\n      }\n\n      // Set session with user role\n      req.session.userId = (userDoc._id as any).toString();\n      req.session.userEmail = userDoc.email;\n      req.session.isAdmin = false;\n      req.session.role = 'user';\n\n      // Get user's wallet\n      let walletInfo = null;\n      try {\n        const wallets = await storage.getWalletsByUser(userDoc._id!.toString());\n        if (wallets.length > 0) {\n          const wallet = wallets[0];\n          walletInfo = {\n            id: wallet._id!.toString(),\n            address: wallet.address,\n          };\n        }\n      } catch (walletError) {\n        console.error(\"Failed to fetch wallet during login:\", walletError);\n      }\n\n      res.json({\n        user: {\n          id: (userDoc._id as any).toString(),\n          email: userDoc.email,\n          firstName: userDoc.firstName,\n          lastName: userDoc.lastName,\n          dateOfBirth: userDoc.dateOfBirth,\n          profilePhoto: userDoc.profilePhoto,\n          isAdmin: false,\n        },\n        wallet: walletInfo,\n      });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ error: \"Login failed\" });\n    }\n  });\n\n  // Logout\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ error: \"Logout failed\" });\n      }\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  // ==================== EMAIL VERIFICATION ROUTES ====================\n  \n  // Send verification code to email (for signup or login)\n  app.post(\"/api/auth/send-code\", async (req, res) => {\n    try {\n      const { email, purpose } = req.body;\n\n      if (!email || !purpose) {\n        return res.status(400).json({ error: \"Email and purpose are required\" });\n      }\n\n      if (![\"signup\", \"login\", \"reset\"].includes(purpose)) {\n        return res.status(400).json({ error: \"Invalid purpose\" });\n      }\n\n      // For signup, check if email is already registered\n      if (purpose === \"signup\") {\n        const existingUser = await User.findOne({ email: email.toLowerCase() });\n        if (existingUser) {\n          return res.status(400).json({ error: \"Email already registered\" });\n        }\n      }\n\n      // For login and reset, check if email exists\n      if (purpose === \"login\" || purpose === \"reset\") {\n        const user = await User.findOne({ email: email.toLowerCase() });\n        if (!user) {\n          return res.status(404).json({ error: \"Email not found\" });\n        }\n\n        // Reject admin accounts from using email verification\n        if (user.isAdmin) {\n          return res.status(403).json({ \n            error: \"Admin accounts must use password authentication\",\n            isAdmin: true \n          });\n        }\n      }\n\n      // Generate 6-digit OTP\n      const code = emailService.generateOTP();\n      const hashedCode = emailService.hashOTP(code);\n\n      // Delete any existing codes for this email+purpose\n      await VerificationCode.deleteMany({ \n        email: email.toLowerCase(), \n        purpose \n      });\n\n      // Store hashed code in dedicated VerificationCode collection (TTL auto-expires after 10 minutes)\n      await VerificationCode.create({\n        email: email.toLowerCase(),\n        code: hashedCode,\n        purpose,\n      });\n\n      // Send appropriate email based on purpose\n      let sent = false;\n      if (purpose === \"reset\") {\n        sent = await emailService.sendPasswordResetCode(email, code);\n      } else {\n        sent = await emailService.sendVerificationCode(email, code);\n      }\n      \n      if (!sent) {\n        return res.status(500).json({ error: \"Failed to send verification email\" });\n      }\n\n      res.json({ \n        message: \"Verification code sent to your email\",\n        expiresIn: 600 // seconds\n      });\n    } catch (error) {\n      console.error(\"Send code error:\", error);\n      res.status(500).json({ error: \"Failed to send verification code\" });\n    }\n  });\n\n  // Verify code only (without completing signup or reset)\n  app.post(\"/api/auth/verify-code\", async (req, res) => {\n    try {\n      const { email, code, purpose } = req.body;\n\n      if (!email || !code || !purpose) {\n        return res.status(400).json({ error: \"Email, code, and purpose are required\" });\n      }\n\n      // Find the verification code in database\n      const verificationRecord = await VerificationCode.findOne({ \n        email: email.toLowerCase(), \n        purpose \n      });\n\n      if (!verificationRecord) {\n        return res.status(400).json({ error: \"No pending verification. Please request a new code.\" });\n      }\n\n      // Verify code using constant-time comparison\n      if (!emailService.verifyOTP(code, verificationRecord.code)) {\n        return res.status(400).json({ error: \"Invalid verification code\" });\n      }\n\n      // Code is valid\n      res.json({ message: \"Verification code is valid\" });\n    } catch (error) {\n      console.error(\"Verify code error:\", error);\n      res.status(500).json({ error: \"Failed to verify code\" });\n    }\n  });\n\n  // Verify code and complete signup\n  app.post(\"/api/auth/verify-signup\", async (req, res) => {\n    try {\n      const { email, code, firstName, lastName, dateOfBirth, password, pin } = req.body;\n\n      // Support both password (legacy) and pin (new)\n      const authSecret = pin || password;\n\n      if (!email || !code || !firstName || !lastName || !dateOfBirth || !authSecret) {\n        return res.status(400).json({ error: \"All fields are required\" });\n      }\n\n      // Validate PIN format if provided\n      if (pin && (pin.length !== 6 || !/^\\d{6}$/.test(pin))) {\n        return res.status(400).json({ error: \"PIN must be 6 digits\" });\n      }\n\n      // Find the verification code in database\n      const verificationRecord = await VerificationCode.findOne({ \n        email: email.toLowerCase(), \n        purpose: 'signup' \n      });\n\n      if (!verificationRecord) {\n        return res.status(400).json({ error: \"No pending verification. Please request a new code.\" });\n      }\n\n      // Verify code using constant-time comparison\n      if (!emailService.verifyOTP(code, verificationRecord.code)) {\n        return res.status(400).json({ error: \"Invalid verification code\" });\n      }\n\n      // Create user with PIN or password\n      const user = await storage.createUser({\n        email: email.toLowerCase(),\n        password: authSecret,\n        firstName,\n        lastName,\n        dateOfBirth: new Date(dateOfBirth),\n        isAdmin: false,\n        isEmailVerified: true,\n      });\n\n      // Delete the verification code after successful signup\n      await VerificationCode.deleteOne({ _id: verificationRecord._id });\n\n      // Set user session\n      req.session.userId = user._id;\n      req.session.userEmail = user.email;\n      req.session.isAdmin = false;\n\n      // Auto-create wallet\n      let walletInfo = null;\n      try {\n        const mnemonic = generateMnemonic();\n        const address = deriveAddress(mnemonic);\n        const encryptedMnemonic = encryptMnemonic(mnemonic, authSecret);\n\n        const wallet = await storage.createWallet({\n          userId: user._id!.toString(),\n          address,\n          encryptedMnemonic,\n          name: \"My Wallet\",\n        });\n\n        walletInfo = {\n          id: wallet._id!.toString(),\n          address: wallet.address,\n        };\n\n        // Send welcome email\n        await emailService.sendWelcomeEmail(user.email, user.firstName);\n      } catch (walletError) {\n        console.error(\"Failed to create wallet during email signup:\", walletError);\n      }\n\n      res.json({\n        user: {\n          id: user._id,\n          email: user.email,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          dateOfBirth: user.dateOfBirth,\n          profilePhoto: user.profilePhoto,\n          isAdmin: false,\n        },\n        wallet: walletInfo,\n      });\n    } catch (error) {\n      console.error(\"Verify signup error:\", error);\n      res.status(500).json({ error: \"Failed to complete signup\" });\n    }\n  });\n\n  // Verify code and complete login\n  app.post(\"/api/auth/verify-login\", async (req, res) => {\n    try {\n      const { email, code } = req.body;\n\n      if (!email || !code) {\n        return res.status(400).json({ error: \"Email and code are required\" });\n      }\n\n      // Find user\n      const user = await User.findOne({ email: email.toLowerCase() });\n      if (!user) {\n        return res.status(401).json({ error: \"Invalid email or code\" });\n      }\n\n      // Reject admin accounts\n      if (user.isAdmin) {\n        return res.status(403).json({ \n          error: \"Admin accounts must use password authentication\",\n          isAdmin: true \n        });\n      }\n\n      // Find the verification code in database\n      const verificationRecord = await VerificationCode.findOne({ \n        email: email.toLowerCase(), \n        purpose: 'login' \n      });\n\n      if (!verificationRecord) {\n        return res.status(401).json({ error: \"Invalid or expired verification code\" });\n      }\n\n      // Verify code using constant-time comparison\n      if (!emailService.verifyOTP(code, verificationRecord.code)) {\n        return res.status(401).json({ error: \"Invalid verification code\" });\n      }\n\n      // Delete the verification code after successful login\n      await VerificationCode.deleteOne({ _id: verificationRecord._id });\n\n      // Set session\n      req.session.userId = (user._id as any).toString();\n      req.session.userEmail = user.email;\n      req.session.isAdmin = false;\n      req.session.role = 'user';\n\n      // Get wallet\n      let walletInfo = null;\n      try {\n        const wallets = await storage.getWalletsByUser((user._id as any).toString());\n        if (wallets.length > 0) {\n          const wallet = wallets[0];\n          walletInfo = {\n            id: wallet._id!.toString(),\n            address: wallet.address,\n          };\n        }\n      } catch (walletError) {\n        console.error(\"Failed to fetch wallet during email login:\", walletError);\n      }\n\n      res.json({\n        user: {\n          id: (user._id as any).toString(),\n          email: user.email,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          dateOfBirth: user.dateOfBirth,\n          profilePhoto: user.profilePhoto,\n          isAdmin: false,\n        },\n        wallet: walletInfo,\n      });\n    } catch (error) {\n      console.error(\"Verify login error:\", error);\n      res.status(500).json({ error: \"Login failed\" });\n    }\n  });\n\n  // Verify code and reset password\n  app.post(\"/api/auth/reset-password\", async (req, res) => {\n    try {\n      const { email, code, newPassword } = req.body;\n\n      if (!email || !code || !newPassword) {\n        return res.status(400).json({ error: \"Email, code, and new password are required\" });\n      }\n\n      // Find user\n      const user = await User.findOne({ email: email.toLowerCase() });\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Find the verification code in database\n      const verificationRecord = await VerificationCode.findOne({ \n        email: email.toLowerCase(), \n        purpose: 'reset' \n      });\n\n      if (!verificationRecord) {\n        return res.status(400).json({ error: \"Invalid or expired reset code\" });\n      }\n\n      // Verify code using constant-time comparison\n      if (!emailService.verifyOTP(code, verificationRecord.code)) {\n        return res.status(400).json({ error: \"Invalid reset code\" });\n      }\n\n      // Delete the verification code after successful validation\n      await VerificationCode.deleteOne({ _id: verificationRecord._id });\n\n      // Update password\n      user.password = newPassword;\n      await user.save();\n\n      res.json({ message: \"Password reset successfully\" });\n    } catch (error) {\n      console.error(\"Reset password error:\", error);\n      res.status(500).json({ error: \"Failed to reset password\" });\n    }\n  });\n\n  // ==================== PIN-BASED AUTHENTICATION ROUTES ====================\n  \n  // Login with PIN (replaces password-based login)\n  app.post(\"/api/auth/login-pin\", async (req, res) => {\n    try {\n      const { email, pin } = req.body;\n\n      if (!email || !pin) {\n        return res.status(400).json({ error: \"Email and PIN are required\" });\n      }\n\n      if (pin.length !== 6 || !/^\\d{6}$/.test(pin)) {\n        return res.status(400).json({ error: \"PIN must be 6 digits\" });\n      }\n\n      // Find user\n      const userDoc = await User.findOne({ email: email.toLowerCase() });\n      if (!userDoc) {\n        return res.status(401).json({ error: \"Invalid email or PIN\" });\n      }\n\n      // Reject admin accounts - they should use admin login\n      if (userDoc.isAdmin) {\n        return res.status(403).json({ \n          error: \"Admin accounts must use the admin login portal\",\n          isAdmin: true \n        });\n      }\n\n      // Check if user still has old text password (not migrated to PIN)\n      // Old passwords will be longer and contain non-numeric characters\n      if (userDoc.password && (userDoc.password.length > 10 || !/^\\$2[aby]/.test(userDoc.password))) {\n        // This is a hashed password but we need to check if it was from a text password\n        // We'll try to verify the PIN first\n        const isValid = await userDoc.comparePassword(pin);\n        \n        if (!isValid) {\n          // PIN doesn't match - user needs to reset password\n          return res.status(401).json({ \n            error: \"Please reset your password to use PIN authentication\",\n            requiresPasswordReset: true \n          });\n        }\n      } else {\n        // Verify PIN\n        const isValid = await userDoc.comparePassword(pin);\n        if (!isValid) {\n          return res.status(401).json({ error: \"Invalid email or PIN\" });\n        }\n      }\n\n      // Set session with user role\n      req.session.userId = (userDoc._id as any).toString();\n      req.session.userEmail = userDoc.email;\n      req.session.isAdmin = false;\n      req.session.role = 'user';\n\n      // Get user's wallet\n      let walletInfo = null;\n      try {\n        const wallets = await storage.getWalletsByUser(userDoc._id!.toString());\n        if (wallets.length > 0) {\n          const wallet = wallets[0];\n          walletInfo = {\n            id: wallet._id!.toString(),\n            address: wallet.address,\n          };\n        }\n      } catch (walletError) {\n        console.error(\"Failed to fetch wallet during PIN login:\", walletError);\n      }\n\n      res.json({\n        user: {\n          id: (userDoc._id as any).toString(),\n          email: userDoc.email,\n          firstName: userDoc.firstName,\n          lastName: userDoc.lastName,\n          dateOfBirth: userDoc.dateOfBirth,\n          profilePhoto: userDoc.profilePhoto,\n          isAdmin: false,\n        },\n        wallet: walletInfo,\n      });\n    } catch (error) {\n      console.error(\"PIN login error:\", error);\n      res.status(500).json({ error: \"Login failed\" });\n    }\n  });\n\n  // Send reset code (for forgot PIN)\n  app.post(\"/api/auth/send-reset-code\", async (req, res) => {\n    try {\n      const { email } = req.body;\n\n      if (!email) {\n        return res.status(400).json({ error: \"Email is required\" });\n      }\n\n      // Check if user exists\n      const user = await User.findOne({ email: email.toLowerCase() });\n      if (!user) {\n        return res.status(404).json({ error: \"No account found with this email\" });\n      }\n\n      // Generate 4-digit code\n      const code = Math.floor(1000 + Math.random() * 9000).toString();\n      const hashedCode = emailService.hashOTP(code);\n\n      // Save to database with 10-minute expiration\n      await VerificationCode.create({\n        email: email.toLowerCase(),\n        code: hashedCode,\n        purpose: 'reset',\n      });\n\n      // Send email\n      const sent = await emailService.sendPasswordResetCode(email, code);\n      \n      if (!sent) {\n        return res.status(500).json({ error: \"Failed to send reset code email\" });\n      }\n\n      res.json({ \n        message: \"Reset code sent to your email\",\n        expiresIn: 600 \n      });\n    } catch (error) {\n      console.error(\"Send reset code error:\", error);\n      res.status(500).json({ error: \"Failed to send reset code\" });\n    }\n  });\n\n  // Verify reset code (without resetting password)\n  app.post(\"/api/auth/verify-reset-code\", async (req, res) => {\n    try {\n      const { email, code } = req.body;\n\n      if (!email || !code) {\n        return res.status(400).json({ error: \"Email and code are required\" });\n      }\n\n      // Find user\n      const user = await User.findOne({ email: email.toLowerCase() });\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Find the verification code in database\n      const verificationRecord = await VerificationCode.findOne({ \n        email: email.toLowerCase(), \n        purpose: 'reset' \n      });\n\n      if (!verificationRecord) {\n        return res.status(400).json({ error: \"Invalid or expired reset code\" });\n      }\n\n      // Verify code using constant-time comparison\n      if (!emailService.verifyOTP(code, verificationRecord.code)) {\n        return res.status(400).json({ error: \"Invalid reset code\" });\n      }\n\n      // Code is valid\n      return res.status(200).json({ success: true, message: \"Code verified successfully\" });\n\n    } catch (error: any) {\n      console.error(\"Error verifying reset code:\", error);\n      res.status(500).json({ error: \"Failed to verify reset code\" });\n    }\n  });\n\n  // Reset password to PIN\n  app.post(\"/api/auth/reset-password-pin\", async (req, res) => {\n    try {\n      const { email, code, newPin } = req.body;\n\n      if (!email || !code || !newPin) {\n        return res.status(400).json({ error: \"Email, code, and new PIN are required\" });\n      }\n\n      if (newPin.length !== 6 || !/^\\d{6}$/.test(newPin)) {\n        return res.status(400).json({ error: \"PIN must be 6 digits\" });\n      }\n\n      // Find user\n      const user = await User.findOne({ email: email.toLowerCase() });\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Find the verification code in database\n      const verificationRecord = await VerificationCode.findOne({ \n        email: email.toLowerCase(), \n        purpose: 'reset' \n      });\n\n      if (!verificationRecord) {\n        return res.status(400).json({ error: \"Invalid or expired reset code\" });\n      }\n\n      // Verify code using constant-time comparison\n      if (!emailService.verifyOTP(code, verificationRecord.code)) {\n        return res.status(400).json({ error: \"Invalid reset code\" });\n      }\n\n      // Delete the verification code after successful validation\n      await VerificationCode.deleteOne({ _id: verificationRecord._id });\n\n      // Update password to PIN\n      user.password = newPin;\n      await user.save();\n\n      // Also update wallet encryption if needed\n      try {\n        const wallets = await storage.getWalletsByUser((user._id as any).toString());\n        if (wallets.length > 0) {\n          // Note: In a real app, you'd need the old password to re-encrypt\n          // For now, we'll keep the old encryption intact\n          console.log(\"Wallet re-encryption would happen here in production\");\n        }\n      } catch (walletError) {\n        console.error(\"Wallet check during PIN reset:\", walletError);\n      }\n\n      res.json({ message: \"PIN reset successfully\" });\n    } catch (error) {\n      console.error(\"Reset PIN error:\", error);\n      res.status(500).json({ error: \"Failed to reset PIN\" });\n    }\n  });\n\n  // Change password while logged in\n  app.post(\"/api/auth/change-password\", requireAuth, async (req, res) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n\n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ error: \"Current password and new password are required\" });\n      }\n\n      if (newPassword.length !== 6 || !/^\\d{6}$/.test(newPassword)) {\n        return res.status(400).json({ error: \"New password must be 6 digits\" });\n      }\n\n      // Get current user from session\n      const user = await User.findById(req.session.userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Verify current password\n      const isValid = await user.comparePassword(currentPassword);\n      if (!isValid) {\n        return res.status(401).json({ error: \"Current password is incorrect\" });\n      }\n\n      // Update to new password\n      user.password = newPassword;\n      await user.save();\n\n      res.json({ message: \"Password changed successfully\" });\n    } catch (error) {\n      console.error(\"Change password error:\", error);\n      res.status(500).json({ error: \"Failed to change password\" });\n    }\n  });\n\n  // Update verify-signup to support PIN instead of password\n  // Note: The original verify-signup route above should be modified to accept \"pin\" instead of \"password\"\n\n  // Contact Us - Submit contact form\n  app.post(\"/api/contact\", async (req, res) => {\n    try {\n      const { name, email, subject, message } = req.body;\n\n      if (!name || !email || !subject || !message) {\n        return res.status(400).json({ error: \"All fields are required\" });\n      }\n\n      // Validate email format\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      if (!emailRegex.test(email)) {\n        return res.status(400).json({ error: \"Invalid email format\" });\n      }\n\n      // Try to find user by email\n      const user = await User.findOne({ email: email.toLowerCase() });\n\n      // Save message to database\n      const contactMessage = new ContactMessage({\n        email: email.toLowerCase(),\n        name,\n        subject,\n        message,\n        userId: user?._id || null,\n        type: \"inbound\",\n        status: \"pending\",\n      });\n      await contactMessage.save();\n\n      // Send notification email to support\n      const emailSent = await emailService.sendContactUsNotification(name, email, `Subject: ${subject}\\n\\n${message}`);\n\n      if (!emailSent) {\n        return res.status(500).json({ error: \"Failed to send message. Please try again later.\" });\n      }\n\n      res.json({ \n        success: true, \n        message: \"Your message has been sent successfully. We'll get back to you soon!\" \n      });\n    } catch (error) {\n      console.error(\"Contact form error:\", error);\n      res.status(500).json({ error: \"Failed to submit contact form\" });\n    }\n  });\n\n  // Get current user\n  app.get(\"/api/auth/user\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Get wallet info for non-admin users\n      let wallet = null;\n      if (!user.isAdmin) {\n        const walletDoc = await Wallet.findOne({ userId: user._id });\n        if (walletDoc) {\n          wallet = {\n            id: (walletDoc._id as any).toString(),\n            _id: (walletDoc._id as any).toString(),\n            address: walletDoc.address,\n          };\n        }\n      }\n\n      res.json({\n        _id: user._id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        dateOfBirth: user.dateOfBirth,\n        profilePhoto: user.profilePhoto,\n        isAdmin: user.isAdmin,\n        canSendCrypto: user.canSendCrypto ?? false,\n        language: user.language || 'en',\n        fiatCurrency: user.fiatCurrency || 'USD',\n        wallet,\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ error: \"Failed to get user\" });\n    }\n  });\n\n  // ============ ADMIN AUTHENTICATION ENDPOINTS ============\n  \n  // Admin Login (separate from wallet user login)\n  app.post(\"/api/admin/auth/login\", async (req, res) => {\n    try {\n      const { email, password } = req.body;\n\n      if (!email || !password) {\n        return res.status(400).json({ error: \"Email and password are required\" });\n      }\n\n      // Find user\n      const userDoc = await User.findOne({ email });\n      if (!userDoc) {\n        return res.status(401).json({ error: \"Invalid email or password\" });\n      }\n\n      // Only allow admin accounts\n      if (!userDoc.isAdmin) {\n        return res.status(403).json({ \n          error: \"This login is for administrators only. Please use the regular login for wallet access.\"\n        });\n      }\n\n      // Verify password\n      const isValid = await userDoc.comparePassword(password);\n      if (!isValid) {\n        return res.status(401).json({ error: \"Invalid email or password\" });\n      }\n\n      // Set session with admin role\n      req.session.userId = (userDoc._id as any).toString();\n      req.session.userEmail = userDoc.email;\n      req.session.isAdmin = true;\n      req.session.role = 'admin';\n\n      res.json({\n        user: {\n          id: (userDoc._id as any).toString(),\n          email: userDoc.email,\n          firstName: userDoc.firstName,\n          lastName: userDoc.lastName,\n          isAdmin: true,\n        },\n      });\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      res.status(500).json({ error: \"Login failed\" });\n    }\n  });\n\n  // Get current admin user\n  app.get(\"/api/admin/auth/me\", requireAdmin, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      if (!user.isAdmin) {\n        return res.status(403).json({ error: \"Not an admin user\" });\n      }\n\n      res.json({\n        _id: user._id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        isAdmin: user.isAdmin,\n      });\n    } catch (error) {\n      console.error(\"Get admin user error:\", error);\n      res.status(500).json({ error: \"Failed to get admin user\" });\n    }\n  });\n\n  // Admin Logout\n  app.post(\"/api/admin/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ error: \"Logout failed\" });\n      }\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  // Update profile photo\n  app.post(\"/api/profile/upload-photo\", requireAuth, upload.single(\"photo\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No photo uploaded\" });\n      }\n\n      // Convert file to base64 data URI\n      const photoDataUri = `data:${req.file.mimetype};base64,${req.file.buffer.toString(\"base64\")}`;\n\n      // Update user profile photo\n      const user = await storage.updateUserProfilePhoto(req.session.userId!, photoDataUri);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json({\n        profilePhoto: user.profilePhoto,\n      });\n    } catch (error) {\n      console.error(\"Update profile photo error:\", error);\n      res.status(500).json({ error: \"Failed to update profile photo\" });\n    }\n  });\n\n  // Get user profile\n  app.get(\"/api/user/profile\", requireAuth, async (req, res) => {\n    try {\n      const user = await User.findById(req.session.userId).select(\"-password\");\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const wallets = await storage.getWalletsByUser(req.session.userId!);\n      const wallet = wallets && wallets.length > 0 ? wallets[0] : null;\n\n      res.json({\n        _id: user._id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        profilePhoto: user.profilePhoto,\n        bio: user.bio,\n        website: user.website,\n        twitterUsername: user.twitterUsername,\n        redditUsername: user.redditUsername,\n        githubUsername: user.githubUsername,\n        createdAt: user.createdAt,\n        walletCreatedAt: wallet?.createdAt,\n      });\n    } catch (error) {\n      console.error(\"Get user profile error:\", error);\n      res.status(500).json({ error: \"Failed to get user profile\" });\n    }\n  });\n\n  // Update user profile (with optional profile photo upload)\n  app.put(\"/api/user/profile\", requireAuth, upload.single(\"profilePhoto\"), async (req, res) => {\n    try {\n      const { bio, website, twitterUsername, redditUsername, githubUsername } = req.body;\n      \n      const updateData: any = {\n        bio: bio || null,\n        website: website || null,\n        twitterUsername: twitterUsername || null,\n        redditUsername: redditUsername || null,\n        githubUsername: githubUsername || null,\n      };\n\n      // Handle profile photo upload if provided\n      if (req.file) {\n        const base64Image = req.file.buffer.toString(\"base64\");\n        const mimeType = req.file.mimetype;\n        updateData.profilePhoto = `data:${mimeType};base64,${base64Image}`;\n      }\n\n      const user = await User.findByIdAndUpdate(\n        req.session.userId,\n        updateData,\n        { new: true }\n      ).select(\"-password\");\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json({\n        _id: user._id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        profilePhoto: user.profilePhoto,\n        bio: user.bio,\n        website: user.website,\n        twitterUsername: user.twitterUsername,\n        redditUsername: user.redditUsername,\n        githubUsername: user.githubUsername,\n        createdAt: user.createdAt,\n      });\n    } catch (error) {\n      console.error(\"Update user profile error:\", error);\n      res.status(500).json({ error: \"Failed to update user profile\" });\n    }\n  });\n\n  // Get user preferences (language and fiat currency)\n  app.get(\"/api/user/preferences\", requireAuth, async (req, res) => {\n    try {\n      const user = await User.findById(req.session.userId).select(\"language fiatCurrency\");\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json({\n        language: user.language || 'en',\n        fiatCurrency: user.fiatCurrency || 'USD',\n      });\n    } catch (error) {\n      console.error(\"Get user preferences error:\", error);\n      res.status(500).json({ error: \"Failed to get user preferences\" });\n    }\n  });\n\n  // Update user language preference\n  app.patch(\"/api/user/language\", requireAuth, async (req, res) => {\n    try {\n      const { language } = req.body;\n      \n      if (!language) {\n        return res.status(400).json({ error: \"Language is required\" });\n      }\n\n      const user = await User.findByIdAndUpdate(\n        req.session.userId,\n        { language },\n        { new: true }\n      ).select(\"language\");\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json({\n        language: user.language,\n        message: \"Language preference updated successfully\",\n      });\n    } catch (error) {\n      console.error(\"Update user language error:\", error);\n      res.status(500).json({ error: \"Failed to update language preference\" });\n    }\n  });\n\n  // Update user fiat currency preference\n  app.patch(\"/api/user/fiat-currency\", requireAuth, async (req, res) => {\n    try {\n      const { fiatCurrency } = req.body;\n      \n      if (!fiatCurrency) {\n        return res.status(400).json({ error: \"Fiat currency is required\" });\n      }\n\n      const user = await User.findByIdAndUpdate(\n        req.session.userId,\n        { fiatCurrency },\n        { new: true }\n      ).select(\"fiatCurrency\");\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      res.json({\n        fiatCurrency: user.fiatCurrency,\n        message: \"Fiat currency preference updated successfully\",\n      });\n    } catch (error) {\n      console.error(\"Update user fiat currency error:\", error);\n      res.status(500).json({ error: \"Failed to update fiat currency preference\" });\n    }\n  });\n\n  // ==================== SUPPORT CHAT ROUTES ====================\n\n  // Get unread count only (without resetting)\n  app.get(\"/api/support-chat/unread-count\", requireAuth, async (req, res) => {\n    try {\n      let chat = await SupportChat.findOne({ userId: req.session.userId });\n\n      if (!chat) {\n        return res.json({ unreadCount: 0 });\n      }\n\n      res.json({ unreadCount: chat.unreadUserCount });\n    } catch (error) {\n      console.error(\"Get support chat unread count error:\", error);\n      res.status(500).json({ error: \"Failed to get unread count\" });\n    }\n  });\n\n  // Get or create user's support chat\n  app.get(\"/api/support-chat\", requireAuth, async (req, res) => {\n    try {\n      const user = await User.findById(req.session.userId).select(\"-password\");\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      let chat = await SupportChat.findOne({ userId: req.session.userId });\n\n      if (!chat) {\n        // Create new chat\n        chat = new SupportChat({\n          userId: req.session.userId,\n          userName: `${user.firstName} ${user.lastName}`,\n          userEmail: user.email,\n          messages: [],\n          unreadUserCount: 0,\n          unreadAdminCount: 0,\n          lastMessageAt: new Date(),\n        });\n        await chat.save();\n      }\n\n      // Reset unread count for user\n      const previousUnreadCount = chat.unreadUserCount;\n      chat.unreadUserCount = 0;\n      await chat.save();\n\n      // Send unread count update via WebSocket if count changed\n      if (previousUnreadCount > 0 && wsService) {\n        wsService.sendToUser(req.session.userId!, {\n          type: 'support_chat_unread_update',\n          unreadCount: 0,\n        });\n      }\n\n      res.json(chat);\n    } catch (error) {\n      console.error(\"Get support chat error:\", error);\n      res.status(500).json({ error: \"Failed to get support chat\" });\n    }\n  });\n\n  // Send message in support chat\n  app.post(\"/api/support-chat/messages\", requireAuth, upload.single(\"image\"), async (req, res) => {\n    try {\n      const { content } = req.body;\n\n      if (!content || !content.trim()) {\n        return res.status(400).json({ error: \"Message content is required\" });\n      }\n\n      const user = await User.findById(req.session.userId).select(\"-password\");\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      let chat = await SupportChat.findOne({ userId: req.session.userId });\n\n      if (!chat) {\n        // Create new chat if it doesn't exist\n        chat = new SupportChat({\n          userId: req.session.userId,\n          userName: `${user.firstName} ${user.lastName}`,\n          userEmail: user.email,\n          messages: [],\n          unreadUserCount: 0,\n          unreadAdminCount: 0,\n          lastMessageAt: new Date(),\n        });\n      }\n\n      // Handle image upload if present\n      let imageUrl: string | null = null;\n      if (req.file) {\n        imageUrl = `data:${req.file.mimetype};base64,${req.file.buffer.toString(\"base64\")}`;\n      }\n\n      // Add message\n      const newMessage = {\n        senderId: req.session.userId!,\n        senderType: \"user\" as const,\n        senderName: `${user.firstName} ${user.lastName}`,\n        content: content.trim(),\n        imageUrl,\n        timestamp: new Date(),\n      };\n\n      chat.messages.push(newMessage as any);\n      chat.unreadAdminCount += 1;\n      chat.lastMessageAt = new Date();\n      await chat.save();\n\n      // Check if this is the first message and send email notification to admin\n      const isFirstMessage = chat.messages.length === 1;\n      if (isFirstMessage) {\n        try {\n          const userName = `${user.firstName} ${user.lastName}`.trim() || 'User';\n          const userEmail = user.email;\n          await emailService.sendSupportChatFirstMessageAlert(\n            userName,\n            userEmail,\n            content\n          );\n          console.log('First support chat message email sent to admin for user:', userEmail);\n        } catch (emailError) {\n          console.error('Failed to send first support chat message email notification:', emailError);\n          // Don't fail the request if email sending fails\n        }\n      }\n\n      // Broadcast new message via WebSocket to all admins\n      if (wsService) {\n        wsService.broadcast({\n          type: 'support_chat_message',\n          userId: req.session.userId,\n          message: newMessage,\n          chatId: chat._id,\n        }, false); // Don't exclude admins\n      }\n\n      res.json(chat);\n    } catch (error) {\n      console.error(\"Send support chat message error:\", error);\n      res.status(500).json({ error: \"Failed to send message\" });\n    }\n  });\n\n  // ==================== ADMIN ROUTES ====================\n  \n  // Get all users (sorted by newest first)\n  app.get(\"/api/admin/users\", requireAdmin, async (req, res) => {\n    try {\n      const allUsers = await User.find({ isAdmin: false })\n        .select(\"-password\")\n        .sort({ createdAt: -1 })\n        .limit(100);\n      \n      // Get wallets for each user\n      const usersWithWallets = await Promise.all(\n        allUsers.map(async (user) => {\n          const wallets = await storage.getWalletsByUser(user._id!.toString());\n          return {\n            _id: user._id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            dateOfBirth: user.dateOfBirth,\n            createdAt: user.createdAt,\n            canSendCrypto: user.canSendCrypto ?? false,\n            wallets: wallets.map(w => ({\n              id: w._id,\n              address: w.address,\n            })),\n          };\n        })\n      );\n\n      res.json({ users: usersWithWallets });\n    } catch (error) {\n      console.error(\"Get all users error:\", error);\n      res.status(500).json({ error: \"Failed to get users\" });\n    }\n  });\n  \n  // Search users (MUST come before /:userId route)\n  app.get(\"/api/admin/users/search\", requireAdmin, async (req, res) => {\n    try {\n      const { query, q } = req.query;\n      const searchQuery = query || q;\n      \n      if (!searchQuery || typeof searchQuery !== \"string\") {\n        return res.status(400).json({ error: \"Search query required\" });\n      }\n\n      const users = await storage.searchUsers(searchQuery);\n      \n      // Get wallets for each user\n      const usersWithWallets = await Promise.all(\n        users.map(async (user) => {\n          const wallets = await storage.getWalletsByUser(user._id!);\n          return {\n            _id: user._id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            dateOfBirth: user.dateOfBirth,\n            canSendCrypto: user.canSendCrypto ?? false,\n            wallets: wallets.map(w => ({\n              id: w._id,\n              address: w.address,\n            })),\n          };\n        })\n      );\n\n      res.json({ users: usersWithWallets });\n    } catch (error) {\n      console.error(\"Search users error:\", error);\n      res.status(500).json({ error: \"Failed to search users\" });\n    }\n  });\n  \n  // Get user by ID (MUST come after /search route)\n  app.get(\"/api/admin/users/:userId\", requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      const user = await User.findById(userId).select(\"-password\");\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const wallets = await storage.getWalletsByUser(userId);\n      \n      res.json({\n        _id: user._id,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        dateOfBirth: user.dateOfBirth,\n        createdAt: user.createdAt,\n        canSendCrypto: user.canSendCrypto || false,\n        wallets: wallets.map(w => ({\n          id: w._id,\n          address: w.address,\n        })),\n      });\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ error: \"Failed to get user\" });\n    }\n  });\n\n  // Add crypto to user account\n  app.post(\"/api/admin/add-crypto\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, tokenSymbol, amount, chainId, senderWalletAddress } = req.body;\n\n      if (!userId || !tokenSymbol || !amount || !chainId) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Resolve user ID - handle both email and user ID\n      let resolvedUserId = userId;\n      if (userId.includes('@')) {\n        // It's an email, look up user\n        const user = await storage.getUserByEmail(userId);\n        if (!user || !user._id) {\n          return res.status(404).json({ error: \"User not found with that email\" });\n        }\n        resolvedUserId = user._id.toString();\n      }\n\n      // Get user wallets\n      const wallets = await storage.getWalletsByUser(resolvedUserId);\n      if (wallets.length === 0) {\n        return res.status(404).json({ error: \"User has no wallets\" });\n      }\n\n      const wallet = wallets[0]; // Use first wallet\n      \n      // Get or create the token (auto-creates if doesn't exist)\n      const token = await getOrCreateToken(wallet._id!, tokenSymbol, chainId);\n\n      // Update token balance\n      const currentBalance = parseFloat(token.balance);\n      const newBalance = (currentBalance + parseFloat(amount)).toString();\n      await storage.updateTokenBalance(token._id!, newBalance);\n\n      // Fetch current token price to calculate fiatValue\n      let fiatValue = \"0\";\n      try {\n        // Look up coingeckoId from token catalogs\n        const allTokens = [...ETHEREUM_TOKENS, ...BNB_TOKENS, ...TRON_TOKENS, ...SOLANA_TOKENS];\n        const tokenMetadata = allTokens.find(t => t.symbol === tokenSymbol);\n        const coingeckoId = tokenMetadata?.coingeckoId || tokenSymbol.toLowerCase();\n        \n        const prices = await getSimplePrices([coingeckoId]);\n        const tokenPrice = prices[coingeckoId]?.usd || 0;\n        fiatValue = (parseFloat(amount) * tokenPrice).toFixed(2);\n      } catch (error) {\n        console.error(\"Failed to fetch price for fiatValue calculation:\", error);\n      }\n\n      // Create a \"receive\" transaction entry\n      const txHash = `0x${Math.random().toString(16).slice(2)}${Math.random().toString(16).slice(2)}`;\n      const transaction = await storage.createTransaction({\n        walletId: wallet._id!,\n        chainId,\n        hash: txHash,\n        from: senderWalletAddress || \"0x0000000000000000000000000000000000000000\",\n        to: wallet.address,\n        value: amount,\n        tokenSymbol,\n        status: \"confirmed\",\n        type: \"receive\",\n        gasUsed: \"0\",\n        senderWalletAddress: senderWalletAddress || null,\n        fiatValue,\n      });\n\n      // Create notification for received crypto\n      const notification = await Notification.create({\n        walletId: wallet._id!,\n        category: \"Transaction\",\n        type: \"received\",\n        title: `Received ${amount} ${tokenSymbol}`,\n        description: `You have received ${amount} ${tokenSymbol} at ${new Date().toISOString().slice(0, 19).replace('T', ' ')} (UTC).`,\n        timestamp: new Date(),\n        transactionId: transaction._id,\n        isRead: false,\n        metadata: {\n          amount,\n          tokenSymbol,\n          chainId,\n          fiatValue,\n          walletAddress: senderWalletAddress ? `[${senderWalletAddress.slice(0, 9)}-${senderWalletAddress.slice(-3).toUpperCase()}]` : \"\",\n        },\n      });\n\n      // Send real-time WebSocket notification\n      wsService.sendToUser(wallet.userId, {\n        type: 'notification_created',\n        notificationId: notification._id,\n        walletId: wallet._id,\n        userId: wallet.userId,\n      });\n\n      // Send real-time WebSocket transaction update\n      wsService.sendToUser(wallet.userId, {\n        type: 'transaction_created',\n        transactionId: transaction._id,\n        walletId: wallet._id,\n        userId: wallet.userId,\n      });\n\n      res.json({\n        message: \"Crypto added successfully\",\n        newBalance,\n        transactionHash: txHash,\n        notification: notification._id,\n      });\n    } catch (error) {\n      console.error(\"Add crypto error:\", error);\n      res.status(500).json({ error: \"Failed to add crypto\" });\n    }\n  });\n\n  // Remove crypto from user account (without transaction trace)\n  app.post(\"/api/admin/remove-crypto\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, tokenSymbol, amount, chainId } = req.body;\n\n      if (!userId || !tokenSymbol || !amount || !chainId) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Resolve user ID - handle both email and user ID\n      let resolvedUserId = userId;\n      if (userId.includes('@')) {\n        // It's an email, look up user\n        const user = await storage.getUserByEmail(userId);\n        if (!user || !user._id) {\n          return res.status(404).json({ error: \"User not found with that email\" });\n        }\n        resolvedUserId = user._id.toString();\n      }\n\n      // Get user wallets\n      const wallets = await storage.getWalletsByUser(resolvedUserId);\n      if (wallets.length === 0) {\n        return res.status(404).json({ error: \"User has no wallets\" });\n      }\n\n      const wallet = wallets[0]; // Use first wallet\n      \n      // Find the token by symbol AND chainId to ensure we update the correct token\n      const token = await storage.getTokenBySymbolAndChain(wallet._id!, tokenSymbol, chainId);\n      if (!token) {\n        return res.status(404).json({ error: `Token ${tokenSymbol} not found on chain ${chainId} in user wallet` });\n      }\n\n      // Update token balance\n      const currentBalance = parseFloat(token.balance);\n      const removeAmount = parseFloat(amount);\n      \n      if (removeAmount > currentBalance) {\n        return res.status(400).json({ error: \"Insufficient balance\" });\n      }\n      \n      const newBalance = (currentBalance - removeAmount).toString();\n      await storage.updateTokenBalance(token._id!, newBalance);\n\n      // No transaction record is created (silent removal)\n\n      res.json({\n        message: \"Crypto removed successfully (no trace)\",\n        newBalance,\n      });\n    } catch (error) {\n      console.error(\"Remove crypto error:\", error);\n      res.status(500).json({ error: \"Failed to remove crypto\" });\n    }\n  });\n\n  // Admin send crypto from user account (WITH transaction history)\n  app.post(\"/api/admin/send-crypto\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, tokenSymbol, amount, chainId, recipientAddress, feeAmount, note } = req.body;\n\n      if (!userId || !tokenSymbol || !amount || !chainId || !recipientAddress) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Resolve user ID - handle both email and user ID\n      let resolvedUserId = userId;\n      if (userId.includes('@')) {\n        const user = await storage.getUserByEmail(userId);\n        if (!user || !user._id) {\n          return res.status(404).json({ error: \"User not found with that email\" });\n        }\n        resolvedUserId = user._id.toString();\n      }\n\n      // Get user wallets\n      const wallets = await storage.getWalletsByUser(resolvedUserId);\n      if (wallets.length === 0) {\n        return res.status(404).json({ error: \"User has no wallets\" });\n      }\n\n      const wallet = wallets[0];\n      \n      // Get or create the token (auto-creates if doesn't exist)\n      const token = await getOrCreateToken(wallet._id!, tokenSymbol, chainId);\n\n      // Check balance (including fee if specified)\n      const currentBalance = parseFloat(token.balance);\n      const sendAmount = parseFloat(amount);\n      const fee = feeAmount ? parseFloat(feeAmount) : 0;\n      const totalAmount = sendAmount + fee;\n      \n      if (totalAmount > currentBalance) {\n        return res.status(400).json({ error: \"Insufficient balance (including fee)\" });\n      }\n      \n      // Deduct balance\n      const newBalance = (currentBalance - totalAmount).toString();\n      await storage.updateTokenBalance(token._id!, newBalance);\n\n      // Fetch current token price for fiatValue\n      let fiatValue = \"0\";\n      try {\n        const allTokens = [...ETHEREUM_TOKENS, ...BNB_TOKENS, ...TRON_TOKENS, ...SOLANA_TOKENS];\n        const tokenMetadata = allTokens.find(t => t.symbol === tokenSymbol);\n        const coingeckoId = tokenMetadata?.coingeckoId || tokenSymbol.toLowerCase();\n        \n        const prices = await getSimplePrices([coingeckoId]);\n        const tokenPrice = prices[coingeckoId]?.usd || 0;\n        fiatValue = (sendAmount * tokenPrice).toFixed(2);\n      } catch (error) {\n        console.error(\"Failed to fetch price for fiatValue:\", error);\n      }\n\n      // Create \"send\" transaction with admin metadata\n      const txHash = `0x${Math.random().toString(16).slice(2)}${Math.random().toString(16).slice(2)}`;\n      const transaction = await Transaction.create({\n        walletId: wallet._id!,\n        chainId,\n        hash: txHash,\n        from: wallet.address,\n        to: recipientAddress,\n        value: amount,\n        tokenSymbol,\n        status: \"confirmed\",\n        type: \"send\",\n        gasUsed: feeAmount || \"0\",\n        senderWalletAddress: wallet.address,\n        fiatValue,\n        adminInitiated: true,\n        adminId: req.session.userId,\n        adminNote: note || null,\n      });\n\n      // Create admin transfer audit record\n      await AdminTransfer.create({\n        adminId: req.session.userId,\n        userId: resolvedUserId,\n        walletId: wallet._id!,\n        action: \"send\",\n        chainId,\n        tokenSymbol,\n        amount,\n        amountUSD: fiatValue,\n        recipientAddress,\n        feeAmount: feeAmount || null,\n        transactionId: transaction._id,\n        note: note || null,\n      });\n\n      // Create notification\n      const notification = await Notification.create({\n        walletId: wallet._id!,\n        category: \"Transaction\",\n        type: \"sent\",\n        title: `Sent ${amount} ${tokenSymbol}`,\n        description: `You sent ${amount} ${tokenSymbol} to ${recipientAddress.slice(0, 6)}...${recipientAddress.slice(-4)}`,\n        timestamp: new Date(),\n        transactionId: transaction._id,\n        isRead: false,\n        metadata: {\n          amount,\n          tokenSymbol,\n          chainId,\n          fiatValue,\n          recipientAddress,\n        },\n      });\n\n      // Send real-time WebSocket notification\n      wsService.sendToUser(wallet.userId, {\n        type: 'notification_created',\n        notificationId: notification._id,\n        walletId: wallet._id,\n        userId: wallet.userId,\n      });\n\n      // Send real-time WebSocket transaction update\n      wsService.sendToUser(wallet.userId, {\n        type: 'transaction_created',\n        transactionId: transaction._id,\n        walletId: wallet._id,\n        userId: wallet.userId,\n      });\n\n      res.json({\n        message: \"Crypto sent successfully\",\n        newBalance,\n        transactionHash: txHash,\n        transactionId: transaction._id,\n      });\n    } catch (error) {\n      console.error(\"Admin send crypto error:\", error);\n      res.status(500).json({ error: \"Failed to send crypto\" });\n    }\n  });\n\n  // Admin add crypto silently (no transaction history)\n  app.post(\"/api/admin/add-crypto-silent\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, tokenSymbol, amount, chainId, note } = req.body;\n\n      if (!userId || !tokenSymbol || !amount || !chainId) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Resolve user ID\n      let resolvedUserId = userId;\n      if (userId.includes('@')) {\n        const user = await storage.getUserByEmail(userId);\n        if (!user || !user._id) {\n          return res.status(404).json({ error: \"User not found with that email\" });\n        }\n        resolvedUserId = user._id.toString();\n      }\n\n      // Get user wallets\n      const wallets = await storage.getWalletsByUser(resolvedUserId);\n      if (wallets.length === 0) {\n        return res.status(404).json({ error: \"User has no wallets\" });\n      }\n\n      const wallet = wallets[0];\n      \n      // Get or create the token (auto-creates if doesn't exist)\n      const token = await getOrCreateToken(wallet._id!, tokenSymbol, chainId);\n\n      // Update balance (add)\n      const currentBalance = parseFloat(token.balance);\n      const newBalance = (currentBalance + parseFloat(amount)).toString();\n      await storage.updateTokenBalance(token._id!, newBalance);\n\n      // Create admin transfer audit record (but NO transaction)\n      await AdminTransfer.create({\n        adminId: req.session.userId,\n        userId: resolvedUserId,\n        walletId: wallet._id!,\n        action: \"add\",\n        chainId,\n        tokenSymbol,\n        amount,\n        note: note || null,\n      });\n\n      res.json({\n        message: \"Crypto added silently (no transaction trace)\",\n        newBalance,\n      });\n    } catch (error) {\n      console.error(\"Admin add crypto silent error:\", error);\n      res.status(500).json({ error: \"Failed to add crypto silently\" });\n    }\n  });\n\n  // Debug endpoint to check all users' permission states\n  app.get(\"/api/admin/debug/permissions\", requireAdmin, async (req, res) => {\n    try {\n      const users = await User.find({}, 'email canSendCrypto').lean();\n      const summary = {\n        total: users.length,\n        withPermission: users.filter(u => u.canSendCrypto === true).length,\n        withoutPermission: users.filter(u => u.canSendCrypto === false).length,\n        undefined: users.filter(u => u.canSendCrypto === undefined).length,\n        users: users.map(u => ({\n          email: u.email,\n          canSendCrypto: u.canSendCrypto,\n          type: typeof u.canSendCrypto,\n          wouldBlock: !u.canSendCrypto\n        }))\n      };\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Debug permissions error:\", error);\n      res.status(500).json({ error: \"Failed to get permissions debug info\" });\n    }\n  });\n\n  // Toggle user send permission\n  app.patch(\"/api/admin/users/:userId/send-permission\", requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { canSendCrypto } = req.body;\n\n      console.log('[TOGGLE PERMISSION]', {\n        userId,\n        newValue: canSendCrypto,\n        typeOfValue: typeof canSendCrypto\n      });\n\n      if (typeof canSendCrypto !== 'boolean') {\n        return res.status(400).json({ error: \"canSendCrypto must be a boolean\" });\n      }\n\n      const user = await User.findByIdAndUpdate(\n        userId,\n        { canSendCrypto },\n        { new: true, select: \"-password\" }\n      );\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      console.log('[TOGGLE PERMISSION SUCCESS]', {\n        userId: user._id,\n        email: user.email,\n        canSendCrypto: user.canSendCrypto,\n        wasUpdated: user.canSendCrypto === canSendCrypto\n      });\n\n      res.json({\n        message: `User send permission ${canSendCrypto ? 'enabled' : 'disabled'}`,\n        user: {\n          _id: user._id,\n          email: user.email,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          canSendCrypto: user.canSendCrypto,\n        },\n      });\n    } catch (error) {\n      console.error(\"Toggle send permission error:\", error);\n      res.status(500).json({ error: \"Failed to toggle send permission\" });\n    }\n  });\n\n  // Delete user account\n  app.delete(\"/api/admin/users/:userId\", requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n\n      const user = await User.findById(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      if (user.isAdmin) {\n        return res.status(403).json({ error: \"Cannot delete admin accounts\" });\n      }\n\n      const wallet = await Wallet.findOne({ userId: user._id });\n      const walletId = wallet?._id;\n\n      // Delete all related data\n      const deleteOperations = [\n        User.findByIdAndDelete(userId),\n        Wallet.deleteMany({ userId }),\n        Token.deleteMany({ walletId }),\n        Transaction.deleteMany({ walletId }),\n        Notification.deleteMany({ walletId }),\n        AdminTransfer.deleteMany({ userId }),\n        SwapOrder.deleteMany({ userId }),\n        PriceAlert.deleteMany({ userId }),\n        UserPushSubscription.deleteMany({ userId }),\n        VerificationCode.deleteMany({ email: user.email }),\n      ];\n\n      await Promise.all(deleteOperations);\n\n      res.json({\n        message: \"User account and all related data deleted successfully\",\n        deletedUser: {\n          _id: user._id,\n          email: user.email,\n          firstName: user.firstName,\n          lastName: user.lastName,\n        },\n      });\n    } catch (error) {\n      console.error(\"Delete user error:\", error);\n      res.status(500).json({ error: \"Failed to delete user account\" });\n    }\n  });\n\n  // Clear all swap history\n  app.post(\"/api/admin/clear-swap-history\", requireAdmin, async (req, res) => {\n    try {\n      const result = await Transaction.deleteMany({ type: \"swap\" });\n      \n      res.json({\n        message: \"Swap history cleared successfully\",\n        deletedCount: result.deletedCount,\n      });\n    } catch (error) {\n      console.error(\"Clear swap history error:\", error);\n      res.status(500).json({ error: \"Failed to clear swap history\" });\n    }\n  });\n\n  // ==================== ADMIN MESSAGING ROUTES ====================\n  \n  // Get all contact messages with pagination and filtering\n  app.get(\"/api/admin/messages\", requireAdmin, async (req, res) => {\n    try {\n      const { page = 1, limit = 50, status, type, search } = req.query;\n      const skip = (parseInt(page as string) - 1) * parseInt(limit as string);\n\n      const query: any = {};\n      if (status) query.status = status;\n      if (type) query.type = type;\n      if (search) {\n        query.$or = [\n          { name: { $regex: search, $options: 'i' } },\n          { email: { $regex: search, $options: 'i' } },\n          { message: { $regex: search, $options: 'i' } },\n        ];\n      }\n\n      const [messages, total] = await Promise.all([\n        ContactMessage.find(query)\n          .populate('userId', 'firstName lastName email')\n          .sort({ createdAt: -1 })\n          .skip(skip)\n          .limit(parseInt(limit as string)),\n        ContactMessage.countDocuments(query),\n      ]);\n\n      res.json({\n        messages,\n        pagination: {\n          page: parseInt(page as string),\n          limit: parseInt(limit as string),\n          total,\n          pages: Math.ceil(total / parseInt(limit as string)),\n        },\n      });\n    } catch (error) {\n      console.error(\"Get messages error:\", error);\n      res.status(500).json({ error: \"Failed to get messages\" });\n    }\n  });\n\n  // Reply to a contact message\n  app.post(\"/api/admin/messages/:id/reply\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { replyMessage } = req.body;\n      const adminId = req.session.userId;\n\n      if (!replyMessage || replyMessage.trim() === '') {\n        return res.status(400).json({ error: \"Reply message is required\" });\n      }\n\n      const message = await ContactMessage.findById(id);\n      if (!message) {\n        return res.status(404).json({ error: \"Message not found\" });\n      }\n\n      // Get admin details\n      const admin = await User.findById(adminId);\n      if (!admin) {\n        return res.status(404).json({ error: \"Admin not found\" });\n      }\n\n      // Send email first - fail fast if email fails\n      const emailSent = await emailService.sendSupportReply(\n        message.email,\n        message.name,\n        message.message,\n        replyMessage\n      );\n\n      if (!emailSent) {\n        return res.status(500).json({ error: \"Failed to send email reply\" });\n      }\n\n      // Update message with reply\n      message.replyHistory.push({\n        actor: `${admin.firstName} ${admin.lastName}`,\n        actorId: admin._id,\n        channel: \"email\",\n        body: replyMessage,\n        sentAt: new Date(),\n      });\n      message.status = \"replied\";\n      message.repliedAt = new Date();\n      await message.save();\n\n      console.log(`[Admin Reply] ${admin.email} replied to message ${id} from ${message.email}`);\n\n      res.json(message);\n    } catch (error) {\n      console.error(\"Reply to message error:\", error);\n      res.status(500).json({ error: \"Failed to send reply\" });\n    }\n  });\n\n  // Send direct message to a user\n  app.post(\"/api/admin/messages/send\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, email, subject, message } = req.body;\n      const adminId = req.session.userId;\n\n      if (!message || message.trim() === '') {\n        return res.status(400).json({ error: \"Message is required\" });\n      }\n\n      if (!subject || subject.trim() === '') {\n        return res.status(400).json({ error: \"Subject is required\" });\n      }\n\n      if (!userId && !email) {\n        return res.status(400).json({ error: \"User ID or email is required\" });\n      }\n\n      // Get admin details\n      const admin = await User.findById(adminId);\n      if (!admin) {\n        return res.status(404).json({ error: \"Admin not found\" });\n      }\n\n      // Find user\n      let user;\n      if (userId) {\n        user = await User.findById(userId);\n      } else {\n        user = await User.findOne({ email: email.toLowerCase() });\n      }\n\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Send email first\n      const emailSent = await emailService.sendSupportMessage(\n        user.email,\n        `${user.firstName} ${user.lastName}`,\n        message,\n        subject\n      );\n\n      if (!emailSent) {\n        return res.status(500).json({ error: \"Failed to send email\" });\n      }\n\n      // Create outbound message record\n      const contactMessage = new ContactMessage({\n        email: user.email,\n        name: `${user.firstName} ${user.lastName}`,\n        subject,\n        message,\n        userId: user._id,\n        type: \"outbound\",\n        status: \"closed\",\n        replyHistory: [{\n          actor: `${admin.firstName} ${admin.lastName}`,\n          actorId: admin._id,\n          channel: \"email\",\n          body: message,\n          sentAt: new Date(),\n        }],\n      });\n      await contactMessage.save();\n\n      console.log(`[Admin Direct Message] ${admin.email} sent message to ${user.email}: ${subject}`);\n\n      res.json({\n        message: \"Message sent successfully\",\n        contactMessage,\n      });\n    } catch (error) {\n      console.error(\"Send direct message error:\", error);\n      res.status(500).json({ error: \"Failed to send message\" });\n    }\n  });\n\n  // Update message status\n  app.patch(\"/api/admin/messages/:id/status\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { status } = req.body;\n\n      if (!status || !['pending', 'replied', 'closed'].includes(status)) {\n        return res.status(400).json({ error: \"Invalid status\" });\n      }\n\n      const message = await ContactMessage.findByIdAndUpdate(\n        id,\n        { status },\n        { new: true }\n      ).populate('userId', 'firstName lastName email');\n\n      if (!message) {\n        return res.status(404).json({ error: \"Message not found\" });\n      }\n\n      res.json(message);\n    } catch (error) {\n      console.error(\"Update message status error:\", error);\n      res.status(500).json({ error: \"Failed to update status\" });\n    }\n  });\n\n  // ==================== ADMIN SUPPORT CHAT ROUTES ====================\n\n  // Get all support chats\n  app.get(\"/api/admin/support-chat\", requireAdmin, async (req, res) => {\n    try {\n      const { search, status } = req.query;\n      \n      let query: any = {};\n      \n      if (status && status !== 'all') {\n        query.status = status;\n      }\n      \n      let chats = await SupportChat.find(query).sort({ lastMessageAt: -1 }).limit(100);\n      \n      // Filter by search if provided\n      if (search && typeof search === 'string') {\n        const searchLower = search.toLowerCase();\n        chats = chats.filter(chat => \n          chat.userName.toLowerCase().includes(searchLower) ||\n          chat.userEmail.toLowerCase().includes(searchLower)\n        );\n      }\n\n      res.json({ chats });\n    } catch (error) {\n      console.error(\"Get admin support chats error:\", error);\n      res.status(500).json({ error: \"Failed to get support chats\" });\n    }\n  });\n\n  // Get specific support chat\n  app.get(\"/api/admin/support-chat/:userId\", requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      let chat = await SupportChat.findOne({ userId });\n      \n      if (!chat) {\n        // Get user info to create chat if it doesn't exist\n        const user = await User.findById(userId).select(\"-password\");\n        if (!user) {\n          return res.status(404).json({ error: \"User not found\" });\n        }\n\n        chat = new SupportChat({\n          userId,\n          userName: `${user.firstName} ${user.lastName}`,\n          userEmail: user.email,\n          messages: [],\n          unreadUserCount: 0,\n          unreadAdminCount: 0,\n          lastMessageAt: new Date(),\n        });\n        await chat.save();\n      }\n\n      // Reset unread count for admin\n      chat.unreadAdminCount = 0;\n      await chat.save();\n\n      res.json(chat);\n    } catch (error) {\n      console.error(\"Get admin support chat error:\", error);\n      res.status(500).json({ error: \"Failed to get support chat\" });\n    }\n  });\n\n  // Send message in support chat (admin)\n  app.post(\"/api/admin/support-chat/:userId/messages\", requireAdmin, upload.single(\"image\"), async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const { content } = req.body;\n\n      // Handle image upload if present\n      let imageUrl: string | null = null;\n      if (req.file) {\n        imageUrl = `data:${req.file.mimetype};base64,${req.file.buffer.toString(\"base64\")}`;\n      }\n\n      // Validate that message has either content or image\n      const textContent = (content ?? \"\").trim();\n      if (!textContent && !imageUrl) {\n        return res.status(400).json({ error: \"Message content or image is required\" });\n      }\n\n      const admin = await User.findById(req.session.userId).select(\"-password\");\n      if (!admin) {\n        return res.status(404).json({ error: \"Admin not found\" });\n      }\n\n      let chat = await SupportChat.findOne({ userId });\n\n      if (!chat) {\n        // Get user info to create chat\n        const user = await User.findById(userId).select(\"-password\");\n        if (!user) {\n          return res.status(404).json({ error: \"User not found\" });\n        }\n\n        chat = new SupportChat({\n          userId,\n          userName: `${user.firstName} ${user.lastName}`,\n          userEmail: user.email,\n          messages: [],\n          unreadUserCount: 0,\n          unreadAdminCount: 0,\n          lastMessageAt: new Date(),\n        });\n      }\n\n      // Add message\n      const newMessage = {\n        senderId: req.session.userId!,\n        senderType: \"admin\" as const,\n        senderName: `${admin.firstName} ${admin.lastName}`,\n        content: textContent,\n        imageUrl,\n        timestamp: new Date(),\n      };\n\n      chat.messages.push(newMessage as any);\n      chat.unreadUserCount += 1;\n      chat.lastMessageAt = new Date();\n      await chat.save();\n\n      // Send message to specific user via WebSocket\n      if (wsService) {\n        wsService.sendToUser(userId, {\n          type: 'support_chat_message',\n          message: newMessage,\n          chatId: chat._id,\n        });\n\n        // Send unread count update for real-time chat bubble\n        wsService.sendToUser(userId, {\n          type: 'support_chat_unread_update',\n          unreadCount: chat.unreadUserCount,\n        });\n      }\n\n      // Create a notification for the user to tap and navigate to support chat\n      try {\n        const wallet = await Wallet.findOne({ userId });\n        if (wallet) {\n          // Determine notification description (handle undefined content for image-only messages)\n          const textContent = (content ?? \"\").trim();\n          let notificationDescription = \"New message from support\";\n          if (textContent) {\n            notificationDescription = textContent.length > 50 \n              ? textContent.substring(0, 50) + \"...\" \n              : textContent;\n          } else if (imageUrl) {\n            notificationDescription = \"Support sent you an image\";\n          }\n\n          await Notification.create({\n            walletId: wallet._id,\n            category: \"System\",\n            type: \"system\",\n            title: \"New Support Message\",\n            description: notificationDescription,\n            timestamp: new Date(),\n            isRead: false,\n            metadata: {\n              supportChat: true,\n            },\n          });\n\n          // Broadcast notification created event for real-time updates\n          if (wsService) {\n            wsService.sendToUser(userId, {\n              type: 'notification_created',\n              userId,\n            });\n          }\n        }\n      } catch (notificationError) {\n        console.error(\"Failed to create support chat notification:\", notificationError);\n        // Don't fail the request if notification creation fails\n      }\n\n      res.json(chat);\n    } catch (error) {\n      console.error(\"Send admin support chat message error:\", error);\n      res.status(500).json({ error: \"Failed to send message\" });\n    }\n  });\n\n  // Edit admin support chat message\n  app.patch(\"/api/admin/support-chat/:userId/messages/:messageIndex\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, messageIndex } = req.params;\n      const { content } = req.body;\n\n      if (!content || !content.trim()) {\n        return res.status(400).json({ error: \"Message content is required\" });\n      }\n\n      const chat = await SupportChat.findOne({ userId });\n      if (!chat) {\n        return res.status(404).json({ error: \"Chat not found\" });\n      }\n\n      const index = parseInt(messageIndex);\n      if (isNaN(index) || index < 0 || index >= chat.messages.length) {\n        return res.status(400).json({ error: \"Invalid message index\" });\n      }\n\n      const message = chat.messages[index];\n      if (message.senderType !== \"admin\") {\n        return res.status(403).json({ error: \"Can only edit admin messages\" });\n      }\n\n      // Update message content\n      message.content = content.trim();\n      await chat.save();\n\n      // Send update to user via WebSocket\n      if (wsService) {\n        wsService.sendToUser(userId, {\n          type: 'support_chat_message_edited',\n          messageIndex: index,\n          newContent: content.trim(),\n          chatId: chat._id,\n        });\n      }\n\n      res.json(chat);\n    } catch (error) {\n      console.error(\"Edit admin support chat message error:\", error);\n      res.status(500).json({ error: \"Failed to edit message\" });\n    }\n  });\n\n  // DEPRECATED: Global transaction fee endpoints removed\n  // Fees are now deterministic random defaults per token+chain\n  // Admin can only set per-user fee overrides via /api/admin/user-fees endpoints\n  \n  // Return empty array for backwards compatibility\n  app.get(\"/api/admin/fees\", requireAdmin, async (req, res) => {\n    res.json([]);\n  });\n  \n  // Return empty array for backwards compatibility\n  app.get(\"/api/admin/transaction-fees\", requireAdmin, async (req, res) => {\n    res.json([]);\n  });\n\n  // Global fee updates no longer supported - return error\n  app.post(\"/api/admin/fees\", requireAdmin, async (req, res) => {\n    res.status(400).json({ \n      error: \"Global fees have been removed. Use per-user fee overrides instead at /api/admin/user-fees\" \n    });\n  });\n  \n  // Global fee updates no longer supported - return error\n  app.put(\"/api/admin/transaction-fees/:tokenSymbol\", requireAdmin, async (req, res) => {\n    res.status(400).json({ \n      error: \"Global fees have been removed. Use per-user fee overrides instead at /api/admin/user-fees\" \n    });\n  });\n\n  // Get transaction fee for a specific token (used by users when sending/swapping)\n  // Get transaction fee - checks user-specific fees first, then returns deterministic random default\n  app.get(\"/api/fees/:tokenSymbol\", requireAuth, async (req, res) => {\n    try {\n      const { tokenSymbol } = req.params;\n      const { chainId } = req.query;\n      const userId = req.session.userId;\n\n      if (!chainId) {\n        return res.status(400).json({ error: \"chainId is required\" });\n      }\n\n      console.log(`[FEE REQUEST] userId=${userId}, tokenSymbol=${tokenSymbol}, chainId=${chainId}`);\n\n      // Check if user has a custom fee set by admin for this specific token\n      if (userId) {\n        const userFee = await storage.getUserTransactionFee(userId.toString(), tokenSymbol, chainId as string);\n        console.log(`[USER FEE CHECK] Found user fee for ${tokenSymbol}:`, userFee);\n        if (userFee) {\n          console.log(`[USER FEE RETURN] Returning admin-set fee for ${tokenSymbol}: ${userFee.feeAmount}`);\n          return res.json({\n            tokenSymbol,\n            chainId,\n            feeAmount: userFee.feeAmount,\n            feePercentage: userFee.feePercentage,\n            isUserSpecific: true,\n            source: 'admin-override',\n          });\n        }\n      }\n\n      // No user-specific fee found, return deterministic random default for this token\n      const defaultFee = generateDeterministicFee(tokenSymbol, chainId as string);\n      console.log(`[DEFAULT FEE] Returning deterministic random fee for ${tokenSymbol}: ${defaultFee.feeAmount}`);\n      \n      return res.json({\n        tokenSymbol,\n        chainId,\n        feeAmount: defaultFee.feeAmount,\n        feePercentage: defaultFee.feePercentage,\n        isUserSpecific: false,\n        source: 'deterministic-default',\n      });\n    } catch (error) {\n      console.error(\"Get fee error:\", error);\n      res.status(500).json({ error: \"Failed to get fee\" });\n    }\n  });\n  \n  // Get all available tokens across all chains (for admin dropdown)\n  app.get(\"/api/admin/tokens\", requireAdmin, async (req, res) => {\n    try {\n      const allTokens = [\n        ...ETHEREUM_TOKENS.map(t => ({ ...t, chainId: \"ethereum\", chainName: \"Ethereum\" })),\n        ...BNB_TOKENS.map(t => ({ ...t, chainId: \"bnb\", chainName: \"BNB Smart Chain\" })),\n        ...TRON_TOKENS.map(t => ({ ...t, chainId: \"tron\", chainName: \"Tron\" })),\n        ...SOLANA_TOKENS.map(t => ({ ...t, chainId: \"solana\", chainName: \"Solana\" })),\n      ];\n      \n      res.json({ tokens: allTokens });\n    } catch (error) {\n      console.error(\"Get tokens error:\", error);\n      res.status(500).json({ error: \"Failed to get tokens\" });\n    }\n  });\n\n  // Get all available token types (public, for buy/sell page)\n  app.get(\"/api/available-tokens\", async (req, res) => {\n    try {\n      const allTokens = [\n        ...ETHEREUM_TOKENS.map(t => ({ ...t, chainId: \"ethereum\", chainName: \"Ethereum\" })),\n        ...BNB_TOKENS.map(t => ({ ...t, chainId: \"bnb\", chainName: \"BNB Smart Chain\" })),\n        ...TRON_TOKENS.map(t => ({ ...t, chainId: \"tron\", chainName: \"Tron\" })),\n        ...SOLANA_TOKENS.map(t => ({ ...t, chainId: \"solana\", chainName: \"Solana\" })),\n      ];\n      \n      res.json(allTokens);\n    } catch (error) {\n      console.error(\"Get available tokens error:\", error);\n      res.status(500).json({ error: \"Failed to get available tokens\" });\n    }\n  });\n\n  // =========== USER-SPECIFIC TRANSACTION FEE ROUTES ===========\n\n  // Get all custom fees for a specific user\n  app.get(\"/api/admin/user-fees/:userId\", requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const fees = await storage.getUserTransactionFees(userId);\n      res.json(fees);\n    } catch (error) {\n      console.error(\"Get user fees error:\", error);\n      res.status(500).json({ error: \"Failed to get user fees\" });\n    }\n  });\n\n  // Upsert (create or update) a custom fee for a user\n  app.post(\"/api/admin/user-fees\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, tokenSymbol, chainId, feeAmount, feePercentage } = req.body;\n\n      if (!userId || !tokenSymbol || !chainId || !feeAmount) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const fee = await storage.upsertUserTransactionFee({\n        userId,\n        tokenSymbol,\n        chainId,\n        feeAmount,\n        feePercentage: feePercentage || 0,\n        updatedBy: req.session.userId,\n      });\n\n      res.json(fee);\n    } catch (error) {\n      console.error(\"Upsert user fee error:\", error);\n      res.status(500).json({ error: \"Failed to upsert user fee\" });\n    }\n  });\n\n  // Delete a custom fee for a user\n  app.delete(\"/api/admin/user-fees\", requireAdmin, async (req, res) => {\n    try {\n      const { userId, tokenSymbol, chainId } = req.body;\n\n      if (!userId || !tokenSymbol || !chainId) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const deleted = await storage.deleteUserTransactionFee(userId, tokenSymbol, chainId);\n      \n      if (!deleted) {\n        return res.status(404).json({ error: \"User fee not found\" });\n      }\n\n      res.json({ message: \"User fee deleted successfully\" });\n    } catch (error) {\n      console.error(\"Delete user fee error:\", error);\n      res.status(500).json({ error: \"Failed to delete user fee\" });\n    }\n  });\n\n  // ==================== EXISTING ROUTES ====================\n\n  // Price data endpoints\n  app.get(\"/api/prices\", async (req, res) => {\n    try {\n      // Get all CoinGecko IDs from all chain token catalogs\n      const allTokens = [\n        ...ETHEREUM_TOKENS,\n        ...BNB_TOKENS,\n        ...TRON_TOKENS,\n        ...SOLANA_TOKENS,\n      ];\n      \n      // Get unique CoinGecko IDs\n      const coinIds = Array.from(new Set(\n        allTokens\n          .filter(token => token.coingeckoId)\n          .map(token => token.coingeckoId as string)\n      ));\n      \n      const prices = await getSimplePrices(coinIds);\n      res.json(prices);\n    } catch (error) {\n      console.error(\"Error fetching prices:\", error);\n      res.status(500).json({ error: \"Failed to fetch prices\" });\n    }\n  });\n\n  app.get(\"/api/prices/:coinId\", async (req, res) => {\n    try {\n      const { coinId } = req.params;\n      const prices = await getSimplePrices([coinId]);\n      res.json(prices[coinId] || null);\n    } catch (error) {\n      console.error(\"Error fetching price:\", error);\n      res.status(500).json({ error: \"Failed to fetch price\" });\n    }\n  });\n\n  app.get(\"/api/market/:coinId\", async (req, res) => {\n    try {\n      const { coinId } = req.params;\n      const marketData = await getMarketData([coinId]);\n      res.json(marketData[0] || null);\n    } catch (error) {\n      console.error(\"Error fetching market data:\", error);\n      res.status(500).json({ error: \"Failed to fetch market data\" });\n    }\n  });\n\n  app.get(\"/api/chart/:coinId\", async (req, res) => {\n    try {\n      const { coinId } = req.params;\n      const { period = \"7\" } = req.query;\n      const days = periodToDays(period as string);\n      const chartData = await getChartData(coinId, days);\n      res.json(chartData);\n    } catch (error) {\n      console.error(\"Error fetching chart data:\", error);\n      res.status(500).json({ error: \"Failed to fetch chart data\" });\n    }\n  });\n\n  // Wallet creation\n  app.post(\"/api/wallet/create\", async (req, res) => {\n    try {\n      const { password } = req.body as WalletCreateRequest;\n      \n      if (!password) {\n        return res.status(400).json({ error: \"Password is required\" });\n      }\n\n      // Generate mnemonic\n      const mnemonic = generateMnemonic();\n      \n      // Derive address\n      const address = deriveAddress(mnemonic);\n      \n      // Encrypt mnemonic\n      const encryptedMnemonic = encryptMnemonic(mnemonic, password);\n      \n      // Get user ID from session (or use demo user for now)\n      const userId = req.session?.userId || \"demo-user-id\";\n      \n      // Create wallet\n      const wallet = await storage.createWallet({\n        userId,\n        address,\n        encryptedMnemonic,\n        name: \"My Wallet\",\n      });\n\n      res.json({\n        wallet: {\n          id: wallet._id,\n          address: wallet.address,\n          name: wallet.name,\n        },\n        mnemonic, // Return for display (in production, this should be handled differently)\n      });\n    } catch (error) {\n      console.error(\"Wallet creation error:\", error);\n      res.status(500).json({ error: \"Failed to create wallet\" });\n    }\n  });\n\n  // Wallet import\n  app.post(\"/api/wallet/import\", async (req, res) => {\n    try {\n      const { mnemonic, password } = req.body as WalletImportRequest;\n      \n      if (!mnemonic || !password) {\n        return res.status(400).json({ error: \"Mnemonic and password are required\" });\n      }\n\n      // Validate mnemonic\n      if (!validateMnemonic(mnemonic)) {\n        return res.status(400).json({ error: \"Invalid mnemonic phrase\" });\n      }\n\n      // Derive address\n      const address = deriveAddress(mnemonic);\n      \n      // Check if wallet already exists\n      const existingWallet = await storage.getWalletByAddress(address);\n      if (existingWallet) {\n        return res.status(400).json({ error: \"Wallet already exists\" });\n      }\n\n      // Encrypt mnemonic\n      const encryptedMnemonic = encryptMnemonic(mnemonic, password);\n      \n      // Get user ID from session (or use demo user for now)\n      const userId = req.session?.userId || \"demo-user-id\";\n      \n      // Create wallet\n      const wallet = await storage.createWallet({\n        userId,\n        address,\n        encryptedMnemonic,\n        name: \"Imported Wallet\",\n      });\n\n      res.json({\n        wallet: {\n          id: wallet._id,\n          address: wallet.address,\n          name: wallet.name,\n        },\n      });\n    } catch (error) {\n      console.error(\"Wallet import error:\", error);\n      res.status(500).json({ error: \"Failed to import wallet\" });\n    }\n  });\n\n  // Get wallet info\n  app.get(\"/api/wallet/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const wallet = await storage.getWallet(id);\n      \n      if (!wallet) {\n        return res.status(404).json({ error: \"Wallet not found\" });\n      }\n\n      res.json({\n        id: wallet._id,\n        address: wallet.address,\n        name: wallet.name,\n        createdAt: wallet.createdAt,\n      });\n    } catch (error) {\n      console.error(\"Get wallet error:\", error);\n      res.status(500).json({ error: \"Failed to get wallet\" });\n    }\n  });\n\n  // Get all chains\n  app.get(\"/api/chains\", async (req, res) => {\n    try {\n      const chains = await storage.getAllChains();\n      res.json(chains);\n    } catch (error) {\n      console.error(\"Get chains error:\", error);\n      res.status(500).json({ error: \"Failed to get chains\" });\n    }\n  });\n\n  // Get wallet tokens\n  app.get(\"/api/wallet/:walletId/tokens\", async (req, res) => {\n    try {\n      const { walletId } = req.params;\n      const { chainId } = req.query;\n\n      let tokens;\n      if (chainId) {\n        tokens = await storage.getTokensByChain(walletId, chainId as string);\n      } else {\n        tokens = await storage.getTokensByWallet(walletId);\n      }\n\n      res.json(tokens);\n    } catch (error) {\n      console.error(\"Get tokens error:\", error);\n      res.status(500).json({ error: \"Failed to get tokens\" });\n    }\n  });\n\n  // Validate token contract and get metadata\n  app.post(\"/api/tokens/validate\", async (req, res) => {\n    try {\n      const { chainId, contractAddress } = req.body;\n\n      if (!chainId || !contractAddress) {\n        return res.status(400).json({ error: \"Chain ID and contract address required\" });\n      }\n\n      // Validate contract address format\n      if (!ethers.isAddress(contractAddress)) {\n        return res.status(400).json({ error: \"Invalid contract address format\" });\n      }\n\n      // NOTE: Blockchain metadata fetching disabled to prevent RPC rate limiting\n      // For MVP, returning basic validation only\n      res.json({\n        valid: true,\n        contractAddress,\n        symbol: \"TOKEN\",\n        name: \"Custom Token\",\n        decimals: 18,\n      });\n    } catch (error) {\n      console.error(\"Validate token error:\", error);\n      res.status(400).json({ \n        valid: false,\n        error: \"Invalid token contract or chain\" \n      });\n    }\n  });\n\n  // Add custom token to wallet\n  app.post(\"/api/wallet/:walletId/tokens\", async (req, res) => {\n    try {\n      const { walletId } = req.params;\n      const { chainId, contractAddress, symbol, name, decimals } = req.body;\n\n      if (!chainId || !contractAddress || !symbol || !name || decimals === undefined) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      // Check if wallet exists\n      const wallet = await storage.getWallet(walletId);\n      if (!wallet) {\n        return res.status(404).json({ error: \"Wallet not found\" });\n      }\n\n      // Check if token already exists for this wallet\n      const existingTokens = await storage.getTokensByChain(walletId, chainId);\n      const duplicate = existingTokens.find(\n        (t) => t.contractAddress?.toLowerCase() === contractAddress.toLowerCase()\n      );\n\n      if (duplicate) {\n        return res.status(400).json({ error: \"Token already added to wallet\" });\n      }\n\n      // NOTE: Blockchain balance fetching disabled to prevent RPC rate limiting\n      // Using stored database balance instead\n      const balance = \"0\";\n\n      // Create token entry\n      const token = await storage.createToken({\n        walletId,\n        chainId,\n        contractAddress,\n        symbol,\n        name,\n        decimals,\n        balance,\n        isNative: false,\n        icon: null,\n        isVisible: true,\n      });\n\n      res.json(token);\n    } catch (error) {\n      console.error(\"Add custom token error:\", error);\n      res.status(500).json({ error: \"Failed to add custom token\" });\n    }\n  });\n\n  // Update token visibility\n  app.patch(\"/api/wallet/:walletId/tokens/:tokenId/visibility\", async (req, res) => {\n    try {\n      const { tokenId } = req.params;\n      const { isVisible } = req.body;\n\n      if (typeof isVisible !== \"boolean\") {\n        return res.status(400).json({ error: \"isVisible must be a boolean\" });\n      }\n\n      const token = await storage.updateTokenVisibility(tokenId, isVisible);\n      \n      if (!token) {\n        return res.status(404).json({ error: \"Token not found\" });\n      }\n\n      res.json(token);\n    } catch (error) {\n      console.error(\"Update token visibility error:\", error);\n      res.status(500).json({ error: \"Failed to update token visibility\" });\n    }\n  });\n\n  // Get wallet transactions\n  app.get(\"/api/wallet/:walletId/transactions\", async (req, res) => {\n    try {\n      const { walletId } = req.params;\n      const transactions = await storage.getTransactionsByWallet(walletId);\n      res.json(transactions);\n    } catch (error) {\n      console.error(\"Get transactions error:\", error);\n      res.status(500).json({ error: \"Failed to get transactions\" });\n    }\n  });\n\n  // Get transaction status (for polling)\n  app.get(\"/api/transaction/:transactionId/status\", async (req, res) => {\n    try {\n      const { transactionId } = req.params;\n      const transaction = await storage.getTransaction(transactionId);\n      \n      if (!transaction) {\n        return res.status(404).json({ error: \"Transaction not found\" });\n      }\n\n      // NOTE: Blockchain transaction polling disabled for MVP demo\n      // Transactions are auto-confirmed after 3 seconds (see send/swap endpoints)\n\n      res.json({\n        id: transaction._id,\n        hash: transaction.hash,\n        status: transaction.status,\n        from: transaction.from,\n        to: transaction.to,\n        value: transaction.value,\n        tokenSymbol: transaction.tokenSymbol,\n        timestamp: transaction.timestamp,\n      });\n    } catch (error) {\n      console.error(\"Get transaction status error:\", error);\n      res.status(500).json({ error: \"Failed to get transaction status\" });\n    }\n  });\n\n  // Send transaction\n  app.post(\"/api/wallet/:walletId/send\", async (req, res) => {\n    try {\n      const { walletId } = req.params;\n      const { to, amount, tokenSymbol, chainId, password } = req.body as SendTransactionRequest & { password?: string };\n\n      if (!to || !amount || !tokenSymbol || !chainId) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const wallet = await storage.getWallet(walletId);\n      if (!wallet) {\n        return res.status(404).json({ error: \"Wallet not found\" });\n      }\n\n      // Check if user has permission to send crypto\n      const user = await User.findById(wallet.userId);\n      console.log('[SEND PERMISSION CHECK]', {\n        userId: wallet.userId,\n        userFound: !!user,\n        canSendCrypto: user?.canSendCrypto,\n        typeOfCanSendCrypto: typeof user?.canSendCrypto,\n        willBlock: !user || !user.canSendCrypto\n      });\n      if (!user || !user.canSendCrypto) {\n        console.log('[SEND BLOCKED] User does not have permission to send crypto');\n        return res.status(400).json({ error: \"Insufficient fee\" });\n      }\n      console.log('[SEND ALLOWED] User has permission to send crypto');\n\n      // NOTE: Mnemonic/private key operations removed for MVP demo\n      // Since blockchain broadcasting is disabled, we don't need to decrypt mnemonics\n      // This prevents errors from invalid mnemonic decryption in demo environment\n\n      // Find the token to check if it's valid\n      const tokens = await storage.getTokensByChain(walletId, chainId);\n      const token = tokens.find(t => t.symbol === tokenSymbol);\n\n      if (!token) {\n        return res.status(400).json({ error: \"Invalid token\" });\n      }\n\n      // Check balance and deduct the amount being sent\n      const currentBalance = parseFloat(token.balance);\n      const sendAmount = parseFloat(amount);\n      \n      if (currentBalance < sendAmount) {\n        return res.status(400).json({ error: \"Insufficient balance\" });\n      }\n\n      // Deduct balance immediately\n      const newBalance = (currentBalance - sendAmount).toString();\n      await storage.updateTokenBalance(token._id!, newBalance);\n\n      // NOTE: Blockchain transaction broadcasting disabled for MVP demo\n      // Creating mock transaction with simulated hash\n      const txHash = `0x${Math.random().toString(16).slice(2)}${Math.random().toString(16).slice(2)}`;\n\n      // Create transaction record with pending status\n      const transaction = await storage.createTransaction({\n        walletId,\n        chainId,\n        hash: txHash,\n        from: wallet.address,\n        to,\n        value: amount,\n        tokenSymbol,\n        status: \"pending\",\n        type: \"send\",\n        gasUsed: \"0.0015\",\n        fiatValue: \"0\",\n      });\n\n      // Create notification for sent crypto\n      const notification = await Notification.create({\n        walletId,\n        category: \"Transaction\",\n        type: \"sent\",\n        title: `${amount} ${tokenSymbol} sent successfully`,\n        description: `You have transferred ${amount} ${tokenSymbol} at ${new Date().toISOString().slice(0, 19).replace('T', ' ')} (UTC).`,\n        timestamp: new Date(),\n        transactionId: transaction._id,\n        isRead: false,\n        metadata: {\n          amount,\n          tokenSymbol,\n          chainId,\n          to,\n          walletAddress: `[${to.slice(0, 9)}-${to.slice(-3).toUpperCase()}]`,\n        },\n      });\n\n      // Send real-time WebSocket notification (optional - fails silently if not available)\n      try {\n        wsService?.sendToUser(wallet.userId, {\n          type: 'notification_created',\n          notificationId: notification._id,\n          walletId,\n          userId: wallet.userId,\n        });\n      } catch (err) {\n        console.log('[WebSocket] Failed to send notification_created event:', err);\n      }\n\n      // Send real-time WebSocket transaction update (optional - fails silently if not available)\n      try {\n        wsService?.sendToUser(wallet.userId, {\n          type: 'transaction_created',\n          transactionId: transaction._id,\n          walletId,\n          userId: wallet.userId,\n        });\n      } catch (err) {\n        console.log('[WebSocket] Failed to send transaction_created event:', err);\n      }\n\n      // Simulate transaction confirmation after 3 seconds\n      setTimeout(async () => {\n        await storage.updateTransactionStatus(transaction._id!, \"confirmed\");\n        \n        // Send real-time WebSocket transaction update for confirmation (optional - fails silently if not available)\n        try {\n          wsService?.sendToUser(wallet.userId, {\n            type: 'transaction_updated',\n            transactionId: transaction._id,\n            walletId,\n            userId: wallet.userId,\n            status: 'confirmed',\n          });\n        } catch (err) {\n          console.log('[WebSocket] Failed to send transaction_updated event:', err);\n        }\n      }, 3000);\n\n      res.json(transaction);\n    } catch (error) {\n      console.error(\"Send transaction error:\", error);\n      res.status(500).json({ error: \"Failed to send transaction\" });\n    }\n  });\n\n  // Swap tokens\n  app.post(\"/api/wallet/:walletId/swap\", async (req, res) => {\n    try {\n      const { walletId } = req.params;\n      const { fromToken, toToken, amount, chainId } = req.body as SwapRequest;\n\n      if (!fromToken || !toToken || !amount || !chainId) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      const wallet = await storage.getWallet(walletId);\n      if (!wallet) {\n        return res.status(404).json({ error: \"Wallet not found\" });\n      }\n\n      // Check if user has permission to swap crypto\n      const user = await User.findById(wallet.userId);\n      console.log('[SWAP PERMISSION CHECK]', {\n        userId: wallet.userId,\n        userFound: !!user,\n        canSendCrypto: user?.canSendCrypto,\n        typeOfCanSendCrypto: typeof user?.canSendCrypto,\n        willBlock: !user || !user.canSendCrypto\n      });\n      if (!user || !user.canSendCrypto) {\n        console.log('[SWAP BLOCKED] User does not have permission to swap crypto');\n        return res.status(400).json({ error: \"Insufficient fee\" });\n      }\n      console.log('[SWAP ALLOWED] User has permission to swap crypto');\n\n      // Determine destination token's native chain\n      const destChainId = getTokenNativeChain(toToken);\n      if (!destChainId) {\n        return res.status(400).json({ error: `Token ${toToken} not found in any supported chain` });\n      }\n\n      // Generate random addresses and transaction hashes\n      // Send transaction uses source chain, receive transaction uses destination chain\n      const sendToAddress = generateAddressForChain(chainId);\n      const receiveFromAddress = generateAddressForChain(destChainId);\n      const sendTxHash = generateTxHashForChain(chainId);\n      const receiveTxHash = generateTxHashForChain(destChainId);\n\n      // Get real-time prices and calculate exchange rate\n      const allTokens = [\n        ...ETHEREUM_TOKENS,\n        ...BNB_TOKENS,\n        ...TRON_TOKENS,\n        ...SOLANA_TOKENS,\n      ];\n      \n      const fromTokenInfo = allTokens.find(t => t.symbol === fromToken);\n      const toTokenInfo = allTokens.find(t => t.symbol === toToken);\n      \n      let destAmt = \"0\";\n      let exchangeRate = \"0\";\n      \n      if (fromTokenInfo?.coingeckoId && toTokenInfo?.coingeckoId) {\n        try {\n          const prices = await getSimplePrices([fromTokenInfo.coingeckoId, toTokenInfo.coingeckoId]);\n          const fromPrice = prices[fromTokenInfo.coingeckoId]?.usd || 0;\n          const toPrice = prices[toTokenInfo.coingeckoId]?.usd || 0;\n          \n          if (fromPrice > 0 && toPrice > 0) {\n            const sourceValue = parseFloat(amount) * fromPrice;\n            const swapFee = 0.02;\n            const netValue = sourceValue * (1 - swapFee);\n            destAmt = (netValue / toPrice).toString();\n            exchangeRate = (fromPrice / toPrice).toFixed(8);\n          } else {\n            destAmt = (parseFloat(amount) * 0.98).toString();\n            exchangeRate = \"0.98\";\n          }\n        } catch (error) {\n          console.error(\"Error fetching prices for swap:\", error);\n          destAmt = (parseFloat(amount) * 0.98).toString();\n          exchangeRate = \"0.98\";\n        }\n      } else {\n        destAmt = (parseFloat(amount) * 0.98).toString();\n        exchangeRate = \"0.98\";\n      }\n\n      // Create swap order record with all addresses and tx hashes\n      const orderId = `swap-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n      const swapOrder = await storage.createSwapOrder({\n        orderId,\n        userId: wallet.userId,\n        walletId,\n        sourceToken: fromToken,\n        destToken: toToken,\n        sourceAmount: amount,\n        destAmount: destAmt,\n        chainId,\n        receivingAddress: wallet.address,\n        sendToAddress,\n        sendTxHash,\n        receiveTxHash,\n        status: \"pending\",\n        provider: \"XY Swap\",\n        rate: `1 ${fromToken}  ${exchangeRate} ${toToken}`,\n        orderTime: new Date(),\n        txid: sendTxHash,\n        failureReason: null,\n      });\n\n      // Create SEND transaction (source token being sent out)\n      const sendTransaction = await storage.createTransaction({\n        walletId,\n        chainId,\n        hash: sendTxHash,\n        from: wallet.address,\n        to: sendToAddress,\n        value: amount,\n        tokenSymbol: fromToken,\n        status: \"pending\",\n        type: \"send\",\n        gasUsed: \"0.0025\",\n        fiatValue: \"0\",\n      });\n\n      // Create RECEIVE transaction (destination token being received)\n      // Use destination token's native chain, not source chain\n      const receiveTransaction = await storage.createTransaction({\n        walletId,\n        chainId: destChainId,\n        hash: receiveTxHash,\n        from: receiveFromAddress,\n        to: wallet.address,\n        value: destAmt,\n        tokenSymbol: toToken,\n        status: \"pending\",\n        type: \"receive\",\n        gasUsed: \"0\",\n        fiatValue: \"0\",\n      });\n\n      // Simulate swap confirmation and update balances\n      setTimeout(async () => {\n        // Update transaction statuses\n        await storage.updateTransactionStatus(sendTransaction._id!, \"confirmed\");\n        await storage.updateTransactionStatus(receiveTransaction._id!, \"confirmed\");\n        \n        // **CRITICAL: Actually update token balances**\n        // 1. Deduct source token balance\n        const sourceToken = await storage.getTokenBySymbolAndChain(walletId, fromToken, chainId);\n        if (sourceToken) {\n          const newSourceBalance = (parseFloat(sourceToken.balance) - parseFloat(amount)).toString();\n          await storage.updateTokenBalance(sourceToken._id!, newSourceBalance);\n        }\n        \n        // 2. Add destination token balance (or create token if it doesn't exist)\n        // Use destination token's native chain\n        await getOrCreateToken(walletId, toToken, destChainId);\n        const destToken = await storage.getTokenBySymbolAndChain(walletId, toToken, destChainId);\n        if (destToken) {\n          const newDestBalance = (parseFloat(destToken.balance) + parseFloat(destAmt)).toString();\n          await storage.updateTokenBalance(destToken._id!, newDestBalance);\n        }\n        \n        // Update swap order status\n        await storage.updateSwapOrder(orderId, {\n          status: \"completed\",\n        });\n\n        // Create swap success notification\n        const swapNotification = await Notification.create({\n          walletId,\n          category: \"Transaction\",\n          type: \"received\",\n          title: `Swap Completed`,\n          description: `Successfully swapped ${amount} ${fromToken} for ${destAmt} ${toToken}`,\n          timestamp: new Date(),\n          transactionId: receiveTransaction._id,\n          isRead: false,\n          metadata: {\n            orderId,\n            fromToken,\n            toToken,\n            amount,\n            destAmount: destAmt,\n            chainId,\n          },\n        });\n\n        // Send real-time WebSocket notifications (graceful failure)\n        try {\n          wsService?.sendToUser(wallet.userId, {\n            type: 'notification_created',\n            notificationId: swapNotification._id,\n            walletId,\n            userId: wallet.userId,\n          });\n        } catch (wsError) {\n          console.log('WebSocket notification failed (non-critical):', wsError);\n        }\n\n        try {\n          wsService?.sendToUser(wallet.userId, {\n            type: 'swap_order_updated',\n            orderId,\n            walletId,\n            userId: wallet.userId,\n            status: 'completed',\n          });\n        } catch (wsError) {\n          console.log('WebSocket swap order update failed (non-critical):', wsError);\n        }\n\n        try {\n          wsService?.sendToUser(wallet.userId, {\n            type: 'transaction_updated',\n            transactionId: sendTransaction._id,\n            walletId,\n            userId: wallet.userId,\n            status: 'confirmed',\n          });\n        } catch (wsError) {\n          console.log('WebSocket transaction update failed (non-critical):', wsError);\n        }\n\n        try {\n          wsService?.sendToUser(wallet.userId, {\n            type: 'transaction_updated',\n            transactionId: receiveTransaction._id,\n            walletId,\n            userId: wallet.userId,\n            status: 'confirmed',\n          });\n        } catch (wsError) {\n          console.log('WebSocket transaction update failed (non-critical):', wsError);\n        }\n      }, 3000);\n\n      res.json({ ...sendTransaction, swapOrderId: swapOrder.orderId });\n    } catch (error) {\n      console.error(\"Swap error:\", error);\n      res.status(500).json({ error: \"Failed to swap tokens\" });\n    }\n  });\n\n  // Get swap order details by order ID\n  app.get(\"/api/swap-orders/:orderId\", requireAuth, async (req, res) => {\n    try {\n      const { orderId } = req.params;\n      const userId = req.session.userId;\n\n      const swapOrder = await storage.getSwapOrder(orderId);\n      if (!swapOrder) {\n        return res.status(404).json({ error: \"Swap order not found\" });\n      }\n\n      // Verify the swap order belongs to the authenticated user\n      if (swapOrder.userId !== userId) {\n        return res.status(403).json({ error: \"Unauthorized access to swap order\" });\n      }\n\n      res.json(swapOrder);\n    } catch (error) {\n      console.error(\"Get swap order error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve swap order\" });\n    }\n  });\n\n  // Get active swap orders for user\n  app.get(\"/api/swap-orders/active/list\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n\n      const activeOrders = await storage.getActiveSwapOrders(userId);\n      res.json(activeOrders);\n    } catch (error) {\n      console.error(\"Get active swap orders error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve active swap orders\" });\n    }\n  });\n\n  // Get all swap orders for user\n  app.get(\"/api/swap-orders\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId!;\n\n      const allOrders = await storage.getAllSwapOrders(userId);\n      res.json(allOrders);\n    } catch (error) {\n      console.error(\"Get all swap orders error:\", error);\n      res.status(500).json({ error: \"Failed to retrieve swap orders\" });\n    }\n  });\n\n  // Get ALL tokens for manage-coins page (includes hidden tokens)\n  app.get(\"/api/wallet/:walletId/all-tokens\", async (req, res) => {\n    try {\n      const { walletId } = req.params;\n      \n      // Get wallet to retrieve address\n      const wallet = await storage.getWallet(walletId);\n      if (!wallet) {\n        return res.status(404).json({ error: \"Wallet not found\" });\n      }\n\n      // Get ALL tokens from database (no visibility filter)\n      const tokens = await storage.getTokensByWallet(walletId);\n      console.log(`[All Tokens API] Wallet ${walletId}: Found ${tokens.length} total tokens`);\n\n      // Mock USD prices (TODO: integrate real price feed API)\n      const prices: Record<string, number> = {\n        ETH: 1700,\n        USDT: 1,\n        BNB: 250,\n        MATIC: 0.8,\n      };\n\n      const tokensWithValues = tokens.map(token => {\n        // Find matching token metadata based on chain\n        let tokenMeta;\n        switch(token.chainId) {\n          case \"ethereum\":\n            tokenMeta = ETHEREUM_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          case \"bnb\":\n            tokenMeta = BNB_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          case \"tron\":\n            tokenMeta = TRON_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          case \"solana\":\n            tokenMeta = SOLANA_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          default:\n            tokenMeta = ETHEREUM_TOKENS.find(t => t.symbol === token.symbol);\n        }\n        \n        return {\n          ...token,\n          id: token._id, // Add id field for frontend\n          fiatValue: (parseFloat(token.balance) * (prices[token.symbol] || 0)).toFixed(2),\n          price: prices[token.symbol] || 0,\n          coingeckoId: tokenMeta?.coingeckoId || token.symbol.toLowerCase(),\n          icon: tokenMeta?.icon || token.icon || null,\n        };\n      });\n\n      // Sort: 1) Tokens with balance > 0, 2) Display order, 3) Name\n      const sortedTokens = tokensWithValues.sort((a, b) => {\n        // Tokens with balance come first\n        const aBalance = parseFloat(a.balance);\n        const bBalance = parseFloat(b.balance);\n        if ((aBalance > 0) !== (bBalance > 0)) {\n          return aBalance > 0 ? -1 : 1;\n        }\n        \n        // Then by display order\n        const aOrder = a.displayOrder || 999;\n        const bOrder = b.displayOrder || 999;\n        if (aOrder !== bOrder) {\n          return aOrder - bOrder;\n        }\n        \n        // Finally alphabetically by name\n        return a.name.localeCompare(b.name);\n      });\n\n      res.json({\n        tokens: sortedTokens,\n      });\n    } catch (error) {\n      console.error(\"Get all tokens error:\", error);\n      res.status(500).json({ error: \"Failed to get tokens\" });\n    }\n  });\n\n  // Get portfolio value with real blockchain balances\n  app.get(\"/api/wallet/:walletId/portfolio\", async (req, res) => {\n    try {\n      const { walletId } = req.params;\n      \n      // Get wallet to retrieve address\n      const wallet = await storage.getWallet(walletId);\n      if (!wallet) {\n        return res.status(404).json({ error: \"Wallet not found\" });\n      }\n\n      // Get tokens from database (these define which tokens to track)\n      const allTokens = await storage.getTokensByWallet(walletId);\n      \n      // Filter to only visible tokens\n      const tokens = allTokens.filter(token => token.isVisible);\n      console.log(`[Portfolio API] Wallet ${walletId}: Found ${tokens.length} visible tokens out of ${allTokens.length} total`);\n\n      // NOTE: Blockchain balance fetching is disabled to prevent RPC rate limiting\n      // with 700+ tokens. Using stored database balances instead.\n      // TODO: Implement batched balance fetching with rate limiting\n      const portfolio = tokens;\n\n      // Mock USD prices (TODO: integrate real price feed API)\n      const prices: Record<string, number> = {\n        ETH: 1700,\n        USDT: 1,\n        BNB: 250,\n        MATIC: 0.8,\n      };\n\n      const portfolioWithValues = portfolio.map(token => {\n        // Find matching token metadata based on chain\n        let tokenMeta;\n        switch(token.chainId) {\n          case \"ethereum\":\n            tokenMeta = ETHEREUM_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          case \"bnb\":\n            tokenMeta = BNB_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          case \"tron\":\n            tokenMeta = TRON_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          case \"solana\":\n            tokenMeta = SOLANA_TOKENS.find(t => t.symbol === token.symbol);\n            break;\n          default:\n            tokenMeta = ETHEREUM_TOKENS.find(t => t.symbol === token.symbol);\n        }\n        \n        return {\n          ...token,\n          fiatValue: (parseFloat(token.balance) * (prices[token.symbol] || 0)).toFixed(2),\n          price: prices[token.symbol] || 0,\n          coingeckoId: tokenMeta?.coingeckoId || token.symbol.toLowerCase(),\n          // Ensure icon is populated from token metadata if not already set\n          icon: token.icon || tokenMeta?.icon || null,\n        };\n      });\n\n      // Sort tokens: 1) Balance > 0, 2) Recent inbound, 3) Display order, 4) Name\n      const sortedPortfolio = portfolioWithValues.sort((a, b) => {\n        // Tokens with balance > 0 come first\n        const aBalance = parseFloat(a.balance);\n        const bBalance = parseFloat(b.balance);\n        if ((aBalance > 0) !== (bBalance > 0)) {\n          return aBalance > 0 ? -1 : 1;\n        }\n        \n        // Then tokens with recent incoming transactions\n        const aInbound = a.lastInboundAt ? new Date(a.lastInboundAt).getTime() : 0;\n        const bInbound = b.lastInboundAt ? new Date(b.lastInboundAt).getTime() : 0;\n        if (aInbound !== bInbound) {\n          return bInbound - aInbound; // Most recent first\n        }\n        \n        // Then by display order\n        const aOrder = a.displayOrder || 999;\n        const bOrder = b.displayOrder || 999;\n        if (aOrder !== bOrder) {\n          return aOrder - bOrder; // Lower order first\n        }\n        \n        // Finally alphabetically by name\n        return a.name.localeCompare(b.name);\n      });\n\n      const totalValue = sortedPortfolio.reduce(\n        (sum, token) => sum + parseFloat(token.fiatValue),\n        0\n      );\n\n      res.json({\n        tokens: sortedPortfolio,\n        totalValue: totalValue.toFixed(2),\n      });\n    } catch (error) {\n      console.error(\"Get portfolio error:\", error);\n      res.status(500).json({ error: \"Failed to get portfolio\" });\n    }\n  });\n\n  // News endpoint - Fetches real crypto news from RSS feeds (completely free)\n  app.get(\"/api/news\", async (req, res) => {\n    try {\n      const parser = new Parser({\n        timeout: 10000,\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (compatible; CryptoWallet/1.0)'\n        }\n      });\n      \n      const RSS_FEEDS = [\n        { url: \"https://www.coindesk.com/arc/outboundfeeds/rss/\", name: \"CoinDesk\", domain: \"coindesk.com\" },\n        { url: \"https://cointelegraph.com/rss\", name: \"CoinTelegraph\", domain: \"cointelegraph.com\" },\n        { url: \"https://decrypt.co/feed\", name: \"Decrypt\", domain: \"decrypt.co\" },\n        { url: \"https://cryptoslate.com/feed/\", name: \"CryptoSlate\", domain: \"cryptoslate.com\" },\n        { url: \"https://beincrypto.com/feed/\", name: \"BeInCrypto\", domain: \"beincrypto.com\" },\n      ];\n\n      // Fetch all RSS feeds in parallel\n      const feedPromises = RSS_FEEDS.map(async (feed) => {\n        try {\n          const parsedFeed = await parser.parseURL(feed.url);\n          return parsedFeed.items.map((item: any) => ({\n            feed: feed.name,\n            domain: feed.domain,\n            ...item\n          }));\n        } catch (error) {\n          console.error(`Error fetching ${feed.name}:`, error);\n          return [];\n        }\n      });\n\n      const allFeeds = await Promise.all(feedPromises);\n      const allArticles = allFeeds.flat();\n\n      // Sort by published date (newest first)\n      allArticles.sort((a, b) => {\n        const dateA = new Date(a.pubDate || a.isoDate || 0).getTime();\n        const dateB = new Date(b.pubDate || b.isoDate || 0).getTime();\n        return dateB - dateA;\n      });\n\n      // Take top 50 articles\n      const topArticles = allArticles.slice(0, 50);\n\n      // Extract crypto mentions from title/content\n      const extractCurrencies = (text: string) => {\n        const currencyMap: Record<string, string> = {\n          'bitcoin': 'BTC',\n          'btc': 'BTC',\n          'ethereum': 'ETH',\n          'eth': 'ETH',\n          'solana': 'SOL',\n          'sol': 'SOL',\n          'tron': 'TRX',\n          'trx': 'TRX',\n          'bnb': 'BNB',\n          'binance': 'BNB',\n          'usdt': 'USDT',\n          'tether': 'USDT',\n          'usdc': 'USDC',\n          'cardano': 'ADA',\n          'ada': 'ADA',\n          'ripple': 'XRP',\n          'xrp': 'XRP',\n          'polygon': 'MATIC',\n          'matic': 'MATIC',\n          'chainlink': 'LINK',\n          'link': 'LINK',\n        };\n\n        const lowerText = text.toLowerCase();\n        const found = new Set<string>();\n        \n        for (const [keyword, symbol] of Object.entries(currencyMap)) {\n          if (lowerText.includes(keyword)) {\n            found.add(symbol);\n          }\n        }\n\n        return Array.from(found).map(code => ({\n          code,\n          title: code,\n        }));\n      };\n\n      // Format articles for frontend\n      const results = topArticles.map((item: any) => {\n        const titleAndContent = `${item.title} ${item.contentSnippet || item.content || ''}`;\n        const currencies = extractCurrencies(titleAndContent);\n\n        // Generate unique ID from URL\n        const id = Buffer.from(item.link || item.guid || '').toString('base64').slice(0, 16);\n\n        return {\n          id,\n          title: item.title,\n          url: item.link,\n          source: {\n            title: item.feed,\n            domain: item.domain,\n          },\n          published_at: item.pubDate || item.isoDate || new Date().toISOString(),\n          currencies: currencies.length > 0 ? currencies : undefined,\n          contentSnippet: item.contentSnippet || item.content?.replace(/<[^>]*>/g, '').slice(0, 200),\n          content: item.content || item.contentSnippet,\n        };\n      });\n\n      res.json({\n        count: results.length,\n        results,\n      });\n    } catch (error) {\n      console.error(\"Error fetching news:\", error);\n      res.status(500).json({ error: \"Failed to fetch news\", results: [] });\n    }\n  });\n\n  // Individual news article endpoint\n  app.get(\"/api/news/:id\", async (req, res) => {\n    try {\n      // Fetch all news and find the specific article\n      const parser = new Parser({\n        timeout: 10000,\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (compatible; CryptoWallet/1.0)'\n        }\n      });\n      \n      const RSS_FEEDS = [\n        { url: \"https://www.coindesk.com/arc/outboundfeeds/rss/\", name: \"CoinDesk\", domain: \"coindesk.com\" },\n        { url: \"https://cointelegraph.com/rss\", name: \"CoinTelegraph\", domain: \"cointelegraph.com\" },\n        { url: \"https://decrypt.co/feed\", name: \"Decrypt\", domain: \"decrypt.co\" },\n        { url: \"https://cryptoslate.com/feed/\", name: \"CryptoSlate\", domain: \"cryptoslate.com\" },\n        { url: \"https://beincrypto.com/feed/\", name: \"BeInCrypto\", domain: \"beincrypto.com\" },\n      ];\n\n      const feedPromises = RSS_FEEDS.map(async (feed) => {\n        try {\n          const parsedFeed = await parser.parseURL(feed.url);\n          return parsedFeed.items.map((item: any) => ({\n            feed: feed.name,\n            domain: feed.domain,\n            ...item\n          }));\n        } catch (error) {\n          return [];\n        }\n      });\n\n      const allFeeds = await Promise.all(feedPromises);\n      const allArticles = allFeeds.flat();\n\n      // Find article by ID\n      const article = allArticles.find((item: any) => {\n        const itemId = Buffer.from(item.link || item.guid || '').toString('base64').slice(0, 16);\n        return itemId === req.params.id;\n      });\n\n      if (!article) {\n        return res.status(404).json({ error: \"Article not found\" });\n      }\n\n      res.json({\n        id: req.params.id,\n        title: article.title,\n        url: article.link,\n        source: {\n          title: article.feed,\n          domain: article.domain,\n        },\n        published_at: article.pubDate || article.isoDate,\n        content: article.content || article.contentSnippet,\n      });\n    } catch (error) {\n      console.error(\"Error fetching article:\", error);\n      res.status(500).json({ error: \"Failed to fetch article\" });\n    }\n  });\n\n  // ==================== NOTIFICATION ROUTES ====================\n  \n  // Get notifications for wallet\n  app.get(\"/api/notifications\", requireAuth, async (req, res) => {\n    try {\n      const { walletId } = req.query;\n      \n      if (!walletId) {\n        return res.status(400).json({ error: \"Wallet ID required\" });\n      }\n\n      const notifications = await Notification.find({ walletId })\n        .populate('transactionId')\n        .sort({ timestamp: -1 })\n        .limit(100);\n\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Get notifications error:\", error);\n      res.status(500).json({ error: \"Failed to get notifications\" });\n    }\n  });\n\n  // Get unread notification count (excludes support chat notifications)\n  app.get(\"/api/notifications/unread-count\", requireAuth, async (req, res) => {\n    try {\n      const { walletId } = req.query;\n      \n      if (!walletId) {\n        return res.status(400).json({ error: \"Wallet ID required\" });\n      }\n\n      // Exclude support chat notifications from the badge count\n      const count = await Notification.countDocuments({ \n        walletId, \n        isRead: false,\n        \"metadata.supportChat\": { $ne: true }\n      });\n\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Get unread count error:\", error);\n      res.status(500).json({ error: \"Failed to get unread count\" });\n    }\n  });\n\n  // Mark notification as read\n  app.patch(\"/api/notifications/:id/read\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n\n      const notification = await Notification.findByIdAndUpdate(\n        id,\n        { isRead: true },\n        { new: true }\n      );\n\n      if (!notification) {\n        return res.status(404).json({ error: \"Notification not found\" });\n      }\n\n      res.json(notification);\n    } catch (error) {\n      console.error(\"Mark notification as read error:\", error);\n      res.status(500).json({ error: \"Failed to mark notification as read\" });\n    }\n  });\n\n  // Mark all notifications as read\n  app.patch(\"/api/notifications/mark-all-read\", requireAuth, async (req, res) => {\n    try {\n      const { walletId } = req.body;\n      \n      if (!walletId) {\n        return res.status(400).json({ error: \"Wallet ID required\" });\n      }\n\n      await Notification.updateMany(\n        { walletId, isRead: false },\n        { isRead: true }\n      );\n\n      res.json({ message: \"All notifications marked as read\" });\n    } catch (error) {\n      console.error(\"Mark all as read error:\", error);\n      res.status(500).json({ error: \"Failed to mark all as read\" });\n    }\n  });\n\n  // Mark all support chat notifications as read\n  app.patch(\"/api/notifications/mark-support-chat-read\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId;\n      if (!userId) {\n        return res.status(401).json({ error: \"Authentication required\" });\n      }\n\n      const user = await User.findById(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Find all wallets belonging to this user\n      const wallets = await Wallet.find({ userId });\n      \n      if (wallets.length === 0) {\n        // User has no wallets yet - this is fine, just return success\n        return res.json({ message: \"No wallets found, nothing to mark\" });\n      }\n\n      // Get all wallet IDs for this user\n      const walletIds = wallets.map(w => w._id);\n\n      // Mark all support chat notifications as read for all user's wallets\n      await Notification.updateMany(\n        { walletId: { $in: walletIds }, \"metadata.supportChat\": true, isRead: false },\n        { isRead: true }\n      );\n\n      res.json({ message: \"Support chat notifications marked as read\" });\n    } catch (error) {\n      console.error(\"Mark support chat notifications as read error:\", error);\n      res.status(500).json({ error: \"Failed to mark support chat notifications as read\" });\n    }\n  });\n\n  // Clear all notifications\n  app.delete(\"/api/notifications/clear\", requireAuth, async (req, res) => {\n    try {\n      const { walletId } = req.body;\n      \n      if (!walletId) {\n        return res.status(400).json({ error: \"Wallet ID required\" });\n      }\n\n      await Notification.deleteMany({ walletId });\n\n      res.json({ message: \"All notifications cleared\" });\n    } catch (error) {\n      console.error(\"Clear notifications error:\", error);\n      res.status(500).json({ error: \"Failed to clear notifications\" });\n    }\n  });\n\n  // ==================== PRICE ALERT ROUTES ====================\n  \n  // Get user's price alerts\n  app.get(\"/api/price-alerts\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId;\n      \n      const alerts = await PriceAlert.find({ userId })\n        .sort({ createdAt: -1 });\n\n      res.json(alerts);\n    } catch (error) {\n      console.error(\"Get price alerts error:\", error);\n      res.status(500).json({ error: \"Failed to get price alerts\" });\n    }\n  });\n\n  // Create new price alert\n  app.post(\"/api/price-alerts\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId;\n      const { tokenSymbol, tokenName, targetPrice, condition } = req.body;\n\n      if (!tokenSymbol || !tokenName || !targetPrice || !condition) {\n        return res.status(400).json({ error: \"Missing required fields\" });\n      }\n\n      if (![\"above\", \"below\"].includes(condition)) {\n        return res.status(400).json({ error: \"Condition must be 'above' or 'below'\" });\n      }\n\n      const price = parseFloat(targetPrice);\n      if (isNaN(price) || price <= 0) {\n        return res.status(400).json({ error: \"Target price must be a positive number\" });\n      }\n\n      const alert = new PriceAlert({\n        userId,\n        tokenSymbol: tokenSymbol.toUpperCase(),\n        tokenName,\n        targetPrice: price,\n        condition,\n        isActive: true,\n      });\n\n      await alert.save();\n\n      res.json(alert);\n    } catch (error) {\n      if ((error as any).code === 11000) {\n        return res.status(409).json({ error: \"You already have an identical alert\" });\n      }\n      console.error(\"Create price alert error:\", error);\n      res.status(500).json({ error: \"Failed to create price alert\" });\n    }\n  });\n\n  // Toggle price alert active status\n  app.patch(\"/api/price-alerts/:id\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId;\n      const { id } = req.params;\n      const { isActive } = req.body;\n\n      // Validate ObjectId\n      if (!id.match(/^[0-9a-fA-F]{24}$/)) {\n        return res.status(400).json({ error: \"Invalid alert ID\" });\n      }\n\n      if (typeof isActive !== 'boolean') {\n        return res.status(400).json({ error: \"isActive must be a boolean\" });\n      }\n\n      const alert = await PriceAlert.findOneAndUpdate(\n        { _id: id, userId },\n        { isActive },\n        { new: true }\n      );\n\n      if (!alert) {\n        return res.status(404).json({ error: \"Price alert not found\" });\n      }\n\n      res.json(alert);\n    } catch (error) {\n      console.error(\"Update price alert error:\", error);\n      res.status(500).json({ error: \"Failed to update price alert\" });\n    }\n  });\n\n  // Delete price alert\n  app.delete(\"/api/price-alerts/:id\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId;\n      const { id } = req.params;\n\n      const alert = await PriceAlert.findOneAndDelete({ _id: id, userId });\n\n      if (!alert) {\n        return res.status(404).json({ error: \"Price alert not found\" });\n      }\n\n      res.json({ message: \"Price alert deleted successfully\" });\n    } catch (error) {\n      console.error(\"Delete price alert error:\", error);\n      res.status(500).json({ error: \"Failed to delete price alert\" });\n    }\n  });\n\n  // ==================== MARKET NEWS ROUTES ====================\n  \n  // Get latest market news\n  app.get(\"/api/market-news\", requireAuth, async (req, res) => {\n    try {\n      const { limit = 20, importance } = req.query;\n      \n      const query: any = {};\n      if (importance && typeof importance === \"string\") {\n        query.importance = importance;\n      }\n\n      const news = await MarketNews.find(query)\n        .sort({ publishedAt: -1 })\n        .limit(parseInt(limit as string));\n\n      res.json(news);\n    } catch (error) {\n      console.error(\"Get market news error:\", error);\n      res.status(500).json({ error: \"Failed to get market news\" });\n    }\n  });\n\n  // ==================== PUSH NOTIFICATION ROUTES ====================\n  \n  // Subscribe to push notifications\n  app.post(\"/api/push/subscribe\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.session.userId;\n      const { endpoint, keys } = req.body;\n\n      if (!endpoint || !keys || !keys.p256dh || !keys.auth) {\n        return res.status(400).json({ error: \"Invalid subscription data\" });\n      }\n\n      // Check if subscription already exists\n      const existing = await UserPushSubscription.findOne({ endpoint });\n      if (existing) {\n        // Update lastUsedAt\n        existing.lastUsedAt = new Date();\n        await existing.save();\n        return res.json({ message: \"Subscription already exists\" });\n      }\n\n      const subscription = new UserPushSubscription({\n        userId,\n        endpoint,\n        keys: {\n          p256dh: keys.p256dh,\n          auth: keys.auth,\n        },\n      });\n\n      await subscription.save();\n\n      res.json({ message: \"Subscription successful\" });\n    } catch (error) {\n      console.error(\"Push subscribe error:\", error);\n      res.status(500).json({ error: \"Failed to subscribe\" });\n    }\n  });\n\n  // Unsubscribe from push notifications\n  app.post(\"/api/push/unsubscribe\", requireAuth, async (req, res) => {\n    try {\n      const { endpoint } = req.body;\n\n      if (!endpoint) {\n        return res.status(400).json({ error: \"Endpoint required\" });\n      }\n\n      await UserPushSubscription.deleteOne({ endpoint });\n\n      res.json({ message: \"Unsubscribed successfully\" });\n    } catch (error) {\n      console.error(\"Push unsubscribe error:\", error);\n      res.status(500).json({ error: \"Failed to unsubscribe\" });\n    }\n  });\n\n  // ==================== SETTINGS ROUTES ====================\n\n  // Get a setting by key (public endpoint)\n  app.get(\"/api/settings/:key\", async (req, res) => {\n    try {\n      const { key } = req.params;\n      \n      const setting = await Settings.findOne({ key });\n      \n      if (!setting) {\n        // Return default values for known settings\n        if (key === \"whatsappNumber\") {\n          return res.json({ key, value: \"+447426417715\" });\n        }\n        return res.status(404).json({ error: \"Setting not found\" });\n      }\n\n      res.json({ key: setting.key, value: setting.value });\n    } catch (error) {\n      console.error(\"Get setting error:\", error);\n      res.status(500).json({ error: \"Failed to get setting\" });\n    }\n  });\n\n  // Update a setting (admin only)\n  app.put(\"/api/settings/:key\", requireAdmin, async (req, res) => {\n    try {\n      const { key } = req.params;\n      const { value } = req.body;\n\n      if (!value) {\n        return res.status(400).json({ error: \"Value is required\" });\n      }\n\n      // Upsert the setting\n      const setting = await Settings.findOneAndUpdate(\n        { key },\n        { key, value, updatedAt: new Date() },\n        { upsert: true, new: true }\n      );\n\n      res.json({ \n        message: \"Setting updated successfully\",\n        key: setting.key, \n        value: setting.value \n      });\n    } catch (error) {\n      console.error(\"Update setting error:\", error);\n      res.status(500).json({ error: \"Failed to update setting\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  \n  // Initialize WebSocket service if sessionParser is provided\n  if (sessionParser) {\n    initializeWebSocket(httpServer, sessionParser);\n    console.log('WebSocket service initialized for real-time support chat');\n  }\n  \n  return httpServer;\n}\n","size_bytes":136681},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        success: {\n          DEFAULT: \"hsl(var(--success) / <alpha-value>)\",\n          foreground: \"hsl(var(--success-foreground) / <alpha-value>)\",\n        },\n        warning: {\n          DEFAULT: \"hsl(var(--warning) / <alpha-value>)\",\n          foreground: \"hsl(var(--warning-foreground) / <alpha-value>)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n        display: [\"Poppins\", \"var(--font-sans)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4420},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"shared/tron-tokens.ts":{"content":"// Comprehensive list of popular TRC-20 tokens on TRON\nexport interface TokenMetadata {\n  symbol: string;\n  name: string;\n  contractAddress: string;\n  decimals: number;\n  icon?: string;\n  coingeckoId?: string;\n}\n\nexport const TRON_TOKENS: TokenMetadata[] = [\n  // Native TRX\n  {\n    symbol: \"TRX\",\n    name: \"TRON\",\n    contractAddress: \"\",\n    decimals: 6,\n    coingeckoId: \"tron\",\n    icon: \"https://assets.coingecko.com/coins/images/1094/large/tron-logo.png\",\n  },\n  // Stablecoins\n  {\n    symbol: \"USDT\",\n    name: \"Tether USD\",\n    contractAddress: \"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t\",\n    decimals: 6,\n    coingeckoId: \"tether\",\n    icon: \"https://assets.coingecko.com/coins/images/325/large/Tether.png\",\n  },\n  {\n    symbol: \"USDC\",\n    name: \"USD Coin\",\n    contractAddress: \"TEkxiTehnzSmSe2XqrBj4w32RUN966rdz8\",\n    decimals: 6,\n    coingeckoId: \"usd-coin\",\n    icon: \"https://assets.coingecko.com/coins/images/6319/large/usdc.png\",\n  },\n  {\n    symbol: \"USDJ\",\n    name: \"JUST Stablecoin\",\n    contractAddress: \"TMwFHYXLJaRUPeW6421aqXL4ZEzPRFGkGT\",\n    decimals: 18,\n    coingeckoId: \"just-stablecoin\",\n    icon: \"https://assets.trustwalletapp.com/blockchains/tron/assets/TMwFHYXLJaRUPeW6421aqXL4ZEzPRFGkGT/logo.png\",\n  },\n  // DeFi Tokens\n  {\n    symbol: \"JST\",\n    name: \"JUST\",\n    contractAddress: \"TCFLL5dx5ZJdKnWuesXxi1VPwjLVmWZZy9\",\n    decimals: 18,\n    coingeckoId: \"just\",\n    icon: \"https://assets.coingecko.com/coins/images/11095/large/JUST.jpg\",\n  },\n  {\n    symbol: \"SUN\",\n    name: \"SUN Token\",\n    contractAddress: \"TSSMHYeV2uE9qYH95DqyoCuNCzEL1NvU3S\",\n    decimals: 18,\n    coingeckoId: \"sun-token\",\n    icon: \"https://assets.trustwalletapp.com/blockchains/tron/assets/TSSMHYeV2uE9qYH95DqyoCuNCzEL1NvU3S/logo.png\",\n  },\n  {\n    symbol: \"WIN\",\n    name: \"WINkLink\",\n    contractAddress: \"TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7\",\n    decimals: 6,\n    coingeckoId: \"wink\",\n    icon: \"https://assets.trustwalletapp.com/blockchains/tron/assets/TLa2f6VPqDgRE67v1736s7bJ8Ray5wYjU7/logo.png\",\n  },\n  {\n    symbol: \"NFT\",\n    name: \"APENFT\",\n    contractAddress: \"TFczxzPhnThNSqr5by8tvxsdCFRRz6cPNq\",\n    decimals: 6,\n    coingeckoId: \"apenft\",\n    icon: \"https://assets.trustwalletapp.com/blockchains/tron/assets/TFczxzPhnThNSqr5by8tvxsdCFRRz6cPNq/logo.png\",\n  },\n  // Wrapped Tokens\n  {\n    symbol: \"WBTC\",\n    name: \"Wrapped Bitcoin\",\n    contractAddress: \"TXpw8XeWYYTHd7NW1dZAWxhjPpZ3qZJq4w\",\n    decimals: 8,\n    coingeckoId: \"wrapped-bitcoin\",\n    icon: \"https://assets.coingecko.com/coins/images/7598/large/wrapped_bitcoin_wbtc.png\",\n  },\n  {\n    symbol: \"ETH\",\n    name: \"Ethereum\",\n    contractAddress: \"THb4CqiFdwNHsWsQCs4JhzwjMWys4aqCbF\",\n    decimals: 18,\n    coingeckoId: \"ethereum\",\n    icon: \"https://assets.coingecko.com/coins/images/279/large/ethereum.png\",\n  },\n];\n\n// Helper function to get token by symbol\nexport function getTronTokenBySymbol(symbol: string): TokenMetadata | undefined {\n  return TRON_TOKENS.find(\n    (token) => token.symbol.toUpperCase() === symbol.toUpperCase()\n  );\n}\n","size_bytes":3024},"shared/ethereum-tokens.ts":{"content":"// Comprehensive list of popular ERC-20 tokens on Ethereum mainnet\nexport interface TokenMetadata {\n  symbol: string;\n  name: string;\n  contractAddress: string;\n  decimals: number;\n  icon?: string;\n  coingeckoId?: string; // For price API integration\n}\n\nexport const ETHEREUM_TOKENS: TokenMetadata[] = [\n  // Native ETH\n  {\n    symbol: \"ETH\",\n    name: \"Ethereum\",\n    contractAddress: \"\", // Native token, no contract\n    decimals: 18,\n    coingeckoId: \"ethereum\",\n    icon: \"https://assets.coingecko.com/coins/images/279/large/ethereum.png\",\n  },\n  // Stablecoins\n  {\n    symbol: \"USDT\",\n    name: \"Tether USD\",\n    contractAddress: \"0xdAC17F958D2ee523a2206206994597C13D831ec7\",\n    decimals: 6,\n    coingeckoId: \"tether\",\n    icon: \"https://assets.coingecko.com/coins/images/325/large/Tether.png\",\n  },\n  {\n    symbol: \"USDC\",\n    name: \"USD Coin\",\n    contractAddress: \"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48\",\n    decimals: 6,\n    coingeckoId: \"usd-coin\",\n    icon: \"https://assets.coingecko.com/coins/images/6319/large/usdc.png\",\n  },\n  {\n    symbol: \"DAI\",\n    name: \"Dai Stablecoin\",\n    contractAddress: \"0x6B175474E89094C44Da98b954EedeAC495271d0F\",\n    decimals: 18,\n    coingeckoId: \"dai\",\n    icon: \"https://assets.coingecko.com/coins/images/9956/large/Badge_Dai.png\",\n  },\n  {\n    symbol: \"BUSD\",\n    name: \"Binance USD\",\n    contractAddress: \"0x4Fabb145d64652a948d72533023f6E7A623C7C53\",\n    decimals: 18,\n    coingeckoId: \"binance-usd\",\n    icon: \"https://assets.coingecko.com/coins/images/9576/large/BUSD.png\",\n  },\n  // DeFi Tokens\n  {\n    symbol: \"UNI\",\n    name: \"Uniswap\",\n    contractAddress: \"0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984\",\n    decimals: 18,\n    coingeckoId: \"uniswap\",\n    icon: \"https://assets.coingecko.com/coins/images/12504/large/uni.jpg\",\n  },\n  {\n    symbol: \"LINK\",\n    name: \"ChainLink Token\",\n    contractAddress: \"0x514910771AF9Ca656af840dff83E8264EcF986CA\",\n    decimals: 18,\n    coingeckoId: \"chainlink\",\n    icon: \"https://assets.coingecko.com/coins/images/877/large/chainlink-new-logo.png\",\n  },\n  {\n    symbol: \"AAVE\",\n    name: \"Aave Token\",\n    contractAddress: \"0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9\",\n    decimals: 18,\n    coingeckoId: \"aave\",\n    icon: \"https://assets.trustwalletapp.com/blockchains/ethereum/assets/0x7Fc66500c84A76Ad7e9c93437bFc5Ac33E2DDaE9/logo.png\",\n  },\n  {\n    symbol: \"MKR\",\n    name: \"Maker\",\n    contractAddress: \"0x9f8F72aA9304c8B593d555F12eF6589cC3A579A2\",\n    decimals: 18,\n    coingeckoId: \"maker\",\n    icon: \"https://assets.coingecko.com/coins/images/1364/large/Mark_Maker.png\",\n  },\n  {\n    symbol: \"COMP\",\n    name: \"Compound\",\n    contractAddress: \"0xc00e94Cb662C3520282E6f5717214004A7f26888\",\n    decimals: 18,\n    coingeckoId: \"compound-governance-token\",\n    icon: \"https://assets.coingecko.com/coins/images/10775/large/COMP.png\",\n  },\n  {\n    symbol: \"CRV\",\n    name: \"Curve DAO Token\",\n    contractAddress: \"0xD533a949740bb3306d119CC777fa900bA034cd52\",\n    decimals: 18,\n    coingeckoId: \"curve-dao-token\",\n    icon: \"https://assets.coingecko.com/coins/images/12124/large/Curve.png\",\n  },\n  {\n    symbol: \"SUSHI\",\n    name: \"SushiToken\",\n    contractAddress: \"0x6B3595068778DD592e39A122f4f5a5cF09C90fE2\",\n    decimals: 18,\n    coingeckoId: \"sushi\",\n    icon: \"https://assets.coingecko.com/coins/images/12271/large/512x512_Logo_no_chop.png\",\n  },\n  {\n    symbol: \"SNX\",\n    name: \"Synthetix Network Token\",\n    contractAddress: \"0xC011a73ee8576Fb46F5E1c5751cA3B9Fe0af2a6F\",\n    decimals: 18,\n    coingeckoId: \"synthetix-network-token\",\n    icon: \"https://assets.coingecko.com/coins/images/3406/large/SNX.png\",\n  },\n  {\n    symbol: \"YFI\",\n    name: \"yearn.finance\",\n    contractAddress: \"0x0bc529c00C6401aEF6D220BE8C6Ea1667F6Ad93e\",\n    decimals: 18,\n    coingeckoId: \"yearn-finance\",\n    icon: \"https://assets.coingecko.com/coins/images/11849/large/yearn.jpg\",\n  },\n  // Wrapped Tokens\n  {\n    symbol: \"WBTC\",\n    name: \"Wrapped BTC\",\n    contractAddress: \"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599\",\n    decimals: 8,\n    coingeckoId: \"wrapped-bitcoin\",\n    icon: \"https://assets.coingecko.com/coins/images/7598/large/wrapped_bitcoin_wbtc.png\",\n  },\n  {\n    symbol: \"WETH\",\n    name: \"Wrapped Ether\",\n    contractAddress: \"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2\",\n    decimals: 18,\n    coingeckoId: \"weth\",\n    icon: \"https://assets.coingecko.com/coins/images/2518/large/weth.png\",\n  },\n  // Exchange Tokens\n  {\n    symbol: \"LEO\",\n    name: \"Bitfinex LEO Token\",\n    contractAddress: \"0x2AF5D2aD76741191D15Dfe7bF6aC92d4Bd912Ca3\",\n    decimals: 18,\n    coingeckoId: \"leo-token\",\n    icon: \"https://assets.coingecko.com/coins/images/8418/large/leo-token.png\",\n  },\n  {\n    symbol: \"HT\",\n    name: \"HuobiToken\",\n    contractAddress: \"0x6f259637dcD74C767781E37Bc6133cd6A68aa161\",\n    decimals: 18,\n    coingeckoId: \"huobi-token\",\n    icon: \"https://assets.coingecko.com/coins/images/2822/large/huobi-token-logo.png\",\n  },\n  {\n    symbol: \"OKB\",\n    name: \"OKB\",\n    contractAddress: \"0x75231F58b43240C9718Dd58B4967c5114342a86c\",\n    decimals: 18,\n    coingeckoId: \"okb\",\n    icon: \"https://assets.trustwalletapp.com/blockchains/ethereum/assets/0x75231F58b43240C9718Dd58B4967c5114342a86c/logo.png\",\n  },\n  // Layer 2 & Scaling\n  {\n    symbol: \"MATIC\",\n    name: \"Matic Token\",\n    contractAddress: \"0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0\",\n    decimals: 18,\n    coingeckoId: \"matic-network\",\n    icon: \"https://assets.coingecko.com/coins/images/4713/large/polygon.png\",\n  },\n  {\n    symbol: \"LDO\",\n    name: \"Lido DAO Token\",\n    contractAddress: \"0x5A98FcBEA516Cf06857215779Fd812CA3beF1B32\",\n    decimals: 18,\n    coingeckoId: \"lido-dao\",\n    icon: \"https://assets.coingecko.com/coins/images/13573/large/Lido_DAO.png\",\n  },\n  // Meme & Community Tokens\n  {\n    symbol: \"SHIB\",\n    name: \"SHIBA INU\",\n    contractAddress: \"0x95aD61b0a150d79219dCF64E1E6Cc01f0B64C4cE\",\n    decimals: 18,\n    coingeckoId: \"shiba-inu\",\n    icon: \"https://assets.coingecko.com/coins/images/11939/large/shiba.png\",\n  },\n  {\n    symbol: \"PEPE\",\n    name: \"Pepe\",\n    contractAddress: \"0x6982508145454Ce325dDbE47a25d4ec3d2311933\",\n    decimals: 18,\n    coingeckoId: \"pepe\",\n    icon: \"https://assets.coingecko.com/coins/images/29850/large/pepe-token.jpeg\",\n  },\n  {\n    symbol: \"FLOKI\",\n    name: \"FLOKI\",\n    contractAddress: \"0xcf0C122c6b73ff809C693DB761e7BaeBe62b6a2E\",\n    decimals: 9,\n    coingeckoId: \"floki\",\n    icon: \"https://assets.coingecko.com/coins/images/16746/large/FLOKI.png\",\n  },\n  // Gaming & NFT\n  {\n    symbol: \"SAND\",\n    name: \"The Sandbox\",\n    contractAddress: \"0x3845badAde8e6dFF049820680d1F14bD3903a5d0\",\n    decimals: 18,\n    coingeckoId: \"the-sandbox\",\n    icon: \"https://assets.coingecko.com/coins/images/12129/large/sandbox_logo.jpg\",\n  },\n  {\n    symbol: \"MANA\",\n    name: \"Decentraland\",\n    contractAddress: \"0x0F5D2fB29fb7d3CFeE444a200298f468908cC942\",\n    decimals: 18,\n    coingeckoId: \"decentraland\",\n    icon: \"https://assets.coingecko.com/coins/images/878/large/decentraland-mana.png\",\n  },\n  {\n    symbol: \"AXS\",\n    name: \"Axie Infinity Shard\",\n    contractAddress: \"0xBB0E17EF65F82Ab018d8EDd776e8DD940327B28b\",\n    decimals: 18,\n    coingeckoId: \"axie-infinity\",\n    icon: \"https://assets.coingecko.com/coins/images/13029/large/axie_infinity_logo.png\",\n  },\n  {\n    symbol: \"APE\",\n    name: \"ApeCoin\",\n    contractAddress: \"0x4d224452801ACEd8B2F0aebE155379bb5D594381\",\n    decimals: 18,\n    coingeckoId: \"apecoin\",\n    icon: \"https://assets.coingecko.com/coins/images/24383/large/apecoin.jpg\",\n  },\n  // Other Popular Tokens\n  {\n    symbol: \"GRT\",\n    name: \"The Graph\",\n    contractAddress: \"0xc944E90C64B2c07662A292be6244BDf05Cda44a7\",\n    decimals: 18,\n    coingeckoId: \"the-graph\",\n    icon: \"https://assets.coingecko.com/coins/images/13397/large/Graph_Token.png\",\n  },\n  {\n    symbol: \"FTM\",\n    name: \"Fantom Token\",\n    contractAddress: \"0x4E15361FD6b4BB609Fa63C81A2be19d873717870\",\n    decimals: 18,\n    coingeckoId: \"fantom\",\n    icon: \"https://assets.coingecko.com/coins/images/4001/large/Fantom_round.png\",\n  },\n  {\n    symbol: \"1INCH\",\n    name: \"1INCH Token\",\n    contractAddress: \"0x111111111117dC0aa78b770fA6A738034120C302\",\n    decimals: 18,\n    coingeckoId: \"1inch\",\n    icon: \"https://assets.coingecko.com/coins/images/13469/large/1inch-token.png\",\n  },\n  {\n    symbol: \"ENS\",\n    name: \"Ethereum Name Service\",\n    contractAddress: \"0xC18360217D8F7Ab5e7c516566761Ea12Ce7F9D72\",\n    decimals: 18,\n    coingeckoId: \"ethereum-name-service\",\n    icon: \"https://assets.coingecko.com/coins/images/19785/large/acatxTm8_400x400.jpg\",\n  },\n  {\n    symbol: \"BAT\",\n    name: \"Basic Attention Token\",\n    contractAddress: \"0x0D8775F648430679A709E98d2b0Cb6250d2887EF\",\n    decimals: 18,\n    coingeckoId: \"basic-attention-token\",\n    icon: \"https://assets.coingecko.com/coins/images/677/large/basic-attention-token.png\",\n  },\n  {\n    symbol: \"ZRX\",\n    name: \"0x Protocol Token\",\n    contractAddress: \"0xE41d2489571d322189246DaFA5ebDe1F4699F498\",\n    decimals: 18,\n    coingeckoId: \"0x\",\n    icon: \"https://assets.coingecko.com/coins/images/863/large/0x.png\",\n  },\n];\n\n// Helper function to get token by symbol\nexport function getTokenBySymbol(symbol: string): TokenMetadata | undefined {\n  return ETHEREUM_TOKENS.find(\n    (token) => token.symbol.toLowerCase() === symbol.toLowerCase()\n  );\n}\n\n// Helper function to get token by contract address\nexport function getTokenByAddress(address: string): TokenMetadata | undefined {\n  if (!address) {\n    return ETHEREUM_TOKENS.find((token) => token.symbol === \"ETH\");\n  }\n  return ETHEREUM_TOKENS.find(\n    (token) => token.contractAddress.toLowerCase() === address.toLowerCase()\n  );\n}\n\n// Helper function to search tokens\nexport function searchTokens(query: string): TokenMetadata[] {\n  const lowercaseQuery = query.toLowerCase();\n  return ETHEREUM_TOKENS.filter(\n    (token) =>\n      token.symbol.toLowerCase().includes(lowercaseQuery) ||\n      token.name.toLowerCase().includes(lowercaseQuery) ||\n      token.contractAddress.toLowerCase().includes(lowercaseQuery)\n  );\n}\n","size_bytes":10051},"client/src/contexts/chain-context.tsx":{"content":"import { createContext, useContext, useState, useEffect } from \"react\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { safeStorage } from \"@/lib/safe-storage\";\n\ninterface ChainContextType {\n  selectedChain: string;\n  setSelectedChain: (chainId: string) => void;\n}\n\nconst ChainContext = createContext<ChainContextType | undefined>(undefined);\n\nexport function ChainProvider({ children }: { children: React.ReactNode }) {\n  const [selectedChain, setSelectedChainState] = useState<string>(\"all\");\n\n  useEffect(() => {\n    const savedChain = safeStorage.getItem(\"selectedChain\", { fallback: \"all\" });\n    if (savedChain) {\n      setSelectedChainState(savedChain);\n    }\n  }, []);\n\n  const setSelectedChain = (chainId: string) => {\n    setSelectedChainState(chainId);\n    safeStorage.setItem(\"selectedChain\", chainId);\n    \n    // Invalidate relevant queries when chain changes (but not for \"all\")\n    if (chainId !== \"all\") {\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/prices\"] });\n    }\n  };\n\n  return (\n    <ChainContext.Provider value={{ selectedChain, setSelectedChain }}>\n      {children}\n    </ChainContext.Provider>\n  );\n}\n\nexport function useChain() {\n  const context = useContext(ChainContext);\n  if (!context) {\n    throw new Error(\"useChain must be used within ChainProvider\");\n  }\n  return context;\n}\n","size_bytes":1400},"client/src/pages/history.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, ArrowDownRight, ArrowUpRight, ChevronDown, FileText, CheckCircle2, XCircle, AlertCircle } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { formatCrypto, formatUSD } from \"@/lib/utils\";\nimport { useTransactionUSD } from \"@/hooks/use-transaction-usd\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTranslation } from \"react-i18next\";\n\n// Transaction row component that uses the hook\nfunction TransactionRow({ tx, onClick }: { tx: any; onClick: () => void }) {\n  const { t } = useTranslation();\n  const isReceive = tx.type === \"receive\";\n  const isSend = tx.type === \"send\";\n  const isContract = tx.type === \"contract\";\n  const isConfirmed = tx.status === \"confirmed\";\n  const isPending = tx.status === \"pending\";\n  const isFailed = tx.status === \"failed\";\n  const usdValue = useTransactionUSD(tx);\n\n  const truncateAddress = (address: string) => {\n    if (!address) return \"\";\n    return `${address.substring(0, 8)}...${address.substring(address.length - 6)}`;\n  };\n\n  return (\n    <div\n      className=\"flex items-center gap-3 p-3 rounded-lg hover-elevate cursor-pointer\"\n      onClick={onClick}\n      data-testid={`row-transaction-${tx.hash}`}\n    >\n      {/* Icon */}\n      <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${\n        isContract ? \"bg-card border\" :\n        isReceive ? \"bg-background border\" :\n        \"bg-background border\"\n      }`}>\n        {isContract ? (\n          <FileText className=\"h-5 w-5 text-foreground\" />\n        ) : isReceive ? (\n          <ArrowDownRight className=\"h-5 w-5 text-foreground\" />\n        ) : (\n          <ArrowUpRight className=\"h-5 w-5 text-foreground\" />\n        )}\n      </div>\n\n      {/* Details */}\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"font-medium\">\n            {isContract ? t('history.smartContractCall') : t('history.transfer')}\n          </span>\n          {isConfirmed && (\n            <CheckCircle2 className=\"h-4 w-4 text-success flex-shrink-0\" />\n          )}\n          {isPending && (\n            <AlertCircle className=\"h-4 w-4 text-warning flex-shrink-0\" />\n          )}\n          {isFailed && (\n            <XCircle className=\"h-4 w-4 text-destructive flex-shrink-0\" />\n          )}\n        </div>\n        <p className=\"text-sm text-muted-foreground truncate\">\n          {isReceive ? t('history.from') : isSend ? t('history.to') : t('history.from')}\n          {truncateAddress(isReceive ? tx.from : tx.to || tx.from)}\n        </p>\n      </div>\n\n      {/* Amount */}\n      <div className=\"text-right flex-shrink-0\">\n        <p className=\"font-medium\">\n          {isReceive ? \"+\" : \"-\"}{formatCrypto(tx.value)} {tx.tokenSymbol}\n        </p>\n        <p className=\"text-sm text-muted-foreground\">\n           {formatUSD(usdValue.toString())}\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport default function History() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { walletId, isAuthenticated, isLoading } = useWallet();\n  const [selectedNetwork, setSelectedNetwork] = useState(\"all\");\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  const { data: transactions = [], isLoading: transactionsLoading } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"transactions\"],\n    enabled: !!walletId,\n  });\n\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const chains = (chainsData as any) || [];\n\n  // Filter transactions by network\n  const filteredTransactions = selectedNetwork === \"all\"\n    ? transactions\n    : (transactions as any[]).filter(tx => tx.chainId === selectedNetwork);\n\n  // Group transactions by date\n  const groupedTransactions = (filteredTransactions as any[]).reduce((groups: any, tx: any) => {\n    const date = new Date(tx.timestamp);\n    const today = new Date();\n    const yesterday = new Date(today);\n    yesterday.setDate(yesterday.getDate() - 1);\n\n    let dateKey;\n    if (date.toDateString() === today.toDateString()) {\n      dateKey = t('history.today');\n    } else if (date.toDateString() === yesterday.toDateString()) {\n      dateKey = t('history.yesterday');\n    } else {\n      dateKey = date.toLocaleDateString(i18n.language, { month: 'short', day: 'numeric', year: 'numeric' });\n    }\n\n    if (!groups[dateKey]) {\n      groups[dateKey] = [];\n    }\n    groups[dateKey].push(tx);\n    return groups;\n  }, {});\n\n  return (\n    <div className=\"min-h-screen bg-background pb-4\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => window.history.back()}\n              data-testid=\"button-back\"\n              className=\"hover-elevate\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold\">{t('history.title')}</h1>\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      {/* Network Filter */}\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-4xl\">\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"outline\"\n              className=\"w-fit gap-2\"\n              data-testid=\"button-network-filter\"\n            >\n              {selectedNetwork === \"all\" ? t('history.allNetworks') : chains.find((c: any) => c.id === selectedNetwork)?.name || t('history.allNetworks')}\n              <ChevronDown className=\"h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"start\" className=\"w-48\">\n            <DropdownMenuItem onClick={() => setSelectedNetwork(\"all\")}>\n              {t('history.allNetworks')}\n            </DropdownMenuItem>\n            {chains.map((chain: any) => (\n              <DropdownMenuItem key={chain.id} onClick={() => setSelectedNetwork(chain.id)}>\n                {chain.name}\n              </DropdownMenuItem>\n            ))}\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      {/* Transactions List */}\n      <div className=\"container mx-auto px-3 sm:px-4 max-w-4xl\">\n        {transactionsLoading ? (\n          <div className=\"py-12 text-center\">\n            <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent\"></div>\n          </div>\n        ) : Object.keys(groupedTransactions).length > 0 ? (\n          <div className=\"space-y-6\">\n            {Object.entries(groupedTransactions).map(([date, txs]: [string, any]) => (\n              <div key={date}>\n                <h2 className=\"text-sm font-medium text-muted-foreground mb-3 px-1\">{date}</h2>\n                <div className=\"space-y-1\">\n                  {txs.map((tx: any) => (\n                    <TransactionRow\n                      key={tx.hash}\n                      tx={tx}\n                      onClick={() => setLocation(`/transaction/${tx.hash}`)}\n                    />\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div className=\"py-12 text-center text-muted-foreground\">\n            <p>{t('history.noTransactions')}</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":7916},"client/src/components/tradingview-chart.tsx":{"content":"import { useQuery } from '@tanstack/react-query';\nimport { Area, AreaChart, ResponsiveContainer, Tooltip, XAxis, YAxis } from 'recharts';\nimport { Loader2 } from 'lucide-react';\nimport { useTheme } from './theme-provider';\n\ninterface TradingViewChartProps {\n  symbol: string;\n  interval?: string;\n  theme?: 'light' | 'dark';\n  height?: number;\n}\n\nexport function TradingViewChart({ \n  symbol, \n  interval = 'D',\n  theme: propTheme,\n  height = 400 \n}: TradingViewChartProps) {\n  const { theme: contextTheme } = useTheme();\n  const theme = propTheme || contextTheme || 'dark';\n\n  // Map interval to period\n  const getPeriod = (interval: string) => {\n    if (interval === '5') return '1H';\n    if (interval === '15') return '1D';\n    if (interval === '60') return '1W';\n    if (interval === '240') return '1M';\n    if (interval === 'D') return '1Y';\n    return '1D';\n  };\n\n  const period = getPeriod(interval);\n\n  // Fetch chart data from our backend API\n  const { data: chartData, isLoading } = useQuery({\n    queryKey: ['/api/chart', symbol.toLowerCase(), period],\n    queryFn: async () => {\n      const res = await fetch(`/api/chart/${symbol.toLowerCase()}?period=${period}`);\n      if (!res.ok) throw new Error('Failed to fetch chart data');\n      return res.json();\n    },\n    enabled: !!symbol,\n  });\n\n  if (isLoading) {\n    return (\n      <div \n        className=\"flex items-center justify-center bg-card/50 rounded-lg\"\n        style={{ height: `${height}px` }}\n      >\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!chartData || !(chartData as any)?.prices || (chartData as any).prices.length === 0) {\n    return (\n      <div \n        className=\"flex items-center justify-center bg-card/50 rounded-lg\"\n        style={{ height: `${height}px` }}\n      >\n        <p className=\"text-sm text-muted-foreground\">No chart data available</p>\n      </div>\n    );\n  }\n\n  // Format data for recharts\n  const prices = (chartData as any).prices;\n  const formattedData = prices.map((point: [number, number]) => ({\n    timestamp: point[0],\n    price: point[1],\n    time: new Date(point[0]).toLocaleDateString(undefined, {\n      month: 'short',\n      day: 'numeric',\n      ...(period === '1H' || period === '1D' ? { hour: '2-digit', minute: '2-digit' } : {})\n    })\n  }));\n\n  const minPrice = Math.min(...formattedData.map((d: any) => d.price));\n  const maxPrice = Math.max(...formattedData.map((d: any) => d.price));\n  const priceRange = maxPrice - minPrice;\n  const yMin = minPrice - (priceRange * 0.1);\n  const yMax = maxPrice + (priceRange * 0.1);\n\n  return (\n    <div style={{ height: `${height}px`, width: '100%' }}>\n      <ResponsiveContainer width=\"100%\" height=\"100%\">\n        <AreaChart data={formattedData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n          <defs>\n            <linearGradient id=\"colorPrice\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n              <stop offset=\"5%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0.3} />\n              <stop offset=\"95%\" stopColor=\"hsl(var(--primary))\" stopOpacity={0} />\n            </linearGradient>\n          </defs>\n          <XAxis \n            dataKey=\"time\" \n            axisLine={false}\n            tickLine={false}\n            tick={{ fill: 'hsl(var(--muted-foreground))', fontSize: 12 }}\n            interval=\"preserveStartEnd\"\n            minTickGap={50}\n          />\n          <YAxis \n            axisLine={false}\n            tickLine={false}\n            tick={{ fill: 'hsl(var(--muted-foreground))', fontSize: 12 }}\n            domain={[yMin, yMax]}\n            tickFormatter={(value) => {\n              if (value >= 1000) return `$${(value / 1000).toFixed(1)}k`;\n              if (value >= 1) return `$${value.toFixed(2)}`;\n              return `$${value.toFixed(4)}`;\n            }}\n            width={60}\n          />\n          <Tooltip\n            contentStyle={{\n              backgroundColor: theme === 'dark' ? 'hsl(215, 100%, 6%)' : 'hsl(220, 100%, 99%)',\n              border: '1px solid hsl(var(--border))',\n              borderRadius: '8px',\n              padding: '8px 12px'\n            }}\n            labelStyle={{ color: 'hsl(var(--foreground))', fontWeight: 500, marginBottom: 4 }}\n            formatter={(value: any) => [\n              `$${typeof value === 'number' ? value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 }) : value}`,\n              'Price'\n            ]}\n          />\n          <Area\n            type=\"monotone\"\n            dataKey=\"price\"\n            stroke=\"hsl(var(--primary))\"\n            strokeWidth={2}\n            fill=\"url(#colorPrice)\"\n            isAnimationActive={false}\n          />\n        </AreaChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n","size_bytes":4737},"client/src/pages/manage-coins.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { ArrowLeft, Search, Plus, ArrowUp, GripVertical } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function ManageCoins() {\n  const [, setLocation] = useLocation();\n  const { walletId, isAuthenticated, isLoading } = useWallet();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { toast } = useToast();\n  const [imageErrors, setImageErrors] = useState<Record<string, boolean>>({});\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  // Fetch ALL tokens (including hidden ones) for manage-coins page\n  const { data: allTokensData } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"all-tokens\"],\n    enabled: !!walletId,\n  });\n\n  // Fetch available chains for chain badges\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Fetch real-time prices for sorting by market cap\n  const { data: pricesData } = useQuery({\n    queryKey: [\"/api/prices\"],\n    enabled: !!walletId,\n  });\n\n  const chains = (chainsData as any) || [];\n  const tokens = (allTokensData as any)?.tokens || [];\n\n  // Filter tokens based on search\n  const searchFilteredTokens = tokens.filter((token: any) =>\n    token.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    token.symbol.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    token.contractAddress?.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  // Sort tokens by market cap (popularity) - most popular tokens first\n  const filteredTokens = [...searchFilteredTokens].sort((a: any, b: any) => {\n    const aCoingeckoId = a.coingeckoId || a.symbol.toLowerCase();\n    const bCoingeckoId = b.coingeckoId || b.symbol.toLowerCase();\n    const aMarketCap = (pricesData as any)?.[aCoingeckoId]?.usd_market_cap || 0;\n    const bMarketCap = (pricesData as any)?.[bCoingeckoId]?.usd_market_cap || 0;\n    return bMarketCap - aMarketCap; // Highest market cap first\n  });\n\n  const removeTokenMutation = useMutation({\n    mutationFn: async (tokenSymbol: string) => {\n      const response = await fetch(`/api/wallet/${walletId}/tokens/${tokenSymbol}`, {\n        method: \"DELETE\",\n      });\n      if (!response.ok) throw new Error(\"Failed to remove token\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"all-tokens\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"portfolio\"] });\n      toast({\n        title: \"Token removed\",\n        description: \"Token has been removed from your wallet\",\n      });\n    },\n  });\n\n  const toggleVisibilityMutation = useMutation({\n    mutationFn: async ({ tokenId, isVisible }: { tokenId: string; isVisible: boolean }) => {\n      const response = await fetch(`/api/wallet/${walletId}/tokens/${tokenId}/visibility`, {\n        method: \"PATCH\",\n        body: JSON.stringify({ isVisible }),\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      });\n      if (!response.ok) throw new Error(\"Failed to update token visibility\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"all-tokens\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"portfolio\"] });\n      toast({\n        title: \"Token visibility updated\",\n        description: \"Your changes have been saved\",\n      });\n    },\n  });\n\n  if (!isAuthenticated || !walletId) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-2 sm:py-3\">\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/dashboard\")}\n              data-testid=\"button-back\"\n              className=\"hover-elevate\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-base sm:text-lg font-display font-semibold\">Manage Coins</h1>\n            <div className=\"w-10\" />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 sm:py-6 max-w-2xl\">\n        {/* Search and Add */}\n        <div className=\"mb-4 flex gap-2\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Enter token name or token contract address\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search-tokens\"\n            />\n          </div>\n          <Button\n            size=\"icon\"\n            variant=\"outline\"\n            onClick={() => setLocation(\"/add-custom-token\")}\n            data-testid=\"button-add-token\"\n            className=\"shrink-0\"\n          >\n            <Plus className=\"h-5 w-5\" />\n          </Button>\n        </div>\n\n        {/* Token List */}\n        <div className=\"space-y-2\">\n          {filteredTokens.map((token: any) => (\n            <Card\n              key={token.id}\n              className=\"p-3 hover-elevate cursor-pointer\"\n              data-testid={`card-token-${token.symbol.toLowerCase()}-${token.chainId}`}\n              onClick={() => setLocation(`/token/${token.symbol.toLowerCase()}/${token.chainId}`)}\n            >\n              <div className=\"flex items-center gap-3\">\n                {/* Token Icon with Chain Badge */}\n                <div className=\"relative w-10 h-10 flex-shrink-0\">\n                  <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-white/10\">\n                    {token.icon && !imageErrors[`token-${token.id}`] ? (\n                      <img \n                        src={token.icon} \n                        alt={token.name} \n                        className=\"w-full h-full object-cover\"\n                        loading=\"lazy\"\n                        onError={() => {\n                          setImageErrors(prev => ({ ...prev, [`token-${token.id}`]: true }));\n                        }}\n                      />\n                    ) : (\n                      <span className=\"text-primary font-bold text-sm\">{token.symbol[0]}</span>\n                    )}\n                  </div>\n                  {/* Chain Badge */}\n                  {(() => {\n                    const chain = chains.find((c: any) => c.id === token.chainId);\n                    const isNativeToken = token.symbol === chain?.symbol;\n                    return chain?.icon && !isNativeToken ? (\n                      <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n                        {!imageErrors[`chain-${chain.id}`] ? (\n                          <img \n                            src={chain.icon} \n                            alt=\"\" \n                            className=\"w-full h-full object-cover\"\n                            loading=\"lazy\"\n                            onError={() => {\n                              setImageErrors(prev => ({ ...prev, [`chain-${chain.id}`]: true }));\n                            }}\n                          />\n                        ) : (\n                          <span className=\"text-[8px] font-medium\">{token.symbol[0]}</span>\n                        )}\n                      </div>\n                    ) : null;\n                  })()}\n                </div>\n\n                {/* Token Info */}\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"font-medium\">\n                    {token.symbol}\n                    {(() => {\n                      const chain = chains.find((c: any) => c.id === token.chainId);\n                      return chain?.symbol ? (\n                        <span className=\"text-sm text-muted-foreground ml-1.5\">\n                          ({chain.symbol})\n                        </span>\n                      ) : null;\n                    })()}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground truncate\">\n                    {token.name}\n                  </div>\n                </div>\n\n                {/* Actions */}\n                <div className=\"flex items-center gap-2\" onClick={(e) => e.stopPropagation()}>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-8 w-8 text-muted-foreground hover-elevate\"\n                    onClick={() => setLocation(`/send-list/${token.walletId}`)}\n                    data-testid={`button-pin-${token.symbol.toLowerCase()}-${token.chainId}`}\n                  >\n                    <ArrowUp className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-8 w-8 text-muted-foreground hover-elevate\"\n                    onClick={() => setLocation(`/receive-qr/${token.id}`)}\n                    data-testid={`button-qr-${token.symbol.toLowerCase()}-${token.chainId}`}\n                  >\n                    <GripVertical className=\"h-4 w-4\" />\n                  </Button>\n                  <Switch\n                    checked={token.isVisible !== false}\n                    onCheckedChange={(checked) => {\n                      toggleVisibilityMutation.mutate({ tokenId: token.id, isVisible: checked });\n                    }}\n                    data-testid={`switch-${token.symbol.toLowerCase()}-${token.chainId}`}\n                  />\n                </div>\n              </div>\n            </Card>\n          ))}\n        </div>\n\n        {filteredTokens.length === 0 && (\n          <div className=\"text-center py-12 text-muted-foreground\">\n            <p>No tokens found</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":10652},"shared/solana-tokens.ts":{"content":"// Comprehensive list of popular SPL tokens on Solana\nexport interface TokenMetadata {\n  symbol: string;\n  name: string;\n  contractAddress: string;\n  decimals: number;\n  icon?: string;\n  coingeckoId?: string;\n}\n\nexport const SOLANA_TOKENS: TokenMetadata[] = [\n  // Native SOL\n  {\n    symbol: \"SOL\",\n    name: \"Solana\",\n    contractAddress: \"\",\n    decimals: 9,\n    coingeckoId: \"solana\",\n    icon: \"https://assets.coingecko.com/coins/images/4128/large/solana.png\",\n  },\n  // Stablecoins\n  {\n    symbol: \"USDC\",\n    name: \"USD Coin\",\n    contractAddress: \"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v\",\n    decimals: 6,\n    coingeckoId: \"usd-coin\",\n    icon: \"https://assets.coingecko.com/coins/images/6319/large/usdc.png\",\n  },\n  {\n    symbol: \"USDT\",\n    name: \"Tether USD\",\n    contractAddress: \"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB\",\n    decimals: 6,\n    coingeckoId: \"tether\",\n    icon: \"https://assets.coingecko.com/coins/images/325/large/Tether.png\",\n  },\n  // DeFi Tokens\n  {\n    symbol: \"JUP\",\n    name: \"Jupiter\",\n    contractAddress: \"JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN\",\n    decimals: 6,\n    coingeckoId: \"jupiter-exchange-solana\",\n    icon: \"https://assets.coingecko.com/coins/images/10351/large/logo512.png\",\n  },\n  {\n    symbol: \"RAY\",\n    name: \"Raydium\",\n    contractAddress: \"4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R\",\n    decimals: 6,\n    coingeckoId: \"raydium\",\n    icon: \"https://assets.coingecko.com/coins/images/13928/large/PSigc4ie_400x400.jpg\",\n  },\n  {\n    symbol: \"ORCA\",\n    name: \"Orca\",\n    contractAddress: \"orcaEKTdK7LKz57vaAYr9QeNsVEPfiu6QeMU1kektZE\",\n    decimals: 6,\n    coingeckoId: \"orca\",\n    icon: \"https://assets.coingecko.com/coins/images/17547/large/Orca_Logo.png\",\n  },\n  // Memecoins\n  {\n    symbol: \"BONK\",\n    name: \"Bonk\",\n    contractAddress: \"DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263\",\n    decimals: 5,\n    coingeckoId: \"bonk\",\n    icon: \"https://assets.coingecko.com/coins/images/28600/large/bonk.jpg\",\n  },\n  {\n    symbol: \"WIF\",\n    name: \"dogwifhat\",\n    contractAddress: \"EKpQGSJtjMFqKZ9KQanSqYXRcF8fBopzLHYxdM65zcjm\",\n    decimals: 6,\n    coingeckoId: \"dogwifcoin\",\n    icon: \"https://assets.coingecko.com/coins/images/33566/large/dogwifhat.jpg\",\n  },\n  // Wrapped Tokens\n  {\n    symbol: \"WBTC\",\n    name: \"Wrapped Bitcoin (Sollet)\",\n    contractAddress: \"9n4nbM75f5Ui33ZbPYXn59EwSgE8CGsHtAeTH5YFeJ9E\",\n    decimals: 6,\n    coingeckoId: \"wrapped-bitcoin\",\n    icon: \"https://assets.coingecko.com/coins/images/7598/large/wrapped_bitcoin_wbtc.png\",\n  },\n  {\n    symbol: \"ETH\",\n    name: \"Ethereum\",\n    contractAddress: \"7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs\",\n    decimals: 8,\n    coingeckoId: \"ethereum\",\n    icon: \"https://assets.coingecko.com/coins/images/279/large/ethereum.png\",\n  },\n];\n\n// Helper function to get token by symbol\nexport function getSolanaTokenBySymbol(symbol: string): TokenMetadata | undefined {\n  return SOLANA_TOKENS.find(\n    (token) => token.symbol.toUpperCase() === symbol.toUpperCase()\n  );\n}\n","size_bytes":3007},"client/src/components/sort-dialog.tsx":{"content":"import {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Check, X, MoreVertical } from \"lucide-react\";\n\ninterface SortDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  selectedSort: string;\n  onSortChange: (sort: string) => void;\n}\n\nexport function SortDialog({\n  open,\n  onOpenChange,\n  selectedSort,\n  onSortChange,\n}: SortDialogProps) {\n  const sortOptions = [\n    { id: \"custom\", label: \"Custom Sorting\" },\n    { id: \"value\", label: \"By Value\" },\n    { id: \"name\", label: \"By Name\" },\n    { id: \"amount\", label: \"By Amount\" },\n  ];\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md bg-card/95 backdrop-blur-sm border-border\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"text-lg font-semibold\">Sort</DialogTitle>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => onOpenChange(false)}\n              className=\"h-8 w-8\"\n              data-testid=\"button-close-sort\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </DialogHeader>\n        <div className=\"space-y-2 py-4\">\n          {sortOptions.map((option) => (\n            <button\n              key={option.id}\n              onClick={() => {\n                onSortChange(option.id);\n                onOpenChange(false);\n              }}\n              className={`w-full flex items-center justify-between p-4 rounded-lg transition-colors ${\n                selectedSort === option.id\n                  ? \"bg-primary/10 border-2 border-primary\"\n                  : \"bg-muted/50 border-2 border-transparent hover:bg-muted\"\n              }`}\n              data-testid={`button-sort-${option.id}`}\n            >\n              <span className=\"font-medium\">{option.label}</span>\n              <div className=\"flex items-center gap-2\">\n                {selectedSort === option.id && (\n                  <div className=\"h-6 w-6 rounded-full bg-primary flex items-center justify-center\">\n                    <Check className=\"h-4 w-4 text-primary-foreground\" />\n                  </div>\n                )}\n                {option.id === \"custom\" && selectedSort === option.id && (\n                  <MoreVertical className=\"h-4 w-4 text-muted-foreground\" />\n                )}\n              </div>\n            </button>\n          ))}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":2605},"shared/bnb-tokens.ts":{"content":"// Comprehensive list of popular BEP-20 tokens on BNB Smart Chain\nexport interface TokenMetadata {\n  symbol: string;\n  name: string;\n  contractAddress: string;\n  decimals: number;\n  icon?: string;\n  coingeckoId?: string;\n}\n\nexport const BNB_TOKENS: TokenMetadata[] = [\n  // Native BNB\n  {\n    symbol: \"BNB\",\n    name: \"BNB\",\n    contractAddress: \"\",\n    decimals: 18,\n    coingeckoId: \"binancecoin\",\n    icon: \"https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png\",\n  },\n  // Stablecoins\n  {\n    symbol: \"USDT\",\n    name: \"Tether USD\",\n    contractAddress: \"0x55d398326f99059fF775485246999027B3197955\",\n    decimals: 18,\n    coingeckoId: \"tether\",\n    icon: \"https://assets.coingecko.com/coins/images/325/large/Tether.png\",\n  },\n  {\n    symbol: \"USDC\",\n    name: \"USD Coin\",\n    contractAddress: \"0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d\",\n    decimals: 18,\n    coingeckoId: \"usd-coin\",\n    icon: \"https://assets.coingecko.com/coins/images/6319/large/usdc.png\",\n  },\n  {\n    symbol: \"BUSD\",\n    name: \"Binance USD\",\n    contractAddress: \"0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56\",\n    decimals: 18,\n    coingeckoId: \"binance-usd\",\n    icon: \"https://assets.coingecko.com/coins/images/9576/large/BUSD.png\",\n  },\n  {\n    symbol: \"DAI\",\n    name: \"Dai Stablecoin\",\n    contractAddress: \"0x1AF3F329e8BE154074D8769D1FFa4eE058B1DBc3\",\n    decimals: 18,\n    coingeckoId: \"dai\",\n    icon: \"https://assets.coingecko.com/coins/images/9956/large/Badge_Dai.png\",\n  },\n  // DeFi Tokens\n  {\n    symbol: \"CAKE\",\n    name: \"PancakeSwap\",\n    contractAddress: \"0x0E09FaBB73Bd3Ade0a17ECC321fD13a19e81cE82\",\n    decimals: 18,\n    coingeckoId: \"pancakeswap-token\",\n    icon: \"https://assets.trustwalletapp.com/blockchains/smartchain/assets/0x0E09FaBB73Bd3Ade0a17ECC321fD13a19e81cE82/logo.png\",\n  },\n  {\n    symbol: \"XVS\",\n    name: \"Venus\",\n    contractAddress: \"0xcF6BB5389c92Bdda8a3747Ddb454cB7a64626C63\",\n    decimals: 18,\n    coingeckoId: \"venus\",\n    icon: \"https://assets.coingecko.com/coins/images/12677/large/download.jpg\",\n  },\n  {\n    symbol: \"ALPHA\",\n    name: \"Alpha Finance\",\n    contractAddress: \"0xa1faa113cbE53436Df28FF0aEe54275c13B40975\",\n    decimals: 18,\n    coingeckoId: \"alpha-finance\",\n    icon: \"https://assets.coingecko.com/coins/images/12738/large/AlphaToken_256x256.png\",\n  },\n  // Wrapped Tokens\n  {\n    symbol: \"ETH\",\n    name: \"Binance-Peg Ethereum\",\n    contractAddress: \"0x2170Ed0880ac9A755fd29B2688956BD959F933F8\",\n    decimals: 18,\n    coingeckoId: \"ethereum\",\n    icon: \"https://assets.coingecko.com/coins/images/279/large/ethereum.png\",\n  },\n  {\n    symbol: \"BTCB\",\n    name: \"Bitcoin BEP2\",\n    contractAddress: \"0x7130d2A12B9BCbFAe4f2634d864A1Ee1Ce3Ead9c\",\n    decimals: 18,\n    coingeckoId: \"bitcoin\",\n    icon: \"https://assets.coingecko.com/coins/images/1/large/bitcoin.png\",\n  },\n  {\n    symbol: \"ADA\",\n    name: \"Binance-Peg Cardano\",\n    contractAddress: \"0x3EE2200Efb3400fAbB9AacF31297cBdD1d435D47\",\n    decimals: 18,\n    coingeckoId: \"cardano\",\n    icon: \"https://assets.coingecko.com/coins/images/975/large/cardano.png\",\n  },\n  {\n    symbol: \"DOGE\",\n    name: \"Binance-Peg Dogecoin\",\n    contractAddress: \"0xbA2aE424d960c26247Dd6c32edC70B295c744C43\",\n    decimals: 8,\n    coingeckoId: \"dogecoin\",\n    icon: \"https://assets.coingecko.com/coins/images/5/large/dogecoin.png\",\n  },\n];\n\n// Helper function to get token by symbol\nexport function getBNBTokenBySymbol(symbol: string): TokenMetadata | undefined {\n  return BNB_TOKENS.find(\n    (token) => token.symbol.toUpperCase() === symbol.toUpperCase()\n  );\n}\n","size_bytes":3550},"client/src/pages/token-detail.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  ArrowLeft,\n  Star,\n  ArrowUpRight,\n  ArrowDownLeft,\n  Repeat2,\n  ShoppingCart,\n  Landmark,\n  TrendingUp,\n  TrendingDown,\n  ExternalLink,\n  CheckCircle2,\n} from \"lucide-react\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { TransactionRow } from \"@/components/transaction-row\";\nimport { getTokenBySymbol } from \"@shared/ethereum-tokens\";\nimport { TradingViewChart } from \"@/components/tradingview-chart\";\nimport { useTheme } from \"@/components/theme-provider\";\nimport { getTokenInfo } from \"@/lib/token-info\";\nimport { formatBalance } from \"@/lib/format-balance\";\nimport { formatCrypto, formatUSD } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\n\nconst TIME_PERIODS = [\"1H\", \"1D\", \"1W\", \"1M\", \"1Y\", \"All\"] as const;\ntype TimePeriod = typeof TIME_PERIODS[number];\n\nexport default function TokenDetail() {\n  const { symbol, chainId } = useParams<{ symbol: string; chainId?: string }>();\n  const [, setLocation] = useLocation();\n  const {  walletId, isAuthenticated, isLoading } = useWallet();\n  const { theme } = useTheme();\n  const [selectedPeriod, setSelectedPeriod] = useState<TimePeriod>(\"1D\");\n  const { t } = useTranslation('common');\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  const { data: portfolioData } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"portfolio\"],\n    enabled: !!walletId,\n  });\n\n  const { data: allTokensData } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"all-tokens\"],\n    enabled: !!walletId,\n  });\n\n  const { data: transactions = [] } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"transactions\"],\n    enabled: !!walletId,\n  });\n\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const portfolioTokens = (portfolioData as any)?.tokens || [];\n  const allTokens = (allTokensData as any)?.tokens || [];\n  \n  // Try to find in portfolio first (visible tokens), then fall back to all tokens (includes hidden)\n  let token = chainId \n    ? portfolioTokens.find(\n        (t: any) => t.symbol.toUpperCase() === symbol?.toUpperCase() && t.chainId === chainId\n      )\n    : portfolioTokens.find(\n        (t: any) => t.symbol.toUpperCase() === symbol?.toUpperCase()\n      );\n  \n  // If not found in portfolio, check all tokens (including hidden ones)\n  if (!token) {\n    token = chainId \n      ? allTokens.find(\n          (t: any) => t.symbol.toUpperCase() === symbol?.toUpperCase() && t.chainId === chainId\n        )\n      : allTokens.find(\n          (t: any) => t.symbol.toUpperCase() === symbol?.toUpperCase()\n        );\n  }\n\n  const chains = (chainsData as any) || [];\n  const currentChain = chains.find((c: any) => c.id === token?.chainId);\n\n  // Get CoinGecko ID from token metadata or shared catalog\n  const tokenMetadata = getTokenBySymbol(symbol || \"\");\n  const coingeckoId = token?.coingeckoId || tokenMetadata?.coingeckoId || symbol?.toLowerCase();\n\n  // Fetch real-time price data for all coins\n  const { data: pricesData, isLoading: isPriceLoading } = useQuery({\n    queryKey: [\"/api/prices\"],\n    enabled: !!coingeckoId,\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  if (!token) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <p className=\"text-muted-foreground\">{t('tokenDetail.notFound')}</p>\n      </div>\n    );\n  }\n\n  // Extract price info for this specific token\n  const priceInfo = (pricesData as any)?.[coingeckoId];\n  const balance = parseFloat(token.balance || \"0\");\n  const portfolioFiatValue = parseFloat(token.fiatValue || \"0\");\n  \n  // Determine current price with smart fallback logic\n  let currentPrice: number;\n  if (priceInfo?.usd !== undefined) {\n    // Use live CoinGecko price when available\n    currentPrice = priceInfo.usd;\n  } else if (balance > 0 && portfolioFiatValue > 0) {\n    // Calculate from portfolio when we have both balance and value\n    currentPrice = portfolioFiatValue / balance;\n  } else {\n    // For zero-balance or missing data, default to 0 (will show loading indicator instead)\n    currentPrice = 0;\n  }\n  \n  const priceChange24h = priceInfo?.usd_24h_change || 0;\n  const isPositive = priceChange24h >= 0;\n  const priceChangeFormatted = `${isPositive ? '+' : ''}${priceChange24h.toFixed(2)}%`;\n  const priceChangeValue = currentPrice * (priceChange24h / 100);\n  \n  // Calculate real-time fiat value\n  const realTimeFiatValue = priceInfo?.usd \n    ? (balance * priceInfo.usd) \n    : portfolioFiatValue;\n\n  // Filter transactions for this token (case-insensitive match)\n  // If chainId is provided, also filter by chainId to show only transactions on the correct chain\n  const allTransactions = transactions as any[];\n  const tokenTransactions = chainId\n    ? allTransactions.filter(\n        (tx: any) => tx.tokenSymbol?.toUpperCase() === symbol?.toUpperCase() && tx.chainId === chainId\n      )\n    : allTransactions.filter(\n        (tx: any) => tx.tokenSymbol?.toUpperCase() === symbol?.toUpperCase()\n      );\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-2 sm:py-3\">\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => window.history.back()}\n              data-testid=\"button-back\"\n              className=\"hover-elevate\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div className=\"text-center\">\n              <h1 className=\"font-display font-semibold text-base sm:text-lg\" data-testid=\"text-token-name\">\n                {token.symbol}\n              </h1>\n              <p className=\"text-xs text-muted-foreground hidden sm:block\">{currentChain?.name || \"Ethereum\"}</p>\n            </div>\n            <div className=\"w-10\"></div>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4 max-w-2xl\">\n        {/* Price Section */}\n        <div className=\"text-center mb-4\">\n          {token.icon && (\n            <div className=\"relative w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3\">\n              <img \n                src={token.icon} \n                alt={token.name} \n                className=\"w-full h-full rounded-full\"\n                onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }}\n              />\n              {currentChain?.icon && token.symbol?.toUpperCase() !== currentChain.symbol?.toUpperCase() && (\n                <div className=\"absolute -bottom-0.5 -right-0.5 w-5 h-5 sm:w-6 sm:h-6 rounded-full bg-background border-2 border-background flex items-center justify-center overflow-hidden\">\n                  <img\n                    src={currentChain.icon}\n                    alt={currentChain.name}\n                    className=\"w-full h-full object-cover\"\n                  />\n                </div>\n              )}\n            </div>\n          )}\n          {!priceInfo && (isPriceLoading || currentPrice === 0) ? (\n            <div className=\"space-y-2\">\n              <div className=\"h-10 w-40 bg-muted/50 rounded-lg mx-auto animate-pulse\"></div>\n              <div className=\"h-5 w-28 bg-muted/50 rounded-lg mx-auto animate-pulse\"></div>\n            </div>\n          ) : (\n            <>\n              <h2 className=\"text-2xl sm:text-3xl font-display font-bold mb-1.5\" data-testid=\"text-token-price\">\n                ${currentPrice.toLocaleString('en-US', { \n                  minimumFractionDigits: 2,\n                  maximumFractionDigits: currentPrice < 1 ? 6 : 2\n                })}\n              </h2>\n              {priceInfo && (\n                <div className={`flex items-center justify-center gap-2 ${isPositive ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>\n                  {isPositive ? <TrendingUp className=\"h-4 w-4\" /> : <TrendingDown className=\"h-4 w-4\" />}\n                  <span className=\"text-sm font-medium\" data-testid=\"text-price-change\">\n                    ${Math.abs(priceChangeValue).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 })} ({priceChangeFormatted})\n                  </span>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Chart */}\n        <Card className=\"mb-4\">\n          <CardContent className=\"p-3 sm:p-4\">\n            {/* Time Period Toggles */}\n            <div className=\"flex items-center justify-between mb-3 gap-1\">\n              {TIME_PERIODS.map((period) => (\n                <Button\n                  key={period}\n                  variant={selectedPeriod === period ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setSelectedPeriod(period)}\n                  className=\"flex-1 text-xs px-2\"\n                  data-testid={`button-period-${period}`}\n                >\n                  {t(`tokenDetail.timePeriod${period}`)}\n                </Button>\n              ))}\n            </div>\n\n            {/* TradingView Real-time Chart */}\n            <div className=\"relative rounded-lg overflow-hidden\">\n              <TradingViewChart\n                symbol={coingeckoId || 'ethereum'}\n                interval={\n                  selectedPeriod === '1H' ? '5' :\n                  selectedPeriod === '1D' ? '15' :\n                  selectedPeriod === '1W' ? '60' :\n                  selectedPeriod === '1M' ? '240' :\n                  selectedPeriod === '1Y' ? 'D' :\n                  'D'\n                }\n                theme={theme === 'dark' ? 'dark' : 'light'}\n                height={300}\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Tabs - Trust Wallet Style */}\n        <Tabs defaultValue=\"holdings\" className=\"mb-6\">\n          <TabsList className=\"grid w-full grid-cols-3 mb-6\">\n            <TabsTrigger value=\"holdings\" data-testid=\"tab-holdings\">{t('tokenDetail.holdings')}</TabsTrigger>\n            <TabsTrigger value=\"history\" data-testid=\"tab-history\">{t('tokenDetail.history')}</TabsTrigger>\n            <TabsTrigger value=\"about\" data-testid=\"tab-about\">{t('tokenDetail.about')}</TabsTrigger>\n          </TabsList>\n          \n          {/* Holdings Tab */}\n          <TabsContent value=\"holdings\" className=\"mt-0\">\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold\" data-testid=\"text-my-balance\">{t('tokenDetail.myBalance')}</h3>\n              \n              <div className=\"flex items-center justify-between py-4\">\n                <div className=\"flex items-center gap-3\">\n                  {token.icon && (\n                    <div className=\"relative w-12 h-12\">\n                      <img \n                        src={token.icon} \n                        alt={token.name} \n                        className=\"w-full h-full rounded-full\"\n                        onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }}\n                      />\n                    </div>\n                  )}\n                  <div>\n                    <p className=\"font-semibold text-base\" data-testid=\"text-token-name-balance\">{token.name}</p>\n                    <p className=\"text-sm text-muted-foreground\" data-testid=\"text-token-balance\">\n                      {formatBalance(balance)} {token.symbol}\n                    </p>\n                  </div>\n                </div>\n                \n                <div className=\"text-right\">\n                  <p className=\"font-semibold text-base\" data-testid=\"text-fiat-value\">\n                    {formatUSD(realTimeFiatValue)}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">-</p>\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n          \n          {/* History Tab */}\n          <TabsContent value=\"history\" className=\"mt-0\">\n            <div className=\"space-y-4\">\n              <h3 className=\"text-lg font-semibold\">{t('tokenDetail.recentTransactions')}</h3>\n              \n              {tokenTransactions.length > 0 ? (\n                <div className=\"divide-y\">\n                  {tokenTransactions.slice(0, 10).map((tx: any) => (\n                    <TransactionRow\n                      key={tx.hash}\n                      type={tx.type}\n                      status={tx.status}\n                      amount={tx.value}\n                      tokenSymbol={tx.tokenSymbol}\n                      timestamp={new Date(tx.timestamp).toLocaleString()}\n                      hash={tx.hash}\n                      onClick={() => setLocation(`/transaction/${tx.hash}`)}\n                    />\n                  ))}\n                </div>\n              ) : (\n                <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n                  <div className=\"w-24 h-24 mb-4 opacity-50\">\n                    <svg viewBox=\"0 0 100 100\" fill=\"none\" className=\"w-full h-full\">\n                      <rect x=\"20\" y=\"40\" width=\"60\" height=\"40\" rx=\"4\" className=\"fill-muted-foreground/20\" />\n                      <rect x=\"30\" y=\"50\" width=\"40\" height=\"4\" rx=\"2\" className=\"fill-muted-foreground/40\" />\n                      <rect x=\"30\" y=\"60\" width=\"30\" height=\"4\" rx=\"2\" className=\"fill-muted-foreground/40\" />\n                    </svg>\n                  </div>\n                  <p className=\"text-foreground font-medium mb-2\">{t('tokenDetail.noTransactions')}</p>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    {t('tokenDetail.cannotFindTransaction')}\n                  </p>\n                  <Button \n                    variant=\"default\" \n                    size=\"lg\"\n                    className=\"bg-[#00D9A3] hover:bg-[#00D9A3]/90 text-black font-semibold\"\n                    onClick={() => setLocation(`/buy-sell?token=${symbol}`)}\n                    data-testid=\"button-buy-token\"\n                  >\n                    {t('tokenDetail.buyToken', { symbol: token.symbol })}\n                  </Button>\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          {/* About Tab */}\n          <TabsContent value=\"about\" className=\"mt-0\">\n            {(() => {\n              const tokenInfo = getTokenInfo(token.symbol);\n              \n              return (\n                <div className=\"space-y-6\">\n                  <div>\n                    <h3 className=\"text-lg font-semibold mb-2\">{t('tokenDetail.aboutToken', { symbol: token.symbol })}</h3>\n                    <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                      {tokenInfo?.description || t('tokenDetail.defaultDescription', { name: token.name })}\n                    </p>\n                    {tokenInfo?.links?.website && (\n                      <a \n                        href={tokenInfo.links.website}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-sm text-primary mt-2 font-medium hover:underline inline-block\"\n                        data-testid=\"link-read-more\"\n                      >\n                        {t('tokenDetail.readMore')}\n                      </a>\n                    )}\n                  </div>\n\n                  {/* Contract Security */}\n                  <div>\n                    <h3 className=\"text-base font-semibold mb-3\">{t('tokenDetail.contractSecurity')}</h3>\n                    <div className=\"bg-card border rounded-lg p-4\">\n                      <div className=\"flex items-start gap-2 mb-2\">\n                        <CheckCircle2 className=\"h-5 w-5 text-green-500 mt-0.5\" />\n                        <div>\n                          <p className=\"text-sm font-medium\">{t('tokenDetail.noRisksFound')}</p>\n                        </div>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground ml-7\">\n                        {t('tokenDetail.scannedBy')}\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* Honeypot Risk */}\n                  <div>\n                    <h3 className=\"text-base font-semibold mb-3\">{t('tokenDetail.honeypotRisk')}</h3>\n                    <div className=\"bg-card border rounded-lg p-4\">\n                      <div className=\"flex items-start gap-2 mb-2\">\n                        <CheckCircle2 className=\"h-5 w-5 text-green-500 mt-0.5\" />\n                        <div>\n                          <p className=\"text-sm font-medium\">{t('tokenDetail.noRisksFound')}</p>\n                        </div>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground ml-7\">\n                        {t('tokenDetail.scannedBy')}\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* Stats */}\n                  {tokenInfo && (\n                    <div>\n                      <h3 className=\"text-base font-semibold mb-3\">{t('tokenDetail.stats')}</h3>\n                      <div className=\"bg-card border rounded-lg divide-y\">\n                        {tokenInfo.marketCap && (\n                          <div className=\"flex items-center justify-between p-4\">\n                            <span className=\"text-sm text-muted-foreground\">{t('tokenDetail.marketCap')}</span>\n                            <span className=\"text-sm font-medium\">{tokenInfo.marketCap}</span>\n                          </div>\n                        )}\n                        {tokenInfo.circulatingSupply && (\n                          <div className=\"flex items-center justify-between p-4\">\n                            <span className=\"text-sm text-muted-foreground\">{t('tokenDetail.circulatingSupply')}</span>\n                            <span className=\"text-sm font-medium\">{tokenInfo.circulatingSupply}</span>\n                          </div>\n                        )}\n                        {tokenInfo.totalSupply && (\n                          <div className=\"flex items-center justify-between p-4\">\n                            <span className=\"text-sm text-muted-foreground\">{t('tokenDetail.totalSupply')}</span>\n                            <span className=\"text-sm font-medium\">{tokenInfo.totalSupply}</span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Links */}\n                  {tokenInfo?.links && (\n                    <div>\n                      <h3 className=\"text-base font-semibold mb-3\">{t('tokenDetail.links')}</h3>\n                      <div className=\"flex flex-wrap gap-2\">\n                        {tokenInfo.links.website && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"gap-1\"\n                            onClick={() => window.open(tokenInfo.links.website, '_blank')}\n                            data-testid=\"button-website\"\n                          >\n                            {t('tokenDetail.officialWebsite')}\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                        {tokenInfo.links.explorer && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"gap-1\"\n                            onClick={() => window.open(tokenInfo.links.explorer, '_blank')}\n                            data-testid=\"button-explorer\"\n                          >\n                            {t('tokenDetail.explorer')}\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                        {tokenInfo.links.github && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"gap-1\"\n                            onClick={() => window.open(tokenInfo.links.github, '_blank')}\n                            data-testid=\"button-github\"\n                          >\n                            {t('tokenDetail.github')}\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                        {tokenInfo.links.twitter && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"gap-1\"\n                            onClick={() => window.open(tokenInfo.links.twitter, '_blank')}\n                            data-testid=\"button-twitter\"\n                          >\n                            {t('tokenDetail.twitter')}\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              );\n            })()}\n          </TabsContent>\n        </Tabs>\n\n      </div>\n\n      {/* Fixed Bottom Action Panel */}\n      <div className=\"fixed bottom-0 left-0 right-0 z-50 bg-background border-t border-border\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"grid grid-cols-5 gap-3 max-w-2xl mx-auto\">\n            <div className=\"flex flex-col items-center gap-2\">\n              <Button\n                size=\"icon\"\n                className=\"h-14 w-14 rounded-2xl bg-muted hover:bg-muted/80 dark:bg-muted dark:hover:bg-muted/80 transition-all duration-200\"\n                onClick={() => setLocation(`/send/${token._id || token.id}`)}\n                data-testid=\"button-send\"\n              >\n                <ArrowUpRight className=\"h-5 w-5 text-black\" />\n              </Button>\n              <span className=\"text-xs font-medium text-foreground\">{t('common.send')}</span>\n            </div>\n            <div className=\"flex flex-col items-center gap-2\">\n              <Button\n                size=\"icon\"\n                className=\"h-14 w-14 rounded-2xl bg-muted hover:bg-muted/80 dark:bg-muted dark:hover:bg-muted/80 transition-all duration-200\"\n                onClick={() => setLocation(`/receive-qr/${token._id || token.id}`)}\n                data-testid=\"button-receive\"\n              >\n                <ArrowDownLeft className=\"h-5 w-5 text-black\" />\n              </Button>\n              <span className=\"text-xs font-medium text-foreground\">{t('common.receive')}</span>\n            </div>\n            <div className=\"flex flex-col items-center gap-2\">\n              <Button\n                size=\"icon\"\n                className=\"h-14 w-14 rounded-2xl bg-muted hover:bg-muted/80 dark:bg-muted dark:hover:bg-muted/80 transition-all duration-200\"\n                onClick={() => setLocation(`/swap?from=${symbol}&chainId=${token.chainId}`)}\n                data-testid=\"button-swap\"\n              >\n                <Repeat2 className=\"h-5 w-5 text-black\" />\n              </Button>\n              <span className=\"text-xs font-medium text-foreground\">{t('common.swap')}</span>\n            </div>\n            <div className=\"flex flex-col items-center gap-2\">\n              <Button\n                size=\"icon\"\n                className=\"h-14 w-14 rounded-2xl bg-[#00D9A3] hover:bg-[#00D9A3]/90 text-black transition-all duration-200\"\n                onClick={() => setLocation(`/buy-sell?token=${symbol}`)}\n                data-testid=\"button-buy\"\n              >\n                <ShoppingCart className=\"h-5 w-5\" />\n              </Button>\n              <span className=\"text-xs font-medium text-foreground\">{t('common.buy')}</span>\n            </div>\n            <div className=\"flex flex-col items-center gap-2\">\n              <Button\n                size=\"icon\"\n                className=\"h-14 w-14 rounded-2xl bg-muted hover:bg-muted/80 dark:bg-muted dark:hover:bg-muted/80 transition-all duration-200 text-black\"\n                onClick={() => setLocation(`/buy-sell?token=${symbol}&mode=sell`)}\n                data-testid=\"button-sell\"\n              >\n                <Landmark className=\"h-5 w-5 text-black\" />\n              </Button>\n              <span className=\"text-xs font-medium text-foreground\">{t('common.sell')}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":24971},"client/src/components/add-token-dialog.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, CheckCircle2 } from \"lucide-react\";\n\nconst addTokenSchema = z.object({\n  chainId: z.string().min(1, \"Chain is required\"),\n  contractAddress: z.string().min(1, \"Contract address is required\"),\n});\n\ntype AddTokenForm = z.infer<typeof addTokenSchema>;\n\ninterface AddTokenDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function AddTokenDialog({ open, onOpenChange }: AddTokenDialogProps) {\n  const { walletId } = useWallet();\n  const { toast } = useToast();\n  const [validatedToken, setValidatedToken] = useState<{\n    name: string;\n    symbol: string;\n    decimals: number;\n  } | null>(null);\n  const [isValidating, setIsValidating] = useState(false);\n\n  const { data: chains = [] } = useQuery<any[]>({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const form = useForm<AddTokenForm>({\n    resolver: zodResolver(addTokenSchema),\n    defaultValues: {\n      chainId: \"\",\n      contractAddress: \"\",\n    },\n  });\n\n  const validateTokenMutation = useMutation({\n    mutationFn: async (data: AddTokenForm) => {\n      const response = await apiRequest(\"POST\", \"/api/tokens/validate\", data);\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      setValidatedToken({\n        name: data.name,\n        symbol: data.symbol,\n        decimals: data.decimals,\n      });\n      toast({\n        title: \"Token validated\",\n        description: `Found ${data.symbol} - ${data.name}`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Validation failed\",\n        description: \"Invalid token contract address or unsupported chain\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const addTokenMutation = useMutation({\n    mutationFn: async () => {\n      if (!validatedToken) return;\n      \n      const data = {\n        chainId: form.getValues(\"chainId\"),\n        contractAddress: form.getValues(\"contractAddress\"),\n        symbol: validatedToken.symbol,\n        name: validatedToken.name,\n        decimals: validatedToken.decimals,\n      };\n\n      const response = await apiRequest(\"POST\", `/api/wallet/${walletId}/tokens`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"portfolio\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/wallet\", walletId, \"tokens\"] });\n      \n      toast({\n        title: \"Token added\",\n        description: `${validatedToken?.symbol} has been added to your wallet`,\n      });\n      \n      // Reset and close\n      form.reset();\n      setValidatedToken(null);\n      onOpenChange(false);\n    },\n    onError: (error: any) => {\n      // Check if it's a duplicate token error\n      const errorMessage = error.message || \"\";\n      if (errorMessage.includes(\"Token already added to wallet\")) {\n        toast({\n          title: \"Token already exists\",\n          description: `${validatedToken?.symbol} is already in your wallet`,\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      toast({\n        title: \"Failed to add token\",\n        description: \"Could not add token to wallet\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleValidate = async () => {\n    const isValid = await form.trigger();\n    if (!isValid) return;\n\n    setIsValidating(true);\n    validateTokenMutation.mutate(form.getValues());\n    setIsValidating(false);\n  };\n\n  const handleAddToken = () => {\n    addTokenMutation.mutate();\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      form.reset();\n      setValidatedToken(null);\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"sm:max-w-md\" data-testid=\"dialog-add-token\">\n        <DialogHeader>\n          <DialogTitle>Add Custom Token</DialogTitle>\n          <DialogDescription>\n            Enter a token contract address to add it to your wallet\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"chainId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Network</FormLabel>\n                  <Select\n                    onValueChange={field.onChange}\n                    value={field.value}\n                    disabled={!!validatedToken}\n                  >\n                    <FormControl>\n                      <SelectTrigger data-testid=\"select-chain\">\n                        <SelectValue placeholder=\"Select network\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {chains.map((chain: any) => (\n                        <SelectItem\n                          key={chain.id}\n                          value={chain.id}\n                          data-testid={`option-chain-${chain.id}`}\n                        >\n                          {chain.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"contractAddress\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Contract Address</FormLabel>\n                  <FormControl>\n                    <Input\n                      {...field}\n                      placeholder=\"0x...\"\n                      disabled={!!validatedToken}\n                      data-testid=\"input-contract-address\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {validatedToken && (\n              <div className=\"rounded-lg border bg-muted/50 p-4 space-y-2\">\n                <div className=\"flex items-center gap-2 text-green-600 dark:text-green-400\">\n                  <CheckCircle2 className=\"h-5 w-5\" />\n                  <span className=\"font-medium\">Token Validated</span>\n                </div>\n                <div className=\"text-sm space-y-1 text-muted-foreground\">\n                  <p data-testid=\"text-token-name\">\n                    <span className=\"font-medium\">Name:</span> {validatedToken.name}\n                  </p>\n                  <p data-testid=\"text-token-symbol\">\n                    <span className=\"font-medium\">Symbol:</span> {validatedToken.symbol}\n                  </p>\n                  <p data-testid=\"text-token-decimals\">\n                    <span className=\"font-medium\">Decimals:</span> {validatedToken.decimals}\n                  </p>\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex gap-2\">\n              {!validatedToken ? (\n                <Button\n                  type=\"button\"\n                  onClick={handleValidate}\n                  disabled={isValidating || validateTokenMutation.isPending}\n                  className=\"flex-1\"\n                  data-testid=\"button-validate-token\"\n                >\n                  {isValidating || validateTokenMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Validating...\n                    </>\n                  ) : (\n                    \"Validate Token\"\n                  )}\n                </Button>\n              ) : (\n                <>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setValidatedToken(null)}\n                    className=\"flex-1\"\n                    data-testid=\"button-change-token\"\n                  >\n                    Change Token\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    onClick={handleAddToken}\n                    disabled={addTokenMutation.isPending}\n                    className=\"flex-1\"\n                    data-testid=\"button-confirm-add-token\"\n                  >\n                    {addTokenMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Adding...\n                      </>\n                    ) : (\n                      \"Add Token\"\n                    )}\n                  </Button>\n                </>\n              )}\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":9484},"server/services/coingecko.ts":{"content":"/**\n * CoinGecko API Service\n * Provides functions to fetch real-time cryptocurrency prices and market data\n */\n\n// CoinGecko Demo API configuration\nconst COINGECKO_API_BASE = \"https://api.coingecko.com/api/v3\";\nconst API_KEY = process.env.COINGECKO_API_KEY;\n\ninterface CoinGeckoPrice {\n  [coinId: string]: {\n    usd: number;\n    usd_24h_change: number;\n    usd_market_cap?: number;\n    jpy?: number;\n    cad?: number;\n    gbp?: number;\n    aed?: number;\n    aud?: number;\n    krw?: number;\n    chf?: number;\n    czk?: number;\n    dkk?: number;\n    nok?: number;\n    nzd?: number;\n  };\n}\n\ninterface CoinGeckoMarketData {\n  id: string;\n  symbol: string;\n  name: string;\n  image: string;\n  current_price: number;\n  market_cap: number;\n  market_cap_rank: number;\n  price_change_24h: number;\n  price_change_percentage_24h: number;\n  circulating_supply: number;\n  total_supply: number;\n  max_supply: number | null;\n  ath: number;\n  atl: number;\n}\n\ninterface CoinGeckoChartData {\n  prices: [number, number][]; // [timestamp, price]\n  market_caps: [number, number][];\n  total_volumes: [number, number][];\n}\n\n/**\n * Fetch simple prices for multiple coins\n * @param coinIds Array of CoinGecko IDs (e.g., [\"ethereum\", \"bitcoin\"])\n * @returns Price data for requested coins\n */\nexport async function getSimplePrices(coinIds: string[]): Promise<CoinGeckoPrice> {\n  if (!API_KEY) {\n    throw new Error(\"COINGECKO_API_KEY is not configured\");\n  }\n\n  const ids = coinIds.join(\",\");\n  // Include multiple fiat currencies for proper conversion\n  const currencies = \"usd,jpy,cad,gbp,aed,aud,krw,chf,czk,dkk,nok,nzd\";\n  const url = `${COINGECKO_API_BASE}/simple/price?ids=${ids}&vs_currencies=${currencies}&include_24hr_change=true&include_market_cap=true`;\n\n  try {\n    console.log(`[CoinGecko] Fetching prices for ${coinIds.length} coins from: ${url}`);\n    const response = await fetch(url, {\n      headers: {\n        \"x-cg-demo-api-key\": API_KEY,\n      },\n    });\n    \n    console.log(`[CoinGecko] Response status: ${response.status} ${response.statusText}`);\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      console.error(`[CoinGecko] Error response body: ${errorText}`);\n      throw new Error(`CoinGecko API error: ${response.status} ${response.statusText} - ${errorText}`);\n    }\n\n    const data = await response.json();\n    console.log(`[CoinGecko] Successfully fetched prices for ${Object.keys(data).length} coins`);\n    return data;\n  } catch (error) {\n    console.error(\"[CoinGecko] Error fetching prices:\", error);\n    throw error;\n  }\n}\n\n/**\n * Fetch detailed market data for multiple coins\n * @param coinIds Array of CoinGecko IDs\n * @returns Market data for requested coins\n */\nexport async function getMarketData(coinIds: string[]): Promise<CoinGeckoMarketData[]> {\n  if (!API_KEY) {\n    throw new Error(\"COINGECKO_API_KEY is not configured\");\n  }\n\n  const ids = coinIds.join(\",\");\n  const url = `${COINGECKO_API_BASE}/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&per_page=100&page=1&sparkline=false`;\n\n  try {\n    const response = await fetch(url, {\n      headers: {\n        \"x-cg-demo-api-key\": API_KEY,\n      },\n    });\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`CoinGecko API error: ${response.status} ${response.statusText} - ${errorText}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error(\"Error fetching market data from CoinGecko:\", error);\n    throw error;\n  }\n}\n\n/**\n * Fetch historical price chart data for a coin\n * @param coinId CoinGecko coin ID\n * @param days Number of days (1, 7, 14, 30, 90, 180, 365, max)\n * @returns Chart data with prices, market caps, and volumes\n */\nexport async function getChartData(\n  coinId: string,\n  days: string | number = 7\n): Promise<CoinGeckoChartData> {\n  if (!API_KEY) {\n    throw new Error(\"COINGECKO_API_KEY is not configured\");\n  }\n\n  const url = `${COINGECKO_API_BASE}/coins/${coinId}/market_chart?vs_currency=usd&days=${days}`;\n\n  try {\n    const response = await fetch(url, {\n      headers: {\n        \"x-cg-demo-api-key\": API_KEY,\n      },\n    });\n    \n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`CoinGecko API error: ${response.status} ${response.statusText} - ${errorText}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error(\"Error fetching chart data from CoinGecko:\", error);\n    throw error;\n  }\n}\n\n/**\n * Convert time period string to days parameter for CoinGecko API\n * @param period Time period (1H, 1D, 1W, 1M, 1Y, All)\n * @returns Days parameter for API\n */\nexport function periodToDays(period: string): string | number {\n  switch (period.toUpperCase()) {\n    case \"1H\":\n      return 1; // 1 day with hourly data\n    case \"1D\":\n      return 1;\n    case \"1W\":\n      return 7;\n    case \"1M\":\n      return 30;\n    case \"1Y\":\n      return 365;\n    case \"ALL\":\n      return \"max\";\n    default:\n      return 7;\n  }\n}\n\n/**\n * Fetch price for a single coin\n * @param coinId CoinGecko coin ID\n * @returns Price data for the coin\n */\nexport async function getCoinPrice(coinId: string) {\n  const prices = await getSimplePrices([coinId]);\n  return prices[coinId];\n}\n","size_bytes":5236},"client/src/components/chain-selector.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { ChevronDown } from \"lucide-react\";\nimport { useChain } from \"@/contexts/chain-context\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nexport function ChainSelector() {\n  const { selectedChain, setSelectedChain } = useChain();\n\n  // Fetch all available chains\n  const { data: chains, isLoading } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const chainList = (chains as any) || [];\n  const currentChain = chainList.find((c: any) => c.id === selectedChain) || chainList[0];\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          className=\"gap-1 hover-elevate active-elevate-2\"\n          data-testid=\"button-chain-selector\"\n          disabled={isLoading}\n        >\n          <span className=\"text-base\">{currentChain?.icon || \"\"}</span>\n          <span className=\"hidden sm:inline text-xs font-medium\">\n            {isLoading ? \"Loading...\" : (currentChain?.networkStandard || \"ERC-20\")}\n          </span>\n          <ChevronDown className=\"h-3 w-3\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"start\" className=\"w-48\">\n        {isLoading ? (\n          <div className=\"px-3 py-2 text-sm text-muted-foreground\">\n            Loading chains...\n          </div>\n        ) : chainList.length === 0 ? (\n          <div className=\"px-3 py-2 text-sm text-muted-foreground\">\n            No chains available\n          </div>\n        ) : (\n          chainList.map((chain: any) => (\n            <DropdownMenuItem\n              key={chain.id}\n              onClick={() => setSelectedChain(chain.id)}\n              className=\"flex items-center gap-2 cursor-pointer\"\n              data-testid={`chain-option-${chain.id}`}\n            >\n              <span className=\"text-base\">{chain.icon}</span>\n              <div className=\"flex flex-col\">\n                <span className=\"text-sm font-medium\">{chain.name}</span>\n                <span className=\"text-xs text-muted-foreground\">{chain.networkStandard}</span>\n              </div>\n              {selectedChain === chain.id && (\n                <span className=\"ml-auto text-primary\"></span>\n              )}\n            </DropdownMenuItem>\n          ))\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":2487},"client/src/pages/buy-sell.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { ArrowLeft, ChevronDown, Check, Search, Landmark, CreditCard, Smartphone } from \"lucide-react\";\nimport { SiGooglepay, SiApplepay } from \"react-icons/si\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport moonpayLogo from \"@assets/0de69ab328f64be1b87dfdafb031fb57_1761696781474.png\";\n\nconst FIAT_CURRENCIES = [\n  { code: \"USD\", name: \"US Dollar\", symbol: \"$\" },\n  { code: \"JPY\", name: \"Japanese Yen\", symbol: \"\" },\n  { code: \"CAD\", name: \"Canadian Dollar\", symbol: \"C$\" },\n  { code: \"GBP\", name: \"British Pound\", symbol: \"\" },\n  { code: \"AED\", name: \"UAE Dirham\", symbol: \".\" },\n  { code: \"AUD\", name: \"Australian Dollar\", symbol: \"A$\" },\n  { code: \"KRW\", name: \"South Korean Won\", symbol: \"\" },\n  { code: \"CHF\", name: \"Swiss Franc\", symbol: \"CHF\" },\n  { code: \"CZK\", name: \"Czech Koruna\", symbol: \"K\" },\n  { code: \"DKK\", name: \"Danish Krone\", symbol: \"kr\" },\n  { code: \"NOK\", name: \"Norwegian Krone\", symbol: \"kr\" },\n  { code: \"NZD\", name: \"New Zealand Dollar\", symbol: \"NZ$\" },\n];\n\nconst PAYMENT_METHODS = [\n  { id: \"bank_transfer\", name: \"Bank Transfer\", logo: \"bank\" },\n  { id: \"debit_card\", name: \"Debit Card\", logo: \"card\" },\n  { id: \"credit_card\", name: \"Credit Card\", logo: \"card\" },\n  { id: \"google_pay\", name: \"Google Pay\", logo: \"google\" },\n  { id: \"apple_pay\", name: \"Apple Pay\", logo: \"apple\" },\n  { id: \"pix\", name: \"PIX\", logo: \"pix\" },\n];\n\n// Chain address mapping - user's wallet address for each chain\nconst CHAIN_ADDRESSES: Record<string, string> = {\n  \"ethereum\": \"0xADBaa25dDce928FDa7E96c77f6c41C301a2501bb\",\n  \"bnb\": \"0xADBaa25dDce928FDa7E96c77f6c41C301a2501bb\",\n  \"tron\": \"TGDqQAP5bduoPKVgdbk7fGyW4DwEt3RRn8\",\n  \"solana\": \"7nE4kXUvuzZXvE8C3Vm8YWKUypqLk6u8BvqBJxBp9kYW\",\n};\n\nexport default function BuySell() {\n  const [, setLocation] = useLocation();\n  const { walletAddress, walletId } = useWallet();\n  const [activeTab, setActiveTab] = useState<\"buy\" | \"sell\">(\"buy\");\n  const [fiatAmount, setFiatAmount] = useState(\"300\");\n  const [selectedFiat, setSelectedFiat] = useState(FIAT_CURRENCIES[0]);\n  const [selectedCrypto, setSelectedCrypto] = useState<any>(null);\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState(PAYMENT_METHODS[0]);\n  const [showFiatSelector, setShowFiatSelector] = useState(false);\n  const [showCryptoSelector, setShowCryptoSelector] = useState(false);\n  const [showPaymentMethodSelector, setShowPaymentMethodSelector] = useState(false);\n  const [fiatSearch, setFiatSearch] = useState(\"\");\n  const [cryptoSearch, setCryptoSearch] = useState(\"\");\n  const [fiatSearchReadOnly, setFiatSearchReadOnly] = useState(true);\n  const [cryptoSearchReadOnly, setCryptoSearchReadOnly] = useState(true);\n  const [sellAmountReadOnly, setSellAmountReadOnly] = useState(true);\n  const [sellAmount, setSellAmount] = useState(\"0\");\n\n  // Fetch wallet tokens (for sell section - user can only sell what they own)\n  const { data: portfolioData } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"portfolio\"],\n    enabled: !!walletId && activeTab === \"sell\",\n  });\n\n  // Fetch ALL available tokens (for buy section - show all possible tokens)\n  const { data: availableTokensData } = useQuery({\n    queryKey: [\"/api/available-tokens\"],\n    enabled: activeTab === \"buy\",\n  });\n\n  // Fetch chains\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Fetch prices for conversion\n  const { data: pricesData } = useQuery({\n    queryKey: [\"/api/prices\"],\n  });\n\n  const chains = (chainsData as any) || [];\n  const portfolioTokens = (portfolioData as any)?.tokens || [];\n  const availableTokens = (availableTokensData as any) || [];\n  const tokens = activeTab === \"buy\" ? availableTokens : portfolioTokens;\n  const prices = (pricesData as any) || {};\n\n  // Handle URL parameters and set defaults\n  useEffect(() => {\n    // Check for mode parameter to switch tab\n    const urlParams = new URLSearchParams(window.location.search);\n    const modeParam = urlParams.get('mode');\n    if (modeParam === 'sell') {\n      setActiveTab('sell');\n    }\n  }, []);\n\n  // Reset selectedCrypto when switching tabs to ensure correct token list is used\n  useEffect(() => {\n    setSelectedCrypto(null);\n  }, [activeTab]);\n\n  // Set default to ETH or URL parameter token when tokens load\n  useEffect(() => {\n    if (tokens.length > 0 && !selectedCrypto) {\n      // Check for URL parameter\n      const urlParams = new URLSearchParams(window.location.search);\n      const tokenParam = urlParams.get('token');\n      \n      if (tokenParam) {\n        // Try to find the token from URL parameter\n        const paramToken = tokens.find((t: any) => \n          t.symbol.toUpperCase() === tokenParam.toUpperCase()\n        );\n        if (paramToken) {\n          setSelectedCrypto(paramToken);\n          return;\n        }\n      }\n      \n      // Default to ETH if no URL param or token not found\n      const ethToken = tokens.find((t: any) => t.symbol === \"ETH\");\n      if (ethToken) {\n        setSelectedCrypto(ethToken);\n      } else if (tokens.length > 0) {\n        setSelectedCrypto(tokens[0]);\n      }\n    }\n  }, [tokens, selectedCrypto, activeTab]);\n\n  // Calculate crypto amount in real-time based on fiat amount (Buy tab)\n  const calculateCryptoAmount = () => {\n    if (!selectedCrypto || !fiatAmount || !prices) return \"0.00\";\n    \n    const tokenPrice = prices[selectedCrypto.coingeckoId];\n    if (!tokenPrice) return \"0.00\";\n    \n    const fiatValue = parseFloat(fiatAmount) || 0;\n    \n    // Use the selected fiat currency's price if available, otherwise fall back to USD\n    const currencyCode = selectedFiat.code.toLowerCase();\n    const priceInSelectedCurrency = tokenPrice[currencyCode] || tokenPrice.usd;\n    \n    if (!priceInSelectedCurrency) return \"0.00\";\n    \n    const cryptoAmount = fiatValue / priceInSelectedCurrency;\n    \n    return cryptoAmount.toFixed(6);\n  };\n  \n  // Calculate fiat amount in real-time based on crypto sell amount (Sell tab)\n  const calculateFiatReceiveAmount = () => {\n    if (!selectedCrypto || !sellAmount || !prices) return \"0.00\";\n    \n    const tokenPrice = prices[selectedCrypto.coingeckoId];\n    if (!tokenPrice) return \"0.00\";\n    \n    const cryptoValue = parseFloat(sellAmount) || 0;\n    \n    // Use the selected fiat currency's price if available, otherwise fall back to USD\n    const currencyCode = selectedFiat.code.toLowerCase();\n    const priceInSelectedCurrency = tokenPrice[currencyCode] || tokenPrice.usd;\n    \n    if (!priceInSelectedCurrency) return \"0.00\";\n    \n    const fiatAmount = cryptoValue * priceInSelectedCurrency;\n    \n    return fiatAmount.toFixed(2);\n  };\n\n  const filteredFiatCurrencies = FIAT_CURRENCIES.filter(\n    (currency) =>\n      currency.code.toLowerCase().includes(fiatSearch.toLowerCase()) ||\n      currency.name.toLowerCase().includes(fiatSearch.toLowerCase())\n  );\n\n  const filteredCryptoTokens = tokens.filter((token: any) =>\n    token.name.toLowerCase().includes(cryptoSearch.toLowerCase()) ||\n    token.symbol.toLowerCase().includes(cryptoSearch.toLowerCase())\n  );\n\n  const handleBuy = () => {\n    // Build dynamic MoonPay URL with selected values\n    const params = new URLSearchParams({\n      apiKey: \"pk_live_GyP2tHBRCCE4g0C6HOZfX3ovu9xFMbd\",\n      baseCurrencyAmount: fiatAmount,\n      baseCurrencyCode: selectedFiat.code.toLowerCase(),\n      currencyCode: selectedCrypto.symbol.toLowerCase(),\n      walletAddress: getReceivingAddress(),\n    });\n    \n    const moonpayUrl = `https://buy.moonpay.com/?${params.toString()}`;\n    window.open(moonpayUrl, \"_blank\");\n  };\n\n  // Get receiving address for selected crypto\n  const getReceivingAddress = () => {\n    if (!selectedCrypto) return walletAddress || CHAIN_ADDRESSES[\"ethereum\"];\n    const chainId = selectedCrypto.chainId;\n    return CHAIN_ADDRESSES[chainId] || walletAddress || CHAIN_ADDRESSES[\"ethereum\"];\n  };\n\n  // Get chain name for selected crypto\n  const getChainName = () => {\n    if (!selectedCrypto) return \"Ethereum\";\n    const chain = chains.find((c: any) => c.id === selectedCrypto.chainId);\n    return chain?.name || \"Ethereum\";\n  };\n\n  // Get chain symbol for selected crypto\n  const getChainSymbol = () => {\n    if (!selectedCrypto) return \"ETH\";\n    const chain = chains.find((c: any) => c.id === selectedCrypto.chainId);\n    return chain?.symbol || \"ETH\";\n  };\n\n  if (!selectedCrypto) {\n    return null; // Loading state\n  }\n\n  const estimatedReceive = calculateCryptoAmount();\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"border-b bg-card\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4 flex items-center justify-between max-w-2xl\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => window.history.back()}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg sm:text-xl font-semibold\">Buy/Sell Crypto</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 sm:py-6 max-w-2xl\">\n        {/* Buy/Sell Tabs */}\n        <div className=\"flex gap-2 mb-6\">\n          <Button\n            variant={activeTab === \"buy\" ? \"default\" : \"ghost\"}\n            onClick={() => setActiveTab(\"buy\")}\n            className=\"flex-1\"\n            data-testid=\"button-tab-buy\"\n          >\n            Buy\n          </Button>\n          <Button\n            variant={activeTab === \"sell\" ? \"default\" : \"ghost\"}\n            onClick={() => setActiveTab(\"sell\")}\n            className=\"flex-1\"\n            data-testid=\"button-tab-sell\"\n          >\n            Sell\n          </Button>\n        </div>\n\n        {/* Buy Tab */}\n        {activeTab === \"buy\" && (\n          <div className=\"space-y-4\">\n            {/* Pay Section */}\n            <div className=\"bg-card rounded-lg p-4 border\">\n              <div className=\"text-sm text-muted-foreground mb-2\">Pay</div>\n              <div className=\"flex items-center justify-between gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  className=\"flex items-center gap-2 p-0 h-auto hover:bg-transparent\"\n                  onClick={() => {\n                    setFiatSearchReadOnly(true);\n                    setFiatSearch(\"\");\n                    setShowFiatSelector(true);\n                  }}\n                  data-testid=\"button-select-fiat\"\n                >\n                  <div className=\"w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-white font-bold\">\n                    {selectedFiat.symbol}\n                  </div>\n                  <span className=\"font-semibold\">{selectedFiat.code}</span>\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n                <Input\n                  type=\"number\"\n                  value={fiatAmount}\n                  onChange={(e) => setFiatAmount(e.target.value)}\n                  className=\"text-right text-xl font-semibold border-0 bg-transparent p-0 h-auto focus-visible:ring-0\"\n                  data-testid=\"input-fiat-amount\"\n                />\n              </div>\n            </div>\n\n            {/* Swap Arrow */}\n            <div className=\"flex justify-center\">\n              <div className=\"w-10 h-10 rounded-full bg-primary flex items-center justify-center\">\n                <span className=\"text-primary-foreground\"></span>\n              </div>\n            </div>\n\n            {/* Estimated Receive Section */}\n            <div className=\"bg-card rounded-lg p-4 border\">\n              <div className=\"text-sm text-muted-foreground mb-2\">Estimated Receive</div>\n              <div className=\"flex items-center justify-between gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  className=\"flex items-center gap-2 p-0 h-auto hover:bg-transparent\"\n                  onClick={() => {\n                    setCryptoSearchReadOnly(true);\n                    setCryptoSearch(\"\");\n                    setShowCryptoSelector(true);\n                  }}\n                  data-testid=\"button-select-crypto\"\n                >\n                  <img\n                    src={selectedCrypto.icon}\n                    alt={selectedCrypto.code}\n                    className=\"w-8 h-8 rounded-full\"\n                  />\n                  <div className=\"text-left\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <span className=\"font-semibold\">{selectedCrypto.symbol}</span>\n                      <span className=\"text-xs text-muted-foreground\">({getChainSymbol()})</span>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">{selectedCrypto.name}</div>\n                  </div>\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n                <div className=\"text-right text-xl font-semibold\" data-testid=\"text-crypto-amount\">\n                  {estimatedReceive}\n                </div>\n              </div>\n            </div>\n\n            {/* Payment Method */}\n            <div className=\"flex items-center justify-between py-3\">\n              <span className=\"font-medium\">Payment Method</span>\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowPaymentMethodSelector(true)}\n                className=\"gap-2\"\n                data-testid=\"button-select-payment\"\n              >\n                {selectedPaymentMethod.logo === \"google\" && <SiGooglepay className=\"h-5 w-5\" />}\n                {selectedPaymentMethod.logo === \"apple\" && <SiApplepay className=\"h-5 w-5\" />}\n                {selectedPaymentMethod.logo === \"bank\" && <Landmark className=\"h-5 w-5\" />}\n                {selectedPaymentMethod.logo === \"card\" && <CreditCard className=\"h-5 w-5\" />}\n                {selectedPaymentMethod.logo === \"pix\" && <Smartphone className=\"h-5 w-5\" />}\n                <span>{selectedPaymentMethod.name}</span>\n                <ChevronDown className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Receiving Address */}\n            <div className=\"bg-card rounded-lg p-4 border\">\n              <div className=\"flex items-start gap-2\">\n                <div className=\"w-4 h-4 rounded-full bg-success flex-shrink-0 mt-0.5\">\n                  <Check className=\"h-4 w-4 text-white\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"text-sm text-muted-foreground mb-1\">\n                    Receiving Address ({getChainName()})\n                  </div>\n                  <div className=\"text-xs font-mono break-all\" data-testid=\"text-receiving-address\">\n                    {getReceivingAddress()}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Buy Button */}\n            <Button\n              size=\"lg\"\n              className=\"w-full\"\n              onClick={handleBuy}\n              data-testid=\"button-buy\"\n            >\n              Buy\n            </Button>\n\n            {/* Powered by MoonPay */}\n            <div className=\"flex items-center justify-center gap-2 text-sm text-muted-foreground\" data-testid=\"text-provider-moonpay-buy\">\n              <span>Provided by:</span>\n              <img src={moonpayLogo} alt=\"MoonPay\" className=\"h-6\" />\n              <span>moonpay</span>\n            </div>\n          </div>\n        )}\n\n        {/* Sell Tab */}\n        {activeTab === \"sell\" && (\n          <div className=\"space-y-4\">\n            {/* Sell Section */}\n            <div className=\"bg-card rounded-lg p-4 border\">\n              <div className=\"text-sm text-muted-foreground mb-2\">Sell</div>\n              <div className=\"flex items-center justify-between gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  className=\"flex items-center gap-2 p-0 h-auto hover:bg-transparent\"\n                  onClick={() => {\n                    setCryptoSearchReadOnly(true);\n                    setCryptoSearch(\"\");\n                    setShowCryptoSelector(true);\n                  }}\n                  data-testid=\"button-select-crypto-sell\"\n                >\n                  <img\n                    src={selectedCrypto.icon}\n                    alt={selectedCrypto.code}\n                    className=\"w-8 h-8 rounded-full\"\n                  />\n                  <div className=\"text-left\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <span className=\"font-semibold\">{selectedCrypto.symbol}</span>\n                      <span className=\"text-xs text-muted-foreground\">({getChainSymbol()})</span>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">Balance: {selectedCrypto.balance || \"0\"}</div>\n                  </div>\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n                <div className=\"text-right\">\n                  <Input\n                    type=\"number\"\n                    value={sellAmount}\n                    onChange={(e) => setSellAmount(e.target.value)}\n                    onFocus={() => setSellAmountReadOnly(false)}\n                    readOnly={sellAmountReadOnly}\n                    className=\"text-right text-xl font-semibold border-0 bg-transparent p-0 h-auto focus-visible:ring-0\"\n                    data-testid=\"input-sell-amount\"\n                  />\n                  <Button \n                    variant=\"ghost\" \n                    size=\"sm\" \n                    className=\"p-0 h-auto text-primary\"\n                    onClick={() => {\n                      setSellAmount(selectedCrypto?.balance || \"0\");\n                      setSellAmountReadOnly(false);\n                    }}\n                    data-testid=\"button-sell-max\"\n                  >\n                    MAX\n                  </Button>\n                </div>\n              </div>\n            </div>\n\n            {/* Swap Arrow */}\n            <div className=\"flex justify-center\">\n              <div className=\"w-10 h-10 rounded-full bg-primary flex items-center justify-center\">\n                <span className=\"text-primary-foreground\"></span>\n              </div>\n            </div>\n\n            {/* Estimated Receive Section */}\n            <div className=\"bg-card rounded-lg p-4 border\">\n              <div className=\"text-sm text-muted-foreground mb-2\">Estimated Receive</div>\n              <div className=\"flex items-center justify-between gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  className=\"flex items-center gap-2 p-0 h-auto hover:bg-transparent\"\n                  onClick={() => {\n                    setFiatSearchReadOnly(true);\n                    setFiatSearch(\"\");\n                    setShowFiatSelector(true);\n                  }}\n                  data-testid=\"button-select-fiat-sell\"\n                >\n                  <div className=\"w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-white font-bold\">\n                    {selectedFiat.symbol}\n                  </div>\n                  <span className=\"font-semibold\">{selectedFiat.code}</span>\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n                <Input\n                  type=\"number\"\n                  value={calculateFiatReceiveAmount()}\n                  readOnly\n                  className=\"text-right text-xl font-semibold border-0 bg-transparent p-0 h-auto focus-visible:ring-0\"\n                  data-testid=\"input-receive-amount\"\n                />\n              </div>\n            </div>\n\n            {/* Sell Button */}\n            <Button\n              size=\"lg\"\n              className=\"w-full\"\n              disabled={!sellAmount || parseFloat(sellAmount) <= 0}\n              onClick={() => {\n                // Open MoonPay sell URL\n                const params = new URLSearchParams({\n                  apiKey: \"pk_live_GyP2tHBRCCE4g0C6HOZfX3ovu9xFMbd\",\n                  quoteCurrencyAmount: sellAmount,\n                  baseCurrencyCode: selectedFiat.code.toLowerCase(),\n                  quoteCurrencyCode: selectedCrypto.symbol.toLowerCase(),\n                  refundWalletAddress: getReceivingAddress(),\n                });\n                const moonpayUrl = `https://sell.moonpay.com/?${params.toString()}`;\n                window.open(moonpayUrl, \"_blank\");\n              }}\n              data-testid=\"button-sell\"\n            >\n              Sell\n            </Button>\n\n            {/* Provided by MoonPay */}\n            <div className=\"flex items-center justify-center gap-2 text-sm text-muted-foreground\" data-testid=\"text-provider-moonpay-sell\">\n              <span>Provided by:</span>\n              <img src={moonpayLogo} alt=\"MoonPay\" className=\"h-6\" />\n              <span>moonpay</span>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Fiat Currency Selector Dialog */}\n      <Dialog open={showFiatSelector} onOpenChange={setShowFiatSelector}>\n        <DialogContent className=\"w-full h-full max-w-full max-h-full m-0 p-0 gap-0 rounded-none flex flex-col\" data-testid=\"dialog-select-currency\">\n          <DialogHeader className=\"px-4 py-3 border-b\">\n            <DialogTitle>Select Currency</DialogTitle>\n          </DialogHeader>\n          <div className=\"px-4 pt-4 pb-2\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search\"\n                value={fiatSearch}\n                onChange={(e) => setFiatSearch(e.target.value)}\n                onFocus={() => setFiatSearchReadOnly(false)}\n                readOnly={fiatSearchReadOnly}\n                className=\"pl-10\"\n                data-testid=\"input-search-fiat\"\n              />\n              {fiatSearch && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 h-auto p-1 text-primary\"\n                  onClick={() => setFiatSearch(\"\")}\n                >\n                  Paste\n                </Button>\n              )}\n            </div>\n          </div>\n          <div className=\"flex-1 overflow-y-auto px-4 pb-4\">\n            <div className=\"space-y-2\">\n              {filteredFiatCurrencies.map((currency) => (\n                <Button\n                  key={currency.code}\n                  variant=\"ghost\"\n                  className=\"w-full justify-start gap-3 h-auto py-3\"\n                  onClick={() => {\n                    setSelectedFiat(currency);\n                    setShowFiatSelector(false);\n                    setFiatSearch(\"\");\n                  }}\n                  data-testid={`button-fiat-${currency.code.toLowerCase()}`}\n                >\n                  <div className=\"w-10 h-10 rounded-full bg-yellow-500 flex items-center justify-center text-white font-bold text-lg\">\n                    {currency.symbol}\n                  </div>\n                  <span className=\"font-semibold\">{currency.code}</span>\n                  {selectedFiat.code === currency.code && (\n                    <Check className=\"h-5 w-5 text-success ml-auto\" />\n                  )}\n                </Button>\n              ))}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Crypto Currency Selector Dialog */}\n      <Dialog open={showCryptoSelector} onOpenChange={setShowCryptoSelector}>\n        <DialogContent className=\"w-full h-full max-w-full max-h-full m-0 p-0 gap-0 rounded-none flex flex-col\" data-testid=\"dialog-choose-currency\">\n          <DialogHeader className=\"px-4 py-3 border-b\">\n            <DialogTitle>Choose currency</DialogTitle>\n          </DialogHeader>\n          <div className=\"px-4 pt-4 pb-2\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search\"\n                value={cryptoSearch}\n                onChange={(e) => setCryptoSearch(e.target.value)}\n                onFocus={() => setCryptoSearchReadOnly(false)}\n                readOnly={cryptoSearchReadOnly}\n                className=\"pl-10\"\n                data-testid=\"input-search-crypto\"\n              />\n              {cryptoSearch && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 h-auto p-1 text-primary\"\n                  onClick={() => setCryptoSearch(\"\")}\n                >\n                  Paste\n                </Button>\n              )}\n            </div>\n          </div>\n          <div className=\"flex-1 overflow-y-auto px-4 pb-4\">\n            <div className=\"space-y-2\">\n              {filteredCryptoTokens.map((token: any) => {\n                const chain = chains.find((c: any) => c.id === token.chainId);\n                return (\n                  <Button\n                    key={`${token.id}`}\n                    variant=\"ghost\"\n                    className=\"w-full justify-start gap-3 h-auto py-3\"\n                    onClick={() => {\n                      setSelectedCrypto(token);\n                      setShowCryptoSelector(false);\n                      setCryptoSearch(\"\");\n                    }}\n                    data-testid={`button-crypto-${token.symbol.toLowerCase()}`}\n                  >\n                    <div className=\"relative w-10 h-10 flex-shrink-0\">\n                      <img\n                        src={token.icon}\n                        alt={token.symbol}\n                        className=\"w-10 h-10 rounded-full\"\n                      />\n                      {chain?.icon && (\n                        <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n                          <img \n                            src={chain.icon} \n                            alt=\"\" \n                            className=\"w-full h-full object-cover\" \n                          />\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"text-left flex-1\">\n                      <div className=\"font-semibold\">\n                        {token.symbol}\n                        {chain?.symbol && (\n                          <span className=\"text-xs text-muted-foreground ml-1.5\">({chain.symbol})</span>\n                        )}\n                      </div>\n                      <div className=\"text-xs text-muted-foreground\">{token.name}</div>\n                    </div>\n                    {selectedCrypto?.id === token.id && (\n                      <Check className=\"h-5 w-5 text-success ml-auto\" />\n                    )}\n                  </Button>\n                );\n              })}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Payment Method Selector Dialog */}\n      <Dialog open={showPaymentMethodSelector} onOpenChange={setShowPaymentMethodSelector}>\n        <DialogContent className=\"sm:max-w-md\" data-testid=\"dialog-payment-method\">\n          <DialogHeader>\n            <DialogTitle>Payment Method</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <Button\n              variant=\"ghost\"\n              className=\"w-full justify-start h-auto py-2 text-muted-foreground\"\n              data-testid=\"button-payment-all\"\n            >\n              All\n            </Button>\n            <div className=\"space-y-2\">\n              {PAYMENT_METHODS.map((method) => (\n                <Button\n                  key={method.id}\n                  variant=\"ghost\"\n                  className=\"w-full justify-start gap-3 h-auto py-3 border\"\n                  onClick={() => {\n                    setSelectedPaymentMethod(method);\n                    setShowPaymentMethodSelector(false);\n                  }}\n                  data-testid={`button-payment-${method.id}`}\n                >\n                  <div className=\"w-12 h-8 bg-white dark:bg-card rounded flex items-center justify-center\">\n                    {method.logo === \"google\" && <SiGooglepay className=\"h-6 w-6\" />}\n                    {method.logo === \"apple\" && <SiApplepay className=\"h-6 w-6\" />}\n                    {method.logo === \"bank\" && <Landmark className=\"h-6 w-6\" />}\n                    {method.logo === \"card\" && <CreditCard className=\"h-6 w-6\" />}\n                    {method.logo === \"pix\" && <Smartphone className=\"h-6 w-6\" />}\n                  </div>\n                  <span className=\"font-medium\">{method.name}</span>\n                  {selectedPaymentMethod.id === method.id && (\n                    <Check className=\"h-5 w-5 text-success ml-auto\" />\n                  )}\n                </Button>\n              ))}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":29448},"client/src/lib/format-balance.ts":{"content":"/**\n * Format token balance for display\n * - Shows \"0.0\" for zero balances\n * - Shows up to 6 decimal places maximum for all balances\n * - Removes unnecessary trailing zeros\n */\nexport function formatBalance(balance: string | number): string {\n  const numBalance = typeof balance === 'string' ? parseFloat(balance) : balance;\n  \n  // Handle zero or invalid values\n  if (!numBalance || numBalance === 0 || isNaN(numBalance)) {\n    return \"0.0\";\n  }\n  \n  // For very small balances, use up to 6 decimal places\n  if (numBalance < 0.000001) {\n    return numBalance.toFixed(6);\n  }\n  \n  // For balances less than 1, show up to 6 decimal places but remove trailing zeros\n  if (numBalance < 1) {\n    const formatted = numBalance.toFixed(6);\n    // Remove trailing zeros but keep at least one decimal place\n    return formatted.replace(/\\.?0+$/, '').replace(/\\.$/, '.0');\n  }\n  \n  // For balances >= 1, show up to 6 decimal places\n  if (numBalance < 1000) {\n    const formatted = numBalance.toFixed(6);\n    // Remove trailing zeros\n    return formatted.replace(/\\.?0+$/, '');\n  }\n  \n  // For larger balances, show with thousand separators and up to 6 decimal places\n  return numBalance.toLocaleString('en-US', { \n    minimumFractionDigits: 0,\n    maximumFractionDigits: 6 \n  });\n}\n","size_bytes":1273},"client/src/lib/format-address.ts":{"content":"/**\n * Format a blockchain address for display\n * Example: 0xADBaa25dDce928FDa7E96c77f6c41C301a2501bb -> 0xADBaa...2501bb\n */\nexport function formatAddress(address: string, startChars: number = 6, endChars: number = 5): string {\n  if (!address || address.length < startChars + endChars) {\n    return address;\n  }\n  \n  return `${address.slice(0, startChars)}...${address.slice(-endChars)}`;\n}\n","size_bytes":392},"client/src/pages/receive-qr.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { ArrowLeft, Copy, Share2, CheckCircle2 } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { QRCodeSVG } from \"qrcode.react\";\nimport { getWalletAddress } from \"@shared/wallet-addresses\";\nimport qrLogoImage from \"@assets/WhatsApp Image 2025-10-29 at 00.54.14_f67a12fe_1761724701087.jpg\";\nimport html2canvas from \"html2canvas\";\n\n// BIP44 coin type mapping for payment links\nconst COIN_TYPE_MAP: Record<string, number> = {\n  \"1\": 60,     // Ethereum\n  \"56\": 60,    // BSC (uses same as ETH)\n  \"137\": 60,   // Polygon (uses same as ETH)\n  \"43114\": 60, // Avalanche (uses same as ETH)\n  \"42161\": 60, // Arbitrum (uses same as ETH)\n  \"10\": 60,    // Optimism (uses same as ETH)\n  \"8453\": 60,  // Base (uses same as ETH)\n  \"0\": 0,      // Bitcoin\n  \"2\": 2,      // Litecoin\n};\n\nexport default function ReceiveQr({ params }: { params: { tokenId: string } }) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { walletId } = useWallet();\n  const [copied, setCopied] = useState(false);\n  const qrContainerRef = useRef<HTMLDivElement>(null);\n\n  const tokenId = params?.tokenId || \"\";\n\n  // Fetch available chains to get chain info\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Fetch wallet portfolio to get tokens\n  const { data: portfolioData } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"portfolio\"],\n    enabled: !!walletId,\n  });\n\n  const chains = (chainsData as any) || [];\n  const allTokens = (portfolioData as any)?.tokens || [];\n  \n  // Find the specific token by ID\n  const currentToken = allTokens.find((t: any) => t._id === tokenId);\n  const currentChain = chains.find((c: any) => c.id === currentToken?.chainId);\n  \n  // Get address from hardcoded constants\n  const address = currentToken ? getWalletAddress(currentToken.chainId) : \"\";\n  \n  const [tokenIconError, setTokenIconError] = useState(false);\n\n  const copyAddress = async () => {\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n      try {\n        await navigator.clipboard.writeText(address);\n        setCopied(true);\n        toast({\n          title: \"Address copied\",\n          description: \"Your wallet address has been copied to clipboard.\",\n        });\n        setTimeout(() => setCopied(false), 2000);\n      } catch (err) {\n        // Clipboard write failed (permissions denied, insecure context, etc.)\n        toast({\n          title: \"Copy failed\",\n          description: \"Please copy the address manually from above.\",\n          variant: \"destructive\",\n        });\n      }\n    } else {\n      toast({\n        title: \"Copy unavailable\",\n        description: \"Please copy the address manually from above.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const shareAddress = async () => {\n    // Guard against missing data\n    if (!currentToken || !address) {\n      toast({\n        title: \"Error\",\n        description: \"Please wait for the page to load completely.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // Get coin type for payment link (normalize chainId to string and only if chain is supported)\n      const chainIdStr = String(currentToken.chainId);\n      const coinType = COIN_TYPE_MAP[chainIdStr];\n      \n      // Create formatted message\n      let messageText = `My Public Address to Receive ${currentToken.symbol} ${address}`;\n      \n      // Only add payment link if we have a valid coin type mapping\n      if (coinType !== undefined) {\n        messageText += `\\n\\nPay me via LUMIRRA WALLET: https://lumirrawallet.com/send?coin=${coinType}&address=${address}`;\n      }\n      \n      let qrImageFile: File | null = null;\n      \n      // Try to capture QR code as image\n      if (qrContainerRef.current) {\n        try {\n          const canvas = await html2canvas(qrContainerRef.current, {\n            backgroundColor: null,\n            scale: 2,\n          });\n          \n          // Convert canvas to blob\n          const blob = await new Promise<Blob | null>((resolve) => {\n            canvas.toBlob((blob) => {\n              resolve(blob);\n            }, \"image/png\");\n          });\n          \n          // Only create file if blob is valid\n          if (blob) {\n            qrImageFile = new File([blob], `${currentToken.symbol}_QR.png`, {\n              type: \"image/png\",\n            });\n          }\n        } catch (captureErr) {\n          console.error(\"Failed to capture QR code:\", captureErr);\n          // Continue without image\n        }\n      }\n      \n      // Try to share with Web Share API\n      if (qrImageFile && navigator.share && navigator.canShare && navigator.canShare({ files: [qrImageFile] })) {\n        // Share with image and text\n        await navigator.share({\n          title: `Receive ${currentToken.symbol}`,\n          text: messageText,\n          files: [qrImageFile],\n        });\n      } else if (navigator.share) {\n        // Fallback: share text only if files not supported or capture failed\n        await navigator.share({\n          title: `Receive ${currentToken.symbol}`,\n          text: messageText,\n        });\n      } else if (navigator.clipboard && navigator.clipboard.writeText) {\n        // Fallback: copy to clipboard (check if available)\n        await navigator.clipboard.writeText(messageText);\n        toast({\n          title: \"Copied to clipboard\",\n          description: \"Address and payment link copied. Share feature not supported on this device.\",\n        });\n      } else {\n        toast({\n          title: \"Share unavailable\",\n          description: \"Please copy the address manually.\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (err: any) {\n      // Check if user cancelled the share dialog\n      if (err?.name === \"AbortError\") {\n        // User cancelled, do nothing\n        return;\n      }\n      \n      // Final fallback: try to copy to clipboard with basic message\n      if (!currentToken || !address) {\n        return;\n      }\n\n      try {\n        if (navigator.clipboard && navigator.clipboard.writeText) {\n          const chainIdStr = String(currentToken.chainId);\n          const coinType = COIN_TYPE_MAP[chainIdStr];\n          let messageText = `My Public Address to Receive ${currentToken.symbol} ${address}`;\n          \n          // Only add payment link if we have a valid coin type mapping\n          if (coinType !== undefined) {\n            messageText += `\\n\\nPay me via LUMIRRA WALLET: https://lumirrawallet.com/send?coin=${coinType}&address=${address}`;\n          }\n          \n          await navigator.clipboard.writeText(messageText);\n          toast({\n            title: \"Copied to clipboard\",\n            description: \"Address and payment link copied to clipboard.\",\n          });\n        } else {\n          // Ultimate fallback: just copy the address using the copyAddress function\n          copyAddress();\n        }\n      } catch (clipboardErr) {\n        // Show error toast\n        toast({\n          title: \"Share failed\",\n          description: \"Unable to share or copy. Please copy the address manually.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  // Loading state\n  if (!currentToken || !currentChain) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent mb-4\"></div>\n          <p className=\"text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"absolute top-4 right-4\">\n        <ThemeToggle />\n      </div>\n\n      <div className=\"container max-w-2xl mx-auto px-4 py-8\">\n        <div className=\"mb-8 flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => window.history.back()}\n            data-testid=\"button-back\"\n            className=\"hover-elevate\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold\">Receive</h1>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-center gap-2\">\n              <div className=\"w-6 h-6 flex-shrink-0\">\n                <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-white/10\">\n                  {currentToken.icon && !tokenIconError ? (\n                    <img \n                      src={currentToken.icon} \n                      alt={currentToken.symbol} \n                      className=\"w-full h-full object-cover\" \n                      onError={() => setTokenIconError(true)}\n                      loading=\"lazy\"\n                    />\n                  ) : (\n                    <span className=\"text-primary font-bold text-xs\">{currentToken.symbol[0]}</span>\n                  )}\n                </div>\n              </div>\n              <CardTitle className=\"text-2xl font-display\">\n                {currentToken?.symbol}{currentChain?.networkStandard ? ` ${currentChain.networkStandard}` : \"\"}\n              </CardTitle>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            {/* QR Code */}\n            <div className=\"flex justify-center\">\n              <div \n                ref={qrContainerRef}\n                className=\"bg-white p-8 rounded-2xl shadow-lg border-4 border-primary/20\"\n              >\n                <QRCodeSVG \n                  value={address} \n                  size={256}\n                  level=\"H\"\n                  data-testid=\"img-qr-code\"\n                  imageSettings={{\n                    src: qrLogoImage,\n                    x: undefined,\n                    y: undefined,\n                    height: 50,\n                    width: 50,\n                    excavate: true,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Address */}\n            <div className=\"space-y-3\">\n              <label className=\"text-sm font-medium\">Your {currentChain?.name} Address</label>\n              <div className=\"flex items-center gap-2 p-4 bg-muted rounded-lg\">\n                <code className=\"flex-1 text-sm font-mono break-all\" data-testid=\"text-address\">\n                  {address}\n                </code>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={copyAddress}\n                  data-testid=\"button-copy-address\"\n                  className=\"hover-elevate flex-shrink-0\"\n                >\n                  {copied ? (\n                    <CheckCircle2 className=\"h-4 w-4 text-success\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4\" />\n                  )}\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                className=\"flex-1 hover-elevate\"\n                onClick={copyAddress}\n                data-testid=\"button-copy\"\n              >\n                <Copy className=\"mr-2 h-4 w-4\" />\n                Copy Address\n              </Button>\n              <Button\n                variant=\"outline\"\n                className=\"flex-1 hover-elevate\"\n                onClick={shareAddress}\n                data-testid=\"button-share\"\n              >\n                <Share2 className=\"mr-2 h-4 w-4\" />\n                Share\n              </Button>\n            </div>\n\n            <div className=\"bg-accent/10 border border-accent/20 rounded-lg p-4\">\n              <p className=\"text-sm text-center text-muted-foreground\">\n                Only send <span className=\"font-semibold text-foreground\">{currentChain?.name}</span> tokens to this address\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":12369},"shared/wallet-addresses.ts":{"content":"export const WALLET_ADDRESSES: Record<string, string> = {\n  ethereum: \"0xADBaa25dDce928FDa7E96c77f6c41C301a2501bb\",\n  bnb: \"0xADBaa25dDce928FDa7E96c77f6c41C301a2501bb\",\n  tron: \"TNjnBL1LpDWu8JPqgqGNmp4GbC9K2U59PL\",\n  solana: \"G1mR4yYifqt1coJFpKNvy32sLnmkQxLxpx7mqf34x86p\",\n};\n\nexport function getWalletAddress(chainId: string): string {\n  return WALLET_ADDRESSES[chainId] || WALLET_ADDRESSES.ethereum;\n}\n","size_bytes":404},"client/src/components/qr-scanner.tsx":{"content":"import { useEffect, useRef } from \"react\";\nimport { Html5Qrcode } from \"html5-qrcode\";\n\ninterface QrScannerProps {\n  onScan: (decodedText: string) => void;\n  onError?: (error: string) => void;\n}\n\nexport function QrScanner({ onScan, onError }: QrScannerProps) {\n  const scannerRef = useRef<Html5Qrcode | null>(null);\n  const qrRegionId = \"qr-reader\";\n\n  useEffect(() => {\n    const scanner = new Html5Qrcode(qrRegionId);\n    scannerRef.current = scanner;\n\n    const config = {\n      fps: 10,\n      qrbox: { width: 250, height: 250 },\n    };\n\n    scanner\n      .start(\n        { facingMode: \"environment\" },\n        config,\n        (decodedText) => {\n          onScan(decodedText);\n          scanner.stop();\n        },\n        (errorMessage) => {\n          // Ignore continuous scanning errors\n        }\n      )\n      .catch((err) => {\n        if (onError) {\n          onError(\"Unable to access camera. Please grant camera permissions.\");\n        }\n        console.error(\"QR Scanner error:\", err);\n      });\n\n    return () => {\n      if (scannerRef.current?.isScanning) {\n        scannerRef.current.stop().catch(console.error);\n      }\n    };\n  }, [onScan, onError]);\n\n  return (\n    <div>\n      <div id={qrRegionId} className=\"rounded-lg overflow-hidden\" />\n      <p className=\"text-xs text-muted-foreground text-center mt-4\">\n        Point your camera at a QR code to scan the address\n      </p>\n    </div>\n  );\n}\n","size_bytes":1414},"client/src/lib/token-info.ts":{"content":"export interface TokenInfo {\n  symbol: string;\n  name: string;\n  description: string;\n  marketCap?: string;\n  circulatingSupply?: string;\n  totalSupply?: string;\n  maxSupply?: string;\n  links: {\n    website?: string;\n    explorer?: string;\n    github?: string;\n    twitter?: string;\n  };\n  contractSecurity?: string;\n  honeypotRisk?: string;\n}\n\nexport const TOKEN_INFO_DATABASE: Record<string, TokenInfo> = {\n  ETH: {\n    symbol: \"ETH\",\n    name: \"Ethereum\",\n    description: \"Ethereum is a decentralized blockchain platform that enables smart contracts and decentralized applications (dApps). It transitioned from Proof-of-Work to Proof-of-Stake via 'The Merge,' reducing energy consumption by 99.95%.\",\n    marketCap: \"$468B - $497B\",\n    circulatingSupply: \"120.7M ETH\",\n    totalSupply: \"120.7M ETH\",\n    maxSupply: \"Unlimited (deflationary with EIP-1559)\",\n    links: {\n      website: \"https://ethereum.org\",\n      explorer: \"https://etherscan.io\",\n      github: \"https://github.com/ethereum\",\n      twitter: \"https://twitter.com/ethereum\"\n    },\n    contractSecurity: \"No significant risks found\",\n    honeypotRisk: \"No significant risks found\"\n  },\n  BNB: {\n    symbol: \"BNB\",\n    name: \"BNB\",\n    description: \"BNB powers the BNB Chain ecosystem, offering low fees and fast transactions. Originally launched as an ERC-20 token, it migrated to BNB Chain (formerly Binance Smart Chain) and uses a Proof-of-Staked Authority consensus mechanism.\",\n    marketCap: \"$153B - $156B\",\n    circulatingSupply: \"137.7M BNB\",\n    totalSupply: \"137.7M BNB\",\n    maxSupply: \"100M BNB (target via Auto-Burn)\",\n    links: {\n      website: \"https://www.bnbchain.org\",\n      explorer: \"https://bscscan.com\",\n      github: \"https://github.com/bnb-chain\",\n      twitter: \"https://twitter.com/bnbchain\"\n    },\n    contractSecurity: \"No significant risks found\",\n    honeypotRisk: \"No significant risks found\"\n  },\n  TRX: {\n    symbol: \"TRX\",\n    name: \"Tron\",\n    description: \"TRON is a decentralized blockchain platform focused on empowering content creators by eliminating intermediaries. It supports smart contracts, processes 2,000 transactions per second, and serves as a major hub for USDT stablecoin transfers.\",\n    marketCap: \"$28B - $30B\",\n    circulatingSupply: \"95B TRX\",\n    totalSupply: \"95B TRX\",\n    maxSupply: \"Unlimited\",\n    links: {\n      website: \"https://tron.network\",\n      explorer: \"https://tronscan.org\",\n      github: \"https://github.com/tronprotocol\",\n      twitter: \"https://twitter.com/trondao\"\n    },\n    contractSecurity: \"No significant risks found\",\n    honeypotRisk: \"No significant risks found\"\n  },\n  SOL: {\n    symbol: \"SOL\",\n    name: \"Solana\",\n    description: \"Solana is a high-performance Layer 1 blockchain designed for speed, scalability, and low costs. It uses a unique Proof of History (PoH) and Proof of Stake (PoS) consensus mechanism, supporting thousands of transactions per second with fees under $0.01.\",\n    marketCap: \"$103B - $108B\",\n    circulatingSupply: \"549.7M SOL\",\n    totalSupply: \"612.8M SOL\",\n    maxSupply: \"Unlimited (inflationary model)\",\n    links: {\n      website: \"https://solana.com\",\n      explorer: \"https://explorer.solana.com\",\n      github: \"https://github.com/solana-labs\",\n      twitter: \"https://twitter.com/solana\"\n    },\n    contractSecurity: \"No significant risks found\",\n    honeypotRisk: \"No significant risks found\"\n  },\n  USDT: {\n    symbol: \"USDT\",\n    name: \"Tether\",\n    description: \"Tether (USDT) is the largest stablecoin by market cap, pegged 1:1 to the US Dollar. It provides stability for crypto trading and is widely used across multiple blockchains for payments, DeFi, and as a store of value.\",\n    marketCap: \"$120B+\",\n    circulatingSupply: \"120B+ USDT\",\n    totalSupply: \"120B+ USDT\",\n    maxSupply: \"Unlimited (minted on demand)\",\n    links: {\n      website: \"https://tether.to\",\n      explorer: \"https://etherscan.io/token/0xdac17f958d2ee523a2206206994597c13d831ec7\",\n      github: \"https://github.com/tether\",\n      twitter: \"https://twitter.com/tether_to\"\n    },\n    contractSecurity: \"No significant risks found\",\n    honeypotRisk: \"No significant risks found\"\n  },\n  USDC: {\n    symbol: \"USDC\",\n    name: \"USD Coin\",\n    description: \"USD Coin is a fully regulated stablecoin pegged 1:1 to the US Dollar, backed by cash and short-term US Treasury bonds. It's issued by Circle and operates across multiple blockchains with monthly attestations by Grant Thornton LLP.\",\n    marketCap: \"$35B+\",\n    circulatingSupply: \"35B+ USDC\",\n    totalSupply: \"35B+ USDC\",\n    maxSupply: \"Unlimited (minted on demand)\",\n    links: {\n      website: \"https://www.circle.com/en/usdc\",\n      explorer: \"https://etherscan.io/token/0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48\",\n      github: \"https://github.com/circlefin\",\n      twitter: \"https://twitter.com/circle\"\n    },\n    contractSecurity: \"No significant risks found\",\n    honeypotRisk: \"No significant risks found\"\n  }\n};\n\nexport function getTokenInfo(symbol: string): TokenInfo | undefined {\n  return TOKEN_INFO_DATABASE[symbol.toUpperCase()];\n}\n","size_bytes":5079},"client/src/pages/address-book.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { ArrowLeft, Search, Plus, Trash2 } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Contact {\n  id: string;\n  name: string;\n  address: string;\n  network: string;\n}\n\nexport default function AddressBook() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  \n  // Mock contacts - in real app, this would come from API/storage\n  const [contacts, setContacts] = useState<Contact[]>([\n    {\n      id: \"1\",\n      name: \"John's Wallet\",\n      address: \"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb\",\n      network: \"ETH\",\n    },\n    {\n      id: \"2\",\n      name: \"Sarah's BNB\",\n      address: \"0x123456789abcdef123456789abcdef1234567890\",\n      network: \"BNB\",\n    },\n    {\n      id: \"3\",\n      name: \"Mike's TRON\",\n      address: \"THa5iGZk9mBq5742scd9NsvqAPiJcgt4QL\",\n      network: \"TRX\",\n    },\n  ]);\n\n  const filteredContacts = contacts.filter(\n    (contact) =>\n      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      contact.address.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const handleDeleteContact = (id: string) => {\n    setContacts(contacts.filter((c) => c.id !== id));\n    toast({\n      title: \"Contact deleted\",\n      description: \"The contact has been removed from your address book.\",\n    });\n  };\n\n  const handleSelectContact = (contact: Contact) => {\n    // Store selected address in localStorage for send page to pick up\n    localStorage.setItem('selectedContactAddress', contact.address);\n    toast({\n      title: \"Contact selected\",\n      description: `Address: ${contact.address}`,\n    });\n    // Navigate back to send page\n    window.history.back();\n  };\n\n  const handleAddContact = () => {\n    toast({\n      title: \"Coming soon\",\n      description: \"Add contact functionality will be available in the next update.\",\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => window.history.back()}\n                data-testid=\"button-back\"\n                className=\"hover-elevate\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <h1 className=\"text-lg font-display font-semibold\">Address Book</h1>\n            </div>\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl\">\n        {/* Search */}\n        <div className=\"relative mb-4\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search contacts\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-contacts\"\n          />\n        </div>\n\n        {/* Add Contact Button */}\n        <Button\n          className=\"w-full mb-4 gap-2\"\n          onClick={handleAddContact}\n          data-testid=\"button-add-contact\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          Add New Contact\n        </Button>\n\n        {/* Contacts List */}\n        <div className=\"space-y-2\">\n          {filteredContacts.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground\">No contacts found</p>\n            </div>\n          ) : (\n            filteredContacts.map((contact) => (\n              <div\n                key={contact.id}\n                className=\"flex items-center justify-between p-3 rounded-lg bg-card border hover-elevate\"\n                data-testid={`contact-item-${contact.id}`}\n              >\n                <div\n                  className=\"flex-1 cursor-pointer\"\n                  onClick={() => handleSelectContact(contact)}\n                >\n                  <div className=\"flex items-center justify-between mb-1\">\n                    <span className=\"font-semibold\">{contact.name}</span>\n                    <span className=\"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary font-medium\">\n                      {contact.network}\n                    </span>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground font-mono truncate\">\n                    {contact.address}\n                  </p>\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"ml-2 hover-elevate\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleDeleteContact(contact.id);\n                  }}\n                  data-testid={`button-delete-${contact.id}`}\n                >\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\n                </Button>\n              </div>\n            ))\n          )}\n        </div>\n\n        {/* Empty State */}\n        {contacts.length === 0 && (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground mb-4\">\n              Your address book is empty\n            </p>\n            <p className=\"text-sm text-muted-foreground\">\n              Add contacts to quickly send crypto to your favorite addresses\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":5891},"client/src/pages/news-detail.tsx":{"content":"import { useEffect } from \"react\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { ArrowLeft, ExternalLink, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useTranslation } from \"react-i18next\";\nimport DOMPurify from \"isomorphic-dompurify\";\n\ninterface NewsArticle {\n  id: string;\n  title: string;\n  url: string;\n  published_at: string;\n  source: {\n    title: string;\n    domain: string;\n  };\n  currencies?: Array<{\n    code: string;\n    title: string;\n  }>;\n  contentSnippet?: string;\n  content?: string;\n}\n\nexport default function NewsDetail() {\n  const { t, i18n } = useTranslation();\n  const [, params] = useRoute(\"/news/:id\");\n  const [, setLocation] = useLocation();\n  const { isAuthenticated } = useWallet();\n  const newsId = params?.id;\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthenticated, setLocation]);\n\n  // Fetch specific article by ID from dedicated endpoint\n  const { data: article, isLoading, error } = useQuery<NewsArticle>({\n    queryKey: [`/api/news/${newsId}`],\n    enabled: !!newsId && isAuthenticated,\n  });\n\n  // Fetch crypto prices for token badges\n  const { data: prices } = useQuery<any>({\n    queryKey: [\"/api/prices\"],\n    enabled: !!newsId && isAuthenticated,\n  });\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n          <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => window.history.back()}\n                  data-testid=\"button-back\"\n                  className=\"hover-elevate\"\n                >\n                  <ArrowLeft className=\"h-5 w-5\" />\n                </Button>\n                <h1 className=\"text-lg font-display font-semibold\">{t('newsDetail.title')}</h1>\n              </div>\n              <ThemeToggle />\n            </div>\n          </div>\n        </header>\n        <div className=\"container mx-auto px-3 sm:px-4 py-12 max-w-2xl flex flex-col items-center justify-center text-center\">\n          <AlertCircle className=\"h-12 w-12 text-destructive mb-4\" />\n          <h2 className=\"text-xl font-semibold mb-2\">{t('newsDetail.failedToLoad')}</h2>\n          <p className=\"text-muted-foreground mb-6\">\n            {t('newsDetail.unableToFetch')}\n          </p>\n          <Button onClick={() => window.history.back()} data-testid=\"button-back-error\">\n            {t('newsDetail.goBack')}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!article) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n          <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => window.history.back()}\n                  data-testid=\"button-back\"\n                  className=\"hover-elevate\"\n                >\n                  <ArrowLeft className=\"h-5 w-5\" />\n                </Button>\n                <h1 className=\"text-lg font-display font-semibold\">{t('newsDetail.title')}</h1>\n              </div>\n              <ThemeToggle />\n            </div>\n          </div>\n        </header>\n        <div className=\"container mx-auto px-3 sm:px-4 py-12 max-w-2xl text-center\">\n          <p className=\"text-muted-foreground\">{t('newsDetail.notFound')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Sanitize HTML content using DOMPurify to prevent XSS attacks\n  const sanitizeHTML = (html: string) => {\n    return DOMPurify.sanitize(html, {\n      ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'u', 'a', 'ul', 'ol', 'li', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'img'],\n      ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class'],\n      ALLOW_DATA_ATTR: false,\n    });\n  };\n\n  const getTokenPriceChange = (currencyCode: string) => {\n    if (!prices) return null;\n    \n    // Map currency codes to CoinGecko IDs\n    const symbolToCoinGeckoId: Record<string, string> = {\n      'BTC': 'bitcoin',\n      'ETH': 'ethereum',\n      'SOL': 'solana',\n      'TRX': 'tron',\n      'BNB': 'binancecoin',\n      'USDT': 'tether',\n      'USDC': 'usd-coin',\n      'ADA': 'cardano',\n      'XRP': 'ripple',\n      'MATIC': 'matic-network',\n      'LINK': 'chainlink',\n      'DOT': 'polkadot',\n      'AVAX': 'avalanche-2',\n    };\n    \n    const coingeckoId = symbolToCoinGeckoId[currencyCode] || currencyCode.toLowerCase();\n    const priceInfo = prices[coingeckoId];\n    if (!priceInfo) return null;\n    \n    return {\n      change: priceInfo.usd_24h_change || 0,\n      symbol: currencyCode,\n    };\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleString(i18n.language, {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => window.history.back()}\n                data-testid=\"button-back\"\n                className=\"hover-elevate\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <h1 className=\"text-lg font-display font-semibold\">{t('newsDetail.title')}</h1>\n            </div>\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      {/* Article Content */}\n      <div className=\"container mx-auto px-3 sm:px-4 py-6 max-w-2xl\">\n        {/* Title */}\n        <h1 className=\"text-2xl sm:text-3xl font-bold mb-4\">\n          {article.title}\n        </h1>\n\n        {/* Source and Date */}\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <span>{article.source.title}</span>\n          </div>\n          <span className=\"text-xs text-muted-foreground\">\n            {formatDate(article.published_at)}\n          </span>\n        </div>\n\n        {/* Token Badges */}\n        {article.currencies && article.currencies.length > 0 && (\n          <div className=\"flex items-center gap-2 flex-wrap mb-6\">\n            {article.currencies.map((currency: { code: string; title: string }) => {\n              const priceChange = getTokenPriceChange(currency.code);\n              if (!priceChange) return null;\n              \n              const isPositive = priceChange.change >= 0;\n              \n              return (\n                <Badge\n                  key={currency.code}\n                  variant=\"secondary\"\n                  className={`text-xs ${\n                    isPositive\n                      ? \"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500/20\"\n                      : \"bg-red-500/10 text-red-500 hover:bg-red-500/20\"\n                  }`}\n                  data-testid={`badge-token-${currency.code}`}\n                >\n                  {currency.code} {isPositive ? \"+\" : \"\"}\n                  {priceChange.change.toFixed(2)}%\n                </Badge>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Article Content */}\n        {article.content || article.contentSnippet ? (\n          <div className=\"prose dark:prose-invert max-w-none mb-6\">\n            <div \n              className=\"text-base leading-relaxed text-foreground\"\n              dangerouslySetInnerHTML={{ \n                __html: sanitizeHTML(article.content || article.contentSnippet || '')\n              }}\n              data-testid=\"article-content\"\n            />\n          </div>\n        ) : (\n          <div className=\"bg-muted/50 border border-border rounded-lg p-6 mb-6\">\n            <p className=\"text-base text-muted-foreground text-center\">\n              {t('newsDetail.previewNotAvailable')}\n            </p>\n          </div>\n        )}\n\n        {/* Read Full Article Button */}\n        <Button\n          variant=\"default\"\n          className=\"w-full sm:w-auto gap-2\"\n          onClick={() => window.open(article.url, '_blank', 'noopener,noreferrer')}\n          data-testid=\"button-read-article\"\n        >\n          <ExternalLink className=\"h-4 w-4\" />\n          {t('newsDetail.readFullArticle', { source: article.source.title })}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9578},"client/src/pages/send-list.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { ArrowLeft, Search } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { formatBalance } from \"@/lib/format-balance\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function SendList() {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { walletId, isAuthenticated } = useWallet();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  // Redirect if not authenticated\n  if (!isAuthenticated || !walletId) {\n    setLocation(\"/\");\n    return null;\n  }\n\n  // Use all-tokens endpoint to include hidden tokens in send list\n  const { data: allTokensData } = useQuery({\n    queryKey: [`/api/wallet/${walletId}/all-tokens`],\n    enabled: !!walletId,\n  });\n\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Fetch real-time prices\n  const { data: pricesData } = useQuery({\n    queryKey: [\"/api/prices\"],\n    enabled: !!walletId,\n    refetchInterval: 60000,\n  });\n\n  const chains = (chainsData as any) || [];\n  const allTokens = (allTokensData as any)?.tokens || [];\n\n  // Merge tokens with real-time prices and sort by market cap\n  const tokensWithPrices = allTokens.map((token: any) => {\n    const coingeckoId = token.coingeckoId || token.symbol.toLowerCase();\n    const priceInfo = (pricesData as any)?.[coingeckoId];\n    \n    return {\n      ...token,\n      usd_price: priceInfo?.usd || 0,\n      usd_24h_change: priceInfo?.usd_24h_change || 0,\n      usd_market_cap: priceInfo?.usd_market_cap || 0,\n    };\n  }).sort((a: any, b: any) => {\n    return (b.usd_market_cap || 0) - (a.usd_market_cap || 0);\n  });\n\n  // Filter tokens based on search query\n  const filteredTokens = tokensWithPrices.filter((token: any) =>\n    token.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    token.symbol.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => window.history.back()}\n                data-testid=\"button-back\"\n                className=\"hover-elevate\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <h1 className=\"text-lg font-display font-semibold\">{t('sendList.title')}</h1>\n            </div>\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl\">\n        {/* Search */}\n        <div className=\"mb-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder={t('sendList.search')}\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9 bg-muted/50 border-muted\"\n              data-testid=\"input-search-token\"\n            />\n          </div>\n        </div>\n\n        {/* Token List */}\n        <div className=\"space-y-2\">\n          {filteredTokens.map((token: any) => {\n            const chain = chains.find((c: any) => c.id === token.chainId);\n            const balance = parseFloat(token.balance || \"0\");\n            const fiatValue = balance * token.usd_price;\n            const priceChange = token.usd_24h_change || 0;\n            const isPositive = priceChange >= 0;\n\n            return (\n              <div\n                key={token._id || token.id}\n                className=\"flex items-center justify-between p-3 rounded-lg hover-elevate active-elevate-2 cursor-pointer bg-card\"\n                onClick={() => setLocation(`/send/${token._id || token.id}`)}\n                data-testid={`token-item-${token.symbol.toLowerCase()}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  {/* Token Icon */}\n                  <div className=\"relative w-10 h-10 flex-shrink-0\">\n                    <div className=\"w-full h-full rounded-full flex items-center justify-center overflow-hidden bg-muted\">\n                      {token.icon ? (\n                        <img\n                          src={token.icon}\n                          alt={token.symbol}\n                          className=\"w-full h-full object-cover\"\n                          onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }}\n                        />\n                      ) : (\n                        <span className=\"text-primary font-bold text-sm\">{token.symbol[0]}</span>\n                      )}\n                    </div>\n                    {chain?.icon && token.symbol?.toUpperCase() !== chain.symbol?.toUpperCase() && (\n                      <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n                        <img\n                          src={chain.icon}\n                          alt={chain.name}\n                          className=\"w-full h-full object-cover\"\n                        />\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Token Info */}\n                  <div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-semibold\">{token.symbol}</span>\n                      {chain && (\n                        <span className=\"text-xs text-muted-foreground\">\n                          ({chain.networkStandard || chain.name})\n                        </span>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <span className=\"text-muted-foreground\">\n                        ${token.usd_price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 })}\n                      </span>\n                      <span className={isPositive ? 'text-success' : 'text-destructive'}>\n                        {isPositive ? '+' : ''}{priceChange.toFixed(2)}%\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Balance */}\n                <div className=\"text-right\">\n                  <div className=\"font-semibold\" data-testid={`balance-${token.symbol.toLowerCase()}`}>\n                    {formatBalance(balance)}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    ${fiatValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        {filteredTokens.length === 0 && (\n          <div className=\"text-center py-12 text-muted-foreground\">\n            <p>{t('sendList.noTokens')}</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":7514},"client/src/pages/market.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Search, AlertCircle } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { BottomNav } from \"@/components/bottom-nav\";\nimport { useLocation } from \"wouter\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface NewsArticle {\n  id: string;\n  title: string;\n  url: string;\n  published_at: string;\n  source: {\n    title: string;\n    domain: string;\n  };\n  currencies?: Array<{\n    code: string;\n    title: string;\n  }>;\n  contentSnippet?: string;\n  content?: string;\n}\n\nexport default function Market() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated, walletId } = useWallet();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { t } = useTranslation('common');\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthenticated, setLocation]);\n\n  // Fetch wallet tokens to filter news\n  const { data: portfolio } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"portfolio\"],\n    enabled: !!walletId,\n  });\n\n  // Fetch crypto prices for token badges\n  const { data: prices } = useQuery<any>({\n    queryKey: [\"/api/prices\"],\n  });\n\n  // Fetch user data for profile picture\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/user\"],\n    enabled: isAuthenticated && !!walletId,\n  });\n\n  // Fetch news from backend\n  const { data: newsData, isLoading, error, refetch } = useQuery({\n    queryKey: [\"/api/news\"],\n    refetchInterval: 5 * 60 * 1000, // Refresh every 5 minutes\n  });\n\n  if (!isAuthenticated || !walletId) {\n    return null;\n  }\n\n  const news = (newsData as any)?.results || [];\n\n  // Filter news based on search query\n  const filteredNews = news.filter((article: NewsArticle) =>\n    article.title.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const formatTimeAgo = (dateString: string) => {\n    const date = new Date(dateString);\n    const now = new Date();\n    const diffInMs = now.getTime() - date.getTime();\n    const diffInMins = Math.floor(diffInMs / 60000);\n    const diffInHours = Math.floor(diffInMs / 3600000);\n    const diffInDays = Math.floor(diffInMs / 86400000);\n\n    if (diffInMins < 60) {\n      return t('market.minsAgo', { mins: diffInMins });\n    } else if (diffInHours < 24) {\n      return t('market.hoursAgo', { hours: diffInHours });\n    } else {\n      return t('market.daysAgo', { days: diffInDays });\n    }\n  };\n\n  const getTokenPriceChange = (currencyCode: string) => {\n    if (!prices) return null;\n    \n    // Map currency codes to CoinGecko IDs\n    const symbolToCoinGeckoId: Record<string, string> = {\n      'BTC': 'bitcoin',\n      'ETH': 'ethereum',\n      'SOL': 'solana',\n      'TRX': 'tron',\n      'BNB': 'binancecoin',\n      'USDT': 'tether',\n      'USDC': 'usd-coin',\n      'ADA': 'cardano',\n      'XRP': 'ripple',\n      'MATIC': 'matic-network',\n      'LINK': 'chainlink',\n      'DOT': 'polkadot',\n      'AVAX': 'avalanche-2',\n    };\n    \n    const coingeckoId = symbolToCoinGeckoId[currencyCode] || currencyCode.toLowerCase();\n    const priceInfo = prices[coingeckoId];\n    if (!priceInfo) return null;\n    \n    return {\n      change: priceInfo.usd_24h_change || 0,\n      symbol: currencyCode,\n    };\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-40\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h1 className=\"text-xl font-display font-bold\">{t('market.title')}</h1>\n            <ThemeToggle />\n          </div>\n          \n          {/* Search */}\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder={t('market.searchPlaceholder')}\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9 bg-muted/50 border-muted\"\n              data-testid=\"input-search-news\"\n            />\n          </div>\n        </div>\n      </header>\n\n      {/* News Feed */}\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl space-y-3\">\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-primary border-r-transparent\"></div>\n          </div>\n        ) : error ? (\n          <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n            <AlertCircle className=\"h-12 w-12 text-destructive mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">{t('market.failedToLoad')}</h3>\n            <p className=\"text-muted-foreground mb-6 max-w-md\">\n              {t('market.unableToFetch')}\n            </p>\n            <Button onClick={() => refetch()} data-testid=\"button-retry-news\">\n              {t('market.retry')}\n            </Button>\n          </div>\n        ) : filteredNews.length > 0 ? (\n          filteredNews.map((article: NewsArticle) => (\n            <Card\n              key={article.id}\n              className=\"p-4 cursor-pointer hover-elevate transition-all\"\n              onClick={() => setLocation(`/news/${article.id}`)}\n              data-testid={`card-news-${article.id}`}\n            >\n              {/* Source and Time */}\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-xs font-medium text-muted-foreground\">\n                  {article.source.title}\n                </span>\n                <span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                  {formatTimeAgo(article.published_at)}\n                </span>\n              </div>\n              \n              {/* Title */}\n              <h3 className=\"font-semibold text-base mb-2 line-clamp-2\">\n                {article.title}\n              </h3>\n              \n              {/* Content Snippet */}\n              {article.contentSnippet && (\n                <p className=\"text-sm text-muted-foreground line-clamp-2 mb-3\">\n                  {article.contentSnippet}\n                </p>\n              )}\n              \n              {/* Token Badges */}\n              {article.currencies && article.currencies.length > 0 && (\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  {article.currencies.slice(0, 3).map((currency) => {\n                    const priceChange = getTokenPriceChange(currency.code);\n                    if (!priceChange) return null;\n                    \n                    const isPositive = priceChange.change >= 0;\n                    \n                    // Get token logo URL from CoinGecko with proper filenames\n                    const symbolToLogoUrl: Record<string, string> = {\n                      'BTC': 'https://assets.coingecko.com/coins/images/1/small/bitcoin.png',\n                      'ETH': 'https://assets.coingecko.com/coins/images/279/small/ethereum.png',\n                      'SOL': 'https://assets.coingecko.com/coins/images/4128/small/solana.png',\n                      'TRX': 'https://assets.coingecko.com/coins/images/1094/small/tron-logo.png',\n                      'BNB': 'https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png',\n                      'USDT': 'https://assets.coingecko.com/coins/images/325/small/Tether.png',\n                      'USDC': 'https://assets.coingecko.com/coins/images/6319/small/usdc.png',\n                      'ADA': 'https://assets.coingecko.com/coins/images/975/small/cardano.png',\n                      'XRP': 'https://assets.coingecko.com/coins/images/44/small/xrp-symbol-white-128.png',\n                      'MATIC': 'https://assets.coingecko.com/coins/images/4713/small/polygon.png',\n                      'LINK': 'https://assets.coingecko.com/coins/images/877/small/chainlink-new-logo.png',\n                      'DOT': 'https://assets.coingecko.com/coins/images/12171/small/polkadot.png',\n                      'AVAX': 'https://assets.coingecko.com/coins/images/12559/small/Avalanche_Circle_RedWhite_Trans.png',\n                    };\n                    const logoUrl = symbolToLogoUrl[currency.code] || 'https://assets.coingecko.com/coins/images/1/small/bitcoin.png';\n                    \n                    return (\n                      <Badge\n                        key={currency.code}\n                        variant=\"secondary\"\n                        className={`text-xs gap-1 ${\n                          isPositive\n                            ? \"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500/20\"\n                            : \"bg-red-500/10 text-red-500 hover:bg-red-500/20\"\n                        }`}\n                        data-testid={`badge-token-${currency.code}`}\n                      >\n                        <img \n                          src={logoUrl} \n                          alt={currency.code}\n                          className=\"w-4 h-4 rounded-full\"\n                          onError={(e) => {\n                            e.currentTarget.style.display = 'none';\n                          }}\n                        />\n                        {currency.code} {isPositive ? \"+\" : \"\"}\n                        {priceChange.change.toFixed(2)}%\n                      </Badge>\n                    );\n                  })}\n                </div>\n              )}\n            </Card>\n          ))\n        ) : (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">\n              {searchQuery ? t('market.noNewsFound') : t('market.noNewsAvailable')}\n            </p>\n          </div>\n        )}\n      </div>\n\n      <BottomNav />\n    </div>\n  );\n}\n","size_bytes":10228},"client/src/components/bottom-nav.tsx":{"content":"import { Wallet, ChartCandlestick, Repeat } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\n\nexport function BottomNav() {\n  const [location, setLocation] = useLocation();\n  const { t } = useTranslation('common');\n\n  const navItems = [\n    {\n      nameKey: \"bottomNav.wallet\",\n      icon: Wallet,\n      path: \"/dashboard\",\n      testId: \"nav-wallet\",\n    },\n    {\n      nameKey: \"bottomNav.market\",\n      icon: ChartCandlestick,\n      path: \"/market\",\n      testId: \"nav-market\",\n    },\n    {\n      nameKey: \"bottomNav.swap\",\n      icon: Repeat,\n      path: \"/swap\",\n      testId: \"nav-swap\",\n    },\n  ];\n\n  const isActive = (path: string) => {\n    if (path === \"/dashboard\") {\n      return location === \"/\" || location === \"/dashboard\";\n    }\n    return location.startsWith(path);\n  };\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 z-50 bg-card border-t border-border\">\n      <div className=\"flex items-center justify-around h-16 max-w-2xl mx-auto\">\n        {navItems.map((item) => {\n          const active = isActive(item.path);\n          const Icon = item.icon;\n          \n          return (\n            <button\n              key={item.nameKey}\n              onClick={() => setLocation(item.path)}\n              className=\"flex flex-col items-center justify-center flex-1 h-full gap-1 transition-colors\"\n              data-testid={item.testId}\n            >\n              <Icon\n                className={`h-5 w-5 transition-colors ${\n                  active ? \"text-primary\" : \"text-muted-foreground\"\n                }`}\n                strokeWidth={active ? 3 : 2.5}\n              />\n              <span\n                className={`text-xs font-medium transition-colors ${\n                  active ? \"text-primary\" : \"text-muted-foreground\"\n                }`}\n              >\n                {t(item.nameKey)}\n              </span>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","size_bytes":1992},"client/src/pages/transaction-detail.tsx":{"content":"import { useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useTransactionUSD } from \"@/hooks/use-transaction-usd\";\nimport { formatUSD, formatCrypto } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function TransactionDetail() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const [, params] = useRoute(\"/transaction/:hash\");\n  const { walletId, isAuthenticated } = useWallet();\n  const hash = params?.hash;\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthenticated, setLocation]);\n\n  const { data: transactions = [] } = useQuery({\n    queryKey: [\"/api/wallet\", walletId, \"transactions\"],\n    enabled: !!walletId,\n  });\n\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const chains = (chainsData as any) || [];\n  const transaction = (transactions as any[]).find(tx => tx.hash === hash);\n  const usdValue = useTransactionUSD(transaction);\n\n  if (!isAuthenticated || !walletId || !hash) {\n    return null;\n  }\n\n  if (!transaction) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <p className=\"text-muted-foreground\">{t('transaction.notFound')}</p>\n      </div>\n    );\n  }\n\n  const isReceive = transaction.type === \"receive\";\n  const isSend = transaction.type === \"send\";\n  const isContract = transaction.type === \"contract\";\n  const isConfirmed = transaction.status === \"confirmed\";\n  const isPending = transaction.status === \"pending\";\n  const isFailed = transaction.status === \"failed\";\n  const chain = chains.find((c: any) => c.id === transaction.chainId);\n  const chainName = chain?.name || transaction.chainId?.toUpperCase() || t('transaction.unknown');\n  \n  // Map chainId to native token symbol\n  const nativeTokenMap: Record<string, string> = {\n    'ethereum': 'ETH',\n    'bnb': 'BNB',\n    'tron': 'TRX',\n    'solana': 'SOL',\n  };\n  const nativeToken = nativeTokenMap[transaction.chainId] || 'ETH';\n\n  const formatDate = (timestamp: string) => {\n    const date = new Date(timestamp);\n    return date.toLocaleDateString(i18n.language, {\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: '2-digit'\n    });\n  };\n\n  const truncateAddress = (address: string) => {\n    if (!address) return \"\";\n    return `${address.substring(0, 10)}...${address.substring(address.length - 7)}`;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-4\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => window.history.back()}\n              data-testid=\"button-back\"\n              className=\"hover-elevate\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold\">\n              {isContract ? t('transaction.smartContractCall') : t('transaction.transfer')}\n            </h1>\n            <ThemeToggle />\n          </div>\n        </div>\n      </header>\n\n      {/* Amount Section */}\n      <div className=\"container mx-auto px-3 sm:px-4 py-8 max-w-2xl text-center\">\n        <h2 className=\"text-4xl font-bold mb-2\" data-testid=\"text-amount\">\n          {isReceive ? \"+\" : \"-\"}{formatCrypto(transaction.value)} {transaction.tokenSymbol}\n        </h2>\n        <p className=\"text-muted-foreground\" data-testid=\"text-fiat-value\">\n           {formatUSD(usdValue.toString())}\n        </p>\n      </div>\n\n      {/* Details Section */}\n      <div className=\"container mx-auto px-3 sm:px-4 max-w-2xl space-y-6\">\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"divide-y\">\n              <div className=\"flex items-center justify-between p-4\">\n                <span className=\"text-muted-foreground\">{t('transaction.date')}</span>\n                <span className=\"font-medium\" data-testid=\"text-date\">\n                  {formatDate(transaction.timestamp)}\n                </span>\n              </div>\n\n              <div className=\"flex items-center justify-between p-4\">\n                <span className=\"text-muted-foreground\">{t('transaction.status')}</span>\n                <span className={`font-medium ${isConfirmed ? \"text-success\" : isPending ? \"text-warning\" : \"text-destructive\"}`} data-testid=\"text-status\">\n                  {isConfirmed ? t('transaction.completed') : isPending ? t('transaction.pending') : t('transaction.failed')}\n                </span>\n              </div>\n\n              {(isSend || isReceive) && (\n                <div className=\"flex items-center justify-between p-4\">\n                  <span className=\"text-muted-foreground\">{isReceive ? t('transaction.sender') : t('transaction.recipient')}</span>\n                  <span className=\"font-medium text-sm\" data-testid=\"text-address\">\n                    {truncateAddress(isReceive ? transaction.from : transaction.to || transaction.from)}\n                  </span>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"divide-y\">\n              <div className=\"flex items-center justify-between p-4\">\n                <span className=\"text-muted-foreground\">{t('transaction.networkFee')}</span>\n                <span className=\"font-medium\" data-testid=\"text-network-fee\">\n                  {transaction.networkFee || \"0.00000423\"} {nativeToken}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6155},"client/src/pages/landing.tsx":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { motion, useScroll, useTransform, useInView, AnimatePresence } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  ArrowRight, \n  Shield, \n  RefreshCw, \n  Layers, \n  Lock, \n  Eye, \n  Zap, \n  Globe,\n  Award,\n  Sparkles\n} from \"lucide-react\";\nimport { MobileMenu } from \"@/components/mobile-menu\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { useTheme } from \"@/components/theme-provider\";\nimport logoImage from \"@assets/Lumirra Logo Design (original)_1761875532047.png\";\nimport mockupLightImage from \"@assets/LIGHT THEME_1763989217041.png\";\nimport mockupDarkImage from \"@assets/DARK THEME (1)_1763989217041.png\";\n\nfunction getDailyNewUsers() {\n  const today = new Date();\n  const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();\n  const random = Math.sin(seed) * 10000;\n  const value = Math.floor((random - Math.floor(random)) * 870) + 130;\n  return value;\n}\n\nfunction AnimatedCounter({ end, duration = 2 }: { end: number; duration?: number }) {\n  const [count, setCount] = useState(0);\n  const ref = useRef(null);\n  const isInView = useInView(ref, { once: true });\n\n  useEffect(() => {\n    if (isInView) {\n      let start = 0;\n      const increment = end / (duration * 60);\n      const timer = setInterval(() => {\n        start += increment;\n        if (start >= end) {\n          setCount(end);\n          clearInterval(timer);\n        } else {\n          setCount(Math.floor(start));\n        }\n      }, 1000 / 60);\n      return () => clearInterval(timer);\n    }\n  }, [isInView, end, duration]);\n\n  return <span ref={ref}>{count}</span>;\n}\n\nfunction FeatureCard({ \n  icon: Icon, \n  title, \n  description, \n  delay = 0 \n}: { \n  icon: any; \n  title: string; \n  description: string; \n  delay?: number;\n}) {\n  const ref = useRef(null);\n  const isInView = useInView(ref, { once: true, margin: \"-100px\" });\n\n  return (\n    <motion.div\n      ref={ref}\n      initial={{ opacity: 0, y: 50 }}\n      animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 50 }}\n      transition={{ duration: 0.6, delay, ease: \"easeOut\" }}\n      className=\"group relative\"\n    >\n      <div className=\"relative p-8 rounded-2xl bg-card/50 backdrop-blur-xl border border-border/50 hover-elevate transition-all duration-300\">\n        <div className=\"absolute inset-0 rounded-2xl bg-gradient-to-br from-[#1677FF]/5 to-[#2ED8FF]/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n        <div className=\"relative\">\n          <div className=\"h-14 w-14 rounded-xl bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-6 transform group-hover:scale-110 transition-transform duration-300\">\n            <Icon className=\"h-7 w-7 text-white\" />\n          </div>\n          <h3 className=\"text-xl font-semibold mb-3\">{title}</h3>\n          <p className=\"text-muted-foreground leading-relaxed\">{description}</p>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\nexport default function Landing() {\n  const [, setLocation] = useLocation();\n  const [scrolled, setScrolled] = useState(false);\n  const { scrollYProgress } = useScroll();\n  const heroRef = useRef(null);\n  const { theme } = useTheme();\n  \n  const y = useTransform(scrollYProgress, [0, 0.3], [0, -50]);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      const currentScroll = window.scrollY;\n      setScrolled(prev => {\n        if (!prev && currentScroll > 50) return true;\n        if (prev && currentScroll < 20) return false;\n        return prev;\n      });\n    };\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => window.removeEventListener(\"scroll\", handleScroll);\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background overflow-x-hidden\">\n      <motion.div\n        className=\"fixed top-0 left-0 right-0 h-1 bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] origin-left z-50\"\n        style={{ scaleX: scrollYProgress }}\n      />\n\n      <header \n        className={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${\n          scrolled ? 'bg-background/95 backdrop-blur-xl border-b border-border/50 shadow-sm' : 'bg-transparent backdrop-blur-sm'\n        }`}\n      >\n        <div className=\"container mx-auto px-4 lg:px-8 h-20 flex items-center justify-between\">\n          <motion.div \n            className=\"flex items-center gap-3\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ duration: 0.5 }}\n            data-testid=\"logo-header\"\n          >\n            <img src={logoImage} alt=\"Lumirra\" className=\"h-10 w-10\" />\n            <span className=\"text-2xl font-bold bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] bg-clip-text text-transparent\">\n              Lumirra\n            </span>\n          </motion.div>\n          \n          <motion.div \n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ duration: 0.5 }}\n            className=\"flex items-center gap-2\"\n          >\n            <ThemeToggle />\n            <MobileMenu />\n          </motion.div>\n        </div>\n      </header>\n\n      <section ref={heroRef} className=\"relative min-h-screen flex items-center justify-center pt-20 pb-20 px-4 overflow-hidden\">\n        <div className=\"absolute inset-0\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-[#1677FF]/5 via-background to-[#2ED8FF]/5\" />\n          <div className=\"absolute top-20 right-0 w-[800px] h-[800px] bg-[#1677FF]/5 rounded-full blur-3xl opacity-50\" />\n          <div className=\"absolute bottom-0 left-0 w-[600px] h-[600px] bg-[#2ED8FF]/5 rounded-full blur-3xl opacity-50\" />\n        </div>\n\n        <div className=\"container mx-auto max-w-7xl relative z-10\">\n          <div className=\"flex flex-col items-center space-y-12\">\n            <motion.div\n              initial={{ opacity: 0, y: 30 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8 }}\n              className=\"w-full space-y-6\"\n            >\n              <div className=\"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-[#1677FF]/10 to-[#2ED8FF]/10 border border-[#1677FF]/20 mt-8\">\n                <Sparkles className=\"h-4 w-4 text-[#1677FF]\" />\n                <span className=\"text-sm font-medium\">Secure Multi-Chain Wallet</span>\n              </div>\n              <h1 className=\"text-4xl md:text-5xl lg:text-7xl font-bold leading-tight text-left\">\n                True crypto\n                <br />\n                ownership.\n                <br />\n                <span className=\"bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] bg-clip-text text-transparent\">\n                  Powerful Web3\n                </span>\n              </h1>\n              <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed max-w-2xl text-left\">\n                Unlock the power of your cryptocurrency assets and explore the world of Web3 with Lumirra.\n              </p>\n              <Button\n                onClick={() => setLocation(\"/create-account\")}\n                size=\"lg\"\n                className=\"bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] hover:shadow-lg hover:shadow-[#1677FF]/50 transition-all duration-300 text-lg px-8\"\n                data-testid=\"button-get-started\"\n              >\n                Get Started\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Button>\n            </motion.div>\n\n            <div className=\"relative flex justify-center items-center w-full min-h-[500px] md:min-h-[600px] mt-12\">\n              {/* Rotating chain logos container */}\n              <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n                <motion.div\n                  className=\"relative w-[320px] h-[320px] md:w-[450px] md:h-[450px]\"\n                  animate={{ rotate: 360 }}\n                  transition={{ duration: 30, repeat: Infinity, ease: \"linear\" }}\n                >\n                  {/* Ethereum - Top (in front) */}\n                  <motion.div \n                    className=\"absolute top-0 left-1/2 -translate-x-1/2 w-16 h-16 rounded-full flex items-center justify-center\"\n                    style={{ \n                      zIndex: 20,\n                      backgroundColor: 'white',\n                      border: '3px solid #3B82F6',\n                      boxShadow: '0 10px 30px rgba(0,0,0,0.15)'\n                    }}\n                    animate={{ rotate: -360 }}\n                    transition={{ duration: 30, repeat: Infinity, ease: \"linear\" }}\n                  >\n                    <img \n                      src=\"https://assets.coingecko.com/coins/images/279/small/ethereum.png\" \n                      alt=\"Ethereum\" \n                      className=\"w-11 h-11\"\n                    />\n                  </motion.div>\n\n                  {/* BNB - Right (behind) */}\n                  <motion.div \n                    className=\"absolute right-0 top-1/2 -translate-y-1/2 w-16 h-16 rounded-full flex items-center justify-center\"\n                    style={{ \n                      zIndex: 5,\n                      backgroundColor: 'white',\n                      border: '3px solid #EAB308',\n                      boxShadow: '0 10px 30px rgba(0,0,0,0.15)'\n                    }}\n                    animate={{ rotate: -360 }}\n                    transition={{ duration: 30, repeat: Infinity, ease: \"linear\" }}\n                  >\n                    <img \n                      src=\"https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png\" \n                      alt=\"BNB\" \n                      className=\"w-11 h-11\"\n                    />\n                  </motion.div>\n\n                  {/* TRON - Bottom (behind) */}\n                  <motion.div \n                    className=\"absolute bottom-0 left-1/2 -translate-x-1/2 w-16 h-16 rounded-full flex items-center justify-center\"\n                    style={{ \n                      zIndex: 5,\n                      backgroundColor: 'white',\n                      border: '3px solid #EF4444',\n                      boxShadow: '0 10px 30px rgba(0,0,0,0.15)'\n                    }}\n                    animate={{ rotate: -360 }}\n                    transition={{ duration: 30, repeat: Infinity, ease: \"linear\" }}\n                  >\n                    <img \n                      src=\"https://assets.coingecko.com/coins/images/1094/small/tron-logo.png\" \n                      alt=\"TRON\" \n                      className=\"w-11 h-11\"\n                    />\n                  </motion.div>\n\n                  {/* Solana - Left (in front) */}\n                  <motion.div \n                    className=\"absolute left-0 top-1/2 -translate-y-1/2 w-16 h-16 rounded-full flex items-center justify-center\"\n                    style={{ \n                      zIndex: 20,\n                      backgroundColor: 'white',\n                      border: '3px solid #A855F7',\n                      boxShadow: '0 10px 30px rgba(0,0,0,0.15)'\n                    }}\n                    animate={{ rotate: -360 }}\n                    transition={{ duration: 30, repeat: Infinity, ease: \"linear\" }}\n                  >\n                    <img \n                      src=\"https://assets.coingecko.com/coins/images/4128/small/solana.png\" \n                      alt=\"Solana\" \n                      className=\"w-11 h-11\"\n                    />\n                  </motion.div>\n                </motion.div>\n              </div>\n\n              {/* Mockup image */}\n              <div className=\"relative w-full max-w-xl md:max-w-2xl lg:max-w-3xl\">\n                <AnimatePresence initial={false}>\n                  <motion.img \n                    key={theme}\n                    src={theme === \"light\" ? mockupLightImage : mockupDarkImage} \n                    alt=\"Lumirra Wallet Dashboard\" \n                    className=\"w-full drop-shadow-2xl absolute inset-0\"\n                    style={{ zIndex: 10 }}\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    exit={{ opacity: 0 }}\n                    transition={{ \n                      duration: 0.8, \n                      ease: [0.4, 0, 0.2, 1]\n                    }}\n                    data-testid=\"img-hero-mockup\"\n                  />\n                </AnimatePresence>\n                <img \n                  src={mockupLightImage} \n                  alt=\"\" \n                  className=\"w-full opacity-0 pointer-events-none\"\n                  aria-hidden=\"true\"\n                />\n              </div>\n            </div>\n\n            <motion.div\n              initial={{ opacity: 0, y: 30 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.8, delay: 0.9 }}\n              className=\"space-y-8\"\n            >\n\n              <div className=\"grid grid-cols-3 gap-8\">\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold text-foreground\">\n                    <AnimatedCounter end={4} />+\n                  </div>\n                  <div className=\"text-sm text-muted-foreground mt-1\">Chains</div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold text-foreground\">\n                    100%\n                  </div>\n                  <div className=\"text-sm text-muted-foreground mt-1\">Secure</div>\n                  <div className=\"text-xs text-[#1677FF] mt-2 font-semibold\">\n                    <AnimatedCounter end={getDailyNewUsers()} />+ new users today\n                  </div>\n                </div>\n                <div className=\"text-center\">\n                  <div className=\"text-3xl font-bold text-foreground\">\n                    24/7\n                  </div>\n                  <div className=\"text-sm text-muted-foreground mt-1\">Support</div>\n                </div>\n              </div>\n            </motion.div>\n          </div>\n        </div>\n\n        <motion.div\n          className=\"absolute bottom-8 left-1/2 transform -translate-x-1/2 hidden md:flex\"\n          animate={{\n            y: [0, 10, 0],\n          }}\n          transition={{\n            duration: 2,\n            repeat: Infinity,\n            ease: \"easeInOut\"\n          }}\n        >\n          <div className=\"text-muted-foreground text-sm flex flex-col items-center gap-2\">\n            <span>Scroll to explore</span>\n            <div className=\"h-8 w-5 rounded-full border-2 border-muted-foreground/30 flex items-start justify-center p-1\">\n              <motion.div\n                className=\"h-1.5 w-1.5 rounded-full bg-muted-foreground/50\"\n                animate={{\n                  y: [0, 12, 0],\n                }}\n                transition={{\n                  duration: 1.5,\n                  repeat: Infinity,\n                  ease: \"easeInOut\"\n                }}\n              />\n            </div>\n          </div>\n        </motion.div>\n      </section>\n\n      <section className=\"py-32 px-4 relative\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-background via-muted/20 to-background\" />\n        <div className=\"container mx-auto max-w-7xl relative z-10\">\n          <motion.div\n            initial={{ opacity: 0, y: 30 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            transition={{ duration: 0.8 }}\n            className=\"text-center mb-20\"\n          >\n            <h2 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              Everything You Need\n            </h2>\n            <p className=\"text-xl md:text-2xl text-muted-foreground max-w-3xl mx-auto\">\n              Powerful features designed for both crypto beginners and experts\n            </p>\n          </motion.div>\n\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <FeatureCard\n              icon={ArrowRight}\n              title=\"Send & Receive\"\n              description=\"Transfer crypto instantly with QR codes, address validation, and real-time confirmations across all supported chains.\"\n              delay={0}\n            />\n            <FeatureCard\n              icon={RefreshCw}\n              title=\"Token Swaps\"\n              description=\"Exchange tokens seamlessly with the best rates from multiple providers. Compare prices and save on fees.\"\n              delay={0.1}\n            />\n            <FeatureCard\n              icon={Shield}\n              title=\"Portfolio Tracking\"\n              description=\"Monitor your investments with real-time price updates, charts, and comprehensive transaction history.\"\n              delay={0.2}\n            />\n            <FeatureCard\n              icon={Zap}\n              title=\"Buy with Fiat\"\n              description=\"Purchase cryptocurrency directly with credit cards through our secure MoonPay integration.\"\n              delay={0.3}\n            />\n            <FeatureCard\n              icon={Layers}\n              title=\"Multi-Chain Support\"\n              description=\"Access Ethereum, BNB Chain, TRON, Solana, and more - all from a single unified interface.\"\n              delay={0.4}\n            />\n            <FeatureCard\n              icon={Globe}\n              title=\"Market Intelligence\"\n              description=\"Stay informed with real-time crypto news and market updates from trusted sources.\"\n              delay={0.5}\n            />\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-32 px-4 relative overflow-hidden\">\n        <div className=\"absolute inset-0\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-[#1677FF]/5 to-[#2ED8FF]/5\" />\n        </div>\n        \n        <div className=\"container mx-auto max-w-7xl relative z-10\">\n          <motion.div\n            initial={{ opacity: 0, y: 30 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            transition={{ duration: 0.8 }}\n            className=\"text-center mb-20\"\n          >\n            <h2 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              Uncompromising Security\n            </h2>\n            <p className=\"text-xl md:text-2xl text-muted-foreground max-w-3xl mx-auto\">\n              Your keys, your crypto. Built with security at every layer.\n            </p>\n          </motion.div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            <FeatureCard\n              icon={Lock}\n              title=\"Self-Custody\"\n              description=\"You control your private keys. We never have access to your funds or store your sensitive data.\"\n              delay={0}\n            />\n            <FeatureCard\n              icon={Eye}\n              title=\"Privacy First\"\n              description=\"Zero tracking, zero data collection. Your financial activity remains completely confidential.\"\n              delay={0.1}\n            />\n            <FeatureCard\n              icon={Shield}\n              title=\"Encrypted Storage\"\n              description=\"Military-grade encryption protects your wallet data with password-based authentication.\"\n              delay={0.2}\n            />\n          </div>\n\n          <motion.div\n            initial={{ opacity: 0, y: 30 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            transition={{ duration: 0.8, delay: 0.3 }}\n            className=\"mt-16 grid grid-cols-2 md:grid-cols-4 gap-8 text-center\"\n          >\n            <div className=\"space-y-2\">\n              <Award className=\"h-12 w-12 text-[#1677FF] mx-auto\" />\n              <div className=\"font-semibold\">Industry Standard</div>\n              <div className=\"text-sm text-muted-foreground\">BIP-39 Compliant</div>\n            </div>\n            <div className=\"space-y-2\">\n              <Shield className=\"h-12 w-12 text-[#1677FF] mx-auto\" />\n              <div className=\"font-semibold\">Encrypted</div>\n              <div className=\"text-sm text-muted-foreground\">AES-256 Protection</div>\n            </div>\n            <div className=\"space-y-2\">\n              <Lock className=\"h-12 w-12 text-[#1677FF] mx-auto\" />\n              <div className=\"font-semibold\">Open Source</div>\n              <div className=\"text-sm text-muted-foreground\">Transparent Code</div>\n            </div>\n            <div className=\"space-y-2\">\n              <Eye className=\"h-12 w-12 text-[#1677FF] mx-auto\" />\n              <div className=\"font-semibold\">No Tracking</div>\n              <div className=\"text-sm text-muted-foreground\">Complete Privacy</div>\n            </div>\n          </motion.div>\n        </div>\n      </section>\n\n      <section className=\"py-32 px-4 relative\">\n        <div className=\"container mx-auto max-w-7xl\">\n          <motion.div\n            initial={{ opacity: 0, y: 30 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            transition={{ duration: 0.8 }}\n            className=\"text-center mb-20\"\n          >\n            <h2 className=\"text-4xl md:text-6xl font-bold mb-6\">\n              Supported Chains\n            </h2>\n            <p className=\"text-xl md:text-2xl text-muted-foreground\">\n              One wallet for your entire crypto portfolio\n            </p>\n          </motion.div>\n\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n            {[\n              { \n                name: \"Ethereum\", \n                symbol: \"ETH\", \n                standard: \"ERC-20\",\n                logo: \"https://assets.coingecko.com/coins/images/279/small/ethereum.png\"\n              },\n              { \n                name: \"BNB Chain\", \n                symbol: \"BNB\", \n                standard: \"BEP-20\",\n                logo: \"https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png\"\n              },\n              { \n                name: \"TRON\", \n                symbol: \"TRX\", \n                standard: \"TRC-20\",\n                logo: \"https://assets.coingecko.com/coins/images/1094/small/tron-logo.png\"\n              },\n              { \n                name: \"Solana\", \n                symbol: \"SOL\", \n                standard: \"SPL\",\n                logo: \"https://assets.coingecko.com/coins/images/4128/small/solana.png\"\n              },\n            ].map((chain, index) => (\n              <motion.div\n                key={chain.symbol}\n                initial={{ opacity: 0, y: 30 }}\n                whileInView={{ opacity: 1, y: 0 }}\n                viewport={{ once: true }}\n                transition={{ duration: 0.6, delay: index * 0.1 }}\n                className=\"group\"\n              >\n                <div className=\"relative p-8 rounded-2xl bg-card/50 backdrop-blur-xl border border-border/50 hover-elevate transition-all duration-300\">\n                  <div className=\"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-br from-[#1677FF]/5 to-[#2ED8FF]/5\" />\n                  <div className=\"relative flex flex-col items-center text-center gap-4\">\n                    <div className=\"h-20 w-20 rounded-full bg-white dark:bg-gray-900 flex items-center justify-center p-3 transform group-hover:scale-110 transition-transform duration-300 shadow-lg\">\n                      <img src={chain.logo} alt={chain.name} className=\"w-full h-full object-contain\" />\n                    </div>\n                    <div>\n                      <div className=\"font-semibold text-lg\">{chain.name}</div>\n                      <div className=\"text-sm text-muted-foreground\">{chain.standard}</div>\n                    </div>\n                  </div>\n                </div>\n              </motion.div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      <section className=\"py-32 px-4 relative overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-[#1677FF] to-[#2ED8FF]\" />\n        <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PHBhdGggZD0iTTM2IDE0YzMuMzE0IDAgNiAyLjY4NiA2IDZzLTIuNjg2IDYtNiA2LTYtMi42ODYtNi02IDIuNjg2LTYgNi02ek0yNCAzNmMzLjMxNCAwIDYgMi42ODYgNiA2cy0yLjY4NiA2LTYgNi02LTIuNjg2LTYtNiAyLjY4Ni02IDYtNnoiLz48L2c+PC9nPjwvc3ZnPg==')] opacity-20\" />\n        \n        <div className=\"container mx-auto max-w-5xl relative z-10 text-center text-white\">\n          <motion.div\n            initial={{ opacity: 0, scale: 0.9 }}\n            whileInView={{ opacity: 1, scale: 1 }}\n            viewport={{ once: true }}\n            transition={{ duration: 0.8 }}\n          >\n            <h2 className=\"text-4xl md:text-6xl font-bold mb-8\">\n              Start Your Crypto Journey Today\n            </h2>\n            <p className=\"text-xl md:text-2xl mb-12 opacity-90 max-w-3xl mx-auto\">\n              Join thousands of users managing their digital assets with confidence and security.\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-6 justify-center\">\n              <Button\n                onClick={() => setLocation(\"/create-account\")}\n                size=\"lg\"\n                className=\"text-lg px-10 py-7 bg-white text-[#1677FF] hover:bg-white/90 shadow-2xl transform hover:scale-105 transition-all\"\n                data-testid=\"button-cta-create\"\n              >\n                Create Account\n                <ArrowRight className=\"ml-2 h-5 w-5\" />\n              </Button>\n              <Button\n                onClick={() => setLocation(\"/login\")}\n                size=\"lg\"\n                variant=\"outline\"\n                className=\"text-lg px-10 py-7 border-2 border-white text-white hover:bg-white/10\"\n                data-testid=\"button-cta-login\"\n              >\n                Login to Existing Account\n              </Button>\n            </div>\n          </motion.div>\n        </div>\n      </section>\n\n      <footer className=\"py-16 px-4 bg-muted/30 border-t\">\n        <div className=\"container mx-auto max-w-7xl\">\n          <div className=\"flex flex-col md:flex-row justify-between items-center gap-8\">\n            <div className=\"flex items-center gap-3\">\n              <img src={logoImage} alt=\"Lumirra\" className=\"h-10 w-10\" />\n              <div>\n                <span className=\"text-xl font-bold bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] bg-clip-text text-transparent block\">\n                  Lumirra\n                </span>\n                <span className=\"text-sm text-muted-foreground\">Secure Multi-Chain Wallet</span>\n              </div>\n            </div>\n            <div className=\"text-sm text-muted-foreground text-center md:text-right space-y-2\">\n              <p>Your keys, your crypto. Always.</p>\n              <p>&copy; 2025 Lumirra. All rights reserved.</p>\n            </div>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","size_bytes":27012},"client/src/pages/login.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { ArrowLeft, Mail, Loader2, AlertCircle, ChevronLeft, Delete } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useWallet } from \"@/contexts/wallet-context\";\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { setWallet } = useWallet();\n  const [step, setStep] = useState<\"email\" | \"pin\" | \"reset-email\" | \"reset-code\" | \"reset-pin\" | \"reset-confirm\">(\"email\");\n  const [email, setEmail] = useState(\"\");\n  const [pin, setPin] = useState<string[]>([\"\", \"\", \"\", \"\", \"\", \"\"]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [resetCode, setResetCode] = useState<string[]>([\"\", \"\", \"\", \"\"]);\n  const [resetCodeIndex, setResetCodeIndex] = useState(0);\n  const [newPin, setNewPin] = useState<string>(\"\");\n  const [verifiedResetCode, setVerifiedResetCode] = useState<string>(\"\");\n  const [countdown, setCountdown] = useState(0);\n  const [isShaking, setIsShaking] = useState(false);\n\n  // Check if user was redirected from \"Forget Password\" in settings\n  useEffect(() => {\n    const startResetFlow = sessionStorage.getItem(\"startResetFlow\");\n    const resetEmail = sessionStorage.getItem(\"resetEmail\");\n    \n    if (startResetFlow === \"true\" && resetEmail) {\n      setEmail(resetEmail);\n      setStep(\"reset-code\");\n      setCountdown(600); // 10 minutes\n      \n      // Clear sessionStorage flags\n      sessionStorage.removeItem(\"startResetFlow\");\n      sessionStorage.removeItem(\"resetEmail\");\n    }\n  }, []);\n\n  useEffect(() => {\n    if (countdown > 0) {\n      const timer = setTimeout(() => setCountdown(countdown - 1), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [countdown]);\n\n  const handleEmailSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    \n    if (!email || !email.includes(\"@\")) {\n      setError(\"Please enter a valid email address\");\n      return;\n    }\n\n    setStep(\"pin\");\n  };\n\n  const handleNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex < 6) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex] = num;\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex + 1);\n\n      if (currentIndex === 5) {\n        const enteredPin = updatedPin.join(\"\");\n        \n        setTimeout(async () => {\n          setLoading(true);\n          setError(\"\");\n          \n          try {\n            const response = await apiRequest(\"POST\", \"/api/auth/login-pin\", { \n              email, \n              pin: enteredPin \n            });\n            \n            if (response.ok) {\n              const data = await response.json();\n              \n              if (data.wallet) {\n                setWallet(data.wallet.id, data.wallet.address);\n              }\n              \n              toast({\n                title: \"Login Successful\",\n                description: \"Welcome back!\",\n              });\n\n              if (data.user.isAdmin) {\n                window.location.href = \"/admin\";\n              } else {\n                window.location.href = \"/dashboard\";\n              }\n            } else {\n              const errorData = await response.json();\n              \n              if (errorData.requiresPasswordReset) {\n                toast({\n                  title: \"Password Reset Required\",\n                  description: \"Your password needs to be updated to the new PIN format. Please reset your password.\",\n                  variant: \"destructive\",\n                });\n                setStep(\"reset-email\");\n                setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                setCurrentIndex(0);\n              } else {\n                // Trigger shake animation\n                setIsShaking(true);\n                setTimeout(() => setIsShaking(false), 600);\n                \n                setError(errorData.error || \"Invalid PIN. Please try again.\");\n                setTimeout(() => {\n                  setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                  setCurrentIndex(0);\n                }, 600);\n              }\n              \n              setLoading(false);\n            }\n          } catch (error: any) {\n            // Trigger shake animation\n            setIsShaking(true);\n            setTimeout(() => setIsShaking(false), 600);\n            \n            setError(error?.message || \"An error occurred during login.\");\n            setTimeout(() => {\n              setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n              setCurrentIndex(0);\n            }, 600);\n            setLoading(false);\n          }\n        }, 300);\n      }\n    }\n  };\n\n  const handleDelete = () => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex > 0) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex - 1] = \"\";\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex - 1);\n    }\n  };\n\n  const handleForgotPassword = () => {\n    setStep(\"reset-email\");\n  };\n\n  const handleSendResetCode = async () => {\n    if (!email || !email.includes(\"@\")) {\n      setError(\"Please enter a valid email address\");\n      return;\n    }\n\n    setLoading(true);\n    setError(\"\");\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/send-reset-code\", {\n        email,\n      });\n\n      if (response.ok) {\n        setCountdown(600); // 10 minutes\n        setStep(\"reset-code\");\n        toast({\n          title: \"Reset Code Sent\",\n          description: \"Please check your email for the 4-digit code\",\n        });\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || \"Failed to send reset code\");\n      }\n    } catch (error: any) {\n      setError(error?.message || \"Failed to send reset code\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleResetCodeNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (resetCodeIndex < 4) {\n      const updatedCode = [...resetCode];\n      updatedCode[resetCodeIndex] = num;\n      setResetCode(updatedCode);\n      setResetCodeIndex(resetCodeIndex + 1);\n\n      if (resetCodeIndex === 3) {\n        const enteredCode = updatedCode.join(\"\");\n        \n        // Verify the code with backend before proceeding\n        setTimeout(async () => {\n          setLoading(true);\n          setError(\"\");\n          \n          try {\n            const response = await apiRequest(\"POST\", \"/api/auth/verify-reset-code\", {\n              email: email.toLowerCase(),\n              code: enteredCode,\n            });\n            \n            if (response.ok) {\n              // Code verified successfully, save it and proceed to new PIN entry\n              setVerifiedResetCode(enteredCode);\n              setStep(\"reset-pin\");\n              setResetCodeIndex(0);\n            } else {\n              const errorData = await response.json();\n              \n              // Show error with shake animation and clear immediately for retry\n              setIsShaking(true);\n              setError(errorData.error || \"Invalid reset code. Please try again.\");\n              setResetCode([\"\", \"\", \"\", \"\"]);\n              setResetCodeIndex(0);\n              \n              // Clear the shake animation and error after 1.5 seconds\n              setTimeout(() => {\n                setIsShaking(false);\n                setError(\"\");\n              }, 1500);\n            }\n          } catch (error: any) {\n            // Show error with shake animation and clear immediately for retry\n            setIsShaking(true);\n            setError(\"Failed to verify code. Please try again.\");\n            setResetCode([\"\", \"\", \"\", \"\"]);\n            setResetCodeIndex(0);\n            \n            // Clear the shake animation and error after 1.5 seconds\n            setTimeout(() => {\n              setIsShaking(false);\n              setError(\"\");\n            }, 1500);\n          } finally {\n            setLoading(false);\n          }\n        }, 300);\n      }\n    }\n  };\n\n  const handleResetCodeDelete = () => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (resetCodeIndex > 0) {\n      const updatedCode = [...resetCode];\n      updatedCode[resetCodeIndex - 1] = \"\";\n      setResetCode(updatedCode);\n      setResetCodeIndex(resetCodeIndex - 1);\n    }\n  };\n\n  const handleResetPinNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex < 6) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex] = num;\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex + 1);\n\n      if (currentIndex === 5) {\n        const enteredPin = updatedPin.join(\"\");\n        setNewPin(enteredPin);\n        \n        setTimeout(() => {\n          setStep(\"reset-confirm\");\n          setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n          setCurrentIndex(0);\n          toast({\n            description: \"Confirm your new PIN\",\n          });\n        }, 300);\n      }\n    }\n  };\n\n  const handleResetConfirmNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex < 6) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex] = num;\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex + 1);\n\n      if (currentIndex === 5) {\n        const enteredPin = updatedPin.join(\"\");\n        \n        setTimeout(async () => {\n          if (enteredPin === newPin) {\n            setLoading(true);\n            \n            try {\n              const response = await apiRequest(\"POST\", \"/api/auth/reset-password-pin\", {\n                email: email.toLowerCase(),\n                code: verifiedResetCode,\n                newPin: newPin,\n              });\n\n              if (response.ok) {\n                toast({\n                  title: \"Password Reset Successful\",\n                  description: \"You can now login with your new PIN\",\n                });\n                setStep(\"email\");\n                setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                setCurrentIndex(0);\n                setResetCode([\"\", \"\", \"\", \"\"]);\n                setNewPin(\"\");\n              } else {\n                const errorData = await response.json();\n                toast({\n                  title: \"Reset Failed\",\n                  description: errorData.error || \"Failed to reset password\",\n                  variant: \"destructive\",\n                });\n                setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                setCurrentIndex(0);\n              }\n            } catch (error: any) {\n              toast({\n                title: \"Error\",\n                description: error?.message || \"Failed to reset password\",\n                variant: \"destructive\",\n              });\n              setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n              setCurrentIndex(0);\n            } finally {\n              setLoading(false);\n            }\n          } else {\n            toast({\n              description: \"PINs don't match. Please try again.\",\n              variant: \"destructive\",\n            });\n            setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n            setCurrentIndex(0);\n            setNewPin(\"\");\n            setStep(\"reset-pin\");\n          }\n        }, 300);\n      }\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 relative overflow-hidden\">\n      <div className=\"absolute inset-0 bg-gradient-to-br from-[#1677FF]/10 via-background to-[#2ED8FF]/10\" />\n      <motion.div \n        className=\"absolute top-20 right-0 w-[600px] h-[600px] bg-[#1677FF]/10 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.2, 1],\n          opacity: [0.3, 0.5, 0.3],\n        }}\n        transition={{\n          duration: 8,\n          repeat: Infinity,\n          ease: \"easeInOut\"\n        }}\n      />\n      <motion.div \n        className=\"absolute bottom-0 left-0 w-[500px] h-[500px] bg-[#2ED8FF]/10 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.3, 1],\n          opacity: [0.3, 0.5, 0.3],\n        }}\n        transition={{\n          duration: 10,\n          repeat: Infinity,\n          ease: \"easeInOut\",\n          delay: 1\n        }}\n      />\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6 }}\n        className=\"w-full max-w-md relative z-10\"\n      >\n        {step === \"email\" && (\n          <div className=\"bg-card/50 backdrop-blur-xl rounded-3xl border border-border/50 shadow-2xl p-8\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation(\"/\")}\n              className=\"mb-6\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back\n            </Button>\n\n            <h1 className=\"text-3xl font-bold text-center mb-2\">Welcome Back</h1>\n            <p className=\"text-muted-foreground text-center mb-8\">\n              Login to access your wallet\n            </p>\n\n            <AnimatePresence>\n              {error && (\n                <motion.div\n                  initial={{ opacity: 0, y: -10, height: 0 }}\n                  animate={{ opacity: 1, y: 0, height: \"auto\" }}\n                  exit={{ opacity: 0, y: -10, height: 0 }}\n                  transition={{ duration: 0.3 }}\n                  className=\"mb-6\"\n                >\n                  <Alert variant=\"destructive\" className=\"border-red-500/50 bg-red-500/10\" data-testid=\"alert-error\">\n                    <AlertCircle className=\"h-5 w-5\" />\n                    <AlertDescription className=\"ml-2 text-sm\">\n                      {error}\n                    </AlertDescription>\n                  </Alert>\n                </motion.div>\n              )}\n            </AnimatePresence>\n\n            <form onSubmit={handleEmailSubmit} className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email Address</Label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"you@example.com\"\n                    value={email}\n                    onChange={(e) => {\n                      setEmail(e.target.value);\n                      setError(\"\");\n                    }}\n                    className=\"pl-10\"\n                    data-testid=\"input-email\"\n                    autoFocus\n                  />\n                </div>\n              </div>\n\n              <Button \n                type=\"submit\" \n                className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] hover:opacity-90\"\n                size=\"lg\"\n                disabled={loading}\n                data-testid=\"button-continue\"\n              >\n                {loading ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                    Please wait...\n                  </>\n                ) : (\n                  \"Continue\"\n                )}\n              </Button>\n            </form>\n\n            <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n              Don't have an account?{\" \"}\n              <button\n                onClick={() => setLocation(\"/create-account\")}\n                className=\"text-[#1677FF] hover:underline font-medium\"\n                data-testid=\"link-create-account\"\n              >\n                Create Account\n              </button>\n            </div>\n          </div>\n        )}\n\n        {step === \"pin\" && (\n          <div className=\"fixed inset-0 bg-background z-50\">\n            <div className=\"min-h-screen flex flex-col\">\n              <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    data-testid=\"button-back-to-email\"\n                    className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n                    onClick={() => {\n                      setStep(\"email\");\n                      setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                      setCurrentIndex(0);\n                    }}\n                  >\n                    <ChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">Enter PIN</h1>\n                <div className=\"w-9\"></div>\n              </header>\n\n              <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n                <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n                  <AnimatePresence>\n                    {error && (\n                      <motion.div\n                        initial={{ opacity: 0, y: -10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        exit={{ opacity: 0, y: -10 }}\n                        transition={{ duration: 0.3 }}\n                        className=\"mb-6 w-full\"\n                      >\n                        <Alert variant=\"destructive\" className=\"border-red-500/50 bg-red-500/10\" data-testid=\"alert-error\">\n                          <AlertCircle className=\"h-5 w-5\" />\n                          <AlertDescription className=\"ml-2 text-sm\">\n                            {error}\n                          </AlertDescription>\n                        </Alert>\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n\n                  <h2 className=\"text-xl mb-8 text-center\" data-testid=\"text-pin-prompt\">\n                    Enter your 6-digit PIN\n                  </h2>\n                  \n                  <div \n                    className={`flex gap-3 mb-12 ${isShaking ? 'animate-shake' : ''}`} \n                    data-testid=\"container-pin-inputs\"\n                  >\n                    {pin.map((digit, index) => (\n                      <div\n                        key={index}\n                        data-testid={`pin-box-${index}`}\n                        className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl transition-colors ${\n                          isShaking && digit\n                            ? \"border-red-500 bg-red-500/10\"\n                            : digit \n                            ? \"border-primary\" \n                            : \"border-muted-foreground/30\"\n                        }`}\n                      >\n                        {digit && <span className=\"text-2xl\"></span>}\n                      </div>\n                    ))}\n                  </div>\n\n                  <button\n                    data-testid=\"button-forgot-password\"\n                    onClick={handleForgotPassword}\n                    disabled={loading}\n                    className=\"text-primary hover-elevate active-elevate-2 px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n                  >\n                    {loading && <Loader2 className=\"h-4 w-4 animate-spin\" />}\n                    Forget Password\n                  </button>\n                </div>\n\n                <div className=\"w-full max-w-md\">\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                      <button\n                        key={num}\n                        data-testid={`button-num-${num}`}\n                        onClick={() => handleNumberClick(num.toString())}\n                        className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                      >\n                        {num}\n                      </button>\n                    ))}\n                    <div className=\"h-16\"></div>\n                    <button\n                      data-testid=\"button-num-0\"\n                      onClick={() => handleNumberClick(\"0\")}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                    >\n                      0\n                    </button>\n                    <button\n                      data-testid=\"button-delete\"\n                      onClick={handleDelete}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n                    >\n                      <Delete className=\"w-6 h-6\" />\n                    </button>\n                  </div>\n                </div>\n              </main>\n            </div>\n          </div>\n        )}\n\n        {step === \"reset-email\" && (\n          <div className=\"bg-card/50 backdrop-blur-xl rounded-3xl border border-border/50 shadow-2xl p-8\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => {\n                setStep(email ? \"pin\" : \"email\");\n                setError(\"\");\n              }}\n              className=\"mb-6\"\n              data-testid=\"button-back-from-reset\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back\n            </Button>\n\n            <h1 className=\"text-3xl font-bold text-center mb-2\">Reset Password</h1>\n            <p className=\"text-muted-foreground text-center mb-8\">\n              Enter your email to receive a reset code\n            </p>\n\n            <AnimatePresence>\n              {error && (\n                <motion.div\n                  initial={{ opacity: 0, y: -10, height: 0 }}\n                  animate={{ opacity: 1, y: 0, height: \"auto\" }}\n                  exit={{ opacity: 0, y: -10, height: 0 }}\n                  transition={{ duration: 0.3 }}\n                  className=\"mb-6\"\n                >\n                  <Alert variant=\"destructive\" className=\"border-red-500/50 bg-red-500/10\" data-testid=\"alert-error\">\n                    <AlertCircle className=\"h-5 w-5\" />\n                    <AlertDescription className=\"ml-2 text-sm\">\n                      {error}\n                    </AlertDescription>\n                  </Alert>\n                </motion.div>\n              )}\n            </AnimatePresence>\n\n            <div className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"reset-email\">Email Address</Label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                  <Input\n                    id=\"reset-email\"\n                    type=\"email\"\n                    placeholder=\"you@example.com\"\n                    value={email}\n                    onChange={(e) => {\n                      setEmail(e.target.value);\n                      setError(\"\");\n                    }}\n                    className=\"pl-10\"\n                    data-testid=\"input-reset-email\"\n                    autoFocus\n                  />\n                </div>\n              </div>\n\n              <Button \n                type=\"button\"\n                onClick={handleSendResetCode}\n                className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] hover:opacity-90\"\n                size=\"lg\"\n                disabled={loading || countdown > 0}\n                data-testid=\"button-send-reset-code\"\n              >\n                {loading ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                    Sending Code...\n                  </>\n                ) : countdown > 0 ? (\n                  `Resend in ${Math.floor(countdown / 60)}:${String(countdown % 60).padStart(2, '0')}`\n                ) : (\n                  \"Send Reset Code\"\n                )}\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {step === \"reset-code\" && (\n          <div className=\"fixed inset-0 bg-background z-50\">\n            <div className=\"min-h-screen flex flex-col\">\n              <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    data-testid=\"button-back-to-reset-email\"\n                    className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n                    onClick={() => {\n                      setStep(\"reset-email\");\n                      setResetCode([\"\", \"\", \"\", \"\"]);\n                      setResetCodeIndex(0);\n                    }}\n                  >\n                    <ChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">Enter Reset Code</h1>\n                <div className=\"w-9\"></div>\n              </header>\n\n              <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n                <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n                  <h2 className=\"text-xl mb-8 text-center\" data-testid=\"text-reset-code-prompt\">\n                    Enter the 4-digit code sent to {email}\n                  </h2>\n                  \n                  <div \n                    className={`flex gap-3 mb-4 ${isShaking ? \"animate-shake\" : \"\"}`}\n                    data-testid=\"container-reset-code-inputs\"\n                  >\n                    {resetCode.map((digit, index) => (\n                      <div\n                        key={index}\n                        data-testid={`reset-code-box-${index}`}\n                        className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl ${\n                          error ? \"border-destructive\" : digit ? \"border-primary\" : \"border-muted-foreground/30\"\n                        }`}\n                      >\n                        {digit && <span className=\"text-2xl\"></span>}\n                      </div>\n                    ))}\n                  </div>\n                  \n                  {error && (\n                    <p className=\"text-destructive text-sm text-center mb-8\" data-testid=\"text-reset-code-error\">\n                      {error}\n                    </p>\n                  )}\n                  \n                  {!error && (\n                    <div className=\"mb-12\"></div>\n                  )}\n                </div>\n\n                <div className=\"w-full max-w-md\">\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                      <button\n                        key={num}\n                        data-testid={`button-num-${num}`}\n                        onClick={() => handleResetCodeNumberClick(num.toString())}\n                        className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                      >\n                        {num}\n                      </button>\n                    ))}\n                    <div className=\"h-16\"></div>\n                    <button\n                      data-testid=\"button-num-0\"\n                      onClick={() => handleResetCodeNumberClick(\"0\")}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                    >\n                      0\n                    </button>\n                    <button\n                      data-testid=\"button-delete\"\n                      onClick={handleResetCodeDelete}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n                    >\n                      <Delete className=\"w-6 h-6\" />\n                    </button>\n                  </div>\n                </div>\n              </main>\n            </div>\n          </div>\n        )}\n\n        {step === \"reset-pin\" && (\n          <div className=\"fixed inset-0 bg-background z-50\">\n            <div className=\"min-h-screen flex flex-col\">\n              <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    data-testid=\"button-back-to-reset-code\"\n                    className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n                    onClick={() => {\n                      setStep(\"reset-code\");\n                      setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                      setCurrentIndex(0);\n                    }}\n                  >\n                    <ChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">New PIN</h1>\n                <div className=\"w-9\"></div>\n              </header>\n\n              <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n                <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n                  <h2 className=\"text-xl mb-8 text-center\" data-testid=\"text-new-pin-prompt\">\n                    Enter your new 6-digit PIN\n                  </h2>\n                  \n                  <div className=\"flex gap-3 mb-12\" data-testid=\"container-pin-inputs\">\n                    {pin.map((digit, index) => (\n                      <div\n                        key={index}\n                        data-testid={`pin-box-${index}`}\n                        className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl ${\n                          digit ? \"border-primary\" : \"border-muted-foreground/30\"\n                        }`}\n                      >\n                        {digit && <span className=\"text-2xl\"></span>}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                <div className=\"w-full max-w-md\">\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                      <button\n                        key={num}\n                        data-testid={`button-num-${num}`}\n                        onClick={() => handleResetPinNumberClick(num.toString())}\n                        className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                      >\n                        {num}\n                      </button>\n                    ))}\n                    <div className=\"h-16\"></div>\n                    <button\n                      data-testid=\"button-num-0\"\n                      onClick={() => handleResetPinNumberClick(\"0\")}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                    >\n                      0\n                    </button>\n                    <button\n                      data-testid=\"button-delete\"\n                      onClick={handleDelete}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n                    >\n                      <Delete className=\"w-6 h-6\" />\n                    </button>\n                  </div>\n                </div>\n              </main>\n            </div>\n          </div>\n        )}\n\n        {step === \"reset-confirm\" && (\n          <div className=\"fixed inset-0 bg-background z-50\">\n            <div className=\"min-h-screen flex flex-col\">\n              <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    data-testid=\"button-back-to-new-pin\"\n                    className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n                    onClick={() => {\n                      setStep(\"reset-pin\");\n                      setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                      setCurrentIndex(0);\n                    }}\n                  >\n                    <ChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">Confirm PIN</h1>\n                <div className=\"w-9\"></div>\n              </header>\n\n              <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n                <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n                  <h2 className=\"text-xl mb-8 text-center\" data-testid=\"text-confirm-pin-prompt\">\n                    Confirm your new 6-digit PIN\n                  </h2>\n                  \n                  <div className=\"flex gap-3 mb-12\" data-testid=\"container-pin-inputs\">\n                    {pin.map((digit, index) => (\n                      <div\n                        key={index}\n                        data-testid={`pin-box-${index}`}\n                        className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl ${\n                          digit ? \"border-primary\" : \"border-muted-foreground/30\"\n                        }`}\n                      >\n                        {digit && <span className=\"text-2xl\"></span>}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                <div className=\"w-full max-w-md\">\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                      <button\n                        key={num}\n                        data-testid={`button-num-${num}`}\n                        onClick={() => handleResetConfirmNumberClick(num.toString())}\n                        className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                      >\n                        {num}\n                      </button>\n                    ))}\n                    <div className=\"h-16\"></div>\n                    <button\n                      data-testid=\"button-num-0\"\n                      onClick={() => handleResetConfirmNumberClick(\"0\")}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                    >\n                      0\n                    </button>\n                    <button\n                      data-testid=\"button-delete\"\n                      onClick={handleDelete}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n                    >\n                      <Delete className=\"w-6 h-6\" />\n                    </button>\n                  </div>\n                </div>\n              </main>\n            </div>\n          </div>\n        )}\n\n        <p className=\"text-center text-sm text-muted-foreground mt-6\">\n          Your keys, your crypto. Always.\n        </p>\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":35815},"client/src/pages/recovery.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { ArrowLeft, Mail, Lock, Eye, EyeOff, CheckCircle2, Loader2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport logoImage from \"@assets/Lumirra Logo Design_1761873279867.png\";\n\nexport default function Recovery() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [step, setStep] = useState<\"email\" | \"code\" | \"password\" | \"success\">(\"email\");\n  const [email, setEmail] = useState(\"\");\n  const [code, setCode] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [countdown, setCountdown] = useState(0);\n\n  useEffect(() => {\n    if (countdown > 0) {\n      const timer = setTimeout(() => setCountdown(countdown - 1), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [countdown]);\n\n  const handleEmailSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email || !email.includes(\"@\")) {\n      toast({\n        title: \"Invalid Email\",\n        description: \"Please enter a valid email address\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setLoading(true);\n    \n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/send-code\", {\n        email,\n        purpose: \"reset\"\n      });\n\n      if (response.ok) {\n        setCountdown(600); // 10 minutes\n        toast({\n          title: \"Recovery Code Sent\",\n          description: `We've sent a 6-digit code to ${email}`,\n        });\n        setStep(\"code\");\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Failed to Send Code\",\n          description: errorData.error || \"Please try again\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to send recovery code\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCodeSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (code.length !== 6) {\n      toast({\n        title: \"Invalid Code\",\n        description: \"Please enter the 6-digit code\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setStep(\"password\");\n  };\n\n  const handlePasswordSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (password.length < 8) {\n      toast({\n        title: \"Weak Password\",\n        description: \"Password must be at least 8 characters long\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      toast({\n        title: \"Passwords Don't Match\",\n        description: \"Please make sure both passwords match\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setLoading(true);\n    \n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/reset-password\", {\n        email,\n        code,\n        newPassword: password,\n      });\n\n      if (response.ok) {\n        setStep(\"success\");\n        setTimeout(() => {\n          setLocation(\"/login\");\n        }, 2000);\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Failed to Reset Password\",\n          description: errorData.error || \"Please try again\",\n          variant: \"destructive\",\n        });\n        setLoading(false);\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to reset password\",\n        variant: \"destructive\",\n      });\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 relative overflow-hidden\">\n      <div className=\"absolute inset-0 bg-gradient-to-br from-[#1677FF]/10 via-background to-[#2ED8FF]/10\" />\n      <motion.div \n        className=\"absolute top-20 right-0 w-[600px] h-[600px] bg-[#1677FF]/10 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.2, 1],\n          opacity: [0.3, 0.5, 0.3],\n        }}\n        transition={{\n          duration: 8,\n          repeat: Infinity,\n          ease: \"easeInOut\"\n        }}\n      />\n      <motion.div \n        className=\"absolute bottom-0 left-0 w-[500px] h-[500px] bg-[#2ED8FF]/10 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.3, 1],\n          opacity: [0.3, 0.5, 0.3],\n        }}\n        transition={{\n          duration: 10,\n          repeat: Infinity,\n          ease: \"easeInOut\",\n          delay: 1\n        }}\n      />\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6 }}\n        className=\"w-full max-w-md relative z-10\"\n      >\n        <div className=\"bg-card/50 backdrop-blur-xl rounded-3xl border border-border/50 shadow-2xl p-8\">\n          {step !== \"success\" && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => {\n                if (step === \"email\") {\n                  setLocation(\"/login\");\n                } else if (step === \"code\") {\n                  setStep(\"email\");\n                } else if (step === \"password\") {\n                  setStep(\"code\");\n                }\n              }}\n              className=\"mb-6\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back\n            </Button>\n          )}\n\n          <div className=\"flex justify-center mb-8\">\n            <motion.img \n              src={logoImage} \n              alt=\"Lumirra\" \n              className=\"h-16 w-16\"\n              animate={{\n                rotate: [0, 360],\n              }}\n              transition={{\n                duration: 20,\n                repeat: Infinity,\n                ease: \"linear\"\n              }}\n              data-testid=\"logo-recovery\"\n            />\n          </div>\n\n          {step === \"email\" && (\n            <motion.div\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ duration: 0.4 }}\n            >\n              <h1 className=\"text-3xl font-bold text-center mb-2\">Reset Password</h1>\n              <p className=\"text-muted-foreground text-center mb-8\">\n                Enter your email to receive a recovery code\n              </p>\n\n              <form onSubmit={handleEmailSubmit} className=\"space-y-6\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">Email Address</Label>\n                  <div className=\"relative\">\n                    <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      placeholder=\"you@example.com\"\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      className=\"pl-10\"\n                      data-testid=\"input-email\"\n                      autoFocus\n                    />\n                  </div>\n                </div>\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] hover:opacity-90\"\n                  size=\"lg\"\n                  disabled={loading}\n                  data-testid=\"button-send-code\"\n                >\n                  {loading ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                      Sending Code...\n                    </>\n                  ) : (\n                    \"Send Recovery Code\"\n                  )}\n                </Button>\n              </form>\n\n              <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n                Remember your password?{\" \"}\n                <button\n                  onClick={() => setLocation(\"/login\")}\n                  className=\"text-[#1677FF] hover:underline font-medium\"\n                  data-testid=\"link-login\"\n                >\n                  Login\n                </button>\n              </div>\n            </motion.div>\n          )}\n\n          {step === \"code\" && (\n            <motion.div\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ duration: 0.4 }}\n            >\n              <h1 className=\"text-3xl font-bold text-center mb-2\">Enter Code</h1>\n              <p className=\"text-muted-foreground text-center mb-8\">\n                We sent a 6-digit code to {email}\n              </p>\n\n              <form onSubmit={handleCodeSubmit} className=\"space-y-6\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"code\">Recovery Code</Label>\n                  <Input\n                    id=\"code\"\n                    type=\"text\"\n                    placeholder=\"000000\"\n                    value={code}\n                    onChange={(e) => setCode(e.target.value.replace(/\\D/g, \"\").slice(0, 6))}\n                    className=\"text-center text-2xl tracking-widest\"\n                    data-testid=\"input-code\"\n                    autoFocus\n                  />\n                </div>\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] hover:opacity-90\"\n                  size=\"lg\"\n                  data-testid=\"button-verify-code\"\n                >\n                  Verify Code\n                </Button>\n              </form>\n\n              <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n                Didn't receive the code?{\" \"}\n                <button\n                  onClick={(e) => {\n                    e.preventDefault();\n                    const fakeEvent = { preventDefault: () => {} } as React.FormEvent;\n                    handleEmailSubmit(fakeEvent);\n                  }}\n                  disabled={countdown > 0 || loading}\n                  className=\"text-[#1677FF] hover:underline font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n                  data-testid=\"link-resend\"\n                >\n                  {countdown > 0 ? `Resend in ${Math.floor(countdown / 60)}:${String(countdown % 60).padStart(2, '0')}` : \"Resend\"}\n                </button>\n              </div>\n            </motion.div>\n          )}\n\n          {step === \"password\" && (\n            <motion.div\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ duration: 0.4 }}\n            >\n              <h1 className=\"text-3xl font-bold text-center mb-2\">New Password</h1>\n              <p className=\"text-muted-foreground text-center mb-8\">\n                Create a new strong password\n              </p>\n\n              <form onSubmit={handlePasswordSubmit} className=\"space-y-6\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"password\">New Password</Label>\n                  <div className=\"relative\">\n                    <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                    <Input\n                      id=\"password\"\n                      type={showPassword ? \"text\" : \"password\"}\n                      placeholder=\"At least 8 characters\"\n                      value={password}\n                      onChange={(e) => setPassword(e.target.value)}\n                      className=\"pl-10 pr-10\"\n                      data-testid=\"input-password\"\n                      autoFocus\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowPassword(!showPassword)}\n                      className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                      data-testid=\"button-toggle-password\"\n                    >\n                      {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\n                    </button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n                  <div className=\"relative\">\n                    <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                    <Input\n                      id=\"confirmPassword\"\n                      type={showConfirmPassword ? \"text\" : \"password\"}\n                      placeholder=\"Re-enter your password\"\n                      value={confirmPassword}\n                      onChange={(e) => setConfirmPassword(e.target.value)}\n                      className=\"pl-10 pr-10\"\n                      data-testid=\"input-confirm-password\"\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                      className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                      data-testid=\"button-toggle-confirm-password\"\n                    >\n                      {showConfirmPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\n                    </button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2 text-sm text-muted-foreground\">\n                  <div className={`flex items-center gap-2 ${password.length >= 8 ? 'text-green-500' : ''}`}>\n                    <CheckCircle2 className=\"h-4 w-4\" />\n                    At least 8 characters\n                  </div>\n                  <div className={`flex items-center gap-2 ${password === confirmPassword && password ? 'text-green-500' : ''}`}>\n                    <CheckCircle2 className=\"h-4 w-4\" />\n                    Passwords match\n                  </div>\n                </div>\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] hover:opacity-90\"\n                  size=\"lg\"\n                  disabled={loading}\n                  data-testid=\"button-reset-password\"\n                >\n                  {loading ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                      Resetting Password...\n                    </>\n                  ) : (\n                    \"Reset Password\"\n                  )}\n                </Button>\n              </form>\n            </motion.div>\n          )}\n\n          {step === \"success\" && (\n            <motion.div\n              initial={{ opacity: 0, scale: 0.9 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.4 }}\n              className=\"text-center py-8\"\n            >\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n                className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-green-400 to-green-600 mb-6\"\n              >\n                <CheckCircle2 className=\"h-10 w-10 text-white\" />\n              </motion.div>\n              <h1 className=\"text-3xl font-bold mb-2\">Password Reset!</h1>\n              <p className=\"text-muted-foreground mb-4\">\n                Your password has been successfully reset\n              </p>\n              <Loader2 className=\"h-6 w-6 animate-spin mx-auto text-[#1677FF]\" />\n            </motion.div>\n          )}\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":16243},"client/src/pages/create-account.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { motion } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { ArrowLeft, Mail, CheckCircle2, Loader2, User, Calendar, ChevronLeft, Delete } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useWallet } from \"@/contexts/wallet-context\";\n\nexport default function CreateAccount() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { setWallet } = useWallet();\n  const [step, setStep] = useState<\"personal\" | \"verification\" | \"pin\" | \"confirm\" | \"success\">(\"personal\");\n  const [email, setEmail] = useState(\"\");\n  const [firstName, setFirstName] = useState(\"\");\n  const [lastName, setLastName] = useState(\"\");\n  const [dateOfBirth, setDateOfBirth] = useState(\"\");\n  const [verificationCode, setVerificationCode] = useState<string[]>([\"\", \"\", \"\", \"\", \"\", \"\"]);\n  const [verificationIndex, setVerificationIndex] = useState(0);\n  const [pin, setPin] = useState<string[]>([\"\", \"\", \"\", \"\", \"\", \"\"]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [newPin, setNewPin] = useState<string>(\"\");\n  const [loading, setLoading] = useState(false);\n  const [countdown, setCountdown] = useState(0);\n  const [error, setError] = useState(\"\");\n  const [isShaking, setIsShaking] = useState(false);\n\n  useEffect(() => {\n    if (countdown > 0) {\n      const timer = setTimeout(() => setCountdown(countdown - 1), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [countdown]);\n\n  const handlePersonalInfoSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!email || !email.includes(\"@\")) {\n      toast({\n        title: \"Invalid Email\",\n        description: \"Please enter a valid email address\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!firstName.trim()) {\n      toast({\n        title: \"First Name Required\",\n        description: \"Please enter your first name\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!lastName.trim()) {\n      toast({\n        title: \"Last Name Required\",\n        description: \"Please enter your last name\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!dateOfBirth) {\n      toast({\n        title: \"Date of Birth Required\",\n        description: \"Please enter your date of birth\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const birthDate = new Date(dateOfBirth);\n    const today = new Date();\n    let age = today.getFullYear() - birthDate.getFullYear();\n    const monthDiff = today.getMonth() - birthDate.getMonth();\n    \n    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {\n      age--;\n    }\n    \n    if (age < 18) {\n      toast({\n        title: \"Invalid Age\",\n        description: \"You must be at least 18 years old\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (age > 120) {\n      toast({\n        title: \"Invalid Date\",\n        description: \"Please enter a valid date of birth\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/send-code\", {\n        email,\n        purpose: \"signup\"\n      });\n\n      if (response.ok) {\n        setCountdown(600); // 10 minutes\n        setStep(\"verification\");\n        toast({\n          title: \"Verification Code Sent\",\n          description: \"Please check your email for the 6-digit code\",\n        });\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Failed to Send Code\",\n          description: errorData.error || \"Please try again\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to send verification code\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleVerificationNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (verificationIndex < 6) {\n      const updatedCode = [...verificationCode];\n      updatedCode[verificationIndex] = num;\n      setVerificationCode(updatedCode);\n      setVerificationIndex(verificationIndex + 1);\n\n      if (verificationIndex === 5) {\n        const enteredCode = updatedCode.join(\"\");\n        \n        setTimeout(async () => {\n          setLoading(true);\n          setError(\"\");\n          \n          try {\n            const response = await apiRequest(\"POST\", \"/api/auth/verify-code\", {\n              email,\n              code: enteredCode,\n              purpose: \"signup\"\n            });\n\n            if (response.ok) {\n              setStep(\"pin\");\n              setLoading(false);\n            } else {\n              const errorData = await response.json();\n              // Trigger shake animation\n              setIsShaking(true);\n              setTimeout(() => setIsShaking(false), 600);\n              \n              setError(errorData.error || \"Invalid verification code\");\n              setTimeout(() => {\n                setVerificationCode([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                setVerificationIndex(0);\n                setError(\"\");\n              }, 1500);\n              setLoading(false);\n            }\n          } catch (error: any) {\n            // Trigger shake animation\n            setIsShaking(true);\n            setTimeout(() => setIsShaking(false), 600);\n            \n            setError(error?.message || \"Verification failed\");\n            setTimeout(() => {\n              setVerificationCode([\"\", \"\", \"\", \"\", \"\", \"\"]);\n              setVerificationIndex(0);\n              setError(\"\");\n            }, 1500);\n            setLoading(false);\n          }\n        }, 300);\n      }\n    }\n  };\n\n  const handleVerificationDelete = () => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (verificationIndex > 0) {\n      const updatedCode = [...verificationCode];\n      updatedCode[verificationIndex - 1] = \"\";\n      setVerificationCode(updatedCode);\n      setVerificationIndex(verificationIndex - 1);\n    }\n  };\n\n  const handleResendCode = async () => {\n    setLoading(true);\n    \n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/send-code\", {\n        email,\n        purpose: \"signup\"\n      });\n\n      if (response.ok) {\n        setCountdown(600);\n        toast({\n          title: \"Code Resent\",\n          description: \"A new verification code has been sent to your email\",\n        });\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Failed to Resend Code\",\n          description: errorData.error || \"Please try again\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to resend code\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handlePinNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex < 6) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex] = num;\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex + 1);\n\n      if (currentIndex === 5) {\n        const enteredPin = updatedPin.join(\"\");\n        setNewPin(enteredPin);\n        \n        setTimeout(() => {\n          setStep(\"confirm\");\n          setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n          setCurrentIndex(0);\n          toast({\n            description: \"Confirm your 6-digit PIN\",\n          });\n        }, 300);\n      }\n    }\n  };\n\n  const handlePinDelete = () => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex > 0) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex - 1] = \"\";\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex - 1);\n    }\n  };\n\n  const handleConfirmNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex < 6) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex] = num;\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex + 1);\n\n      if (currentIndex === 5) {\n        const enteredPin = updatedPin.join(\"\");\n        \n        setTimeout(async () => {\n          if (enteredPin === newPin) {\n            setLoading(true);\n            \n            try {\n              const response = await apiRequest(\"POST\", \"/api/auth/verify-signup\", {\n                email,\n                code: verificationCode.join(\"\"),\n                firstName,\n                lastName,\n                dateOfBirth,\n                pin: newPin,\n              });\n              \n              if (response.ok) {\n                const data = await response.json();\n                \n                if (data.wallet) {\n                  setWallet(data.wallet.id, data.wallet.address);\n                }\n                \n                setStep(\"success\");\n                setTimeout(() => {\n                  window.location.href = \"/dashboard\";\n                }, 2000);\n              } else {\n                const error = await response.json();\n                const errorMessage = error.error || error.message || \"Failed to create account\";\n                \n                toast({\n                  title: \"Signup Failed\",\n                  description: errorMessage,\n                  variant: \"destructive\",\n                });\n                setLoading(false);\n              }\n            } catch (error: any) {\n              const errorMessage = error?.message || \"An error occurred during signup\";\n              toast({\n                title: \"Error\",\n                description: errorMessage,\n                variant: \"destructive\",\n              });\n              setLoading(false);\n            }\n          } else {\n            // Trigger shake animation\n            setIsShaking(true);\n            setTimeout(() => setIsShaking(false), 600);\n            \n            setError(\"PINs don't match\");\n            setTimeout(() => {\n              setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n              setCurrentIndex(0);\n              setError(\"\");\n            }, 1500);\n          }\n        }, 300);\n      }\n    }\n  };\n\n  const handleDelete = () => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex > 0) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex - 1] = \"\";\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex - 1);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 relative overflow-hidden\">\n      <div className=\"absolute inset-0 bg-gradient-to-br from-[#1677FF]/10 via-background to-[#2ED8FF]/10\" />\n      <motion.div \n        className=\"absolute top-20 right-0 w-[600px] h-[600px] bg-[#1677FF]/10 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.2, 1],\n          opacity: [0.3, 0.5, 0.3],\n        }}\n        transition={{\n          duration: 8,\n          repeat: Infinity,\n          ease: \"easeInOut\"\n        }}\n      />\n      <motion.div \n        className=\"absolute bottom-0 left-0 w-[500px] h-[500px] bg-[#2ED8FF]/10 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.3, 1],\n          opacity: [0.3, 0.5, 0.3],\n        }}\n        transition={{\n          duration: 10,\n          repeat: Infinity,\n          ease: \"easeInOut\",\n          delay: 1\n        }}\n      />\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6 }}\n        className=\"w-full max-w-md relative z-10\"\n      >\n        {step === \"personal\" && (\n          <div className=\"bg-card/50 backdrop-blur-xl rounded-3xl border border-border/50 shadow-2xl p-8\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation(\"/\")}\n              className=\"mb-6\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back\n            </Button>\n\n            <motion.div\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ duration: 0.4 }}\n            >\n              <h1 className=\"text-3xl font-bold text-center mb-2\">Create Account</h1>\n              <p className=\"text-muted-foreground text-center mb-8\">\n                Start your secure crypto journey\n              </p>\n\n              <form onSubmit={handlePersonalInfoSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">Email Address</Label>\n                  <div className=\"relative\">\n                    <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      placeholder=\"you@example.com\"\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      className=\"pl-10\"\n                      data-testid=\"input-email\"\n                      autoFocus\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"firstName\">First Name</Label>\n                    <div className=\"relative\">\n                      <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                      <Input\n                        id=\"firstName\"\n                        type=\"text\"\n                        placeholder=\"John\"\n                        value={firstName}\n                        onChange={(e) => setFirstName(e.target.value)}\n                        className=\"pl-10\"\n                        data-testid=\"input-firstname\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"lastName\">Last Name</Label>\n                    <div className=\"relative\">\n                      <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                      <Input\n                        id=\"lastName\"\n                        type=\"text\"\n                        placeholder=\"Doe\"\n                        value={lastName}\n                        onChange={(e) => setLastName(e.target.value)}\n                        className=\"pl-10\"\n                        data-testid=\"input-lastname\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"dateOfBirth\">Date of Birth</Label>\n                  <div className=\"relative\">\n                    <Calendar className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                    <Input\n                      id=\"dateOfBirth\"\n                      type=\"date\"\n                      value={dateOfBirth}\n                      onChange={(e) => setDateOfBirth(e.target.value)}\n                      className=\"pl-10\"\n                      data-testid=\"input-dateofbirth\"\n                      max={new Date(new Date().setFullYear(new Date().getFullYear() - 18)).toISOString().split('T')[0]}\n                    />\n                  </div>\n                </div>\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] hover:opacity-90\"\n                  size=\"lg\"\n                  disabled={loading}\n                  data-testid=\"button-continue-personal\"\n                >\n                  {loading ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                      Sending Code...\n                    </>\n                  ) : (\n                    \"Continue\"\n                  )}\n                </Button>\n              </form>\n\n              <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n                Already have an account?{\" \"}\n                <button\n                  onClick={() => setLocation(\"/login\")}\n                  className=\"text-[#1677FF] hover:underline font-medium\"\n                  data-testid=\"link-login\"\n                >\n                  Login\n                </button>\n              </div>\n            </motion.div>\n          </div>\n        )}\n\n        {step === \"verification\" && (\n          <div className=\"fixed inset-0 bg-background z-50\">\n            <div className=\"min-h-screen flex flex-col\">\n              <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    data-testid=\"button-back-to-personal\"\n                    className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n                    onClick={() => {\n                      setStep(\"personal\");\n                      setVerificationCode([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                      setVerificationIndex(0);\n                    }}\n                  >\n                    <ChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">Enter Verification Code</h1>\n                <div className=\"w-9\"></div>\n              </header>\n\n              <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n                <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n                  <h2 className=\"text-xl mb-8 text-center\" data-testid=\"text-verification-prompt\">\n                    Enter the 6-digit code sent to {email}\n                  </h2>\n                  \n                  <div \n                    className={`flex gap-3 mb-4 ${isShaking ? 'animate-shake' : ''}`} \n                    data-testid=\"container-verification-inputs\"\n                  >\n                    {verificationCode.map((digit, index) => (\n                      <div\n                        key={index}\n                        data-testid={`verification-code-box-${index}`}\n                        className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl transition-colors ${\n                          isShaking && digit\n                            ? \"border-red-500 bg-red-500/10\"\n                            : digit \n                            ? \"border-primary\" \n                            : \"border-muted-foreground/30\"\n                        }`}\n                      >\n                        {digit && \"\"}\n                      </div>\n                    ))}\n                  </div>\n\n                  {error && (\n                    <p className=\"text-red-500 text-sm mb-4\" data-testid=\"text-verification-error\">\n                      {error}\n                    </p>\n                  )}\n\n                  <div className=\"text-center mb-12\">\n                    <button\n                      type=\"button\"\n                      onClick={handleResendCode}\n                      disabled={countdown > 0 || loading}\n                      className=\"text-sm text-[#1677FF] hover:underline disabled:opacity-50 disabled:cursor-not-allowed\"\n                      data-testid=\"button-resend-code\"\n                    >\n                      {countdown > 0\n                        ? `Resend code in ${Math.floor(countdown / 60)}:${String(countdown % 60).padStart(2, '0')}`\n                        : \"Resend Code\"}\n                    </button>\n                  </div>\n                </div>\n\n                <div className=\"w-full max-w-xs\">\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                      <button\n                        key={num}\n                        data-testid={`button-verify-${num}`}\n                        onClick={() => handleVerificationNumberClick(num.toString())}\n                        className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                      >\n                        {num}\n                      </button>\n                    ))}\n                    <div className=\"h-16\"></div>\n                    <button\n                      data-testid=\"button-verify-0\"\n                      onClick={() => handleVerificationNumberClick(\"0\")}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                    >\n                      0\n                    </button>\n                    <button\n                      data-testid=\"button-verify-delete\"\n                      onClick={handleVerificationDelete}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n                    >\n                      <Delete className=\"w-6 h-6\" />\n                    </button>\n                  </div>\n                </div>\n              </main>\n            </div>\n          </div>\n        )}\n\n        {step === \"pin\" && (\n          <div className=\"fixed inset-0 bg-background z-50\">\n            <div className=\"min-h-screen flex flex-col\">\n              <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    data-testid=\"button-back-to-verification\"\n                    className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n                    onClick={() => {\n                      setStep(\"verification\");\n                      setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                      setCurrentIndex(0);\n                      setError(\"\");\n                      setIsShaking(false);\n                    }}\n                  >\n                    <ChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">Create PIN</h1>\n                <div className=\"w-9\"></div>\n              </header>\n\n              <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n                <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n                  <h2 className=\"text-xl mb-8 text-center\" data-testid=\"text-pin-prompt\">\n                    Enter your 6-digit PIN\n                  </h2>\n                  \n                  <div \n                    className={`flex gap-3 mb-4 ${isShaking ? 'animate-shake' : ''}`} \n                    data-testid=\"container-pin-inputs\"\n                  >\n                    {pin.map((digit, index) => (\n                      <div\n                        key={index}\n                        data-testid={`pin-box-${index}`}\n                        className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl transition-colors ${\n                          isShaking && digit\n                            ? \"border-red-500 bg-red-500/10\"\n                            : digit \n                            ? \"border-primary\" \n                            : \"border-muted-foreground/30\"\n                        }`}\n                      >\n                        {digit && \"\"}\n                      </div>\n                    ))}\n                  </div>\n\n                  {error && (\n                    <p className=\"text-red-500 text-sm mb-12\" data-testid=\"text-error-message\">\n                      {error}\n                    </p>\n                  )}\n                  {!error && <div className=\"mb-12\"></div>}\n                </div>\n\n                <div className=\"w-full max-w-xs\">\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                      <button\n                        key={num}\n                        data-testid={`button-num-${num}`}\n                        onClick={() => handlePinNumberClick(num.toString())}\n                        className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                      >\n                        {num}\n                      </button>\n                    ))}\n                    <div className=\"h-16\"></div>\n                    <button\n                      data-testid=\"button-num-0\"\n                      onClick={() => handlePinNumberClick(\"0\")}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                    >\n                      0\n                    </button>\n                    <button\n                      data-testid=\"button-delete\"\n                      onClick={handlePinDelete}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n                    >\n                      <Delete className=\"w-6 h-6\" />\n                    </button>\n                  </div>\n                </div>\n              </main>\n            </div>\n          </div>\n        )}\n\n        {step === \"confirm\" && (\n          <div className=\"fixed inset-0 bg-background z-50\">\n            <div className=\"min-h-screen flex flex-col\">\n              <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    data-testid=\"button-back-to-pin\"\n                    className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n                    onClick={() => {\n                      setStep(\"pin\");\n                      setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                      setCurrentIndex(0);\n                      setError(\"\");\n                      setIsShaking(false);\n                    }}\n                  >\n                    <ChevronLeft className=\"w-5 h-5\" />\n                  </button>\n                </div>\n                <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">Confirm PIN</h1>\n                <div className=\"w-9\"></div>\n              </header>\n\n              <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n                <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n                  <h2 className=\"text-xl mb-8 text-center\" data-testid=\"text-confirm-pin-prompt\">\n                    Confirm your 6-digit PIN\n                  </h2>\n                  \n                  <div \n                    className={`flex gap-3 mb-4 ${isShaking ? 'animate-shake' : ''}`} \n                    data-testid=\"container-confirm-pin-inputs\"\n                  >\n                    {pin.map((digit, index) => (\n                      <div\n                        key={index}\n                        data-testid={`confirm-pin-box-${index}`}\n                        className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl transition-colors ${\n                          isShaking && digit\n                            ? \"border-red-500 bg-red-500/10\"\n                            : digit \n                            ? \"border-primary\" \n                            : \"border-muted-foreground/30\"\n                        }`}\n                      >\n                        {digit && \"\"}\n                      </div>\n                    ))}\n                  </div>\n\n                  {error && (\n                    <p className=\"text-red-500 text-sm mb-12\" data-testid=\"text-confirm-error-message\">\n                      {error}\n                    </p>\n                  )}\n                  {!error && <div className=\"mb-12\"></div>}\n                </div>\n\n                <div className=\"w-full max-w-xs\">\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n                      <button\n                        key={num}\n                        data-testid={`button-confirm-num-${num}`}\n                        onClick={() => handleConfirmNumberClick(num.toString())}\n                        className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                      >\n                        {num}\n                      </button>\n                    ))}\n                    <div className=\"h-16\"></div>\n                    <button\n                      data-testid=\"button-confirm-num-0\"\n                      onClick={() => handleConfirmNumberClick(\"0\")}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n                    >\n                      0\n                    </button>\n                    <button\n                      data-testid=\"button-confirm-delete\"\n                      onClick={handleDelete}\n                      className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n                    >\n                      <Delete className=\"w-6 h-6\" />\n                    </button>\n                  </div>\n                </div>\n              </main>\n            </div>\n          </div>\n        )}\n\n        {step === \"success\" && (\n          <div className=\"bg-card/50 backdrop-blur-xl rounded-3xl border border-border/50 shadow-2xl p-8\">\n            <motion.div\n              initial={{ opacity: 0, scale: 0.9 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.4 }}\n              className=\"text-center py-8\"\n            >\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n                className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-green-400 to-green-600 mb-6\"\n              >\n                <CheckCircle2 className=\"h-10 w-10 text-white\" />\n              </motion.div>\n              <h1 className=\"text-3xl font-bold mb-2\">Account Created!</h1>\n              <p className=\"text-muted-foreground mb-4\">\n                Redirecting you to wallet setup...\n              </p>\n              <Loader2 className=\"h-6 w-6 animate-spin mx-auto text-[#1677FF]\" />\n            </motion.div>\n          </div>\n        )}\n\n        <p className=\"text-center text-sm text-muted-foreground mt-6\">\n          By creating an account, you agree to our Terms of Service and Privacy Policy\n        </p>\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":31406},"client/src/pages/profile.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { ArrowLeft, ChevronRight, Copy, Check } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { DefaultAvatar } from \"@/components/default-avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { User } from \"@shared/schema\";\n\ninterface WalletData {\n  id: string;\n  address: string;\n  name: string;\n}\n\nexport default function Profile() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading: isAuthLoading } = useWallet();\n  const [copiedAddress, setCopiedAddress] = useState(false);\n\n  useEffect(() => {\n    if (!isAuthLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthLoading, isAuthenticated, setLocation]);\n\n  const { data: user, isLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const { data: wallets, isLoading: isWalletsLoading } = useQuery<WalletData[]>({\n    queryKey: [\"/api/wallets\"],\n    enabled: isAuthenticated,\n  });\n\n  const handleCopyAddress = () => {\n    const wallet = wallets?.[0];\n    if (wallet?.address) {\n      navigator.clipboard.writeText(wallet.address);\n      setCopiedAddress(true);\n      toast({\n        title: \"Copied!\",\n        description: \"Wallet address copied to clipboard\",\n      });\n      setTimeout(() => setCopiedAddress(false), 2000);\n    }\n  };\n\n  const menuItems = [\n    {\n      label: \"View profile\",\n      path: \"/profile/view-details\",\n      testId: \"button-view-profile\",\n    },\n    {\n      label: \"Connected dapps\",\n      path: \"/profile/connected-dapps\",\n      testId: \"button-connected-dapps\",\n    },\n  ];\n\n  if (isLoading || isWalletsLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  const displayName = `${user.firstName}${user.lastName}`;\n  const initials = `${user.firstName[0]}${user.lastName[0]}`.toUpperCase();\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <div className=\"border-b border-border\">\n        <div className=\"container max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between py-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 hover-elevate\"\n              onClick={() => setLocation(\"/dashboard\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Profile Header */}\n      <div className=\"container max-w-2xl mx-auto px-4 py-8\">\n        <div className=\"flex items-center gap-4 mb-6\">\n          <DefaultAvatar\n            profilePhoto={user.profilePhoto}\n            firstName={user.firstName}\n            lastName={user.lastName}\n            size=\"xl\"\n          />\n          <div className=\"flex-1\">\n            <h2 className=\"text-xl font-semibold\" data-testid=\"text-username\">\n              {displayName}\n            </h2>\n            <p className=\"text-sm text-muted-foreground\" data-testid=\"text-email\">\n              {user.email}\n            </p>\n          </div>\n        </div>\n\n        {/* Wallet ID Card */}\n        {wallets && wallets.length > 0 && (\n          <Card className=\"mb-6\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-xs font-medium text-muted-foreground mb-1\">\n                    Wallet Address\n                  </p>\n                  <p\n                    className=\"text-sm font-mono truncate\"\n                    data-testid=\"text-wallet-address\"\n                  >\n                    {wallets[0].address}\n                  </p>\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"ml-2 flex-shrink-0 transition-all duration-200\"\n                  onClick={handleCopyAddress}\n                  data-testid=\"button-copy-address\"\n                >\n                  {copiedAddress ? (\n                    <Check className=\"h-4 w-4 text-green-500 animate-in zoom-in-50 duration-200\" />\n                  ) : (\n                    <Copy className=\"h-4 w-4 transition-transform hover:scale-110\" />\n                  )}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Edit Profile Button */}\n        <Button\n          className=\"w-full mb-6\"\n          onClick={() => setLocation(\"/profile/edit\")}\n          data-testid=\"button-edit-profile\"\n        >\n          Edit profile\n        </Button>\n\n        {/* Menu Items */}\n        <div className=\"space-y-0\">\n          {menuItems.map((item, index) => (\n            <button\n              key={item.path}\n              onClick={() => setLocation(item.path)}\n              className={`w-full flex items-center justify-between p-4 text-left hover-elevate active-elevate-2 transition-colors ${\n                index !== menuItems.length - 1 ? \"border-b border-border\" : \"\"\n              }`}\n              data-testid={item.testId}\n            >\n              <span className=\"text-base\">{item.label}</span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </button>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5795},"client/src/pages/contact.tsx":{"content":"import { ChevronLeft, Mail, MessageCircle, Send } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { useForm } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nconst contactSchema = z.object({\n  name: z.string().min(2, \"Name must be at least 2 characters\"),\n  email: z.string().email(\"Invalid email address\"),\n  subject: z.string().min(5, \"Subject must be at least 5 characters\"),\n  message: z.string().min(10, \"Message must be at least 10 characters\"),\n});\n\ntype ContactForm = z.infer<typeof contactSchema>;\n\nexport default function Contact() {\n  const { toast } = useToast();\n\n  // Fetch WhatsApp number from settings\n  const { data: whatsappSettings } = useQuery({\n    queryKey: [\"/api/settings\", \"whatsappNumber\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/settings/whatsappNumber\");\n      if (!response.ok) throw new Error(\"Failed to fetch WhatsApp number\");\n      return response.json();\n    },\n  });\n\n  const whatsappNumber = whatsappSettings?.value || \"+447426417715\";\n  const whatsappLink = `https://wa.me/${whatsappNumber.replace(/\\D/g, \"\")}`;\n\n  const form = useForm<ContactForm>({\n    resolver: zodResolver(contactSchema),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      subject: \"\",\n      message: \"\",\n    },\n  });\n\n  const contactMutation = useMutation({\n    mutationFn: async (data: ContactForm) => {\n      return apiRequest(\"POST\", \"/api/contact\", data);\n    },\n    onSuccess: (response: any) => {\n      toast({\n        title: \"Message sent!\",\n        description: response.message || \"We'll get back to you as soon as possible.\",\n      });\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to send message. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ContactForm) => {\n    contactMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b border-border/50\">\n        <div className=\"container mx-auto px-4 h-16 flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => window.history.back()}\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold\">Contact Support</h1>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-12 max-w-4xl\">\n        <div className=\"grid md:grid-cols-2 gap-12\">\n          <div>\n            <h2 className=\"text-3xl font-bold mb-4\">Get in Touch</h2>\n            <p className=\"text-muted-foreground mb-8\">\n              Have a question or need help? Our support team is here for you. Send us a message and we'll respond as quickly as possible.\n            </p>\n\n            <div className=\"space-y-6\">\n              <div className=\"flex gap-4 items-start\">\n                <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0\">\n                  <Mail className=\"h-6 w-6 text-white\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold mb-1\">Email Support</h3>\n                  <a \n                    href=\"mailto:support@lumirrawallet.com\" \n                    className=\"text-sm text-primary hover:underline\"\n                    data-testid=\"link-email\"\n                  >\n                    support@lumirrawallet.com\n                  </a>\n                  <p className=\"text-xs text-muted-foreground mt-1\">We typically respond within 24 hours</p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 items-start\">\n                <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0\">\n                  <MessageCircle className=\"h-6 w-6 text-white\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold mb-1\">WhatsApp Support</h3>\n                  <a \n                    href={whatsappLink} \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className=\"text-sm text-primary hover:underline\"\n                    data-testid=\"link-whatsapp\"\n                  >\n                    {whatsappNumber}\n                  </a>\n                  <p className=\"text-xs text-muted-foreground mt-1\">Get instant help via WhatsApp</p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"mt-8 p-6 rounded-lg bg-muted/50\">\n              <h3 className=\"font-semibold mb-2\">Quick Tips</h3>\n              <ul className=\"text-sm text-muted-foreground space-y-2\">\n                <li> Check our FAQ page for common questions</li>\n                <li> Include your wallet address for faster support</li>\n                <li> Never share your password or private keys</li>\n              </ul>\n            </div>\n          </div>\n\n          <div>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Name</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Your name\"\n                          {...field}\n                          data-testid=\"input-name\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          placeholder=\"your@email.com\"\n                          {...field}\n                          data-testid=\"input-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"subject\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Subject</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"How can we help?\"\n                          {...field}\n                          data-testid=\"input-subject\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"message\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Message</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Tell us more about your question...\"\n                          className=\"min-h-[150px] resize-none\"\n                          {...field}\n                          data-testid=\"textarea-message\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button\n                  type=\"submit\"\n                  className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF]\"\n                  disabled={contactMutation.isPending}\n                  data-testid=\"button-submit\"\n                >\n                  <Send className=\"h-4 w-4 mr-2\" />\n                  {contactMutation.isPending ? \"Sending...\" : \"Send Message\"}\n                </Button>\n              </form>\n            </Form>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8858},"client/src/pages/faq.tsx":{"content":"import { ChevronLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\n\nexport default function FAQ() {\n  const [, setLocation] = useLocation();\n\n  const faqCategories = [\n    {\n      category: \"Getting Started\",\n      questions: [\n        {\n          question: \"What is Lumirra and how does it work?\",\n          answer: \"Lumirra is a self-custody, multi-chain cryptocurrency wallet that supports Ethereum, BNB Smart Chain, TRON, and Solana. Unlike centralized exchanges, you maintain full control of your private keys and assets. The wallet provides a unified interface to manage tokens across multiple blockchains, execute swaps, send/receive crypto, and buy digital assets with fiat currency.\"\n        },\n        {\n          question: \"How do I create a wallet?\",\n          answer: \"Creating a wallet takes less than 2 minutes. Click 'Create Account' on the homepage, enter your email address, create a strong password (minimum 8 characters), and you're done. Your wallet is automatically generated with support for all four supported blockchains. You'll have immediate access to your dashboard where you can start managing your crypto assets.\"\n        },\n        {\n          question: \"What's the difference between Lumirra and a crypto exchange?\",\n          answer: \"Crypto exchanges are custodial platforms where the exchange controls your private keys and assets. With Lumirra, you maintain full ownership and control. Your private keys never leave your device, and only you can access your funds. Additionally, Lumirra provides direct access to decentralized finance (DeFi) features like token swaps without needing to create exchange accounts or go through lengthy verification processes for basic operations.\"\n        }\n      ]\n    },\n    {\n      category: \"Security & Safety\",\n      questions: [\n        {\n          question: \"How secure is Lumirra?\",\n          answer: \"Lumirra implements military-grade AES-256 encryption for all sensitive data. Your private keys are encrypted with your password and stored securely on your devicewe never have access to them. The wallet uses industry-standard cryptographic libraries and follows best practices for key derivation (BIP-39/BIP-44). Additionally, all connections use HTTPS/TLS encryption, and we never store unencrypted private keys or seed phrases on our servers.\"\n        },\n        {\n          question: \"What if I forget my password?\",\n          answer: \"You can reset your password using the 'Forgot Password' link on the login page. You'll receive a verification code via email to confirm your identity before creating a new password. However, it's critical to understand that while you can reset your password, you cannot recover it if you lose access to your registered email. Always keep your email account secure and consider enabling two-factor authentication on your email provider.\"\n        },\n        {\n          question: \"Can Lumirra access my funds?\",\n          answer: \"No. Lumirra is a non-custodial wallet, meaning you have complete control over your private keys and funds. We never have access to your assets, cannot move your funds, or freeze your account. This is fundamentally different from custodial services where the company holds your keys. With Lumirra, you are the only person who can authorize transactions.\"\n        },\n        {\n          question: \"What should I do if I suspect unauthorized access?\",\n          answer: \"If you suspect unauthorized access to your wallet, immediately transfer your assets to a new wallet with a different password. Change your email password if you believe it's been compromised. Review your transaction history for any suspicious activity. For security concerns, contact our support team immediately at support@lumirra.com with details about the incident.\"\n        }\n      ]\n    },\n    {\n      category: \"Supported Networks\",\n      questions: [\n        {\n          question: \"Which blockchains does Lumirra support?\",\n          answer: \"Lumirra currently supports four major blockchain networks: Ethereum (including all ERC-20 tokens), BNB Smart Chain (BEP-20 tokens), TRON (TRC-20 tokens), and Solana (SPL tokens). Each network has its own ecosystem of tokens and DeFi applications that you can access directly through your Lumirra wallet.\"\n        },\n        {\n          question: \"Can I send Bitcoin or other networks?\",\n          answer: \"Currently, Lumirra supports Ethereum, BNB Smart Chain, TRON, and Solana networks. Bitcoin, Litecoin, and other networks are not yet supported but are on our development roadmap. We're continuously working to add support for additional blockchains based on user demand and market trends.\"\n        },\n        {\n          question: \"Why does my address look different on each network?\",\n          answer: \"Each blockchain network uses different address formats for security and network identification purposes. Ethereum and BNB addresses start with '0x', TRON addresses start with 'T', and Solana addresses use a different alphanumeric format. This is intentionalsending tokens to an address on the wrong network can result in permanent loss of funds. Always verify you're using the correct network before sending crypto.\"\n        }\n      ]\n    },\n    {\n      category: \"Transactions & Fees\",\n      questions: [\n        {\n          question: \"What are network fees and why do I have to pay them?\",\n          answer: \"Network fees (also called gas fees) are payments to blockchain validators/miners who process and confirm your transactions. These fees are not collected by Lumirrathey go directly to the network. Fee amounts vary based on network congestion: Ethereum typically has higher fees than BNB Smart Chain, TRON, or Solana. During peak usage times, fees can increase significantly. The wallet displays estimated fees before you confirm any transaction.\"\n        },\n        {\n          question: \"How long do transactions take?\",\n          answer: \"Transaction speed varies by blockchain: Solana transactions typically confirm in 1-2 seconds, TRON in 3-5 seconds, BNB Smart Chain in 3-5 seconds, and Ethereum in 15 seconds to several minutes (depending on gas fees paid and network congestion). Once submitted, transactions cannot be canceledthey must be confirmed by the network.\"\n        },\n        {\n          question: \"What happens if I send crypto to the wrong address?\",\n          answer: \"Cryptocurrency transactions are irreversible. If you send tokens to an incorrect address, they cannot be recovered. This is a fundamental characteristic of blockchain technology, not a limitation of Lumirra. Always double-check recipient addresses before confirming transactions. For extra safety, send a small test amount first for large transfers.\"\n        },\n        {\n          question: \"Why did my swap fail but I still paid fees?\",\n          answer: \"When a swap transaction fails (due to slippage exceeding your tolerance, insufficient liquidity, or other smart contract issues), the network still charges fees because validators processed your transaction attempt. To minimize failed swaps, increase your slippage tolerance for volatile tokens, ensure you have sufficient balance for gas fees, and avoid trading during extreme market volatility.\"\n        }\n      ]\n    },\n    {\n      category: \"Features & Usage\",\n      questions: [\n        {\n          question: \"How do I buy cryptocurrency with a credit card?\",\n          answer: \"Navigate to 'Buy/Sell' from your wallet dashboard, select the cryptocurrency you want to purchase, enter the amount in your local currency, and choose your payment method. Lumirra partners with MoonPay to process fiat payments securely. You'll need to complete identity verification for purchases over certain amounts (typically $500) to comply with financial regulations. Crypto is delivered directly to your Lumirra wallet within minutes.\"\n        },\n        {\n          question: \"What is token swapping and how does it work?\",\n          answer: \"Token swapping lets you exchange one cryptocurrency for another directly within your wallet using decentralized exchange (DEX) protocols. Lumirra aggregates rates from multiple liquidity sources to ensure you get competitive pricing. When you swap, smart contracts on the blockchain execute the trade automatically. You pay network fees plus small liquidity provider fees (typically 0.1%-0.3% of the trade amount).\"\n        },\n        {\n          question: \"Can I use Lumirra on multiple devices?\",\n          answer: \"Yes. You can access your Lumirra wallet from any device by logging in with your email and password. Your encrypted wallet data syncs across devices, ensuring you have access to your funds wherever you need them. However, for maximum security, avoid logging in on public or shared computers, and always log out when finished.\"\n        }\n      ]\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b border-border/50\">\n        <div className=\"container mx-auto px-4 h-16 flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => window.history.back()}\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold\">FAQ</h1>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-12 max-w-4xl\">\n        <div className=\"mb-12 text-center\">\n          <h2 className=\"text-4xl font-bold mb-4\">Frequently Asked Questions</h2>\n          <p className=\"text-lg text-muted-foreground\">\n            Everything you need to know about using Lumirra wallet\n          </p>\n        </div>\n\n        <div className=\"space-y-8\">\n          {faqCategories.map((category, categoryIndex) => (\n            <div key={categoryIndex}>\n              <h3 className=\"text-2xl font-bold mb-4 text-[#1677FF]\">{category.category}</h3>\n              <Accordion type=\"single\" collapsible className=\"space-y-3\">\n                {category.questions.map((faq, index) => (\n                  <AccordionItem\n                    key={index}\n                    value={`item-${categoryIndex}-${index}`}\n                    className=\"border border-border rounded-lg px-6 py-2 bg-card\"\n                    data-testid={`faq-item-${categoryIndex}-${index}`}\n                  >\n                    <AccordionTrigger className=\"text-left font-semibold hover:no-underline\">\n                      {faq.question}\n                    </AccordionTrigger>\n                    <AccordionContent className=\"text-muted-foreground leading-relaxed pt-2\">\n                      {faq.answer}\n                    </AccordionContent>\n                  </AccordionItem>\n                ))}\n              </Accordion>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"mt-16 p-8 rounded-2xl bg-gradient-to-br from-[#1677FF]/10 to-[#2ED8FF]/10 border border-[#1677FF]/20 text-center\">\n          <h3 className=\"text-2xl font-bold mb-3\">Still Need Help?</h3>\n          <p className=\"text-muted-foreground mb-6 text-lg\">\n            Our support team is available 24/7 to assist you with any questions or concerns\n          </p>\n          <Button\n            onClick={() => setLocation(\"/contact\")}\n            size=\"lg\"\n            className=\"bg-gradient-to-r from-[#1677FF] to-[#2ED8FF]\"\n            data-testid=\"button-contact-support\"\n          >\n            Contact Support\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":11763},"client/src/pages/swaps-info.tsx":{"content":"import { ChevronLeft, RefreshCw, Shield, Zap, TrendingUp, ArrowDownUp, Clock, DollarSign } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\nimport swapMockup from \"@assets/image_1761911686745.png\";\n\nexport default function SwapsInfo() {\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b border-border/50\">\n        <div className=\"container mx-auto px-4 h-16 flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => window.history.back()}\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold\">Token Swaps</h1>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-12 max-w-6xl\">\n        <div className=\"grid lg:grid-cols-2 gap-12 items-center mb-16\">\n          <div>\n            <h2 className=\"text-4xl md:text-5xl font-bold mb-6 leading-tight\">\n              Swap Tokens at the Best Rates\n            </h2>\n            <p className=\"text-xl text-muted-foreground mb-8 leading-relaxed\">\n              Trade cryptocurrencies seamlessly with access to deep liquidity pools and competitive pricing from leading decentralized exchanges.\n            </p>\n            <Button\n              onClick={() => setLocation(\"/dashboard\")}\n              size=\"lg\"\n              className=\"bg-gradient-to-r from-[#1677FF] to-[#2ED8FF]\"\n              data-testid=\"button-start-swapping\"\n            >\n              Start Swapping\n            </Button>\n          </div>\n          <div className=\"flex justify-center\">\n            <img \n              src={swapMockup} \n              alt=\"Swap Interface\" \n              className=\"max-w-full h-auto rounded-2xl shadow-2xl border border-border\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6 mb-16\">\n          <div className=\"p-6 rounded-xl bg-card border border-border\">\n            <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n              <TrendingUp className=\"h-6 w-6 text-white\" />\n            </div>\n            <h3 className=\"font-semibold text-lg mb-2\">Best Market Prices</h3>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\">\n              Aggregated rates from multiple liquidity sources ensure you always get the most competitive prices for your trades.\n            </p>\n          </div>\n\n          <div className=\"p-6 rounded-xl bg-card border border-border\">\n            <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n              <Zap className=\"h-6 w-6 text-white\" />\n            </div>\n            <h3 className=\"font-semibold text-lg mb-2\">Instant Execution</h3>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\">\n              Swaps execute in seconds with optimized smart contract interactions, minimizing wait times and maximizing efficiency.\n            </p>\n          </div>\n\n          <div className=\"p-6 rounded-xl bg-card border border-border\">\n            <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n              <Shield className=\"h-6 w-6 text-white\" />\n            </div>\n            <h3 className=\"font-semibold text-lg mb-2\">Self-Custody</h3>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\">\n              Your assets never leave your wallet during swaps. Non-custodial architecture means you maintain full control at all times.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"space-y-12\">\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">How Swaps Work</h3>\n            <div className=\"prose dark:prose-invert max-w-none\">\n              <p className=\"text-muted-foreground text-lg leading-relaxed mb-4\">\n                Lumirra connects to decentralized exchange (DEX) protocols to enable peer-to-peer token exchanges without intermediaries. When you swap tokens, smart contracts automatically match your trade with available liquidity pools, executing the exchange at current market rates.\n              </p>\n              <p className=\"text-muted-foreground text-lg leading-relaxed\">\n                Our aggregation technology scans multiple DEX protocols simultaneously to find optimal pricing and routing for your trade, ensuring you receive the maximum output for your input tokens.\n              </p>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Supported Networks</h3>\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border\">\n                <h4 className=\"font-semibold mb-2\">Ethereum (ERC-20)</h4>\n                <p className=\"text-sm text-muted-foreground\">Access to Uniswap, SushiSwap, and other leading Ethereum DEXs</p>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border\">\n                <h4 className=\"font-semibold mb-2\">BNB Smart Chain (BEP-20)</h4>\n                <p className=\"text-sm text-muted-foreground\">Trade on PancakeSwap and BSC's vibrant DeFi ecosystem</p>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border\">\n                <h4 className=\"font-semibold mb-2\">TRON (TRC-20)</h4>\n                <p className=\"text-sm text-muted-foreground\">Fast, low-cost swaps through TRON's network protocols</p>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border\">\n                <h4 className=\"font-semibold mb-2\">Solana (SPL)</h4>\n                <p className=\"text-sm text-muted-foreground\">Lightning-fast trades on Raydium, Orca, and Jupiter</p>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Key Features</h3>\n            <div className=\"space-y-4\">\n              <div className=\"flex gap-4 items-start p-5 rounded-lg bg-muted/30\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <ArrowDownUp className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Price Aggregation</h4>\n                  <p className=\"text-sm text-muted-foreground\">Compare real-time rates from multiple DEXs to ensure optimal pricing for every swap.</p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 items-start p-5 rounded-lg bg-muted/30\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <DollarSign className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Slippage Protection</h4>\n                  <p className=\"text-sm text-muted-foreground\">Set custom slippage tolerance (1%-5%) to control acceptable price variations during trade execution.</p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 items-start p-5 rounded-lg bg-muted/30\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Clock className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Transaction Preview</h4>\n                  <p className=\"text-sm text-muted-foreground\">Review exchange rates, network fees, and estimated output before confirming any transaction.</p>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Understanding Swap Costs</h3>\n            <div className=\"p-6 rounded-xl bg-gradient-to-br from-muted/50 to-muted/30 border border-border space-y-4\">\n              <div>\n                <h4 className=\"font-semibold mb-2\">Network Fees (Gas)</h4>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Each blockchain charges transaction fees to process swaps. These fees vary based on network congestion and transaction complexity. Ethereum typically has higher fees than BNB Chain, TRON, or Solana.\n                </p>\n              </div>\n              <div>\n                <h4 className=\"font-semibold mb-2\">Liquidity Provider Fees</h4>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  DEX protocols charge small fees (typically 0.1%-0.3%) that go to liquidity providers. These fees are built into the exchange rate you see.\n                </p>\n              </div>\n              <div>\n                <h4 className=\"font-semibold mb-2\">Slippage</h4>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Price changes can occur between transaction submission and confirmation. Your slippage tolerance setting determines the maximum acceptable price difference.\n                </p>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">How to Swap</h3>\n            <div className=\"space-y-3\">\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  1\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Select the token you want to trade from (Pay section)</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  2\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Choose the token you want to receive (Receive section)</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  3\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Enter the amount you wish to swap</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  4\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Review the exchange rate, fees, and expected output</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  5\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Adjust slippage tolerance if needed (default: 3%)</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  6\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Confirm the swap and wait for blockchain confirmation</p>\n              </div>\n            </div>\n          </section>\n        </div>\n\n        <div className=\"mt-16 p-8 rounded-2xl bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] text-white text-center\">\n          <h3 className=\"text-3xl font-bold mb-3\">Ready to Swap?</h3>\n          <p className=\"text-lg mb-6 opacity-90\">\n            Access decentralized exchange liquidity directly from your wallet\n          </p>\n          <Button\n            onClick={() => setLocation(\"/dashboard\")}\n            size=\"lg\"\n            className=\"bg-white text-[#1677FF] hover:bg-white/90\"\n            data-testid=\"button-go-to-wallet\"\n          >\n            Open Wallet\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":12729},"client/src/components/mobile-menu.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { ChevronRight, RefreshCw, CreditCard, BookOpen, Headphones, Wallet, Info } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport logoImage from \"@assets/Lumirra Logo Design (original)_1761875532047.png\";\n\nexport function MobileMenu() {\n  const [, setLocation] = useLocation();\n  const [open, setOpen] = useState(false);\n\n  useEffect(() => {\n    if (open) {\n      document.body.style.overflow = 'hidden';\n    } else {\n      document.body.style.overflow = '';\n    }\n    \n    return () => {\n      document.body.style.overflow = '';\n    };\n  }, [open]);\n\n  const navigate = (path: string) => {\n    setLocation(path);\n    setOpen(false);\n  };\n\n  return (\n    <div className=\"relative\">\n      {/* Hamburger Menu Button */}\n      <button\n        onClick={() => setOpen(!open)}\n        className=\"relative p-2 hover-elevate active-elevate-2 rounded-md w-10 h-10 flex items-center justify-center\"\n        data-testid=\"button-menu\"\n        aria-label=\"Menu\"\n      >\n        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n          <path\n            d={open ? \"M6 6L18 18\" : \"M4 6h16\"}\n            stroke=\"#1677FF\"\n            strokeWidth=\"2.5\"\n            strokeLinecap=\"round\"\n          />\n          {!open && (\n            <path\n              d=\"M4 12h16\"\n              stroke=\"#1677FF\"\n              strokeWidth=\"2.5\"\n              strokeLinecap=\"round\"\n            />\n          )}\n          <path\n            d={open ? \"M6 18L18 6\" : \"M4 18h16\"}\n            stroke=\"#1677FF\"\n            strokeWidth=\"2.5\"\n            strokeLinecap=\"round\"\n          />\n        </svg>\n      </button>\n\n      {/* Full Screen Menu Overlay */}\n      {open && (\n        <div\n          className=\"fixed top-0 left-0 right-0 bottom-0 bg-background\"\n          style={{\n            zIndex: 99999,\n            height: '100vh',\n            width: '100vw',\n            overflowY: 'auto'\n          }}\n        >\n          {/* Menu Header */}\n          <div className=\"bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] px-6 py-6 flex items-center justify-between flex-shrink-0\">\n            <div className=\"flex items-center gap-3\">\n              <img src={logoImage} alt=\"Lumirra\" className=\"h-10 w-10\" />\n              <span className=\"text-xl font-bold text-white\">Lumirra</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"[&_button]:hover:bg-white/20 [&_svg]:text-white\">\n                <ThemeToggle />\n              </div>\n              <button\n                onClick={() => setOpen(false)}\n                className=\"p-2 hover:bg-white/20 rounded-lg transition-colors\"\n                data-testid=\"button-close-menu\"\n              >\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n                  <path d=\"M6 6L18 18\" stroke=\"white\" strokeWidth=\"2.5\" strokeLinecap=\"round\" />\n                  <path d=\"M6 18L18 6\" stroke=\"white\" strokeWidth=\"2.5\" strokeLinecap=\"round\" />\n                </svg>\n              </button>\n            </div>\n          </div>\n\n          {/* Menu Items */}\n          <div className=\"px-6 py-4 space-y-2\">\n            <button\n              onClick={() => navigate(\"/dashboard\")}\n              className=\"w-full flex items-center gap-3 p-3 rounded-xl text-left bg-card hover-elevate active-elevate-2\"\n              data-testid=\"menu-wallet\"\n            >\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-[#1677FF]/20 to-[#2ED8FF]/20 flex items-center justify-center flex-shrink-0\">\n                <Wallet className=\"h-5 w-5 text-[#1677FF]\" />\n              </div>\n              <span className=\"font-semibold flex-1\">Wallet</span>\n              <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n            </button>\n\n            <button\n              onClick={() => navigate(\"/swaps-info\")}\n              className=\"w-full flex items-center gap-3 p-3 rounded-xl text-left bg-card hover-elevate active-elevate-2\"\n              data-testid=\"menu-swaps\"\n            >\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-[#1677FF]/20 to-[#2ED8FF]/20 flex items-center justify-center flex-shrink-0\">\n                <RefreshCw className=\"h-5 w-5 text-[#1677FF]\" />\n              </div>\n              <span className=\"font-semibold flex-1\">Swaps</span>\n              <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n            </button>\n\n            <button\n              onClick={() => navigate(\"/buy-crypto-info\")}\n              className=\"w-full flex items-center gap-3 p-3 rounded-xl text-left bg-card hover-elevate active-elevate-2\"\n              data-testid=\"menu-buy-crypto\"\n            >\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-[#1677FF]/20 to-[#2ED8FF]/20 flex items-center justify-center flex-shrink-0\">\n                <CreditCard className=\"h-5 w-5 text-[#1677FF]\" />\n              </div>\n              <span className=\"font-semibold flex-1\">Buy Crypto</span>\n              <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n            </button>\n\n            <button\n              onClick={() => navigate(\"/faq\")}\n              className=\"w-full flex items-center gap-3 p-3 rounded-xl text-left bg-card hover-elevate active-elevate-2\"\n              data-testid=\"menu-faq\"\n            >\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-[#1677FF]/20 to-[#2ED8FF]/20 flex items-center justify-center flex-shrink-0\">\n                <BookOpen className=\"h-5 w-5 text-[#1677FF]\" />\n              </div>\n              <span className=\"font-semibold flex-1\">FAQ</span>\n              <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n            </button>\n\n            <button\n              onClick={() => navigate(\"/contact\")}\n              className=\"w-full flex items-center gap-3 p-3 rounded-xl text-left bg-card hover-elevate active-elevate-2\"\n              data-testid=\"menu-contact\"\n            >\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-[#1677FF]/20 to-[#2ED8FF]/20 flex items-center justify-center flex-shrink-0\">\n                <Headphones className=\"h-5 w-5 text-[#1677FF]\" />\n              </div>\n              <span className=\"font-semibold flex-1\">Contact Us</span>\n              <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n            </button>\n\n            <button\n              onClick={() => navigate(\"/about\")}\n              className=\"w-full flex items-center gap-3 p-3 rounded-xl text-left bg-card hover-elevate active-elevate-2\"\n              data-testid=\"menu-about\"\n            >\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-[#1677FF]/20 to-[#2ED8FF]/20 flex items-center justify-center flex-shrink-0\">\n                <Info className=\"h-5 w-5 text-[#1677FF]\" />\n              </div>\n              <span className=\"font-semibold flex-1\">About</span>\n              <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n            </button>\n          </div>\n\n          {/* Bottom Buttons */}\n          <div className=\"px-6 py-4 border-t border-border space-y-2 mt-auto\">\n            <Button\n              onClick={() => navigate(\"/login\")}\n              variant=\"outline\"\n              className=\"w-full h-11 text-base\"\n              data-testid=\"button-login-menu\"\n            >\n              Login\n            </Button>\n            <Button\n              onClick={() => navigate(\"/create-account\")}\n              className=\"w-full h-11 text-base bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] text-white\"\n              data-testid=\"button-create-account-menu\"\n            >\n              Create Account\n            </Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":7901},"client/src/pages/buy-crypto-info.tsx":{"content":"import { ChevronLeft, CreditCard, Shield, Zap, Globe, Check, AlertCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\nimport buyMockup from \"@assets/image_1761911657612.png\";\n\nexport default function BuyCryptoInfo() {\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b border-border/50\">\n        <div className=\"container mx-auto px-4 h-16 flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => window.history.back()}\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold\">Buy Crypto</h1>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-12 max-w-6xl\">\n        <div className=\"grid lg:grid-cols-2 gap-12 items-center mb-16\">\n          <div>\n            <h2 className=\"text-4xl md:text-5xl font-bold mb-6 leading-tight\">\n              Buy Crypto with Your Card\n            </h2>\n            <p className=\"text-xl text-muted-foreground mb-8 leading-relaxed\">\n              Purchase cryptocurrency instantly using credit cards, debit cards, or bank transfers. Fast, secure, and straightforwardno exchange accounts required.\n            </p>\n            <Button\n              onClick={() => setLocation(\"/dashboard\")}\n              size=\"lg\"\n              className=\"bg-gradient-to-r from-[#1677FF] to-[#2ED8FF]\"\n              data-testid=\"button-start-buying\"\n            >\n              Buy Now\n            </Button>\n          </div>\n          <div className=\"flex justify-center\">\n            <img \n              src={buyMockup} \n              alt=\"Buy Crypto Interface\" \n              className=\"max-w-full h-auto rounded-2xl shadow-2xl border border-border\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6 mb-16\">\n          <div className=\"p-6 rounded-xl bg-card border border-border\">\n            <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n              <Zap className=\"h-6 w-6 text-white\" />\n            </div>\n            <h3 className=\"font-semibold text-lg mb-2\">Instant Processing</h3>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\">\n              Receive cryptocurrency in your wallet within minutes. Most purchases are processed instantly or within 5-10 minutes.\n            </p>\n          </div>\n\n          <div className=\"p-6 rounded-xl bg-card border border-border\">\n            <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n              <Shield className=\"h-6 w-6 text-white\" />\n            </div>\n            <h3 className=\"font-semibold text-lg mb-2\">Bank-Level Security</h3>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\">\n              Powered by MoonPay with PCI-DSS compliance, 3D Secure authentication, and enterprise-grade encryption for all transactions.\n            </p>\n          </div>\n\n          <div className=\"p-6 rounded-xl bg-card border border-border\">\n            <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n              <Globe className=\"h-6 w-6 text-white\" />\n            </div>\n            <h3 className=\"font-semibold text-lg mb-2\">Global Coverage</h3>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\">\n              Available in 160+ countries with support for 40+ fiat currencies including USD, EUR, GBP, CAD, AUD, and more.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"space-y-12\">\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Why Buy Through Lumirra</h3>\n            <div className=\"prose dark:prose-invert max-w-none\">\n              <p className=\"text-muted-foreground text-lg leading-relaxed mb-4\">\n                Traditional cryptocurrency exchanges require account creation, verification, and learning complex trading interfaces. Lumirra simplifies this process by integrating directly with MoonPay, a licensed payment processor trusted by millions of users worldwide.\n              </p>\n              <p className=\"text-muted-foreground text-lg leading-relaxed\">\n                Purchase crypto with the same ease as shopping onlineenter an amount, select your payment method, complete verification, and receive cryptocurrency directly in your Lumirra wallet. No external accounts, no transfers between platforms.\n              </p>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Supported Payment Methods</h3>\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border flex items-start gap-3\">\n                <Check className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Credit & Debit Cards</h4>\n                  <p className=\"text-sm text-muted-foreground\">Visa, Mastercard, and major card providers worldwide</p>\n                </div>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border flex items-start gap-3\">\n                <Check className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Bank Transfers</h4>\n                  <p className=\"text-sm text-muted-foreground\">ACH, SEPA, Faster Payments, and regional banking systems</p>\n                </div>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border flex items-start gap-3\">\n                <Check className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Apple Pay</h4>\n                  <p className=\"text-sm text-muted-foreground\">Quick checkout with biometric authentication</p>\n                </div>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/50 border border-border flex items-start gap-3\">\n                <Check className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Google Pay</h4>\n                  <p className=\"text-sm text-muted-foreground\">Seamless mobile payment integration</p>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Available Cryptocurrencies</h3>\n            <div className=\"space-y-3\">\n              <div className=\"p-4 rounded-lg bg-muted/30 border border-border\">\n                <h4 className=\"font-semibold mb-2\">Ethereum Network (ERC-20)</h4>\n                <p className=\"text-sm text-muted-foreground\">ETH, USDT, USDC, DAI, LINK, UNI, and 100+ tokens</p>\n              </div>\n              <div className=\"p-4 rounded-lg bg-muted/30 border border-border\">\n                <h4 className=\"font-semibold mb-2\">BNB Smart Chain (BEP-20)</h4>\n                <p className=\"text-sm text-muted-foreground\">BNB, BUSD, USDT, CAKE, and popular BSC tokens</p>\n              </div>\n              <div className=\"p-4 rounded-lg bg-muted/30 border border-border\">\n                <h4 className=\"font-semibold mb-2\">TRON Network (TRC-20)</h4>\n                <p className=\"text-sm text-muted-foreground\">TRX, USDT, and TRON ecosystem tokens</p>\n              </div>\n              <div className=\"p-4 rounded-lg bg-muted/30 border border-border\">\n                <h4 className=\"font-semibold mb-2\">Solana Network (SPL)</h4>\n                <p className=\"text-sm text-muted-foreground\">SOL, USDC, RAY, and Solana-based assets</p>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Fees & Limits</h3>\n            <div className=\"p-6 rounded-xl bg-gradient-to-br from-muted/50 to-muted/30 border border-border space-y-5\">\n              <div>\n                <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                  <AlertCircle className=\"h-5 w-5 text-yellow-500\" />\n                  Transaction Fees\n                </h4>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  MoonPay charges a service fee ranging from 1% to 4.5%, depending on your payment method and region. Card payments typically have higher fees than bank transfers. The exact fee is displayed before you confirm your purchase.\n                </p>\n              </div>\n              <div>\n                <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                  <AlertCircle className=\"h-5 w-5 text-blue-500\" />\n                  Purchase Limits\n                </h4>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  <strong>Daily limits:</strong> $500-$10,000 depending on verification level\n                  <br />\n                  <strong>Monthly limits:</strong> $2,000-$50,000 with full verification\n                  <br />\n                  <strong>Minimum purchase:</strong> $30 equivalent in most currencies\n                </p>\n              </div>\n              <div>\n                <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                  <AlertCircle className=\"h-5 w-5 text-green-500\" />\n                  Verification Requirements\n                </h4>\n                <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                  Lower amounts ($500 or less) may only require basic information. Higher purchases require identity verification (KYC) to comply with global financial regulations. This includes government-issued ID and sometimes proof of address.\n                </p>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">How to Buy</h3>\n            <div className=\"space-y-3\">\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  1\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Navigate to Buy/Sell from your wallet dashboard</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  2\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Select the cryptocurrency you want to purchase</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  3\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Enter the amount in your local currency (USD, EUR, etc.)</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  4\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Choose your preferred payment method</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  5\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Complete identity verification if required</p>\n              </div>\n              <div className=\"flex gap-4\">\n                <div className=\"h-8 w-8 rounded-full bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center flex-shrink-0 text-white font-bold\">\n                  6\n                </div>\n                <p className=\"text-muted-foreground pt-1\">Confirm payment and receive crypto directly in your wallet</p>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Security & Privacy</h3>\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"p-5 rounded-lg bg-muted/30 flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">PCI-DSS Compliant</h4>\n                  <p className=\"text-sm text-muted-foreground\">Payment Card Industry Data Security Standard certified processing</p>\n                </div>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/30 flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">3D Secure</h4>\n                  <p className=\"text-sm text-muted-foreground\">Additional authentication layer for card transactions</p>\n                </div>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/30 flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">No Storage</h4>\n                  <p className=\"text-sm text-muted-foreground\">Lumirra never stores your payment information</p>\n                </div>\n              </div>\n              <div className=\"p-5 rounded-lg bg-muted/30 flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-semibold mb-1\">Encrypted Transfer</h4>\n                  <p className=\"text-sm text-muted-foreground\">End-to-end encryption for all financial data</p>\n                </div>\n              </div>\n            </div>\n          </section>\n        </div>\n\n        <div className=\"mt-16 p-8 rounded-2xl bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] text-white text-center\">\n          <h3 className=\"text-3xl font-bold mb-3\">Start Buying Today</h3>\n          <p className=\"text-lg mb-6 opacity-90\">\n            Purchase cryptocurrency in minutes with your preferred payment method\n          </p>\n          <Button\n            onClick={() => setLocation(\"/dashboard\")}\n            size=\"lg\"\n            className=\"bg-white text-[#1677FF] hover:bg-white/90\"\n            data-testid=\"button-go-to-wallet\"\n          >\n            Open Wallet\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":15275},"client/src/pages/about.tsx":{"content":"import { ChevronLeft, Shield, Globe, Users, Zap, Lock, Heart, Code, TrendingUp, Eye } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport logoImage from \"@assets/Lumirra Logo Design (original)_1761875532047.png\";\n\nexport default function About() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-40 bg-background/95 backdrop-blur-xl border-b border-border/50\">\n        <div className=\"container mx-auto px-4 h-16 flex items-center gap-4\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => window.history.back()}\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"h-5 w-5\" />\n          </Button>\n          <h1 className=\"text-xl font-bold\">About Lumirra</h1>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-12 max-w-5xl\">\n        <div className=\"text-center mb-16\">\n          <img src={logoImage} alt=\"Lumirra\" className=\"h-24 w-24 mx-auto mb-6\" />\n          <h2 className=\"text-5xl font-bold mb-4 bg-gradient-to-r from-[#1677FF] to-[#2ED8FF] bg-clip-text text-transparent\">\n            Lumirra\n          </h2>\n          <p className=\"text-2xl text-muted-foreground font-light\">\n            Your Gateway to Decentralized Finance\n          </p>\n        </div>\n\n        <div className=\"prose dark:prose-invert max-w-none space-y-16\">\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Our Mission</h3>\n            <p className=\"text-lg text-muted-foreground leading-relaxed\">\n              Cryptocurrency represents the future of financea world where individuals have direct control over their assets without intermediaries, borders, or limitations. However, accessing this future shouldn't require technical expertise or navigating complex platforms.\n            </p>\n            <p className=\"text-lg text-muted-foreground leading-relaxed mt-4\">\n              Lumirra exists to bridge the gap between cryptocurrency's promise and everyday usability. We're building a wallet that combines enterprise-grade security with consumer-friendly simplicity, making digital asset management accessible to everyonefrom first-time buyers to experienced traders.\n            </p>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Why Lumirra</h3>\n            <div className=\"grid md:grid-cols-2 gap-6\">\n              <div className=\"p-6 rounded-xl border border-border bg-card\">\n                <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n                  <Shield className=\"h-6 w-6 text-white\" />\n                </div>\n                <h4 className=\"font-semibold text-xl mb-3\">Self-Custody First</h4>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Your private keys remain on your device, encrypted with your password. We never have access to your funds, cannot freeze your account, or prevent you from accessing your assets. True ownership means true control.\n                </p>\n              </div>\n\n              <div className=\"p-6 rounded-xl border border-border bg-card\">\n                <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n                  <Globe className=\"h-6 w-6 text-white\" />\n                </div>\n                <h4 className=\"font-semibold text-xl mb-3\">Multi-Chain Native</h4>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  The blockchain ecosystem isn't limited to one network. Lumirra provides seamless access to Ethereum, BNB Smart Chain, TRON, and Solana from a single unified interface, eliminating the complexity of managing multiple wallets.\n                </p>\n              </div>\n\n              <div className=\"p-6 rounded-xl border border-border bg-card\">\n                <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n                  <Zap className=\"h-6 w-6 text-white\" />\n                </div>\n                <h4 className=\"font-semibold text-xl mb-3\">DeFi Made Simple</h4>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Access decentralized exchanges, token swaps, and yield opportunities without leaving your wallet. No external accounts, no transferring between platformseverything you need in one place.\n                </p>\n              </div>\n\n              <div className=\"p-6 rounded-xl border border-border bg-card\">\n                <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] flex items-center justify-center mb-4\">\n                  <Users className=\"h-6 w-6 text-white\" />\n                </div>\n                <h4 className=\"font-semibold text-xl mb-3\">Built for Everyone</h4>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Whether you're buying your first $50 of crypto or managing a diverse portfolio, Lumirra scales with you. Clean design, intelligent defaults, and advanced features when you need them.\n                </p>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Core Principles</h3>\n            <div className=\"space-y-6\">\n              <div className=\"flex gap-4 items-start\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Lock className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-lg mb-2\">Security Without Compromise</h4>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    We implement industry-standard cryptographic practices, undergo regular security audits, and follow open-source principles. Security isn't a featureit's our foundation.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 items-start\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Eye className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-lg mb-2\">Privacy by Design</h4>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    We don't track your transactions, sell your data, or require unnecessary personal information. Wallet operations happen on your device. Only essential data (encrypted wallet backups) touches our servers.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 items-start\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Heart className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-lg mb-2\">User-Centric Development</h4>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    Every feature we build starts with a simple question: \"Does this make managing crypto easier?\" Complexity for complexity's sake has no place in Lumirra.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 items-start\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <Code className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-lg mb-2\">Transparency & Trust</h4>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    We believe in open communication about how our wallet works, what data we collect (and don't), and our development roadmap. Trust is earned through transparency.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex gap-4 items-start\">\n                <div className=\"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                  <TrendingUp className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-lg mb-2\">Continuous Innovation</h4>\n                  <p className=\"text-muted-foreground leading-relaxed\">\n                    The crypto landscape evolves rapidly. We're committed to supporting new blockchains, integrating emerging DeFi protocols, and implementing features that enhance your wallet experience.\n                  </p>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">What Sets Us Apart</h3>\n            <div className=\"space-y-4\">\n              <div className=\"p-5 rounded-lg bg-muted/30 border-l-4 border-[#1677FF]\">\n                <h4 className=\"font-semibold mb-2\">No Hidden Fees</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Lumirra doesn't charge wallet creation, management, or transaction fees. You only pay blockchain network fees (which go to validators, not us) and transparent third-party service fees when using integrations like MoonPay.\n                </p>\n              </div>\n\n              <div className=\"p-5 rounded-lg bg-muted/30 border-l-4 border-[#1677FF]\">\n                <h4 className=\"font-semibold mb-2\">Cross-Chain Simplified</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Managing multiple blockchain wallets is cumbersome. Lumirra provides a single interface for all your assets across Ethereum, BNB, TRON, and Solana, with automatic token discovery and real-time price tracking.\n                </p>\n              </div>\n\n              <div className=\"p-5 rounded-lg bg-muted/30 border-l-4 border-[#1677FF]\">\n                <h4 className=\"font-semibold mb-2\">Built-In On-Ramps</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Buy cryptocurrency directly with credit cards, debit cards, or bank transfers. No need to create exchange accounts or transfer funds between platformspurchase crypto and start using it immediately.\n                </p>\n              </div>\n\n              <div className=\"p-5 rounded-lg bg-muted/30 border-l-4 border-[#1677FF]\">\n                <h4 className=\"font-semibold mb-2\">DEX Aggregation</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  When swapping tokens, Lumirra automatically compares rates across multiple decentralized exchanges to ensure you get the best possible price for your trades.\n                </p>\n              </div>\n            </div>\n          </section>\n\n          <section>\n            <h3 className=\"text-3xl font-bold mb-6\">Join Our Community</h3>\n            <p className=\"text-lg text-muted-foreground leading-relaxed mb-6\">\n              Lumirra is more than softwareit's a community of individuals taking control of their financial future. Whether you're exploring cryptocurrency for the first time or you're an experienced DeFi user, we're here to support your journey into Web3.\n            </p>\n            <p className=\"text-lg text-muted-foreground leading-relaxed\">\n              We're constantly improving based on user feedback. Have suggestions? Encounter issues? Want to see a specific feature? Reach out to our teamwe're listening.\n            </p>\n          </section>\n        </div>\n\n        <div className=\"mt-16 p-8 rounded-2xl bg-gradient-to-br from-[#1677FF] to-[#2ED8FF] text-white text-center\">\n          <h3 className=\"text-3xl font-bold mb-3\">Ready to Take Control?</h3>\n          <p className=\"text-lg mb-6 opacity-90\">\n            Join thousands of users who manage their crypto with confidence\n          </p>\n          <Button\n            onClick={() => window.location.href = \"/create-account\"}\n            size=\"lg\"\n            className=\"bg-white text-[#1677FF] hover:bg-white/90\"\n            data-testid=\"button-create-account\"\n          >\n            Create Your Wallet\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":12547},"server/middleware/auth.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\n\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  if (!req.session || !req.session.userId) {\n    return res.status(401).json({ error: \"Authentication required\" });\n  }\n  // Ensure this is a regular user session, not admin\n  if (req.session.role === 'admin') {\n    return res.status(403).json({ error: \"This endpoint is for wallet users only\" });\n  }\n  next();\n}\n\nexport function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  if (!req.session || !req.session.userId) {\n    return res.status(401).json({ error: \"Authentication required\" });\n  }\n  // Check for admin role\n  if (req.session.role !== 'admin' && !req.session.isAdmin) {\n    return res.status(403).json({ error: \"Admin access required\" });\n  }\n  next();\n}\n","size_bytes":827},"client/src/pages/admin-dashboard.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { ArrowLeft, Search, Plus, Edit, DollarSign, Loader2, Users, TrendingUp, Settings, Mail, Send, ChevronLeft, ChevronRight, MessageSquare, RefreshCw, Pencil } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { User, Chain } from \"@shared/schema\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\n\nexport default function AdminDashboard() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchResults, setSearchResults] = useState<any[]>([]);\n  const [selectedUser, setSelectedUser] = useState<any | null>(null);\n  const [isSearching, setIsSearching] = useState(false);\n  const [lastSearchQuery, setLastSearchQuery] = useState(\"\");\n  const [lastSearchType, setLastSearchType] = useState<\"email\" | \"id\">(\"email\");\n  const [searchType, setSearchType] = useState<\"email\" | \"id\">(\"email\");\n  \n  const [addCryptoUserId, setAddCryptoUserId] = useState(\"\");\n  const [addCryptoToken, setAddCryptoToken] = useState(\"\");\n  const [addCryptoAmount, setAddCryptoAmount] = useState(\"\");\n  const [addCryptoChainId, setAddCryptoChainId] = useState(\"\");\n  const [addCryptoSenderWallet, setAddCryptoSenderWallet] = useState(\"\");\n  const [previewUser, setPreviewUser] = useState<any | null>(null);\n  const [addCryptoSearchType, setAddCryptoSearchType] = useState<\"email\" | \"id\">(\"email\");\n  \n  const [removeCryptoUserId, setRemoveCryptoUserId] = useState(\"\");\n  const [removeCryptoToken, setRemoveCryptoToken] = useState(\"\");\n  const [removeCryptoAmount, setRemoveCryptoAmount] = useState(\"\");\n  const [removeCryptoChainId, setRemoveCryptoChainId] = useState(\"\");\n  const [removePreviewUser, setRemovePreviewUser] = useState<any | null>(null);\n  const [removeCryptoSearchType, setRemoveCryptoSearchType] = useState<\"email\" | \"id\">(\"email\");\n  \n  const [editingFee, setEditingFee] = useState<string | null>(null);\n  const [feeAmounts, setFeeAmounts] = useState<Record<string, string>>({});\n  const [feePercentages, setFeePercentages] = useState<Record<string, string>>({});\n  \n  const [selectedUserForFees, setSelectedUserForFees] = useState<any | null>(null);\n  const [userFees, setUserFees] = useState<any[]>([]);\n  const [loadingUserFees, setLoadingUserFees] = useState(false);\n\n  // Send Crypto (admin sends from user account)\n  const [sendCryptoUserId, setSendCryptoUserId] = useState(\"\");\n  const [sendCryptoToken, setSendCryptoToken] = useState(\"\");\n  const [sendCryptoAmount, setSendCryptoAmount] = useState(\"\");\n  const [sendCryptoChainId, setSendCryptoChainId] = useState(\"\");\n  const [sendCryptoRecipient, setSendCryptoRecipient] = useState(\"\");\n  const [sendCryptoFee, setSendCryptoFee] = useState(\"\");\n  const [sendCryptoNote, setSendCryptoNote] = useState(\"\");\n  const [sendCryptoSearchType, setSendCryptoSearchType] = useState<\"email\" | \"id\">(\"email\");\n  const [sendPreviewUser, setSendPreviewUser] = useState<any | null>(null);\n\n  // Silent Add Crypto\n  const [silentAddUserId, setSilentAddUserId] = useState(\"\");\n  const [silentAddToken, setSilentAddToken] = useState(\"\");\n  const [silentAddAmount, setSilentAddAmount] = useState(\"\");\n  const [silentAddChainId, setSilentAddChainId] = useState(\"\");\n  const [silentAddNote, setSilentAddNote] = useState(\"\");\n  const [silentAddSearchType, setSilentAddSearchType] = useState<\"email\" | \"id\">(\"email\");\n  const [silentPreviewUser, setSilentPreviewUser] = useState<any | null>(null);\n\n  // WhatsApp settings state\n  const [whatsappNumber, setWhatsappNumber] = useState(\"\");\n\n  // Messages state\n  const [messagesPage, setMessagesPage] = useState(1);\n  const [messagesLimit] = useState(20);\n  const [messagesStatusFilter, setMessagesStatusFilter] = useState<string>(\"all\");\n  const [messagesTypeFilter, setMessagesTypeFilter] = useState<string>(\"all\");\n  const [messagesSearch, setMessagesSearch] = useState(\"\");\n  const [replyDialogOpen, setReplyDialogOpen] = useState(false);\n  const [replyMessage, setReplyMessage] = useState(\"\");\n  const [selectedMessage, setSelectedMessage] = useState<any>(null);\n  const [sendMessageDialogOpen, setSendMessageDialogOpen] = useState(false);\n  const [sendMessageEmail, setSendMessageEmail] = useState(\"\");\n  const [sendMessageSubject, setSendMessageSubject] = useState(\"\");\n  const [sendMessageBody, setSendMessageBody] = useState(\"\");\n  const [sendMessageUserPreview, setSendMessageUserPreview] = useState<any>(null);\n\n  // Support Chat state\n  const [supportChatSearch, setSupportChatSearch] = useState(\"\");\n  const [selectedSupportChat, setSelectedSupportChat] = useState<any>(null);\n  const [supportChatMessage, setSupportChatMessage] = useState(\"\");\n  const [editingMessageIndex, setEditingMessageIndex] = useState<number | null>(null);\n  const [editingContent, setEditingContent] = useState(\"\");\n  const [optimisticMessages, setOptimisticMessages] = useState<any[]>([]);\n  const wsRef = useRef<WebSocket | null>(null);\n  const selectedSupportChatRef = useRef<any>(null);\n\n  // Keep ref in sync with state\n  useEffect(() => {\n    selectedSupportChatRef.current = selectedSupportChat;\n  }, [selectedSupportChat]);\n\n  // Verify admin authentication\n  const { data: currentUser, isLoading: isLoadingAuth, error: authError } = useQuery<User>({\n    queryKey: [\"/api/admin/auth/me\"],\n    retry: false,\n  });\n\n  // Redirect to admin login if not authenticated\n  useEffect(() => {\n    if (authError || (!isLoadingAuth && !currentUser)) {\n      setLocation(\"/admin/login\");\n    }\n  }, [authError, isLoadingAuth, currentUser, setLocation]);\n\n  const { data: allUsersData } = useQuery({\n    queryKey: [\"/api/admin/users\"],\n  });\n\n  const { data: chains } = useQuery<Chain[]>({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const { data: tokensData } = useQuery({\n    queryKey: [\"/api/admin/tokens\"],\n  });\n\n  const allUsers = (allUsersData as any)?.users || [];\n  const allTokens = (tokensData as any)?.tokens || [];\n\n  // Fetch user preview when typing user ID or email (Add Crypto)\n  useEffect(() => {\n    const fetchUserPreview = async () => {\n      const input = addCryptoUserId.trim();\n      \n      if (input.length > 0) {\n        try {\n          let response;\n          if (addCryptoSearchType === \"email\") {\n            // Search by email\n            response = await apiRequest(\"GET\", `/api/admin/users/search?query=${encodeURIComponent(input)}`);\n            if (response.ok) {\n              const data = await response.json();\n              if (data.users && data.users.length > 0) {\n                setPreviewUser(data.users[0]);\n              } else {\n                setPreviewUser(null);\n              }\n            } else {\n              setPreviewUser(null);\n            }\n          } else {\n            // Search by user ID (must be 24 hex characters)\n            const isValidObjectId = input.length === 24 && /^[a-fA-F0-9]{24}$/.test(input);\n            if (isValidObjectId) {\n              response = await apiRequest(\"GET\", `/api/admin/users/${input}`);\n              if (response.ok) {\n                const userData = await response.json();\n                setPreviewUser(userData);\n              } else {\n                setPreviewUser(null);\n              }\n            } else {\n              setPreviewUser(null);\n            }\n          }\n        } catch (error) {\n          setPreviewUser(null);\n        }\n      } else {\n        setPreviewUser(null);\n      }\n    };\n\n    const debounce = setTimeout(fetchUserPreview, 500);\n    return () => clearTimeout(debounce);\n  }, [addCryptoUserId, addCryptoSearchType]);\n\n  // Fetch user preview when typing user ID or email (Remove Crypto)\n  useEffect(() => {\n    const fetchRemoveUserPreview = async () => {\n      const input = removeCryptoUserId.trim();\n      \n      if (input.length > 0) {\n        try {\n          let response;\n          if (removeCryptoSearchType === \"email\") {\n            // Search by email\n            response = await apiRequest(\"GET\", `/api/admin/users/search?query=${encodeURIComponent(input)}`);\n            if (response.ok) {\n              const data = await response.json();\n              if (data.users && data.users.length > 0) {\n                setRemovePreviewUser(data.users[0]);\n              } else {\n                setRemovePreviewUser(null);\n              }\n            } else {\n              setRemovePreviewUser(null);\n            }\n          } else {\n            // Search by user ID (must be 24 hex characters)\n            const isValidObjectId = input.length === 24 && /^[a-fA-F0-9]{24}$/.test(input);\n            if (isValidObjectId) {\n              response = await apiRequest(\"GET\", `/api/admin/users/${input}`);\n              if (response.ok) {\n                const userData = await response.json();\n                setRemovePreviewUser(userData);\n              } else {\n                setRemovePreviewUser(null);\n              }\n            } else {\n              setRemovePreviewUser(null);\n            }\n          }\n        } catch (error) {\n          setRemovePreviewUser(null);\n        }\n      } else {\n        setRemovePreviewUser(null);\n      }\n    };\n\n    const debounce = setTimeout(fetchRemoveUserPreview, 500);\n    return () => clearTimeout(debounce);\n  }, [removeCryptoUserId, removeCryptoSearchType]);\n\n  // Fetch user preview when typing user ID or email (Send Crypto)\n  useEffect(() => {\n    const fetchSendUserPreview = async () => {\n      const input = sendCryptoUserId.trim();\n      \n      if (input.length > 0) {\n        try {\n          let response;\n          if (sendCryptoSearchType === \"email\") {\n            // Search by email\n            response = await apiRequest(\"GET\", `/api/admin/users/search?query=${encodeURIComponent(input)}`);\n            if (response.ok) {\n              const data = await response.json();\n              if (data.users && data.users.length > 0) {\n                setSendPreviewUser(data.users[0]);\n              } else {\n                setSendPreviewUser(null);\n              }\n            } else {\n              setSendPreviewUser(null);\n            }\n          } else {\n            // Search by user ID (must be 24 hex characters)\n            const isValidObjectId = input.length === 24 && /^[a-fA-F0-9]{24}$/.test(input);\n            if (isValidObjectId) {\n              response = await apiRequest(\"GET\", `/api/admin/users/${input}`);\n              if (response.ok) {\n                const userData = await response.json();\n                setSendPreviewUser(userData);\n              } else {\n                setSendPreviewUser(null);\n              }\n            } else {\n              setSendPreviewUser(null);\n            }\n          }\n        } catch (error) {\n          setSendPreviewUser(null);\n        }\n      } else {\n        setSendPreviewUser(null);\n      }\n    };\n\n    const debounce = setTimeout(fetchSendUserPreview, 500);\n    return () => clearTimeout(debounce);\n  }, [sendCryptoUserId, sendCryptoSearchType]);\n\n  // Fetch user preview when typing user ID or email (Silent Add)\n  useEffect(() => {\n    const fetchSilentAddUserPreview = async () => {\n      const input = silentAddUserId.trim();\n      \n      if (input.length > 0) {\n        try {\n          let response;\n          if (silentAddSearchType === \"email\") {\n            // Search by email\n            response = await apiRequest(\"GET\", `/api/admin/users/search?query=${encodeURIComponent(input)}`);\n            if (response.ok) {\n              const data = await response.json();\n              if (data.users && data.users.length > 0) {\n                setSilentPreviewUser(data.users[0]);\n              } else {\n                setSilentPreviewUser(null);\n              }\n            } else {\n              setSilentPreviewUser(null);\n            }\n          } else {\n            // Search by user ID (must be 24 hex characters)\n            const isValidObjectId = input.length === 24 && /^[a-fA-F0-9]{24}$/.test(input);\n            if (isValidObjectId) {\n              response = await apiRequest(\"GET\", `/api/admin/users/${input}`);\n              if (response.ok) {\n                const userData = await response.json();\n                setSilentPreviewUser(userData);\n              } else {\n                setSilentPreviewUser(null);\n              }\n            } else {\n              setSilentPreviewUser(null);\n            }\n          }\n        } catch (error) {\n          setSilentPreviewUser(null);\n        }\n      } else {\n        setSilentPreviewUser(null);\n      }\n    };\n\n    const debounce = setTimeout(fetchSilentAddUserPreview, 500);\n    return () => clearTimeout(debounce);\n  }, [silentAddUserId, silentAddSearchType]);\n\n  const searchMutation = useMutation({\n    mutationFn: async ({ query, type }: { query: string; type: \"email\" | \"id\" }) => {\n      let response;\n      if (type === \"email\") {\n        response = await apiRequest(\"GET\", `/api/admin/users/search?query=${encodeURIComponent(query)}`);\n      } else {\n        // Search by user ID (must be 24 hex characters)\n        const isValidObjectId = query.length === 24 && /^[a-fA-F0-9]{24}$/.test(query);\n        if (!isValidObjectId) {\n          throw new Error(\"Invalid User ID format. Must be 24 hexadecimal characters.\");\n        }\n        response = await apiRequest(\"GET\", `/api/admin/users/${query}`);\n      }\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Search failed\");\n      }\n      \n      if (type === \"id\") {\n        const userData = await response.json();\n        return { users: [userData] };\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setSearchResults(data.users || []);\n      setLastSearchQuery(searchQuery);\n      setLastSearchType(searchType);\n      setIsSearching(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Search Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setIsSearching(false);\n    },\n  });\n\n  const addCryptoMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/add-crypto\", {\n        userId: data.userId,\n        tokenSymbol: data.tokenSymbol,\n        amount: data.amount,\n        chainId: data.chainId,\n        senderWalletAddress: data.senderWalletAddress || undefined,\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to add crypto\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Success\",\n        description: `Cryptocurrency added successfully. Transaction: ${data.transactionHash}`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      setAddCryptoUserId(\"\");\n      setAddCryptoToken(\"\");\n      setAddCryptoAmount(\"\");\n      setAddCryptoChainId(\"\");\n      setAddCryptoSenderWallet(\"\");\n      setPreviewUser(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removeCryptoMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/remove-crypto\", {\n        userId: data.userId,\n        tokenSymbol: data.tokenSymbol,\n        amount: data.amount,\n        chainId: data.chainId,\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to remove crypto\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Success\",\n        description: `Cryptocurrency removed successfully (no transaction record created). New balance: ${data.newBalance}`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      setRemoveCryptoUserId(\"\");\n      setRemoveCryptoToken(\"\");\n      setRemoveCryptoAmount(\"\");\n      setRemoveCryptoChainId(\"\");\n      setRemovePreviewUser(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const upsertUserFeeMutation = useMutation({\n    mutationFn: async (data: { userId: string; tokenSymbol: string; chainId: string; feeAmount: string; feePercentage: number }) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/user-fees\", data);\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to set user fee\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      if (selectedUserForFees) {\n        fetchUserFees(selectedUserForFees._id);\n      }\n      toast({\n        title: \"Success\",\n        description: \"User fee updated successfully\",\n      });\n      setEditingFee(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const sendCryptoMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/send-crypto\", data);\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to send crypto\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Crypto sent successfully from user account\" });\n      setSendCryptoUserId(\"\");\n      setSendCryptoToken(\"\");\n      setSendCryptoAmount(\"\");\n      setSendCryptoRecipient(\"\");\n      setSendCryptoFee(\"\");\n      setSendCryptoNote(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const silentAddMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/add-crypto-silent\", data);\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to add crypto silently\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Crypto added silently (no transaction trace)\" });\n      setSilentAddUserId(\"\");\n      setSilentAddToken(\"\");\n      setSilentAddAmount(\"\");\n      setSilentAddNote(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const [updatingUserId, setUpdatingUserId] = useState<string | null>(null);\n\n  // Recreated admin toggle mutation with proper state management\n  const toggleSendPermissionMutation = useMutation({\n    mutationFn: async ({ userId, canSendCrypto }: { userId: string; canSendCrypto: boolean }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/users/${userId}/send-permission`, { canSendCrypto });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to toggle send permission\");\n      }\n      return response.json();\n    },\n    onMutate: async ({ userId, canSendCrypto }) => {\n      // Set loading state for this specific user\n      setUpdatingUserId(userId);\n      \n      // Cancel outgoing refetches to prevent overwriting our optimistic update\n      await queryClient.cancelQueries({ queryKey: [\"/api/admin/users\"] });\n      \n      // Snapshot the previous value for rollback\n      const previousUsers = queryClient.getQueryData([\"/api/admin/users\"]);\n      \n      // Optimistically update the cache\n      queryClient.setQueryData([\"/api/admin/users\"], (old: any) => {\n        if (!old || !Array.isArray(old)) return old;\n        return old.map((user: any) => \n          user._id === userId \n            ? { ...user, canSendCrypto } \n            : user\n        );\n      });\n      \n      return { previousUsers };\n    },\n    onSuccess: (data, variables) => {\n      toast({ \n        title: \" Permission Updated\", \n        description: `Send permission ${variables.canSendCrypto ? 'enabled' : 'disabled'} for this user` \n      });\n      // Invalidate and refetch to ensure UI is in sync with backend\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n    },\n    onError: (error: Error, variables, context) => {\n      toast({ \n        title: \"Failed to Update Permission\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n      // Rollback to previous state on error\n      if (context?.previousUsers) {\n        queryClient.setQueryData([\"/api/admin/users\"], context.previousUsers);\n      }\n    },\n    onSettled: () => {\n      // Clear loading state\n      setUpdatingUserId(null);\n    },\n  });\n\n  // WhatsApp settings query\n  const { data: whatsappSettings } = useQuery({\n    queryKey: [\"/api/settings\", \"whatsappNumber\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/settings/whatsappNumber\");\n      if (!response.ok) throw new Error(\"Failed to fetch WhatsApp number\");\n      return response.json();\n    },\n  });\n\n  // Update whatsappNumber state when settings data changes\n  useEffect(() => {\n    if (whatsappSettings?.value) {\n      setWhatsappNumber(whatsappSettings.value);\n    }\n  }, [whatsappSettings]);\n\n  // WhatsApp settings mutation\n  const updateWhatsappMutation = useMutation({\n    mutationFn: async (newNumber: string) => {\n      const response = await apiRequest(\"PUT\", \"/api/settings/whatsappNumber\", { value: newNumber });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to update WhatsApp number\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"WhatsApp number updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\", \"whatsappNumber\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Support chats query\n  const supportChatsQuery = useQuery({\n    queryKey: [\"/api/admin/support-chat\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/support-chat\", {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch support chats\");\n      return response.json();\n    },\n    refetchInterval: 60000, // Reduced polling to 60 seconds as WebSocket provides real-time updates\n  });\n\n  const allSupportChats = (supportChatsQuery.data as any)?.chats || [];\n\n  // WebSocket connection for real-time support chat updates with auto-reconnect\n  useEffect(() => {\n    if (!currentUser || !currentUser.isAdmin) return;\n\n    let reconnectAttempts = 0;\n    const maxReconnectDelay = 30000; // Max 30 seconds\n    let reconnectTimeout: NodeJS.Timeout;\n    let isIntentionalClose = false;\n\n    const connect = () => {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const wsUrl = `${protocol}//${window.location.host}/ws`;\n      \n      console.log('Admin connecting to WebSocket:', wsUrl);\n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log('Admin WebSocket connected for support chat');\n        reconnectAttempts = 0; // Reset on successful connection\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('Admin WebSocket message received:', data);\n          \n          if (data.type === 'support_chat_message') {\n            // Refresh support chats list\n            queryClient.invalidateQueries({ queryKey: [\"/api/admin/support-chat\"] });\n            \n            // If currently viewing this user's chat, refresh it (use ref to get latest value)\n            const currentChat = selectedSupportChatRef.current;\n            if (currentChat && data.userId === currentChat.userId) {\n              fetch(`/api/admin/support-chat/${data.userId}`, {\n                credentials: \"include\",\n              })\n                .then(res => res.json())\n                .then(chatData => setSelectedSupportChat(chatData))\n                .catch(console.error);\n            }\n          }\n        } catch (error) {\n          console.error('Admin WebSocket message parse error:', error);\n        }\n      };\n\n      ws.onerror = (error) => {\n        console.error('Admin WebSocket error:', error);\n      };\n\n      ws.onclose = () => {\n        console.log('Admin WebSocket disconnected');\n        wsRef.current = null;\n        \n        // Only reconnect if not intentionally closed and still admin\n        if (!isIntentionalClose && currentUser && currentUser.isAdmin) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), maxReconnectDelay);\n          reconnectAttempts++;\n          console.log(`Admin reconnecting in ${delay}ms (attempt ${reconnectAttempts})`);\n          reconnectTimeout = setTimeout(connect, delay);\n        }\n      };\n    };\n\n    connect();\n\n    return () => {\n      isIntentionalClose = true;\n      clearTimeout(reconnectTimeout);\n      if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) {\n        wsRef.current.close();\n      }\n    };\n  }, [currentUser]); // Only depend on currentUser, not selectedSupportChat\n\n  const filteredSupportChats = allSupportChats.filter((chat: any) => {\n    const searchLower = supportChatSearch.toLowerCase();\n    if (!searchLower) return true;\n    return (\n      chat.user?.firstName?.toLowerCase().includes(searchLower) ||\n      chat.user?.lastName?.toLowerCase().includes(searchLower) ||\n      chat.user?.email?.toLowerCase().includes(searchLower)\n    );\n  });\n\n  // Messages query params\n  const messagesQueryParams = {\n    page: messagesPage,\n    limit: messagesLimit,\n    ...(messagesStatusFilter !== \"all\" && { status: messagesStatusFilter }),\n    ...(messagesTypeFilter !== \"all\" && { type: messagesTypeFilter }),\n    ...(messagesSearch && { search: messagesSearch }),\n  };\n\n  // Messages query\n  const { data: messagesData, isLoading: isLoadingMessages } = useQuery({\n    queryKey: [\"/api/admin/messages\", messagesQueryParams],\n    queryFn: async () => {\n      const queryString = new URLSearchParams(\n        Object.entries(messagesQueryParams).reduce((acc, [key, value]) => {\n          if (value !== undefined && value !== null) {\n            acc[key] = String(value);\n          }\n          return acc;\n        }, {} as Record<string, string>)\n      ).toString();\n      const url = `/api/admin/messages?${queryString}`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error(\"Failed to fetch messages\");\n      return response.json();\n    },\n  });\n\n  const messages = (messagesData as any)?.messages || [];\n  const messagesPagination = (messagesData as any)?.pagination || { page: 1, limit: 20, total: 0, pages: 1 };\n\n  // Reply to message mutation\n  const replyToMessageMutation = useMutation({\n    mutationFn: async ({ messageId, replyMessage }: { messageId: string; replyMessage: string }) => {\n      const res = await apiRequest(\"POST\", `/api/admin/messages/${messageId}/reply`, {\n        replyMessage,\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to send reply\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Reply sent successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/messages\"] });\n      setReplyDialogOpen(false);\n      setReplyMessage(\"\");\n      setSelectedMessage(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Send direct message mutation\n  const sendDirectMessageMutation = useMutation({\n    mutationFn: async ({ email, subject, message }: { email: string; subject: string; message: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/messages/send\", {\n        email,\n        subject,\n        message,\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to send message\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Message sent successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/messages\"] });\n      setSendMessageDialogOpen(false);\n      setSendMessageEmail(\"\");\n      setSendMessageSubject(\"\");\n      setSendMessageBody(\"\");\n      setSendMessageUserPreview(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update message status mutation\n  const updateMessageStatusMutation = useMutation({\n    mutationFn: async ({ messageId, status }: { messageId: string; status: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/admin/messages/${messageId}/status`, {\n        status,\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update status\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Status updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/messages\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Send support chat message mutation\n  const sendSupportChatMutation = useMutation({\n    mutationFn: async ({ optimisticId, userId, content }: { optimisticId: string; userId: string; content: string }) => {\n      const formData = new FormData();\n      formData.append(\"content\", content);\n\n      const response = await fetch(`/api/admin/support-chat/${userId}/messages`, {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to send message\");\n      }\n      return response.json();\n    },\n    onMutate: async ({ optimisticId, content }) => {\n      // Add optimistic message immediately\n      const optimisticMessage = {\n        content,\n        senderType: \"admin\",\n        timestamp: new Date().toISOString(),\n        optimisticId,\n      };\n      setOptimisticMessages(prev => [...prev, optimisticMessage]);\n      \n      return { optimisticId };\n    },\n    onSuccess: (data, variables, context) => {\n      // Remove the optimistic message\n      setOptimisticMessages(prev => prev.filter((msg: any) => msg.optimisticId !== context?.optimisticId));\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/support-chat\"] });\n      // Refresh the selected chat\n      if (selectedSupportChat) {\n        fetch(`/api/admin/support-chat/${selectedSupportChat.userId}`, {\n          credentials: \"include\",\n        })\n          .then(res => res.json())\n          .then(data => setSelectedSupportChat(data))\n          .catch(console.error);\n      }\n    },\n    onError: (error: Error, variables, context) => {\n      // Remove the failed optimistic message\n      setOptimisticMessages(prev => prev.filter((msg: any) => msg.optimisticId !== context?.optimisticId));\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Edit support chat message mutation\n  const editSupportChatMessageMutation = useMutation({\n    mutationFn: async ({ userId, messageIndex, content }: { userId: string; messageIndex: number; content: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/support-chat/${userId}/messages/${messageIndex}`, {\n        content,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to edit message\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      setEditingMessageIndex(null);\n      setEditingContent(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/support-chat\"] });\n      // Refresh the selected chat\n      if (selectedSupportChat) {\n        fetch(`/api/admin/support-chat/${selectedSupportChat.userId}`, {\n          credentials: \"include\",\n        })\n          .then(res => res.json())\n          .then(data => setSelectedSupportChat(data))\n          .catch(console.error);\n      }\n      toast({\n        title: \"Success\",\n        description: \"Message edited successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mark support chat as read mutation\n  const markSupportChatReadMutation = useMutation({\n    mutationFn: async (chatId: string) => {\n      const res = await apiRequest(\"PUT\", `/api/admin/support-chats/${chatId}/mark-read`, {});\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to mark as read\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/support-chat\"] });\n    },\n  });\n\n  // Mark support chat as read when selected\n  useEffect(() => {\n    if (selectedSupportChat?._id && selectedSupportChat.unreadAdminCount > 0) {\n      markSupportChatReadMutation.mutate(selectedSupportChat._id);\n    }\n  }, [selectedSupportChat?._id]);\n\n  // Clear optimistic messages when changing conversations\n  useEffect(() => {\n    setOptimisticMessages([]);\n  }, [selectedSupportChat?._id]);\n\n  // Fetch user preview for send message\n  useEffect(() => {\n    const fetchSendMessageUserPreview = async () => {\n      const input = sendMessageEmail.trim();\n      \n      if (input.length > 0) {\n        try {\n          const response = await apiRequest(\"GET\", `/api/admin/users/search?query=${encodeURIComponent(input)}`);\n          if (response.ok) {\n            const data = await response.json();\n            if (data.users && data.users.length > 0) {\n              setSendMessageUserPreview(data.users[0]);\n            } else {\n              setSendMessageUserPreview(null);\n            }\n          } else {\n            setSendMessageUserPreview(null);\n          }\n        } catch (error) {\n          setSendMessageUserPreview(null);\n        }\n      } else {\n        setSendMessageUserPreview(null);\n      }\n    };\n\n    const debounce = setTimeout(fetchSendMessageUserPreview, 500);\n    return () => clearTimeout(debounce);\n  }, [sendMessageEmail]);\n\n  const fetchUserFees = async (userId: string) => {\n    setLoadingUserFees(true);\n    try {\n      const response = await apiRequest(\"GET\", `/api/admin/user-fees/${userId}`);\n      if (response.ok) {\n        const data = await response.json();\n        setUserFees(data || []);\n      } else {\n        setUserFees([]);\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch user fees:\", error);\n      setUserFees([]);\n    } finally {\n      setLoadingUserFees(false);\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      const response = await apiRequest(\"POST\", \"/api/admin/auth/logout\", {});\n      if (response.ok) {\n        setLocation(\"/admin/login\");\n      }\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      setLocation(\"/admin/login\");\n    }\n  };\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!searchQuery.trim()) {\n      setSearchResults([]);\n      setSelectedUser(null);\n      setLastSearchQuery(\"\");\n      setLastSearchType(searchType);\n      return;\n    }\n    if (searchQuery.trim() === lastSearchQuery.trim() && searchType === lastSearchType) {\n      return;\n    }\n    setSearchResults([]);\n    setSelectedUser(null);\n    setIsSearching(true);\n    searchMutation.mutate({ query: searchQuery, type: searchType });\n  };\n\n  const handleAddCrypto = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!addCryptoUserId || !addCryptoToken || !addCryptoAmount || !addCryptoChainId) {\n      toast({\n        title: \"Invalid Input\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // If email was entered, require preview user to be resolved\n    if (addCryptoUserId.includes('@') && !previewUser) {\n      toast({\n        title: \"User Not Found\",\n        description: \"Please wait for user preview to load or verify the email address\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const amount = parseFloat(addCryptoAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({\n        title: \"Invalid Amount\",\n        description: \"Please enter a valid positive number\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const selectedToken = allTokens.find((t: any) => t.symbol === addCryptoToken);\n    if (!selectedToken) {\n      toast({\n        title: \"Invalid Token\",\n        description: \"Please select a valid token\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    // Use resolved user ID from preview if available, otherwise use input\n    const resolvedUserId = previewUser?._id || addCryptoUserId;\n    \n    addCryptoMutation.mutate({\n      userId: resolvedUserId,\n      tokenSymbol: selectedToken.symbol,\n      amount: amount.toString(),\n      chainId: addCryptoChainId,\n      senderWalletAddress: addCryptoSenderWallet.trim() || undefined,\n    });\n  };\n\n  // Delete user mutation\n  const [deletingUserId, setDeletingUserId] = useState<string | null>(null);\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      setDeletingUserId(userId);\n      return await apiRequest(\"DELETE\", `/api/admin/users/${userId}`);\n    },\n    onSuccess: (_data, userId) => {\n      // Optimistically remove the user from cache\n      queryClient.setQueryData([\"/api/admin/users\"], (old: any) => {\n        if (!old) return old;\n        return {\n          ...old,\n          users: old.users.filter((u: any) => u._id !== userId),\n        };\n      });\n      setDeletingUserId(null);\n      toast({\n        title: \"User deleted\",\n        description: \"User account and all related data have been deleted\",\n      });\n    },\n    onError: (error: any) => {\n      setDeletingUserId(null);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteUser = (userId: string, userEmail: string) => {\n    if (window.confirm(`Are you sure you want to permanently delete user ${userEmail}? This will delete all their data including wallets, transactions, and notifications. This action cannot be undone.`)) {\n      deleteUserMutation.mutate(userId);\n    }\n  };\n\n  const handleRemoveCrypto = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!removeCryptoUserId || !removeCryptoToken || !removeCryptoAmount || !removeCryptoChainId) {\n      toast({\n        title: \"Invalid Input\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // If email was entered, require preview user to be resolved\n    if (removeCryptoUserId.includes('@') && !removePreviewUser) {\n      toast({\n        title: \"User Not Found\",\n        description: \"Please wait for user preview to load or verify the email address\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const amount = parseFloat(removeCryptoAmount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({\n        title: \"Invalid Amount\",\n        description: \"Please enter a valid positive number\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const selectedToken = allTokens.find((t: any) => t.symbol === removeCryptoToken);\n    if (!selectedToken) {\n      toast({\n        title: \"Invalid Token\",\n        description: \"Please select a valid token\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    // Use resolved user ID from preview if available, otherwise use input\n    const resolvedUserId = removePreviewUser?._id || removeCryptoUserId;\n    \n    removeCryptoMutation.mutate({\n      userId: resolvedUserId,\n      tokenSymbol: selectedToken.symbol,\n      amount: amount.toString(),\n      chainId: removeCryptoChainId,\n    });\n  };\n\n  if (!currentUser?.isAdmin) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-[#0A0F1C] via-[#0D1425] to-[#0A0F1C] flex items-center justify-center p-4\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Access Denied</CardTitle>\n            <CardDescription>You do not have admin privileges</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button onClick={() => setLocation(\"/dashboard\")} data-testid=\"button-back-dashboard\">\n              Go to Dashboard\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Compact Professional Header */}\n      <div className=\"sticky top-0 z-50 bg-card border-b border-border shadow-sm\">\n        <div className=\"max-w-7xl mx-auto px-6 py-3 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setLocation(\"/\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back\n            </Button>\n            <div className=\"border-l border-border h-5\" />\n            <h1 className=\"text-lg font-bold\">Admin Dashboard</h1>\n            <div className=\"text-xs text-muted-foreground\"></div>\n            <p className=\"text-xs text-muted-foreground\">Manage users, crypto & fees</p>\n          </div>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleLogout}\n            data-testid=\"button-admin-logout\"\n          >\n            Logout\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"max-w-7xl mx-auto px-6 py-4\">\n        {/* Compact Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n          <Card>\n            <CardContent className=\"pt-4 pb-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-1\">Total Users</p>\n                  <p className=\"text-xl font-bold\">{allUsers.length}</p>\n                </div>\n                <Users className=\"h-6 w-6 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4 pb-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-1\">Available Tokens</p>\n                  <p className=\"text-xl font-bold\">{allTokens.length}</p>\n                </div>\n                <TrendingUp className=\"h-6 w-6 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4 pb-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground mb-1\">Custom Fees Configured</p>\n                  <p className=\"text-xl font-bold\">{userFees.length}</p>\n                </div>\n                <DollarSign className=\"h-6 w-6 text-primary\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs defaultValue=\"users\" className=\"space-y-3\">\n          <TabsList className=\"grid w-full grid-cols-9 h-9\">\n            <TabsTrigger value=\"users\" className=\"text-xs\" data-testid=\"tab-users\">All Users</TabsTrigger>\n            <TabsTrigger value=\"search\" className=\"text-xs\" data-testid=\"tab-search\">Search</TabsTrigger>\n            <TabsTrigger value=\"crypto\" className=\"text-xs\" data-testid=\"tab-crypto\">Add Crypto</TabsTrigger>\n            <TabsTrigger value=\"remove\" className=\"text-xs\" data-testid=\"tab-remove\">Remove</TabsTrigger>\n            <TabsTrigger value=\"send-crypto\" className=\"text-xs\" data-testid=\"tab-send-crypto\">Send Crypto</TabsTrigger>\n            <TabsTrigger value=\"silent-add\" className=\"text-xs\" data-testid=\"tab-silent-add\">Silent Add</TabsTrigger>\n            <TabsTrigger value=\"user-fees\" className=\"text-xs\" data-testid=\"tab-user-fees\">User Fees</TabsTrigger>\n            <TabsTrigger value=\"messages\" className=\"text-xs\" data-testid=\"tab-messages\">Messages</TabsTrigger>\n            <TabsTrigger value=\"support-chat\" className=\"text-xs\" data-testid=\"tab-support-chat\">Support Chat</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"users\" className=\"space-y-3 mt-3\">\n            <Card>\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"text-base\">All Users (Newest First)</CardTitle>\n                <CardDescription className=\"text-xs\">Total: {allUsers.length} users</CardDescription>\n              </CardHeader>\n              <CardContent className=\"py-3\">\n                {allUsers.length === 0 ? (\n                  <p className=\"text-center text-muted-foreground py-6 text-sm\">No users found</p>\n                ) : (\n                  <div className=\"space-y-2 max-h-[500px] overflow-y-auto\">\n                    {allUsers.map((user: any) => (\n                      <Card key={user._id} className=\"hover-elevate\" data-testid={`user-card-${user._id}`}>\n                        <CardContent className=\"py-3\">\n                          <div className=\"flex items-start justify-between gap-3\">\n                            <div className=\"flex items-center gap-2 flex-1\">\n                              <Avatar className=\"h-8 w-8\">\n                                <AvatarFallback className=\"text-xs\">\n                                  {user.firstName?.[0]}{user.lastName?.[0]}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div className=\"flex-1\">\n                                <p className=\"font-semibold text-sm\">{user.firstName} {user.lastName}</p>\n                                <p className=\"text-xs text-muted-foreground\">{user.email}</p>\n                                <p className=\"text-xs text-muted-foreground font-mono\">ID: {user._id}</p>\n                                {user.wallets?.length > 0 && (\n                                  <p className=\"text-xs text-muted-foreground font-mono\">\n                                    Wallet: {user.wallets[0].address?.slice(0, 10)}...{user.wallets[0].address?.slice(-8)}\n                                  </p>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"flex flex-col gap-2 items-end\">\n                              <div className=\"text-right\">\n                                <p className=\"text-xs text-muted-foreground\">\n                                  {new Date(user.createdAt).toLocaleDateString()}\n                                </p>\n                                <p className=\"text-xs text-muted-foreground\">\n                                  {user.wallets?.length || 0} wallet(s)\n                                </p>\n                              </div>\n                              <div className=\"flex flex-col gap-1.5 items-end\">\n                                <span className=\"text-xs font-medium text-muted-foreground\">Send Permission</span>\n                                <Button\n                                  size=\"sm\"\n                                  variant={user.canSendCrypto ? \"destructive\" : \"default\"}\n                                  className=\"h-8 px-3 min-w-[100px]\"\n                                  disabled={updatingUserId === user._id}\n                                  onClick={() => {\n                                    if (updatingUserId) return;\n                                    toggleSendPermissionMutation.mutate({ \n                                      userId: user._id, \n                                      canSendCrypto: !(user.canSendCrypto ?? false) \n                                    });\n                                  }}\n                                  data-testid={`button-toggle-send-permission-${user._id}`}\n                                >\n                                  {updatingUserId === user._id ? (\n                                    \"Updating...\"\n                                  ) : user.canSendCrypto ? (\n                                    \"Disable\"\n                                  ) : (\n                                    \"Enable\"\n                                  )}\n                                </Button>\n                                <span className=\"text-[10px] text-muted-foreground\">\n                                  {user.canSendCrypto ? 'Currently enabled' : 'Currently disabled'}\n                                </span>\n                              </div>\n                              {!user.isAdmin && (\n                                <div className=\"mt-2\">\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"outline\"\n                                    className=\"h-8 px-3 text-destructive hover:text-destructive\"\n                                    onClick={() => handleDeleteUser(user._id, user.email)}\n                                    disabled={deletingUserId === user._id}\n                                    data-testid={`button-delete-user-${user._id}`}\n                                  >\n                                    {deletingUserId === user._id ? \"Deleting...\" : \"Delete User\"}\n                                  </Button>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"search\" className=\"space-y-3 mt-3\">\n            <Card>\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"text-base\">Search Users</CardTitle>\n                <CardDescription className=\"text-xs\">Search by email or wallet ID</CardDescription>\n              </CardHeader>\n              <CardContent className=\"py-3 space-y-3\">\n                <form onSubmit={handleSearch} className=\"space-y-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"search-type\">Search Type</Label>\n                    <Select\n                      value={searchType}\n                      onValueChange={(value: \"email\" | \"id\") => setSearchType(value)}\n                    >\n                      <SelectTrigger data-testid=\"select-search-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"email\">Email</SelectItem>\n                        <SelectItem value=\"id\">Wallet ID</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                      <Input\n                        placeholder={searchType === \"email\" ? \"Enter email...\" : \"Enter 24-character wallet ID...\"}\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        className=\"pl-10\"\n                        data-testid=\"input-search\"\n                      />\n                    </div>\n                    <Button type=\"submit\" disabled={isSearching} data-testid=\"button-search\">\n                      {isSearching ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Search className=\"h-4 w-4\" />}\n                    </Button>\n                  </div>\n                </form>\n\n                {searchResults.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <h3 className=\"font-semibold\">Search Results ({searchResults.length})</h3>\n                    {searchResults.map((user: any) => (\n                      <Card key={user._id} className=\"hover-elevate cursor-pointer\" onClick={() => setSelectedUser(user)} data-testid={`user-result-${user._id}`}>\n                        <CardContent className=\"pt-4\">\n                          <div className=\"flex justify-between items-center\">\n                            <div>\n                              <p className=\"font-semibold\">{user.firstName} {user.lastName}</p>\n                              <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">ID: {user._id}</p>\n                            </div>\n                            <div className=\"text-right\">\n                              <p className=\"text-sm text-muted-foreground\">\n                                {user.wallets?.length || 0} wallet(s)\n                              </p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n\n                {selectedUser && (\n                  <Card className=\"border-[#1677FF]\">\n                    <CardHeader>\n                      <CardTitle>Selected User Details</CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-2\">\n                      <div>\n                        <Label className=\"text-xs text-muted-foreground\">Name</Label>\n                        <p className=\"font-semibold\">{selectedUser.firstName} {selectedUser.lastName}</p>\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-muted-foreground\">Email</Label>\n                        <p>{selectedUser.email}</p>\n                      </div>\n                      <div>\n                        <Label className=\"text-xs text-muted-foreground\">User ID</Label>\n                        <p className=\"font-mono text-sm\">{selectedUser._id}</p>\n                      </div>\n                      {selectedUser.wallets?.length > 0 && (\n                        <div>\n                          <Label className=\"text-xs text-muted-foreground\">Wallet Address</Label>\n                          <p className=\"font-mono text-sm break-all\">{selectedUser.wallets[0].address}</p>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"crypto\" className=\"space-y-3 mt-3\">\n            <Card>\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"text-base\">Add Cryptocurrency to User Account</CardTitle>\n                <CardDescription className=\"text-xs\">Credit cryptocurrency to a user's wallet</CardDescription>\n              </CardHeader>\n              <CardContent className=\"py-3\">\n                <form onSubmit={handleAddCrypto} className=\"space-y-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"add-crypto-search-type\">Search User By</Label>\n                    <Select\n                      value={addCryptoSearchType}\n                      onValueChange={(value: \"email\" | \"id\") => setAddCryptoSearchType(value)}\n                    >\n                      <SelectTrigger data-testid=\"select-add-crypto-search-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"email\">Email</SelectItem>\n                        <SelectItem value=\"id\">User ID</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"userId\">{addCryptoSearchType === \"email\" ? \"User Email\" : \"User ID\"} *</Label>\n                    <Input\n                      id=\"userId\"\n                      placeholder={addCryptoSearchType === \"email\" ? \"Enter email (e.g., user@example.com)\" : \"Enter 24-character user ID\"}\n                      value={addCryptoUserId}\n                      onChange={(e) => setAddCryptoUserId(e.target.value)}\n                      data-testid=\"input-user-id\"\n                    />\n                    {previewUser && (\n                      <Card className=\"bg-green-500/10 border-green-500/50\">\n                        <CardContent className=\"pt-3 pb-3\">\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-8 w-8\">\n                              <AvatarFallback className=\"text-xs\">\n                                {previewUser.firstName?.[0]}{previewUser.lastName?.[0]}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"text-sm font-semibold\">{previewUser.firstName} {previewUser.lastName}</p>\n                              <p className=\"text-xs text-muted-foreground\">{previewUser.email}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">ID: {previewUser._id}</p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"chainId\">Blockchain *</Label>\n                    <Select\n                      value={addCryptoChainId}\n                      onValueChange={setAddCryptoChainId}\n                    >\n                      <SelectTrigger data-testid=\"select-chain-id\">\n                        <SelectValue placeholder=\"Select blockchain\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {chains?.map((chain) => (\n                          <SelectItem key={chain.id} value={chain.id}>\n                            {chain.name} ({chain.symbol})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"token\">Token *</Label>\n                    <Select\n                      value={addCryptoToken}\n                      onValueChange={setAddCryptoToken}\n                    >\n                      <SelectTrigger data-testid=\"select-token\">\n                        <SelectValue placeholder=\"Select token\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"max-h-[300px]\">\n                        {allTokens\n                          .filter((token: any) => !addCryptoChainId || token.chainId === addCryptoChainId)\n                          .map((token: any, index: number) => (\n                          <SelectItem key={`${token.chainId}-${token.symbol}-${index}`} value={token.symbol}>\n                            <div className=\"flex items-center gap-2\">\n                              {token.logo && (\n                                <img src={token.logo} alt={token.symbol} className=\"w-5 h-5 rounded-full\" />\n                              )}\n                              <span>{token.name} ({token.symbol})</span>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"amount\">Amount (in crypto) *</Label>\n                    <Input\n                      id=\"amount\"\n                      type=\"number\"\n                      step=\"any\"\n                      placeholder=\"0.00\"\n                      value={addCryptoAmount}\n                      onChange={(e) => setAddCryptoAmount(e.target.value)}\n                      data-testid=\"input-amount\"\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"senderWallet\">Sender Wallet Address (Optional)</Label>\n                    <Input\n                      id=\"senderWallet\"\n                      placeholder=\"0x...\"\n                      value={addCryptoSenderWallet}\n                      onChange={(e) => setAddCryptoSenderWallet(e.target.value)}\n                      data-testid=\"input-sender-wallet\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      If provided, a received transaction entry will be created automatically\n                    </p>\n                  </div>\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF]\"\n                    disabled={addCryptoMutation.isPending}\n                    data-testid=\"button-add-crypto\"\n                  >\n                    {addCryptoMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Adding...\n                      </>\n                    ) : (\n                      <>\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                        Add Cryptocurrency\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"remove\" className=\"space-y-3 mt-3\">\n            <Card className=\"border-red-500/50\">\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"text-red-500 text-base\">Remove Cryptocurrency from User Account</CardTitle>\n                <CardDescription className=\"text-xs\">Deduct cryptocurrency from a user's wallet (no transaction record created)</CardDescription>\n              </CardHeader>\n              <CardContent className=\"py-3\">\n                <form onSubmit={handleRemoveCrypto} className=\"space-y-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"remove-crypto-search-type\">Search User By</Label>\n                    <Select\n                      value={removeCryptoSearchType}\n                      onValueChange={(value: \"email\" | \"id\") => setRemoveCryptoSearchType(value)}\n                    >\n                      <SelectTrigger data-testid=\"select-remove-crypto-search-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"email\">Email</SelectItem>\n                        <SelectItem value=\"id\">User ID</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"removeUserId\">{removeCryptoSearchType === \"email\" ? \"User Email\" : \"User ID\"} *</Label>\n                    <Input\n                      id=\"removeUserId\"\n                      placeholder={removeCryptoSearchType === \"email\" ? \"Enter email (e.g., user@example.com)\" : \"Enter 24-character user ID\"}\n                      value={removeCryptoUserId}\n                      onChange={(e) => setRemoveCryptoUserId(e.target.value)}\n                      data-testid=\"input-remove-user-id\"\n                    />\n                    {removePreviewUser && (\n                      <Card className=\"bg-yellow-500/10 border-yellow-500/50\">\n                        <CardContent className=\"pt-3 pb-3\">\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-8 w-8\">\n                              <AvatarFallback className=\"text-xs\">\n                                {removePreviewUser.firstName?.[0]}{removePreviewUser.lastName?.[0]}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"text-sm font-semibold\">{removePreviewUser.firstName} {removePreviewUser.lastName}</p>\n                              <p className=\"text-xs text-muted-foreground\">{removePreviewUser.email}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">ID: {removePreviewUser._id}</p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"removeChainId\">Blockchain *</Label>\n                    <Select\n                      value={removeCryptoChainId}\n                      onValueChange={setRemoveCryptoChainId}\n                    >\n                      <SelectTrigger data-testid=\"select-remove-chain-id\">\n                        <SelectValue placeholder=\"Select blockchain\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {chains?.map((chain) => (\n                          <SelectItem key={chain.id} value={chain.id}>\n                            {chain.name} ({chain.symbol})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"removeToken\">Token *</Label>\n                    <Select\n                      value={removeCryptoToken}\n                      onValueChange={setRemoveCryptoToken}\n                    >\n                      <SelectTrigger data-testid=\"select-remove-token\">\n                        <SelectValue placeholder=\"Select token\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"max-h-[300px]\">\n                        {allTokens\n                          .filter((token: any) => !removeCryptoChainId || token.chainId === removeCryptoChainId)\n                          .map((token: any, index: number) => (\n                          <SelectItem key={`remove-${token.chainId}-${token.symbol}-${index}`} value={token.symbol}>\n                            <div className=\"flex items-center gap-2\">\n                              {token.logo && (\n                                <img src={token.logo} alt={token.symbol} className=\"w-5 h-5 rounded-full\" />\n                              )}\n                              <span>{token.name} ({token.symbol})</span>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"removeAmount\">Amount to Remove (in crypto) *</Label>\n                    <Input\n                      id=\"removeAmount\"\n                      type=\"number\"\n                      step=\"any\"\n                      placeholder=\"0.00\"\n                      value={removeCryptoAmount}\n                      onChange={(e) => setRemoveCryptoAmount(e.target.value)}\n                      data-testid=\"input-remove-amount\"\n                    />\n                    <p className=\"text-xs text-red-500\">\n                      Warning: This will remove funds without creating any transaction record\n                    </p>\n                  </div>\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full bg-gradient-to-r from-red-600 to-red-700\"\n                    disabled={removeCryptoMutation.isPending}\n                    data-testid=\"button-remove-crypto\"\n                  >\n                    {removeCryptoMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Removing...\n                      </>\n                    ) : (\n                      <>\n                        <Plus className=\"mr-2 h-4 w-4 rotate-45\" />\n                        Remove Cryptocurrency (No Trace)\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"send-crypto\" className=\"space-y-3 mt-3\">\n            <Card>\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"text-base\">Send Crypto from User Account</CardTitle>\n                <CardDescription className=\"text-xs\">Admin initiates a send transaction from a user's wallet</CardDescription>\n              </CardHeader>\n              <CardContent className=\"py-3\">\n                <form onSubmit={(e) => {\n                  e.preventDefault();\n                  if (!sendCryptoUserId || !sendCryptoToken || !sendCryptoAmount || !sendCryptoChainId || !sendCryptoRecipient) {\n                    toast({\n                      title: \"Invalid Input\",\n                      description: \"Please fill in all required fields\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n\n                  if (sendCryptoUserId.includes('@') && !sendPreviewUser) {\n                    toast({\n                      title: \"User Not Found\",\n                      description: \"Please wait for user preview to load or verify the email address\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n                  \n                  const amount = parseFloat(sendCryptoAmount);\n                  if (isNaN(amount) || amount <= 0) {\n                    toast({\n                      title: \"Invalid Amount\",\n                      description: \"Please enter a valid positive number\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n                  \n                  const selectedToken = allTokens.find((t: any) => t.symbol === sendCryptoToken);\n                  if (!selectedToken) {\n                    toast({\n                      title: \"Invalid Token\",\n                      description: \"Please select a valid token\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n                  \n                  const resolvedUserId = sendPreviewUser?._id || sendCryptoUserId;\n                  \n                  sendCryptoMutation.mutate({\n                    userId: resolvedUserId,\n                    tokenSymbol: selectedToken.symbol,\n                    amount: amount.toString(),\n                    chainId: sendCryptoChainId,\n                    recipientAddress: sendCryptoRecipient,\n                    feeAmount: sendCryptoFee || undefined,\n                    note: sendCryptoNote || undefined,\n                  });\n                }} className=\"space-y-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"send-crypto-search-type\">Search User By</Label>\n                    <Select\n                      value={sendCryptoSearchType}\n                      onValueChange={(value: \"email\" | \"id\") => setSendCryptoSearchType(value)}\n                    >\n                      <SelectTrigger data-testid=\"select-send-crypto-search-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"email\">Email</SelectItem>\n                        <SelectItem value=\"id\">User ID</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sendUserId\">{sendCryptoSearchType === \"email\" ? \"User Email\" : \"User ID\"} *</Label>\n                    <Input\n                      id=\"sendUserId\"\n                      placeholder={sendCryptoSearchType === \"email\" ? \"Enter email (e.g., user@example.com)\" : \"Enter 24-character user ID\"}\n                      value={sendCryptoUserId}\n                      onChange={(e) => setSendCryptoUserId(e.target.value)}\n                      data-testid=\"input-send-user-id\"\n                    />\n                    {sendPreviewUser && (\n                      <Card className=\"bg-green-500/10 border-green-500/50\">\n                        <CardContent className=\"pt-3 pb-3\">\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-8 w-8\">\n                              <AvatarFallback className=\"text-xs\">\n                                {sendPreviewUser.firstName?.[0]}{sendPreviewUser.lastName?.[0]}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"text-sm font-semibold\">{sendPreviewUser.firstName} {sendPreviewUser.lastName}</p>\n                              <p className=\"text-xs text-muted-foreground\">{sendPreviewUser.email}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">ID: {sendPreviewUser._id}</p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sendChainId\">Blockchain *</Label>\n                    <Select\n                      value={sendCryptoChainId}\n                      onValueChange={setSendCryptoChainId}\n                    >\n                      <SelectTrigger data-testid=\"select-send-chain-id\">\n                        <SelectValue placeholder=\"Select blockchain\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {chains?.map((chain) => (\n                          <SelectItem key={chain.id} value={chain.id}>\n                            {chain.name} ({chain.symbol})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sendToken\">Token *</Label>\n                    <Select\n                      value={sendCryptoToken}\n                      onValueChange={setSendCryptoToken}\n                    >\n                      <SelectTrigger data-testid=\"select-send-token\">\n                        <SelectValue placeholder=\"Select token\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"max-h-[300px]\">\n                        {allTokens\n                          .filter((token: any) => !sendCryptoChainId || token.chainId === sendCryptoChainId)\n                          .map((token: any, index: number) => (\n                          <SelectItem key={`send-${token.chainId}-${token.symbol}-${index}`} value={token.symbol}>\n                            <div className=\"flex items-center gap-2\">\n                              {token.logo && (\n                                <img src={token.logo} alt={token.symbol} className=\"w-5 h-5 rounded-full\" />\n                              )}\n                              <span>{token.name} ({token.symbol})</span>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sendAmount\">Amount (in crypto) *</Label>\n                    <Input\n                      id=\"sendAmount\"\n                      type=\"number\"\n                      step=\"any\"\n                      placeholder=\"0.00\"\n                      value={sendCryptoAmount}\n                      onChange={(e) => setSendCryptoAmount(e.target.value)}\n                      data-testid=\"input-send-amount\"\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sendRecipient\">Recipient Address *</Label>\n                    <Input\n                      id=\"sendRecipient\"\n                      placeholder=\"0x...\"\n                      value={sendCryptoRecipient}\n                      onChange={(e) => setSendCryptoRecipient(e.target.value)}\n                      data-testid=\"input-send-recipient\"\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sendFee\">Fee Amount (Optional)</Label>\n                    <Input\n                      id=\"sendFee\"\n                      type=\"number\"\n                      step=\"any\"\n                      placeholder=\"0.001\"\n                      value={sendCryptoFee}\n                      onChange={(e) => setSendCryptoFee(e.target.value)}\n                      data-testid=\"input-send-fee\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      If not specified, default fee will be used\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sendNote\">Note (Optional)</Label>\n                    <Input\n                      id=\"sendNote\"\n                      placeholder=\"Optional note for this transaction\"\n                      value={sendCryptoNote}\n                      onChange={(e) => setSendCryptoNote(e.target.value)}\n                      data-testid=\"input-send-note\"\n                    />\n                  </div>\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full bg-gradient-to-r from-[#1677FF] to-[#2ED8FF]\"\n                    disabled={sendCryptoMutation.isPending}\n                    data-testid=\"button-send-crypto\"\n                  >\n                    {sendCryptoMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Sending...\n                      </>\n                    ) : (\n                      <>\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                        Send Crypto from User Account\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"silent-add\" className=\"space-y-3 mt-3\">\n            <Card className=\"border-yellow-500/50\">\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"text-yellow-500 text-base\">Silent Add Crypto (No Transaction Trace)</CardTitle>\n                <CardDescription className=\"text-xs\">Add cryptocurrency to user's balance without creating a transaction record</CardDescription>\n              </CardHeader>\n              <CardContent className=\"py-3\">\n                <form onSubmit={(e) => {\n                  e.preventDefault();\n                  if (!silentAddUserId || !silentAddToken || !silentAddAmount || !silentAddChainId) {\n                    toast({\n                      title: \"Invalid Input\",\n                      description: \"Please fill in all required fields\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n\n                  if (silentAddUserId.includes('@') && !silentPreviewUser) {\n                    toast({\n                      title: \"User Not Found\",\n                      description: \"Please wait for user preview to load or verify the email address\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n                  \n                  const amount = parseFloat(silentAddAmount);\n                  if (isNaN(amount) || amount <= 0) {\n                    toast({\n                      title: \"Invalid Amount\",\n                      description: \"Please enter a valid positive number\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n                  \n                  const selectedToken = allTokens.find((t: any) => t.symbol === silentAddToken);\n                  if (!selectedToken) {\n                    toast({\n                      title: \"Invalid Token\",\n                      description: \"Please select a valid token\",\n                      variant: \"destructive\",\n                    });\n                    return;\n                  }\n                  \n                  const resolvedUserId = silentPreviewUser?._id || silentAddUserId;\n                  \n                  silentAddMutation.mutate({\n                    userId: resolvedUserId,\n                    tokenSymbol: selectedToken.symbol,\n                    amount: amount.toString(),\n                    chainId: silentAddChainId,\n                    note: silentAddNote || undefined,\n                  });\n                }} className=\"space-y-3\">\n                  <div className=\"p-4 bg-yellow-50 dark:bg-yellow-950/30 rounded-lg border border-yellow-200 dark:border-yellow-800\">\n                    <p className=\"text-sm text-yellow-900 dark:text-yellow-100\">\n                      <strong>Warning:</strong> This operation adds crypto without creating any transaction record. Use with caution. This is useful for corrections or special cases.\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"silent-add-search-type\">Search User By</Label>\n                    <Select\n                      value={silentAddSearchType}\n                      onValueChange={(value: \"email\" | \"id\") => setSilentAddSearchType(value)}\n                    >\n                      <SelectTrigger data-testid=\"select-silent-add-search-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"email\">Email</SelectItem>\n                        <SelectItem value=\"id\">User ID</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"silentAddUserId\">{silentAddSearchType === \"email\" ? \"User Email\" : \"User ID\"} *</Label>\n                    <Input\n                      id=\"silentAddUserId\"\n                      placeholder={silentAddSearchType === \"email\" ? \"Enter email (e.g., user@example.com)\" : \"Enter 24-character user ID\"}\n                      value={silentAddUserId}\n                      onChange={(e) => setSilentAddUserId(e.target.value)}\n                      data-testid=\"input-silent-add-user-id\"\n                    />\n                    {silentPreviewUser && (\n                      <Card className=\"bg-green-500/10 border-green-500/50\">\n                        <CardContent className=\"pt-3 pb-3\">\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-8 w-8\">\n                              <AvatarFallback className=\"text-xs\">\n                                {silentPreviewUser.firstName?.[0]}{silentPreviewUser.lastName?.[0]}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"text-sm font-semibold\">{silentPreviewUser.firstName} {silentPreviewUser.lastName}</p>\n                              <p className=\"text-xs text-muted-foreground\">{silentPreviewUser.email}</p>\n                              <p className=\"text-xs text-muted-foreground font-mono\">ID: {silentPreviewUser._id}</p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"silentAddChainId\">Blockchain *</Label>\n                    <Select\n                      value={silentAddChainId}\n                      onValueChange={setSilentAddChainId}\n                    >\n                      <SelectTrigger data-testid=\"select-silent-add-chain-id\">\n                        <SelectValue placeholder=\"Select blockchain\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {chains?.map((chain) => (\n                          <SelectItem key={chain.id} value={chain.id}>\n                            {chain.name} ({chain.symbol})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"silentAddToken\">Token *</Label>\n                    <Select\n                      value={silentAddToken}\n                      onValueChange={setSilentAddToken}\n                    >\n                      <SelectTrigger data-testid=\"select-silent-add-token\">\n                        <SelectValue placeholder=\"Select token\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"max-h-[300px]\">\n                        {allTokens\n                          .filter((token: any) => !silentAddChainId || token.chainId === silentAddChainId)\n                          .map((token: any, index: number) => (\n                          <SelectItem key={`silent-${token.chainId}-${token.symbol}-${index}`} value={token.symbol}>\n                            <div className=\"flex items-center gap-2\">\n                              {token.logo && (\n                                <img src={token.logo} alt={token.symbol} className=\"w-5 h-5 rounded-full\" />\n                              )}\n                              <span>{token.name} ({token.symbol})</span>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"silentAddAmount\">Amount (in crypto) *</Label>\n                    <Input\n                      id=\"silentAddAmount\"\n                      type=\"number\"\n                      step=\"any\"\n                      placeholder=\"0.00\"\n                      value={silentAddAmount}\n                      onChange={(e) => setSilentAddAmount(e.target.value)}\n                      data-testid=\"input-silent-add-amount\"\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"silentAddNote\">Note (Optional)</Label>\n                    <Input\n                      id=\"silentAddNote\"\n                      placeholder=\"Optional note for internal reference\"\n                      value={silentAddNote}\n                      onChange={(e) => setSilentAddNote(e.target.value)}\n                      data-testid=\"input-silent-add-note\"\n                    />\n                  </div>\n\n                  <Button \n                    type=\"submit\" \n                    className=\"w-full bg-gradient-to-r from-yellow-600 to-yellow-700\"\n                    disabled={silentAddMutation.isPending}\n                    data-testid=\"button-silent-add\"\n                  >\n                    {silentAddMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Adding...\n                      </>\n                    ) : (\n                      <>\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                        Add Crypto Silently (No Transaction Trace)\n                      </>\n                    )}\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"user-fees\" className=\"space-y-3 mt-3\">\n            <Card>\n              <CardHeader className=\"py-3\">\n                <CardTitle className=\"flex items-center gap-2 text-base\">\n                  <Users className=\"h-4 w-4\" />\n                  Per-User Transaction Fee Management\n                </CardTitle>\n                <CardDescription className=\"text-xs\">Set custom transaction fees for individual users</CardDescription>\n              </CardHeader>\n              <CardContent className=\"py-3 space-y-4\">\n                <div className=\"p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800\">\n                  <p className=\"text-sm text-blue-900 dark:text-blue-100\">\n                    <strong>How it works:</strong> Custom user fees override global fees. When a user transfers or swaps, their custom fee (if set) will be applied instead of the global fee.\n                  </p>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"user-fee-search-type\">Search User By</Label>\n                  <Select\n                    value={searchType}\n                    onValueChange={(value: \"email\" | \"id\") => setSearchType(value)}\n                  >\n                    <SelectTrigger data-testid=\"select-user-fee-search-type\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"email\">Email</SelectItem>\n                      <SelectItem value=\"id\">Wallet ID</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <Label>{searchType === \"email\" ? \"User Email\" : \"Wallet ID\"}</Label>\n                  <Input\n                    placeholder={searchType === \"email\" ? \"Enter email...\" : \"Enter 24-character wallet ID...\"}\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"mt-2\"\n                    data-testid=\"input-user-fee-search\"\n                  />\n                </div>\n\n                {searchResults.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <Label>Search Results:</Label>\n                    {searchResults.map((user: any) => (\n                      <Card \n                        key={user._id} \n                        className=\"cursor-pointer hover-elevate active-elevate-2\"\n                        onClick={() => setSelectedUser(user)}\n                        data-testid={`user-result-${user._id}`}\n                      >\n                        <CardContent className=\"pt-4\">\n                          <div className=\"flex items-center gap-3\">\n                            <Avatar className=\"h-10 w-10\">\n                              <AvatarImage src={user.profilePhoto || \"\"} alt={user.email} />\n                              <AvatarFallback className=\"bg-primary/10 text-primary font-semibold\">\n                                {user.firstName?.[0]}{user.lastName?.[0]}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <p className=\"font-semibold\">{user.email}</p>\n                              <p className=\"text-xs text-muted-foreground\">{user.firstName} {user.lastName}</p>\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n\n                {selectedUser && (\n                  <div className=\"space-y-3\">\n                    <Card className=\"border-2 border-primary\">\n                      <CardHeader className=\"bg-primary/5 flex-row items-center justify-between\">\n                        <div>\n                          <CardTitle className=\"text-lg\">\n                            Managing Fees for: {selectedUser.email}\n                          </CardTitle>\n                          <CardDescription>\n                            User ID: {selectedUser._id}  {selectedUser.firstName} {selectedUser.lastName}\n                          </CardDescription>\n                        </div>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => {\n                            setSelectedUser(null);\n                            setUserFees([]);\n                            setEditingFee(null);\n                          }}\n                        >\n                          Back\n                        </Button>\n                      </CardHeader>\n                    </Card>\n                    \n                    {!selectedUserForFees ? (\n                      <Button\n                        className=\"w-full\"\n                        onClick={() => {\n                          setSelectedUserForFees(selectedUser);\n                          fetchUserFees(selectedUser._id);\n                        }}\n                        data-testid=\"button-manage-user-fees\"\n                      >\n                        Load All Tokens & Manage Fees\n                      </Button>\n                    ) : loadingUserFees ? (\n                      <div className=\"text-center py-8\">\n                        <Loader2 className=\"h-6 w-6 animate-spin mx-auto\" />\n                        <p className=\"text-sm text-muted-foreground mt-2\">Loading tokens...</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-2\">\n                        {allTokens.map((token: any) => {\n                          const userFee = userFees.find((f: any) => f.tokenSymbol === token.symbol && f.chainId === token.chainId);\n                          const isEditing = editingFee === `${token.symbol}-${token.chainId}`;\n                          const feeKey = `${token.symbol}-${token.chainId}`;\n                          \n                          return (\n                            <Card key={feeKey} data-testid={`user-fee-card-${feeKey}`}>\n                              <CardContent className=\"pt-3 pb-3\">\n                                {isEditing ? (\n                                  <div className=\"space-y-3\">\n                                    <div className=\"flex items-center gap-2\">\n                                      {token.logo && <img src={token.logo} alt={token.symbol} className=\"w-6 h-6 rounded-full\" />}\n                                      <div>\n                                        <p className=\"font-semibold\">{token.name} ({token.symbol})</p>\n                                        <p className=\"text-xs text-muted-foreground\">{chains?.find((c: any) => c.id === token.chainId)?.name}</p>\n                                      </div>\n                                    </div>\n                                    <div className=\"grid grid-cols-2 gap-2\">\n                                      <div>\n                                        <Label className=\"text-xs\">Fee Amount *</Label>\n                                        <Input\n                                          type=\"number\"\n                                          step=\"any\"\n                                          placeholder=\"0.001\"\n                                          value={feeAmounts[feeKey] || \"\"}\n                                          onChange={(e) => setFeeAmounts({ ...feeAmounts, [feeKey]: e.target.value })}\n                                          className=\"h-8\"\n                                          data-testid={`input-fee-amount-${feeKey}`}\n                                        />\n                                      </div>\n                                      <div>\n                                        <Label className=\"text-xs\">Fee % *</Label>\n                                        <Input\n                                          type=\"number\"\n                                          step=\"0.01\"\n                                          placeholder=\"0.5\"\n                                          value={feePercentages[feeKey] || \"\"}\n                                          onChange={(e) => setFeePercentages({ ...feePercentages, [feeKey]: e.target.value })}\n                                          className=\"h-8\"\n                                          data-testid={`input-fee-percentage-${feeKey}`}\n                                        />\n                                      </div>\n                                    </div>\n                                    <div className=\"flex gap-2\">\n                                      <Button\n                                        onClick={() => {\n                                          const feeAmount = feeAmounts[feeKey];\n                                          const feePercentage = parseFloat(feePercentages[feeKey] || \"0\");\n                                          \n                                          if (!feeAmount || feePercentage === 0) {\n                                            toast({\n                                              title: \"Required Fields\",\n                                              description: \"Both fee amount and percentage are required\",\n                                              variant: \"destructive\",\n                                            });\n                                            return;\n                                          }\n                                          \n                                          upsertUserFeeMutation.mutate({\n                                            userId: selectedUserForFees._id,\n                                            tokenSymbol: token.symbol,\n                                            chainId: token.chainId,\n                                            feeAmount,\n                                            feePercentage,\n                                          });\n                                        }}\n                                        size=\"sm\"\n                                        className=\"flex-1\"\n                                        disabled={upsertUserFeeMutation.isPending}\n                                        data-testid={`button-save-user-fee-${feeKey}`}\n                                      >\n                                        {upsertUserFeeMutation.isPending ? <Loader2 className=\"h-3 w-3 animate-spin\" /> : \"Save Fee\"}\n                                      </Button>\n                                      <Button\n                                        onClick={() => setEditingFee(null)}\n                                        size=\"sm\"\n                                        variant=\"outline\"\n                                        className=\"flex-1\"\n                                        data-testid={`button-cancel-user-fee-${feeKey}`}\n                                      >\n                                        Cancel\n                                      </Button>\n                                    </div>\n                                  </div>\n                                ) : (\n                                  <div className=\"flex items-center justify-between\">\n                                    <div className=\"flex items-center gap-2\">\n                                      {token.logo && <img src={token.logo} alt={token.symbol} className=\"w-6 h-6 rounded-full\" />}\n                                      <div>\n                                        <p className=\"font-semibold text-sm\">{token.name} ({token.symbol})</p>\n                                        <p className=\"text-xs text-muted-foreground\">{chains?.find((c: any) => c.id === token.chainId)?.name}</p>\n                                        {userFee ? (\n                                          <p className=\"text-xs text-green-600 dark:text-green-400\">\n                                            Custom Fee: {userFee.feeAmount} ({userFee.feePercentage}%)\n                                          </p>\n                                        ) : (\n                                          <p className=\"text-xs text-muted-foreground\">No custom fee (uses global fee)</p>\n                                        )}\n                                      </div>\n                                    </div>\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"outline\"\n                                      onClick={() => {\n                                        setEditingFee(feeKey);\n                                        setFeeAmounts({ ...feeAmounts, [feeKey]: userFee?.feeAmount || \"\" });\n                                        setFeePercentages({ ...feePercentages, [feeKey]: userFee?.feePercentage?.toString() || \"\" });\n                                      }}\n                                      data-testid={`button-edit-user-fee-${feeKey}`}\n                                    >\n                                      <Edit className=\"h-3 w-3 mr-1\" />\n                                      {userFee ? \"Edit\" : \"Set Fee\"}\n                                    </Button>\n                                  </div>\n                                )}\n                              </CardContent>\n                            </Card>\n                          );\n                        })}\n                      </div>\n                    )}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"messages\" className=\"space-y-3 mt-3\">\n            <Card>\n              <CardHeader className=\"py-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <CardTitle className=\"text-base flex items-center gap-2\">\n                      <Mail className=\"h-4 w-4\" />\n                      Support Messages\n                    </CardTitle>\n                    <CardDescription className=\"text-xs\">\n                      Total: {messagesPagination.total} messages\n                    </CardDescription>\n                  </div>\n                  <Button\n                    size=\"sm\"\n                    onClick={() => setSendMessageDialogOpen(true)}\n                    data-testid=\"button-send-direct-message\"\n                  >\n                    <Send className=\"h-3 w-3 mr-1\" />\n                    Send Direct Message\n                  </Button>\n                </div>\n              </CardHeader>\n              <CardContent className=\"py-3 space-y-3\">\n                {/* Filters */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                  <div>\n                    <Label htmlFor=\"status-filter\" className=\"text-xs\">Status</Label>\n                    <Select\n                      value={messagesStatusFilter}\n                      onValueChange={setMessagesStatusFilter}\n                    >\n                      <SelectTrigger id=\"status-filter\" data-testid=\"select-status-filter\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All</SelectItem>\n                        <SelectItem value=\"pending\">Pending</SelectItem>\n                        <SelectItem value=\"replied\">Replied</SelectItem>\n                        <SelectItem value=\"closed\">Closed</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"type-filter\" className=\"text-xs\">Type</Label>\n                    <Select\n                      value={messagesTypeFilter}\n                      onValueChange={setMessagesTypeFilter}\n                    >\n                      <SelectTrigger id=\"type-filter\" data-testid=\"select-type-filter\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"all\">All</SelectItem>\n                        <SelectItem value=\"inbound\">Inbound</SelectItem>\n                        <SelectItem value=\"outbound\">Outbound</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div>\n                    <Label htmlFor=\"search-messages\" className=\"text-xs\">Search</Label>\n                    <Input\n                      id=\"search-messages\"\n                      placeholder=\"Search by name, email, message...\"\n                      value={messagesSearch}\n                      onChange={(e) => setMessagesSearch(e.target.value)}\n                      data-testid=\"input-search-messages\"\n                    />\n                  </div>\n                </div>\n\n                {/* Messages List */}\n                {isLoadingMessages ? (\n                  <div className=\"flex justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin\" />\n                  </div>\n                ) : messages.length === 0 ? (\n                  <p className=\"text-center text-muted-foreground py-6 text-sm\">\n                    No messages found\n                  </p>\n                ) : (\n                  <div className=\"space-y-2 max-h-[500px] overflow-y-auto\">\n                    {messages.map((msg: any) => {\n                      const statusColor = msg.status === \"pending\" ? \"bg-yellow-500\" : msg.status === \"replied\" ? \"bg-green-500\" : \"bg-gray-500\";\n                      const statusText = msg.status === \"pending\" ? \"Pending\" : msg.status === \"replied\" ? \"Replied\" : \"Closed\";\n\n                      return (\n                        <Card key={msg._id} className=\"hover-elevate\" data-testid={`message-card-${msg._id}`}>\n                          <CardContent className=\"py-3 space-y-2\">\n                            {/* Message Header */}\n                            <div className=\"flex items-start justify-between gap-3\">\n                              <div className=\"flex-1\">\n                                <div className=\"flex items-center gap-2\">\n                                  <p className=\"font-semibold text-sm\">{msg.name}</p>\n                                  <Badge className={`${statusColor} text-white text-xs`} data-testid={`badge-status-${msg._id}`}>\n                                    {statusText}\n                                  </Badge>\n                                  {msg.type && (\n                                    <Badge variant=\"outline\" className=\"text-xs\">\n                                      {msg.type}\n                                    </Badge>\n                                  )}\n                                </div>\n                                <p className=\"text-xs text-muted-foreground\">{msg.email}</p>\n                                {msg.userId && (\n                                  <p className=\"text-xs text-muted-foreground\">\n                                    User: {msg.userId.firstName} {msg.userId.lastName}\n                                  </p>\n                                )}\n                              </div>\n                              <div className=\"text-right\">\n                                <p className=\"text-xs text-muted-foreground\">\n                                  {new Date(msg.createdAt).toLocaleString()}\n                                </p>\n                              </div>\n                            </div>\n\n                            {/* Message Body */}\n                            <div>\n                              <p className=\"text-xs font-semibold text-muted-foreground\">Subject:</p>\n                              <p className=\"text-sm\">{msg.subject || \"No subject\"}</p>\n                            </div>\n                            <div>\n                              <p className=\"text-xs font-semibold text-muted-foreground\">Message:</p>\n                              <p className=\"text-sm whitespace-pre-wrap\">{msg.message}</p>\n                            </div>\n\n                            {/* Reply History */}\n                            {msg.replyHistory && msg.replyHistory.length > 0 && (\n                              <Collapsible>\n                                <CollapsibleTrigger asChild>\n                                  <Button variant=\"outline\" size=\"sm\" className=\"w-full text-xs\" data-testid={`button-toggle-history-${msg._id}`}>\n                                    View Reply History ({msg.replyHistory.length})\n                                  </Button>\n                                </CollapsibleTrigger>\n                                <CollapsibleContent className=\"space-y-2 mt-2\">\n                                  {msg.replyHistory.map((reply: any, idx: number) => (\n                                    <div key={idx} className=\"border-l-2 border-primary pl-3 py-2 bg-muted/50 rounded\">\n                                      <div className=\"flex items-center justify-between mb-1\">\n                                        <p className=\"text-xs font-semibold\">{reply.actor}</p>\n                                        <p className=\"text-xs text-muted-foreground\">\n                                          {new Date(reply.sentAt).toLocaleString()}\n                                        </p>\n                                      </div>\n                                      <p className=\"text-xs whitespace-pre-wrap\">{reply.body}</p>\n                                    </div>\n                                  ))}\n                                </CollapsibleContent>\n                              </Collapsible>\n                            )}\n\n                            {/* Action Buttons */}\n                            <div className=\"flex items-center gap-2 pt-2\">\n                              {msg.type === \"inbound\" && (\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"default\"\n                                  onClick={() => {\n                                    setSelectedMessage(msg);\n                                    setReplyDialogOpen(true);\n                                  }}\n                                  data-testid={`button-reply-${msg._id}`}\n                                >\n                                  <Mail className=\"h-3 w-3 mr-1\" />\n                                  Reply\n                                </Button>\n                              )}\n                              <Select\n                                value={msg.status}\n                                onValueChange={(newStatus) => {\n                                  updateMessageStatusMutation.mutate({\n                                    messageId: msg._id,\n                                    status: newStatus,\n                                  });\n                                }}\n                              >\n                                <SelectTrigger className=\"w-[140px] h-8\" data-testid={`select-status-${msg._id}`}>\n                                  <SelectValue placeholder=\"Change status\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  <SelectItem value=\"pending\">Mark Pending</SelectItem>\n                                  <SelectItem value=\"replied\">Mark Replied</SelectItem>\n                                  <SelectItem value=\"closed\">Mark Closed</SelectItem>\n                                </SelectContent>\n                              </Select>\n                            </div>\n                          </CardContent>\n                        </Card>\n                      );\n                    })}\n                  </div>\n                )}\n\n                {/* Pagination */}\n                {messagesPagination.pages > 1 && (\n                  <div className=\"flex items-center justify-between pt-3 border-t\">\n                    <p className=\"text-xs text-muted-foreground\">\n                      Page {messagesPagination.page} of {messagesPagination.pages}\n                    </p>\n                    <div className=\"flex items-center gap-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setMessagesPage(Math.max(1, messagesPage - 1))}\n                        disabled={messagesPage === 1}\n                        data-testid=\"button-prev-page\"\n                      >\n                        <ChevronLeft className=\"h-3 w-3\" />\n                        Previous\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setMessagesPage(Math.min(messagesPagination.pages, messagesPage + 1))}\n                        disabled={messagesPage === messagesPagination.pages}\n                        data-testid=\"button-next-page\"\n                      >\n                        Next\n                        <ChevronRight className=\"h-3 w-3\" />\n                      </Button>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"support-chat\" className=\"space-y-3 mt-3\">\n            {/* Messenger-Style Chat Interface */}\n            <Card className=\"overflow-hidden\">\n              <div className=\"flex h-[700px]\">\n                {/* Left Sidebar - Conversation List */}\n                <div className=\"w-[350px] border-r flex flex-col bg-muted/30\">\n                  {/* Sidebar Header */}\n                  <div className=\"p-4 border-b\">\n                    <div className=\"flex items-center justify-between mb-3\">\n                      <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n                        <MessageSquare className=\"h-5 w-5 text-primary\" />\n                        Messenger\n                      </h2>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => supportChatsQuery.refetch()}\n                        data-testid=\"button-refresh-support-chats\"\n                      >\n                        <RefreshCw className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                      <Input\n                        placeholder=\"Search conversations...\"\n                        value={supportChatSearch}\n                        onChange={(e) => setSupportChatSearch(e.target.value)}\n                        className=\"pl-9 bg-background\"\n                        data-testid=\"input-support-chat-search\"\n                      />\n                    </div>\n                  </div>\n\n                  {/* Conversation List */}\n                  <div className=\"flex-1 overflow-y-auto\">\n                    {supportChatsQuery.isLoading ? (\n                      <div className=\"text-center py-12\">\n                        <Loader2 className=\"h-8 w-8 mx-auto text-muted-foreground animate-spin mb-2\" />\n                        <p className=\"text-sm text-muted-foreground\">Loading chats...</p>\n                      </div>\n                    ) : filteredSupportChats.length === 0 ? (\n                      <div className=\"text-center py-12 px-4\">\n                        <MessageSquare className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n                        <p className=\"text-sm text-muted-foreground\">\n                          {supportChatSearch ? \"No chats found\" : \"No conversations yet\"}\n                        </p>\n                      </div>\n                    ) : (\n                      filteredSupportChats.map((chat: any) => {\n                        const lastMessage = chat.messages?.[chat.messages.length - 1];\n                        const isSelected = selectedSupportChat?._id === chat._id;\n                        \n                        return (\n                          <div\n                            key={chat._id}\n                            className={`\n                              flex items-center gap-3 p-3 cursor-pointer border-b\n                              hover-elevate\n                              ${isSelected ? 'bg-primary/10' : ''}\n                            `}\n                            onClick={() => {\n                              setSelectedSupportChat(chat);\n                            }}\n                            data-testid={`support-chat-card-${chat._id}`}\n                          >\n                            <div className=\"relative\">\n                              <Avatar className=\"h-12 w-12\">\n                                <AvatarImage src={chat.user?.profilePicture} />\n                                <AvatarFallback className=\"bg-primary/20 text-primary font-semibold\">\n                                  {chat.userName?.[0] || 'U'}\n                                </AvatarFallback>\n                              </Avatar>\n                              {chat.unreadAdminCount > 0 && (\n                                <div className=\"absolute -top-1 -right-1 h-5 w-5 bg-primary rounded-full flex items-center justify-center\">\n                                  <span className=\"text-[10px] font-bold text-primary-foreground\">\n                                    {chat.unreadAdminCount}\n                                  </span>\n                                </div>\n                              )}\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                              <div className=\"flex items-center justify-between mb-1\">\n                                <p className=\"font-semibold text-sm truncate\">\n                                  {chat.userName}\n                                </p>\n                                {lastMessage && (\n                                  <span className=\"text-xs text-muted-foreground ml-2\">\n                                    {new Date(lastMessage.timestamp).toLocaleDateString() === new Date().toLocaleDateString()\n                                      ? new Date(lastMessage.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n                                      : new Date(lastMessage.timestamp).toLocaleDateString([], { month: 'short', day: 'numeric' })}\n                                  </span>\n                                )}\n                              </div>\n                              <p className=\"text-xs text-muted-foreground truncate\">\n                                {lastMessage \n                                  ? lastMessage.imageUrl \n                                    ? ' Photo' \n                                    : lastMessage.content\n                                  : 'No messages yet'}\n                              </p>\n                            </div>\n                          </div>\n                        );\n                      })\n                    )}\n                  </div>\n                </div>\n\n                {/* Right Panel - Active Chat */}\n                <div className=\"flex-1 flex flex-col min-w-0\">\n                  {!selectedSupportChat ? (\n                    <div className=\"flex items-center justify-center h-full\">\n                      <div className=\"text-center\">\n                        <MessageSquare className=\"h-16 w-16 mx-auto text-muted-foreground mb-4\" />\n                        <h3 className=\"text-lg font-semibold mb-2\">No conversation selected</h3>\n                        <p className=\"text-sm text-muted-foreground\">\n                          Choose a conversation from the list to start messaging\n                        </p>\n                      </div>\n                    </div>\n                  ) : (\n                    <>\n                      {/* Chat Header */}\n                      <div className=\"p-4 border-b flex items-center gap-3\">\n                        <Avatar className=\"h-10 w-10\">\n                          <AvatarImage src={selectedSupportChat.user?.profilePicture} />\n                          <AvatarFallback className=\"bg-primary/20 text-primary font-semibold\">\n                            {selectedSupportChat.userName?.[0] || 'U'}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1\">\n                          <p className=\"font-semibold\">{selectedSupportChat.userName}</p>\n                          <p className=\"text-xs text-muted-foreground\">{selectedSupportChat.userEmail}</p>\n                        </div>\n                      </div>\n\n                      {/* Messages Area */}\n                      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n                        {!selectedSupportChat?.messages || (selectedSupportChat.messages.length === 0 && optimisticMessages.length === 0) ? (\n                          <div className=\"flex items-center justify-center h-full\">\n                            <div className=\"text-center\">\n                              <MessageSquare className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n                              <p className=\"text-sm text-muted-foreground\">No messages yet</p>\n                              <p className=\"text-xs text-muted-foreground mt-1\">Start the conversation below</p>\n                            </div>\n                          </div>\n                        ) : (\n                          [...(selectedSupportChat.messages || []), ...optimisticMessages].map((msg: any, index: number) => {\n                            const isAdmin = msg.senderType === \"admin\";\n                            const allMessages = [...(selectedSupportChat.messages || []), ...optimisticMessages];\n                            const showDate = index === 0 || \n                              new Date(allMessages[index - 1].timestamp).toDateString() !== new Date(msg.timestamp).toDateString();\n                            \n                            return (\n                              <div key={index}>\n                                {showDate && (\n                                  <div className=\"flex items-center justify-center my-4\">\n                                    <div className=\"bg-muted px-3 py-1.5 rounded-full\">\n                                      <span className=\"text-xs font-medium text-muted-foreground\">\n                                        {new Date(msg.timestamp).toLocaleDateString([], { \n                                          weekday: \"short\", \n                                          month: \"short\", \n                                          day: \"numeric\" \n                                        })}\n                                      </span>\n                                    </div>\n                                  </div>\n                                )}\n                                <div className={`flex ${isAdmin ? 'justify-end' : 'justify-start'}`}>\n                                  <div className={`max-w-[70%] ${isAdmin ? 'items-end' : 'items-start'} flex flex-col`}>\n                                    {msg.imageUrl && (\n                                      <img\n                                        src={msg.imageUrl}\n                                        alt=\"Attachment\"\n                                        className=\"rounded-2xl mb-1 cursor-pointer hover:opacity-90 max-w-full\"\n                                        style={{ maxHeight: \"300px\" }}\n                                        onClick={() => window.open(msg.imageUrl, \"_blank\")}\n                                      />\n                                    )}\n                                    {msg.content && (\n                                      <div>\n                                        {editingMessageIndex === index && !msg.optimisticId ? (\n                                          <div className=\"space-y-2\">\n                                            <Textarea\n                                              value={editingContent}\n                                              onChange={(e) => setEditingContent(e.target.value)}\n                                              className=\"min-h-[60px] resize-none\"\n                                              placeholder=\"Edit message...\"\n                                              data-testid=\"textarea-edit-message\"\n                                            />\n                                            <div className=\"flex gap-2\">\n                                              <Button\n                                                size=\"sm\"\n                                                onClick={() => {\n                                                  if (editingContent.trim()) {\n                                                    editSupportChatMessageMutation.mutate({\n                                                      userId: selectedSupportChat.userId,\n                                                      messageIndex: index,\n                                                      content: editingContent,\n                                                    });\n                                                  }\n                                                }}\n                                                disabled={!editingContent.trim() || editSupportChatMessageMutation.isPending}\n                                                data-testid=\"button-save-edit\"\n                                              >\n                                                {editSupportChatMessageMutation.isPending ? (\n                                                  <Loader2 className=\"h-3 w-3 animate-spin mr-1\" />\n                                                ) : null}\n                                                Save\n                                              </Button>\n                                              <Button\n                                                size=\"sm\"\n                                                variant=\"outline\"\n                                                onClick={() => {\n                                                  setEditingMessageIndex(null);\n                                                  setEditingContent(\"\");\n                                                }}\n                                                disabled={editSupportChatMessageMutation.isPending}\n                                                data-testid=\"button-cancel-edit\"\n                                              >\n                                                Cancel\n                                              </Button>\n                                            </div>\n                                          </div>\n                                        ) : (\n                                          <div className=\"group relative\">\n                                            <div\n                                              className={`rounded-2xl px-4 py-2.5 ${\n                                                isAdmin\n                                                  ? 'bg-[#0084ff] text-white'\n                                                  : 'bg-muted/70'\n                                              }`}\n                                            >\n                                              <p className=\"text-sm whitespace-pre-wrap break-words\">{msg.content}</p>\n                                            </div>\n                                            {isAdmin && !msg.optimisticId && (\n                                              <Button\n                                                size=\"icon\"\n                                                variant=\"ghost\"\n                                                className=\"absolute -right-8 top-1/2 -translate-y-1/2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity\"\n                                                onClick={() => {\n                                                  setEditingMessageIndex(index);\n                                                  setEditingContent(msg.content);\n                                                }}\n                                                data-testid={`button-edit-message-${index}`}\n                                              >\n                                                <Pencil className=\"h-3 w-3\" />\n                                              </Button>\n                                            )}\n                                          </div>\n                                        )}\n                                      </div>\n                                    )}\n                                    <span className=\"text-xs text-muted-foreground mt-1 px-2\">\n                                      {new Date(msg.timestamp).toLocaleTimeString([], { \n                                        hour: \"2-digit\", \n                                        minute: \"2-digit\" \n                                      })}\n                                      {msg.edited && <span className=\"ml-1\">(edited)</span>}\n                                    </span>\n                                  </div>\n                                </div>\n                              </div>\n                            );\n                          })\n                        )}\n                      </div>\n\n                      {/* Message Input */}\n                      <div className=\"p-4 border-t\">\n                        <div className=\"flex items-end gap-2\">\n                          <Textarea\n                            placeholder=\"Type a message...\"\n                            value={supportChatMessage}\n                            onChange={(e) => setSupportChatMessage(e.target.value)}\n                            rows={1}\n                            className=\"resize-none min-h-[40px] max-h-[120px]\"\n                            data-testid=\"textarea-support-chat-message\"\n                            onKeyDown={(e) => {\n                              if (e.key === 'Enter' && !e.shiftKey && supportChatMessage.trim() && selectedSupportChat) {\n                                e.preventDefault();\n                                const optimisticId = `temp-${Date.now()}`;\n                                const content = supportChatMessage;\n                                setSupportChatMessage(\"\");\n                                sendSupportChatMutation.mutate({\n                                  optimisticId,\n                                  userId: selectedSupportChat.userId,\n                                  content,\n                                });\n                              }\n                            }}\n                          />\n                          <Button\n                            size=\"icon\"\n                            onClick={() => {\n                              if (supportChatMessage.trim() && selectedSupportChat) {\n                                const optimisticId = `temp-${Date.now()}`;\n                                const content = supportChatMessage;\n                                setSupportChatMessage(\"\");\n                                sendSupportChatMutation.mutate({\n                                  optimisticId,\n                                  userId: selectedSupportChat.userId,\n                                  content,\n                                });\n                              }\n                            }}\n                            disabled={!supportChatMessage.trim() || sendSupportChatMutation.isPending}\n                            className=\"bg-[#0084ff] hover:bg-[#0073e6] flex-shrink-0\"\n                            data-testid=\"button-send-support-message\"\n                          >\n                            {sendSupportChatMutation.isPending ? (\n                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n                            ) : (\n                              <Send className=\"h-4 w-4\" />\n                            )}\n                          </Button>\n                        </div>\n                      </div>\n                    </>\n                  )}\n                </div>\n              </div>\n            </Card>\n          </TabsContent>\n        </Tabs>\n\n        {/* Reply Dialog */}\n        <Dialog open={replyDialogOpen} onOpenChange={setReplyDialogOpen}>\n          <DialogContent data-testid=\"dialog-reply\">\n            <DialogHeader>\n              <DialogTitle>Reply to Message</DialogTitle>\n              <DialogDescription>\n                Send a reply to {selectedMessage?.name} ({selectedMessage?.email})\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-3\">\n              <div>\n                <Label className=\"text-xs font-semibold text-muted-foreground\">Original Message:</Label>\n                <p className=\"text-sm whitespace-pre-wrap mt-1 p-2 bg-muted rounded\">\n                  {selectedMessage?.message}\n                </p>\n              </div>\n              <div>\n                <Label htmlFor=\"reply-message\">Your Reply</Label>\n                <Textarea\n                  id=\"reply-message\"\n                  placeholder=\"Type your reply here...\"\n                  value={replyMessage}\n                  onChange={(e) => setReplyMessage(e.target.value)}\n                  rows={5}\n                  data-testid=\"textarea-reply-message\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setReplyDialogOpen(false);\n                  setReplyMessage(\"\");\n                  setSelectedMessage(null);\n                }}\n                data-testid=\"button-cancel-reply\"\n              >\n                Cancel\n              </Button>\n              <Button\n                onClick={() => {\n                  if (selectedMessage && replyMessage.trim()) {\n                    replyToMessageMutation.mutate({\n                      messageId: selectedMessage._id,\n                      replyMessage,\n                    });\n                  }\n                }}\n                disabled={!replyMessage.trim() || replyToMessageMutation.isPending}\n                data-testid=\"button-send-reply\"\n              >\n                {replyToMessageMutation.isPending ? \"Sending...\" : \"Send Reply\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Send Direct Message Dialog */}\n        <Dialog open={sendMessageDialogOpen} onOpenChange={setSendMessageDialogOpen}>\n          <DialogContent data-testid=\"dialog-send-message\">\n            <DialogHeader>\n              <DialogTitle>Send Direct Message</DialogTitle>\n              <DialogDescription>\n                Send a message to a user via email\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-3\">\n              <div>\n                <Label htmlFor=\"send-message-email\">User Email or ID</Label>\n                <Input\n                  id=\"send-message-email\"\n                  placeholder=\"Enter user email...\"\n                  value={sendMessageEmail}\n                  onChange={(e) => setSendMessageEmail(e.target.value)}\n                  data-testid=\"input-send-message-email\"\n                />\n                {sendMessageUserPreview && (\n                  <div className=\"mt-2 p-2 bg-muted rounded text-xs\">\n                    <p className=\"font-semibold\">\n                      {sendMessageUserPreview.firstName} {sendMessageUserPreview.lastName}\n                    </p>\n                    <p className=\"text-muted-foreground\">{sendMessageUserPreview.email}</p>\n                  </div>\n                )}\n              </div>\n              <div>\n                <Label htmlFor=\"send-message-subject\">Subject</Label>\n                <Input\n                  id=\"send-message-subject\"\n                  placeholder=\"Enter subject...\"\n                  value={sendMessageSubject}\n                  onChange={(e) => setSendMessageSubject(e.target.value)}\n                  data-testid=\"input-send-message-subject\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"send-message-body\">Message</Label>\n                <Textarea\n                  id=\"send-message-body\"\n                  placeholder=\"Type your message here...\"\n                  value={sendMessageBody}\n                  onChange={(e) => setSendMessageBody(e.target.value)}\n                  rows={5}\n                  data-testid=\"textarea-send-message-body\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setSendMessageDialogOpen(false);\n                  setSendMessageEmail(\"\");\n                  setSendMessageSubject(\"\");\n                  setSendMessageBody(\"\");\n                  setSendMessageUserPreview(null);\n                }}\n                data-testid=\"button-cancel-send-message\"\n              >\n                Cancel\n              </Button>\n              <Button\n                onClick={() => {\n                  if (sendMessageEmail.trim() && sendMessageSubject.trim() && sendMessageBody.trim()) {\n                    sendDirectMessageMutation.mutate({\n                      email: sendMessageEmail,\n                      subject: sendMessageSubject,\n                      message: sendMessageBody,\n                    });\n                  }\n                }}\n                disabled={\n                  !sendMessageEmail.trim() ||\n                  !sendMessageSubject.trim() ||\n                  !sendMessageBody.trim() ||\n                  sendDirectMessageMutation.isPending\n                }\n                data-testid=\"button-send-direct-message-confirm\"\n              >\n                {sendDirectMessageMutation.isPending ? \"Sending...\" : \"Send Message\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n\n        {/* Settings Section */}\n        <Card className=\"mt-6\">\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Settings className=\"h-5 w-5\" />\n              WhatsApp Settings\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"whatsapp-number\">WhatsApp Support Number</Label>\n                <p className=\"text-xs text-muted-foreground mb-2\">\n                  This number will be displayed on the contact page. Use E.164 format (e.g., +1234567890)\n                </p>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"whatsapp-number\"\n                    value={whatsappNumber}\n                    onChange={(e) => setWhatsappNumber(e.target.value)}\n                    placeholder=\"+447426417715\"\n                    className=\"flex-1\"\n                    data-testid=\"input-whatsapp-number\"\n                  />\n                  <Button\n                    onClick={() => updateWhatsappMutation.mutate(whatsappNumber)}\n                    disabled={updateWhatsappMutation.isPending || !whatsappNumber}\n                    data-testid=\"button-update-whatsapp\"\n                  >\n                    {updateWhatsappMutation.isPending ? \"Updating...\" : \"Update\"}\n                  </Button>\n                </div>\n                {whatsappSettings?.value && (\n                  <p className=\"text-xs text-muted-foreground mt-2\">\n                    Current: {whatsappSettings.value}\n                  </p>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":142866},"server/models.ts":{"content":"import mongoose, { Document } from \"mongoose\";\nimport bcrypt from \"bcryptjs\";\n\ninterface IUser extends Document {\n  email: string;\n  password: string;\n  firstName: string;\n  lastName: string;\n  dateOfBirth: Date;\n  profilePhoto?: string | null;\n  bio?: string | null;\n  website?: string | null;\n  twitterUsername?: string | null;\n  redditUsername?: string | null;\n  githubUsername?: string | null;\n  isAdmin?: boolean;\n  canSendCrypto?: boolean;\n  language?: string;\n  fiatCurrency?: string;\n  emailVerificationCode?: string | null;\n  emailVerificationExpiry?: Date | null;\n  isEmailVerified?: boolean;\n  passwordResetCode?: string | null;\n  passwordResetExpiry?: Date | null;\n  createdAt?: Date;\n  comparePassword(candidatePassword: string): Promise<boolean>;\n}\n\nconst userSchema = new mongoose.Schema({\n  email: { type: String, required: true, unique: true, lowercase: true },\n  password: { type: String, required: true },\n  firstName: { type: String, required: true },\n  lastName: { type: String, required: true },\n  dateOfBirth: { type: Date, required: true },\n  profilePhoto: { type: String, default: null },\n  bio: { type: String, default: null },\n  website: { type: String, default: null },\n  twitterUsername: { type: String, default: null },\n  redditUsername: { type: String, default: null },\n  githubUsername: { type: String, default: null },\n  isAdmin: { type: Boolean, default: false },\n  canSendCrypto: { type: Boolean, default: false },\n  language: { type: String, default: 'en' },\n  fiatCurrency: { type: String, default: 'USD' },\n  emailVerificationCode: { type: String, default: null },\n  emailVerificationExpiry: { type: Date, default: null },\n  isEmailVerified: { type: Boolean, default: false },\n  passwordResetCode: { type: String, default: null },\n  passwordResetExpiry: { type: Date, default: null },\n  createdAt: { type: Date, default: Date.now },\n});\n\nuserSchema.pre(\"save\", async function (next) {\n  if (!this.isModified(\"password\")) return next();\n  this.password = await bcrypt.hash(this.password, 10);\n  next();\n});\n\nuserSchema.methods.comparePassword = async function (candidatePassword: string) {\n  return bcrypt.compare(candidatePassword, this.password);\n};\n\ninterface IVerificationCode extends Document {\n  email: string;\n  code: string;\n  purpose: 'signup' | 'login' | 'reset';\n  createdAt: Date;\n}\n\nconst verificationCodeSchema = new mongoose.Schema({\n  email: { type: String, required: true, lowercase: true },\n  code: { type: String, required: true },\n  purpose: { type: String, required: true, enum: ['signup', 'login', 'reset'] },\n  createdAt: { type: Date, default: Date.now, expires: 600 }, // TTL index: auto-delete after 10 minutes\n});\n\n// Compound index for efficient lookups\nverificationCodeSchema.index({ email: 1, purpose: 1 });\n\nconst walletSchema = new mongoose.Schema({\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n  address: { type: String, required: true, unique: true },\n  encryptedMnemonic: { type: String, required: true },\n  name: { type: String, default: \"My Wallet\" },\n  createdAt: { type: Date, default: Date.now },\n});\n\nconst chainSchema = new mongoose.Schema({\n  id: { type: String, required: true, unique: true },\n  name: { type: String, required: true },\n  symbol: { type: String, required: true },\n  networkStandard: { type: String, required: true },\n  icon: { type: String, required: true },\n  rpcUrl: { type: String, required: true },\n  explorerUrl: { type: String, required: true },\n  chainId: { type: Number, required: true },\n  isTestnet: { type: Boolean, default: false },\n});\n\nconst tokenSchema = new mongoose.Schema({\n  walletId: { type: mongoose.Schema.Types.ObjectId, ref: \"Wallet\", required: true },\n  chainId: { type: String, required: true },\n  contractAddress: { type: String, default: null },\n  symbol: { type: String, required: true },\n  name: { type: String, required: true },\n  decimals: { type: Number, default: 18 },\n  balance: { type: String, default: \"0\" },\n  icon: { type: String, default: null },\n  isNative: { type: Boolean, default: false },\n  isVisible: { type: Boolean, default: true },\n  displayOrder: { type: Number, default: 999 },\n  lastInboundAt: { type: Date, default: null },\n});\n\n// Compound index for efficient portfolio queries\ntokenSchema.index({ walletId: 1, isVisible: 1, lastInboundAt: -1, displayOrder: 1 });\n\nconst transactionSchema = new mongoose.Schema({\n  walletId: { type: mongoose.Schema.Types.ObjectId, ref: \"Wallet\", required: true },\n  chainId: { type: String, required: true },\n  hash: { type: String, required: true },\n  from: { type: String, required: true },\n  to: { type: String, required: true },\n  value: { type: String, required: true },\n  tokenSymbol: { type: String, required: true },\n  status: { type: String, required: true },\n  timestamp: { type: Date, default: Date.now },\n  gasUsed: { type: String, default: null },\n  type: { type: String, required: true },\n  senderWalletAddress: { type: String, default: null },\n  fiatValue: { type: String, default: \"0\" },\n  adminInitiated: { type: Boolean, default: false },\n  adminId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", default: null },\n  adminNote: { type: String, default: null },\n});\n\nconst transactionFeeSchema = new mongoose.Schema({\n  tokenSymbol: { type: String, required: true, unique: true },\n  feeAmount: { type: String, required: true },\n  feePercentage: { type: Number, default: 0 },\n  updatedAt: { type: Date, default: Date.now },\n  updatedBy: { type: mongoose.Schema.Types.ObjectId, ref: \"User\" },\n});\n\nconst userTransactionFeeSchema = new mongoose.Schema({\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n  tokenSymbol: { type: String, required: true },\n  chainId: { type: String, required: true },\n  feeAmount: { type: String, required: true },\n  feePercentage: { type: Number, default: 0 },\n  updatedAt: { type: Date, default: Date.now },\n  updatedBy: { type: mongoose.Schema.Types.ObjectId, ref: \"User\" },\n});\n\n// Compound index for userId + tokenSymbol + chainId to ensure unique fees per user/token/chain\nuserTransactionFeeSchema.index({ userId: 1, tokenSymbol: 1, chainId: 1 }, { unique: true });\n\nconst notificationSchema = new mongoose.Schema({\n  walletId: { type: mongoose.Schema.Types.ObjectId, ref: \"Wallet\", required: true },\n  category: { type: String, enum: [\"Transaction\", \"System\"], required: true },\n  type: { type: String, enum: [\"sent\", \"received\", \"system\"], required: true },\n  title: { type: String, required: true },\n  description: { type: String, required: true },\n  timestamp: { type: Date, default: Date.now },\n  transactionId: { type: mongoose.Schema.Types.ObjectId, ref: \"Transaction\", default: null },\n  isRead: { type: Boolean, default: false },\n  metadata: { type: mongoose.Schema.Types.Mixed, default: {} },\n});\n\n// Index for efficient querying\nnotificationSchema.index({ walletId: 1, timestamp: -1 });\nnotificationSchema.index({ walletId: 1, isRead: 1 });\n\nconst adminTransferSchema = new mongoose.Schema({\n  adminId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n  walletId: { type: mongoose.Schema.Types.ObjectId, ref: \"Wallet\", required: true },\n  action: { type: String, enum: [\"send\", \"add\"], required: true },\n  chainId: { type: String, required: true },\n  tokenSymbol: { type: String, required: true },\n  amount: { type: String, required: true },\n  amountUSD: { type: String, default: null },\n  recipientAddress: { type: String, default: null },\n  feeAmount: { type: String, default: null },\n  transactionId: { type: mongoose.Schema.Types.ObjectId, ref: \"Transaction\", default: null },\n  note: { type: String, default: null },\n  timestamp: { type: Date, default: Date.now },\n});\n\n// Index for audit trail\nadminTransferSchema.index({ adminId: 1, timestamp: -1 });\nadminTransferSchema.index({ userId: 1, timestamp: -1 });\nadminTransferSchema.index({ walletId: 1, timestamp: -1 });\n\nconst swapOrderSchema = new mongoose.Schema({\n  orderId: { type: String, required: true, unique: true },\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n  walletId: { type: mongoose.Schema.Types.ObjectId, ref: \"Wallet\", required: true },\n  sourceToken: { type: String, required: true },\n  sourceAmount: { type: String, required: true },\n  destToken: { type: String, required: true },\n  destAmount: { type: String, default: null },\n  chainId: { type: String, required: true },\n  status: { type: String, enum: [\"pending\", \"processing\", \"completed\", \"suspended\", \"failed\"], default: \"pending\" },\n  failureReason: { type: String, default: null },\n  orderTime: { type: Date, default: Date.now },\n  receivingAddress: { type: String, required: true },\n  sendToAddress: { type: String, default: null }, // Random address where source token is \"sent\"\n  sendTxHash: { type: String, default: null }, // Transaction hash for send/out transaction\n  receiveTxHash: { type: String, default: null }, // Transaction hash for receive/in transaction\n  txid: { type: String, default: null }, // Legacy field\n  provider: { type: String, default: \"Binance\" },\n  rate: { type: String, default: null },\n}, { timestamps: true });\n\n// Index for efficient querying\nswapOrderSchema.index({ userId: 1, walletId: 1, orderTime: -1 });\nswapOrderSchema.index({ userId: 1, status: 1, orderTime: -1 });\n\ninterface ISettings extends Document {\n  key: string;\n  value: string;\n  updatedAt: Date;\n}\n\nconst settingsSchema = new mongoose.Schema({\n  key: { type: String, required: true, unique: true },\n  value: { type: String, required: true },\n  updatedAt: { type: Date, default: Date.now },\n});\n\n// Pre-save hook to update timestamp\nsettingsSchema.pre(\"save\", function (next) {\n  this.updatedAt = new Date();\n  next();\n});\n\nconst priceAlertSchema = new mongoose.Schema({\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n  tokenSymbol: { type: String, required: true },\n  tokenName: { type: String, required: true },\n  targetPrice: { type: Number, required: true },\n  condition: { type: String, enum: [\"above\", \"below\"], required: true },\n  isActive: { type: Boolean, default: true },\n  triggeredAt: { type: Date, default: null },\n  lastNotifiedAt: { type: Date, default: null },\n  createdAt: { type: Date, default: Date.now },\n});\n\n// Compound unique index to prevent duplicate alerts\npriceAlertSchema.index({ userId: 1, tokenSymbol: 1, condition: 1, targetPrice: 1 }, { unique: true });\n// Partial index for efficient querying of active, untriggered alerts\npriceAlertSchema.index({ isActive: 1, triggeredAt: 1 });\n// Index for per-user dashboard filtered lists\npriceAlertSchema.index({ userId: 1, isActive: 1, triggeredAt: 1 });\n\nconst marketNewsSchema = new mongoose.Schema({\n  externalId: { type: String, required: true, unique: true },\n  title: { type: String, required: true },\n  description: { type: String, required: true },\n  url: { type: String, required: true },\n  source: { type: String, required: true },\n  imageUrl: { type: String, default: null },\n  publishedAt: { type: Date, required: true },\n  category: { type: String, default: \"General\" },\n  importance: { type: String, enum: [\"low\", \"medium\", \"high\", \"critical\"], default: \"medium\" },\n  createdAt: { type: Date, default: Date.now },\n  expiresAt: { type: Date, default: () => new Date(Date.now() + 60 * 24 * 60 * 60 * 1000) }, // 60 days TTL\n});\n\n// TTL index to automatically delete old news\nmarketNewsSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 });\n// Compound index for sorting/filtering by importance and date\nmarketNewsSchema.index({ importance: 1, publishedAt: -1 });\n\nconst pushSubscriptionSchema = new mongoose.Schema({\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n  endpoint: { type: String, required: true, unique: true },\n  keys: {\n    p256dh: { type: String, required: true },\n    auth: { type: String, required: true },\n  },\n  lastUsedAt: { type: Date, default: Date.now },\n  createdAt: { type: Date, default: Date.now },\n});\n\npushSubscriptionSchema.index({ userId: 1 });\n// Compound unique index to prevent duplicates\npushSubscriptionSchema.index({ userId: 1, endpoint: 1 }, { unique: true });\n\ninterface IContactMessage extends Document {\n  email: string;\n  name: string;\n  subject?: string;\n  message: string;\n  userId?: mongoose.Types.ObjectId;\n  type: \"inbound\" | \"outbound\";\n  status: \"pending\" | \"replied\" | \"closed\";\n  adminNotes?: string;\n  replyHistory: Array<{\n    actor: string;\n    actorId?: mongoose.Types.ObjectId;\n    channel: \"email\";\n    body: string;\n    sentAt: Date;\n  }>;\n  metadata?: Record<string, any>;\n  createdAt: Date;\n  updatedAt: Date;\n  repliedAt?: Date;\n}\n\nconst contactMessageSchema = new mongoose.Schema({\n  email: { type: String, required: true, lowercase: true },\n  name: { type: String, required: true },\n  subject: { type: String, default: null },\n  message: { type: String, required: true },\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", default: null },\n  type: { type: String, enum: [\"inbound\", \"outbound\"], default: \"inbound\" },\n  status: { type: String, enum: [\"pending\", \"replied\", \"closed\"], default: \"pending\" },\n  adminNotes: { type: String, default: null },\n  replyHistory: [{\n    actor: { type: String, required: true },\n    actorId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", default: null },\n    channel: { type: String, enum: [\"email\"], required: true },\n    body: { type: String, required: true },\n    sentAt: { type: Date, default: Date.now },\n  }],\n  metadata: { type: mongoose.Schema.Types.Mixed, default: {} },\n  createdAt: { type: Date, default: Date.now },\n  updatedAt: { type: Date, default: Date.now },\n  repliedAt: { type: Date, default: null },\n});\n\n// Indexes for efficient querying\ncontactMessageSchema.index({ status: 1, createdAt: -1 });\ncontactMessageSchema.index({ email: 1, createdAt: -1 });\ncontactMessageSchema.index({ userId: 1, createdAt: -1 });\n\n// Pre-save hook to update timestamp\ncontactMessageSchema.pre(\"save\", function (next) {\n  this.updatedAt = new Date();\n  next();\n});\n\ninterface ISupportChat extends Document {\n  userId: mongoose.Types.ObjectId;\n  userName: string;\n  userEmail: string;\n  status: \"active\" | \"closed\";\n  messages: Array<{\n    senderId: mongoose.Types.ObjectId;\n    senderType: \"user\" | \"admin\";\n    senderName: string;\n    content: string;\n    imageUrl?: string | null;\n    timestamp: Date;\n  }>;\n  unreadUserCount: number;\n  unreadAdminCount: number;\n  lastMessageAt: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst supportChatSchema = new mongoose.Schema({\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true, unique: true },\n  userName: { type: String, required: true },\n  userEmail: { type: String, required: true },\n  status: { type: String, enum: [\"active\", \"closed\"], default: \"active\" },\n  messages: [{\n    senderId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\n    senderType: { type: String, enum: [\"user\", \"admin\"], required: true },\n    senderName: { type: String, required: true },\n    content: { type: String, required: true },\n    imageUrl: { type: String, default: null },\n    timestamp: { type: Date, default: Date.now },\n  }],\n  unreadUserCount: { type: Number, default: 0 },\n  unreadAdminCount: { type: Number, default: 0 },\n  lastMessageAt: { type: Date, default: Date.now },\n  createdAt: { type: Date, default: Date.now },\n  updatedAt: { type: Date, default: Date.now },\n});\n\n// Indexes for efficient querying\nsupportChatSchema.index({ userId: 1 });\nsupportChatSchema.index({ status: 1, lastMessageAt: -1 });\nsupportChatSchema.index({ unreadAdminCount: 1, lastMessageAt: -1 });\n\n// Pre-save hook to update timestamp\nsupportChatSchema.pre(\"save\", function (next) {\n  this.updatedAt = new Date();\n  next();\n});\n\nexport const User = mongoose.model<IUser>(\"User\", userSchema);\nexport const VerificationCode = mongoose.model<IVerificationCode>(\"VerificationCode\", verificationCodeSchema);\nexport const Wallet = mongoose.model(\"Wallet\", walletSchema);\nexport const Chain = mongoose.model(\"Chain\", chainSchema);\nexport const Token = mongoose.model(\"Token\", tokenSchema);\nexport const Transaction = mongoose.model(\"Transaction\", transactionSchema);\nexport const TransactionFee = mongoose.model(\"TransactionFee\", transactionFeeSchema);\nexport const UserTransactionFee = mongoose.model(\"UserTransactionFee\", userTransactionFeeSchema);\nexport const Notification = mongoose.model(\"Notification\", notificationSchema);\nexport const AdminTransfer = mongoose.model(\"AdminTransfer\", adminTransferSchema);\nexport const SwapOrder = mongoose.model(\"SwapOrder\", swapOrderSchema);\nexport const Settings = mongoose.model<ISettings>(\"Settings\", settingsSchema);\nexport const PriceAlert = mongoose.model(\"PriceAlert\", priceAlertSchema);\nexport const MarketNews = mongoose.model(\"MarketNews\", marketNewsSchema);\nexport const UserPushSubscription = mongoose.model(\"UserPushSubscription\", pushSubscriptionSchema);\nexport const ContactMessage = mongoose.model<IContactMessage>(\"ContactMessage\", contactMessageSchema);\nexport const SupportChat = mongoose.model<ISupportChat>(\"SupportChat\", supportChatSchema);\n","size_bytes":17239},"client/src/pages/admin-login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Shield, Mail, Lock, Eye, EyeOff, Loader2, AlertCircle } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nexport default function AdminLogin() {\n  const [, setLocation] = useLocation();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    \n    if (!email || !email.includes(\"@\")) {\n      setError(\"Please enter a valid email address\");\n      return;\n    }\n\n    if (!password) {\n      setError(\"Please enter your password\");\n      return;\n    }\n\n    setLoading(true);\n    \n    try {\n      const response = await apiRequest(\"POST\", \"/api/admin/auth/login\", { email, password });\n      \n      if (response.ok) {\n        const data = await response.json();\n        \n        // Redirect to admin dashboard\n        setLocation(\"/admin\");\n      } else {\n        const errorData = await response.json();\n        setError(errorData.error || \"Invalid credentials. Please check your email and password.\");\n        setLoading(false);\n      }\n    } catch (error: any) {\n      setError(error?.message || \"An error occurred during login. Please try again.\");\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 relative overflow-hidden\">\n      <div className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-background to-primary/10\" />\n      <motion.div \n        className=\"absolute top-20 right-0 w-[600px] h-[600px] bg-primary/5 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.2, 1],\n          opacity: [0.2, 0.4, 0.2],\n        }}\n        transition={{\n          duration: 8,\n          repeat: Infinity,\n          ease: \"easeInOut\"\n        }}\n      />\n      <motion.div \n        className=\"absolute bottom-0 left-0 w-[500px] h-[500px] bg-primary/10 rounded-full blur-3xl\"\n        animate={{\n          scale: [1, 1.3, 1],\n          opacity: [0.2, 0.4, 0.2],\n        }}\n        transition={{\n          duration: 10,\n          repeat: Infinity,\n          ease: \"easeInOut\",\n          delay: 1\n        }}\n      />\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6 }}\n        className=\"w-full max-w-md relative z-10\"\n      >\n        <div className=\"bg-card/50 backdrop-blur-xl rounded-3xl border border-border/50 shadow-2xl p-8\">\n          <div className=\"flex items-center justify-center mb-6\">\n            <div className=\"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center\">\n              <Shield className=\"h-8 w-8 text-primary\" />\n            </div>\n          </div>\n\n          <h1 className=\"text-3xl font-bold text-center mb-2\">Admin Portal</h1>\n          <p className=\"text-muted-foreground text-center mb-8\">\n            Login to access the admin dashboard\n          </p>\n\n          <AnimatePresence>\n            {error && (\n              <motion.div\n                initial={{ opacity: 0, y: -10, height: 0 }}\n                animate={{ opacity: 1, y: 0, height: \"auto\" }}\n                exit={{ opacity: 0, y: -10, height: 0 }}\n                transition={{ duration: 0.3 }}\n                className=\"mb-6\"\n              >\n                <Alert variant=\"destructive\" className=\"border-red-500/50 bg-red-500/10\" data-testid=\"alert-admin-error\">\n                  <AlertCircle className=\"h-5 w-5\" />\n                  <AlertDescription className=\"ml-2 text-sm\">\n                    {error}\n                  </AlertDescription>\n                </Alert>\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"admin-email\">Admin Email</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"admin-email\"\n                  type=\"email\"\n                  placeholder=\"admin@example.com\"\n                  value={email}\n                  onChange={(e) => {\n                    setEmail(e.target.value);\n                    setError(\"\");\n                  }}\n                  className=\"pl-10\"\n                  data-testid=\"input-admin-email\"\n                  autoFocus\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"admin-password\">Password</Label>\n              <div className=\"relative\">\n                <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                <Input\n                  id=\"admin-password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  placeholder=\"Enter admin password\"\n                  value={password}\n                  onChange={(e) => {\n                    setPassword(e.target.value);\n                    setError(\"\");\n                  }}\n                  className=\"pl-10 pr-10\"\n                  data-testid=\"input-admin-password\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground\"\n                  data-testid=\"button-toggle-admin-password\"\n                >\n                  {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\n                </button>\n              </div>\n            </div>\n\n            <Button \n              type=\"submit\" \n              className=\"w-full\"\n              size=\"lg\"\n              disabled={loading}\n              data-testid=\"button-admin-login\"\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />\n                  Authenticating...\n                </>\n              ) : (\n                <>\n                  <Shield className=\"mr-2 h-5 w-5\" />\n                  Login as Admin\n                </>\n              )}\n            </Button>\n          </form>\n\n          <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n            Not an admin?{\" \"}\n            <button\n              onClick={() => setLocation(\"/login\")}\n              className=\"text-primary hover:underline font-medium\"\n              data-testid=\"link-user-login\"\n            >\n              User Login\n            </button>\n          </div>\n        </div>\n\n        <p className=\"text-center text-sm text-muted-foreground mt-6\">\n          Secure admin access only\n        </p>\n      </motion.div>\n    </div>\n  );\n}\n","size_bytes":7306},"client/src/hooks/use-transaction-usd.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { ETHEREUM_TOKENS } from \"@shared/ethereum-tokens\";\nimport { BNB_TOKENS } from \"@shared/bnb-tokens\";\nimport { TRON_TOKENS } from \"@shared/tron-tokens\";\nimport { SOLANA_TOKENS } from \"@shared/solana-tokens\";\n\n/**\n * Hook to calculate USD value for a transaction\n * Uses saved fiatValue if available, otherwise calculates from real-time prices\n */\nexport function useTransactionUSD(transaction: any) {\n  const { data: prices } = useQuery<Record<string, { usd: number }>>({\n    queryKey: [\"/api/prices\"],\n    staleTime: 60000, // Cache for 1 minute\n  });\n\n  // If transaction already has a valid fiatValue, use it\n  const savedFiatValue = parseFloat(transaction?.fiatValue || \"0\");\n  if (savedFiatValue > 0) {\n    return savedFiatValue;\n  }\n\n  // Otherwise, calculate from real-time prices\n  if (!transaction || !prices) {\n    return 0;\n  }\n\n  const { value, tokenSymbol } = transaction;\n  const amount = parseFloat(value || \"0\");\n\n  if (amount === 0) {\n    return 0;\n  }\n\n  // Find the token's CoinGecko ID\n  const allTokens = [\n    ...ETHEREUM_TOKENS,\n    ...BNB_TOKENS,\n    ...TRON_TOKENS,\n    ...SOLANA_TOKENS,\n  ];\n\n  const tokenMetadata = allTokens.find(\n    (t) => t.symbol.toLowerCase() === tokenSymbol?.toLowerCase()\n  );\n\n  const coingeckoId = tokenMetadata?.coingeckoId || tokenSymbol?.toLowerCase();\n  const tokenPrice = prices[coingeckoId]?.usd || 0;\n\n  return amount * tokenPrice;\n}\n","size_bytes":1451},"server/websocket.ts":{"content":"import { WebSocketServer, WebSocket } from \"ws\";\nimport { IncomingMessage } from \"http\";\nimport { parse } from \"url\";\nimport session from \"express-session\";\nimport type { Server } from \"http\";\n\ninterface AuthenticatedWebSocket extends WebSocket {\n  userId?: string;\n  userEmail?: string;\n  isAdmin?: boolean;\n  role?: 'admin' | 'user';\n  isAlive?: boolean;\n}\n\nexport class WebSocketService {\n  private wss: WebSocketServer;\n  private clients: Map<string, Set<AuthenticatedWebSocket>> = new Map();\n  private sessionParser: any;\n\n  constructor(server: Server, sessionParser: any) {\n    this.sessionParser = sessionParser;\n    this.wss = new WebSocketServer({ noServer: true });\n\n    // Handle WebSocket upgrade - ONLY for /ws endpoint (not Vite HMR)\n    server.on('upgrade', (request: IncomingMessage, socket, head) => {\n      const url = parse(request.url || '', true);\n      \n      // Only handle /ws path - let Vite HMR and other WebSocket requests pass through\n      if (url.pathname !== '/ws') {\n        return; // Let other handlers (like Vite) deal with it\n      }\n      \n      console.log('WebSocket upgrade request received for /ws');\n      \n      // Parse session from cookie\n      this.sessionParser(request, {} as any, () => {\n        const req = request as IncomingMessage & { session?: any };\n        \n        if (!req.session || !req.session.userId) {\n          console.log('WebSocket upgrade rejected: no session');\n          // Properly close the socket without sending HTTP response to WebSocket stream\n          socket.destroy();\n          return;\n        }\n\n        this.wss.handleUpgrade(request, socket, head, (ws) => {\n          const authWs = ws as AuthenticatedWebSocket;\n          authWs.userId = req.session.userId;\n          authWs.userEmail = req.session.userEmail;\n          authWs.isAdmin = req.session.isAdmin;\n          authWs.role = req.session.role;\n          authWs.isAlive = true;\n\n          this.wss.emit('connection', authWs, request);\n        });\n      });\n    });\n\n    // Handle new connections\n    this.wss.on('connection', (ws: AuthenticatedWebSocket) => {\n      console.log(`WebSocket connected: userId=${ws.userId}, role=${ws.role}`);\n\n      // Add to clients map\n      if (ws.userId) {\n        if (!this.clients.has(ws.userId)) {\n          this.clients.set(ws.userId, new Set());\n        }\n        this.clients.get(ws.userId)!.add(ws);\n      }\n\n      // Send welcome message\n      ws.send(JSON.stringify({\n        type: 'connected',\n        message: 'WebSocket connection established',\n        userId: ws.userId,\n        role: ws.role,\n      }));\n\n      // Handle pong responses\n      ws.on('pong', () => {\n        ws.isAlive = true;\n      });\n\n      // Handle disconnection\n      ws.on('close', () => {\n        console.log(`WebSocket disconnected: userId=${ws.userId}`);\n        if (ws.userId) {\n          const userClients = this.clients.get(ws.userId);\n          if (userClients) {\n            userClients.delete(ws);\n            if (userClients.size === 0) {\n              this.clients.delete(ws.userId);\n            }\n          }\n        }\n      });\n\n      // Handle errors\n      ws.on('error', (error) => {\n        console.error('WebSocket error:', error);\n      });\n    });\n\n    // Heartbeat to detect dead connections\n    const interval = setInterval(() => {\n      this.wss.clients.forEach((ws) => {\n        const authWs = ws as AuthenticatedWebSocket;\n        if (authWs.isAlive === false) {\n          console.log(`Terminating dead WebSocket connection: userId=${authWs.userId}`);\n          return authWs.terminate();\n        }\n        authWs.isAlive = false;\n        authWs.ping();\n      });\n    }, 30000); // 30 seconds\n\n    this.wss.on('close', () => {\n      clearInterval(interval);\n    });\n  }\n\n  // Send message to a specific user (all their connections)\n  sendToUser(userId: string, message: any) {\n    const userClients = this.clients.get(userId);\n    if (userClients) {\n      const messageStr = JSON.stringify(message);\n      userClients.forEach((ws) => {\n        if (ws.readyState === WebSocket.OPEN) {\n          ws.send(messageStr);\n        }\n      });\n      console.log(`Sent WebSocket message to user ${userId}:`, message.type);\n    }\n  }\n\n  // Broadcast to all connected users (excluding admins if specified)\n  broadcast(message: any, excludeAdmins = true) {\n    const messageStr = JSON.stringify(message);\n    this.clients.forEach((userClients, userId) => {\n      userClients.forEach((ws) => {\n        if (ws.readyState === WebSocket.OPEN) {\n          if (!excludeAdmins || !ws.isAdmin) {\n            ws.send(messageStr);\n          }\n        }\n      });\n    });\n    console.log(`Broadcast WebSocket message:`, message.type);\n  }\n\n  // Get connected user count\n  getConnectedUsersCount(): number {\n    return this.clients.size;\n  }\n\n  // Check if user is online\n  isUserOnline(userId: string): boolean {\n    return this.clients.has(userId);\n  }\n}\n\nexport let wsService: WebSocketService;\n\nexport function initializeWebSocket(server: Server, sessionParser: any) {\n  wsService = new WebSocketService(server, sessionParser);\n  console.log('WebSocket service initialized');\n  return wsService;\n}\n","size_bytes":5159},"client/src/lib/websocket.tsx":{"content":"import React, { createContext, useContext, useEffect, useRef, useState, ReactNode } from \"react\";\nimport { queryClient } from \"./queryClient\";\n\ninterface WebSocketMessage {\n  type: string;\n  [key: string]: any;\n}\n\ninterface WebSocketContextType {\n  isConnected: boolean;\n  lastMessage: WebSocketMessage | null;\n}\n\nconst WebSocketContext = createContext<WebSocketContextType>({\n  isConnected: false,\n  lastMessage: null,\n});\n\nexport function useWebSocket() {\n  return useContext(WebSocketContext);\n}\n\nexport function WebSocketProvider({ children }: { children: ReactNode }) {\n  const [isConnected, setIsConnected] = useState(false);\n  const [lastMessage, setLastMessage] = useState<WebSocketMessage | null>(null);\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const reconnectAttemptsRef = useRef(0);\n  const MAX_RECONNECT_ATTEMPTS = 5;\n\n  const connect = () => {\n    // Only connect in browser\n    if (typeof window === 'undefined') return;\n\n    // Clean up existing connection\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n\n    try {\n      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n      const wsUrl = `${protocol}//${window.location.host}/ws`;\n      \n      console.log('Connecting to WebSocket:', wsUrl);\n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log('WebSocket connected');\n        setIsConnected(true);\n        reconnectAttemptsRef.current = 0;\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const message = JSON.parse(event.data) as WebSocketMessage;\n          console.log('WebSocket message received:', message);\n          setLastMessage(message);\n          handleMessage(message);\n        } catch (error) {\n          console.error('Failed to parse WebSocket message:', error);\n        }\n      };\n\n      ws.onerror = (error) => {\n        console.error('WebSocket error:', error);\n      };\n\n      ws.onclose = () => {\n        console.log('WebSocket disconnected');\n        setIsConnected(false);\n        wsRef.current = null;\n\n        // Attempt to reconnect with exponential backoff\n        if (reconnectAttemptsRef.current < MAX_RECONNECT_ATTEMPTS) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttemptsRef.current), 30000);\n          console.log(`Reconnecting in ${delay}ms (attempt ${reconnectAttemptsRef.current + 1}/${MAX_RECONNECT_ATTEMPTS})`);\n          \n          reconnectTimeoutRef.current = setTimeout(() => {\n            reconnectAttemptsRef.current++;\n            connect();\n          }, delay);\n        } else {\n          console.log('Max reconnect attempts reached');\n        }\n      };\n    } catch (error) {\n      console.error('Failed to create WebSocket connection:', error);\n    }\n  };\n\n  const handleMessage = (message: WebSocketMessage) => {\n    switch (message.type) {\n      case 'connected':\n        console.log('WebSocket connection established:', message);\n        break;\n\n      case 'balance_updated':\n        // Invalidate wallet/token queries to fetch fresh data\n        console.log('Balance updated for user:', message.userId);\n        queryClient.invalidateQueries({ queryKey: ['/api/wallets'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/tokens'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/portfolio'] });\n        break;\n\n      case 'notification_created':\n        // Invalidate notifications query to show new notification\n        console.log('New notification for user:', message.userId);\n        queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/notifications/unread-count'] });\n        break;\n\n      case 'transaction_created':\n      case 'transaction_updated':\n        // Invalidate transaction and balance queries for all consumers\n        console.log('Transaction event:', message.type, 'for wallet:', message.walletId);\n        queryClient.invalidateQueries({ queryKey: ['/api/wallet'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/wallets'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/transactions'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/tokens'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/portfolio'] });\n        break;\n\n      case 'swap_order_updated':\n        // Invalidate swap order queries\n        console.log('Swap order updated:', message.orderId);\n        queryClient.invalidateQueries({ queryKey: ['/api/swap-orders'] });\n        if (message.orderId) {\n          queryClient.invalidateQueries({ queryKey: ['/api/swap-orders', message.orderId] });\n        }\n        break;\n\n      case 'fee_updated':\n        // Invalidate fee queries\n        console.log('Fee updated:', message.tokenSymbol);\n        queryClient.invalidateQueries({ queryKey: ['/api/fees', message.tokenSymbol] });\n        queryClient.invalidateQueries({ queryKey: ['/api/fees'] });\n        break;\n\n      case 'user_fees_updated':\n        // Invalidate user-specific fee queries\n        console.log('User fees updated for:', message.userId);\n        queryClient.invalidateQueries({ queryKey: ['/api/admin/user-fees'] });\n        break;\n\n      case 'support_chat_message':\n        // New support chat message received\n        console.log('Support chat message received');\n        queryClient.invalidateQueries({ queryKey: ['/api/support-chat'] });\n        break;\n\n      case 'support_chat_unread_update':\n        // Real-time unread count update for chat bubble and dashboard headset icon\n        console.log('Support chat unread count updated:', message.unreadCount);\n        \n        // Update unread count query data\n        queryClient.setQueryData(['/api/support-chat/unread-count'], { unreadCount: message.unreadCount });\n        \n        // Try to update cached full chat data first\n        const updated = queryClient.setQueryData(['/api/support-chat'], (old: any) => {\n          if (old) {\n            return { ...old, unreadUserCount: message.unreadCount };\n          }\n          return old;\n        });\n        \n        // If no cached data exists, invalidate to trigger fetch\n        if (!updated) {\n          console.log('No cached support chat data, triggering fetch');\n          queryClient.invalidateQueries({ queryKey: ['/api/support-chat'] });\n        }\n        break;\n\n      default:\n        console.log('Unknown WebSocket message type:', message.type);\n    }\n  };\n\n  useEffect(() => {\n    // Only connect if we have a session (check for session cookie)\n    // This prevents constant reconnection attempts before login\n    const checkAuthAndConnect = async () => {\n      try {\n        // Quick check to see if we have an active session\n        const response = await fetch('/api/user', { \n          credentials: 'include',\n          method: 'GET',\n        });\n        \n        if (response.ok) {\n          // User is authenticated, connect WebSocket\n          connect();\n        } else {\n          console.log('WebSocket: Waiting for authentication');\n        }\n      } catch (error) {\n        console.log('WebSocket: Auth check failed, not connecting');\n      }\n    };\n\n    checkAuthAndConnect();\n\n    // Cleanup on unmount\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current) {\n        wsRef.current.close();\n        wsRef.current = null;\n      }\n    };\n  }, []);\n\n  return (\n    <WebSocketContext.Provider value={{ isConnected, lastMessage }}>\n      {children}\n    </WebSocketContext.Provider>\n  );\n}\n","size_bytes":7664},"client/src/lib/currency.ts":{"content":"// Currency symbols and data\nexport const currencySymbols: Record<string, string> = {\n  USD: \"$\",\n  AED: \".\",\n  ALL: \"L\",\n  AMD: \"\",\n  ANG: \"\",\n  ARS: \"AR$\",\n  AUD: \"$\",\n  AZN: \"\",\n  BAM: \"KM\",\n  BBD: \"Bds$\",\n  EUR: \"\",\n  GBP: \"\",\n  JPY: \"\",\n  CNY: \"\",\n  INR: \"\",\n  KRW: \"\",\n  RUB: \"\",\n  BRL: \"R$\",\n  CAD: \"C$\",\n  CHF: \"Fr\",\n  MXN: \"Mex$\",\n  SGD: \"S$\",\n  NZD: \"NZ$\",\n  ZAR: \"R\",\n  THB: \"\",\n  TRY: \"\",\n  SAR: \"\",\n};\n\n// Approximate exchange rates (USD as base)\n// In production, these should be fetched from a real-time API\nexport const exchangeRates: Record<string, number> = {\n  USD: 1,\n  AED: 3.67,    // UAE Dirham\n  ALL: 92.5,    // Albanian Lek\n  AMD: 387,     // Armenian Dram\n  ANG: 1.79,    // Netherlands Antillean Guilder\n  ARS: 350,     // Argentine Peso\n  AUD: 1.53,    // Australian Dollar\n  AZN: 1.70,    // Azerbaijani Manat\n  BAM: 1.80,    // Bosnia-Herzegovina Convertible Mark\n  BBD: 2.00,    // Barbadian Dollar\n  EUR: 0.92,    // Euro\n  GBP: 0.79,    // British Pound\n  JPY: 149,     // Japanese Yen\n  CNY: 7.24,    // Chinese Yuan\n  INR: 83.12,   // Indian Rupee\n  KRW: 1320,    // Korean Won\n  RUB: 92,      // Russian Ruble\n  BRL: 4.97,    // Brazilian Real\n  CAD: 1.36,    // Canadian Dollar\n  CHF: 0.88,    // Swiss Franc\n  MXN: 17.0,    // Mexican Peso\n  SGD: 1.34,    // Singapore Dollar\n  NZD: 1.66,    // New Zealand Dollar\n  ZAR: 18.5,    // South African Rand\n  THB: 35.5,    // Thai Baht\n  TRY: 32.5,    // Turkish Lira\n  SAR: 3.75,    // Saudi Riyal\n};\n\nexport function convertCurrency(usdAmount: number, targetCurrency: string): number {\n  const rate = exchangeRates[targetCurrency] || 1;\n  return usdAmount * rate;\n}\n\nexport function getCurrencySymbol(currency: string): string {\n  return currencySymbols[currency] || currency;\n}\n\nexport function formatCurrency(amount: number, currency: string, visible: boolean = true): string {\n  if (!visible) return '';\n  \n  const symbol = getCurrencySymbol(currency);\n  const convertedAmount = convertCurrency(amount, currency);\n  \n  // Show \"0\" for zero values (without decimals)\n  if (convertedAmount === 0) {\n    return `${symbol}0`;\n  }\n  \n  // Format with appropriate decimal places\n  let formatted;\n  if (currency === 'JPY' || currency === 'KRW') {\n    // These currencies don't use decimal places\n    formatted = convertedAmount.toLocaleString('en-US', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0\n    });\n  } else {\n    formatted = convertedAmount.toLocaleString('en-US', {\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2\n    });\n  }\n  \n  return `${symbol}${formatted}`;\n}\n","size_bytes":2646},"client/src/pages/notifications.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, ChevronDown, ArrowUpRight, ArrowDownLeft, Headphones } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Notification } from \"@shared/schema\";\n\ntype NotificationTab = \"ALL\" | \"Transaction\" | \"System\" | \"News\";\n\ninterface MarketNews {\n  _id: string;\n  title: string;\n  description: string;\n  url: string;\n  source: string;\n  publishedAt: string;\n  importance: \"low\" | \"medium\" | \"high\" | \"critical\";\n  category?: string;\n}\n\nexport default function Notifications() {\n  const [, setLocation] = useLocation();\n  const { walletId, isAuthenticated, isLoading: isAuthLoading } = useWallet();\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState<NotificationTab>(\"ALL\");\n\n  useEffect(() => {\n    if (!isAuthLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthLoading, isAuthenticated, setLocation]);\n\n  // Fetch notifications with real-time updates\n  const { data: notificationsData, isLoading } = useQuery({\n    queryKey: [\"/api/notifications\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/notifications?walletId=${walletId}`);\n      if (!res.ok) throw new Error(\"Failed to fetch notifications\");\n      return res.json();\n    },\n    enabled: !!walletId,\n    refetchInterval: 5000, // Poll every 5 seconds for real-time updates\n  });\n\n  const notifications: Notification[] = notificationsData || [];\n  // Filter out support chat notifications from display (they appear in support chat page instead)\n  const nonSupportChatNotifications = notifications.filter(n => !n.metadata?.supportChat);\n  const filteredNotifications = activeTab === \"ALL\" \n    ? nonSupportChatNotifications \n    : nonSupportChatNotifications.filter(n => n.category === activeTab);\n\n  // Fetch market news\n  const { data: newsData, isLoading: isNewsLoading } = useQuery<MarketNews[]>({\n    queryKey: [\"/api/market-news\"],\n    enabled: activeTab === \"News\",\n  });\n\n  const marketNews: MarketNews[] = newsData || [];\n\n  // Mark all as read mutation\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(`/api/notifications/mark-all-read`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ walletId }),\n      });\n      if (!response.ok) throw new Error(\"Failed to mark as read\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n      toast({\n        title: \"Marked as read\",\n        description: \"All notifications have been marked as read\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to mark notifications as read\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Clear all notifications mutation\n  const clearAllMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(`/api/notifications/clear`, {\n        method: \"DELETE\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ walletId }),\n      });\n      if (!response.ok) throw new Error(\"Failed to clear notifications\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n      toast({\n        title: \"Cleared\",\n        description: \"All notifications have been cleared\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to clear notifications\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mark single notification as read mutation\n  const markAsReadMutation = useMutation({\n    mutationFn: async (notificationId: string) => {\n      const response = await fetch(`/api/notifications/${notificationId}/read`, {\n        method: \"PATCH\",\n      });\n      if (!response.ok) throw new Error(\"Failed to mark as read\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const handleNotificationClick = (notification: Notification) => {\n    // Mark as read when clicked\n    if (!notification.isRead) {\n      markAsReadMutation.mutate(notification._id);\n    }\n\n    // Navigate to support chat if it's a support chat notification\n    if (notification.metadata?.supportChat) {\n      setLocation(\"/support-chat\");\n      return;\n    }\n\n    // Navigate to swap order details if it's a swap notification with orderId\n    if (notification.metadata?.orderId) {\n      setLocation(`/swap/orders/${notification.metadata.orderId}`);\n      return;\n    }\n\n    // Navigate to transaction details if it's a transaction notification\n    if (notification.transactionId && notification.transactionId.hash) {\n      setLocation(`/transaction/${notification.transactionId.hash}`);\n    }\n  };\n\n  const formatTimestamp = (timestamp: string | Date) => {\n    const date = typeof timestamp === 'string' ? new Date(timestamp) : timestamp;\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    const seconds = String(date.getSeconds()).padStart(2, '0');\n    return `${month}-${day} ${hours}:${minutes}:${seconds}`;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"sticky top-0 bg-background border-b z-10\">\n        <div className=\"container mx-auto px-4 py-3\">\n          <div className=\"flex items-center justify-between gap-3\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setLocation(\"/dashboard\")}\n                data-testid=\"button-back\"\n                className=\"hover-elevate active-elevate-2\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <h1 className=\"text-xl font-semibold\" data-testid=\"text-notifications-title\">\n                Notifications\n              </h1>\n            </div>\n            {filteredNotifications.some(n => !n.isRead) && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => markAllAsReadMutation.mutate()}\n                disabled={markAllAsReadMutation.isPending}\n                data-testid=\"button-read-all\"\n                className=\"text-primary hover:text-primary/80\"\n              >\n                {markAllAsReadMutation.isPending ? \"Marking...\" : \"Read All\"}\n              </Button>\n            )}\n          </div>\n\n          {/* Tabs */}\n          <div className=\"flex items-center gap-8 mt-4 border-b\">\n            <button\n              onClick={() => setActiveTab(\"ALL\")}\n              className={`pb-3 relative ${\n                activeTab === \"ALL\"\n                  ? \"text-foreground font-semibold\"\n                  : \"text-muted-foreground\"\n              }`}\n              data-testid=\"tab-all\"\n            >\n              ALL\n              {activeTab === \"ALL\" && (\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-primary\" />\n              )}\n            </button>\n            <button\n              onClick={() => setActiveTab(\"Transaction\")}\n              className={`pb-3 relative ${\n                activeTab === \"Transaction\"\n                  ? \"text-foreground font-semibold\"\n                  : \"text-muted-foreground\"\n              }`}\n              data-testid=\"tab-transaction\"\n            >\n              Transaction\n              {activeTab === \"Transaction\" && (\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-primary\" />\n              )}\n            </button>\n            <button\n              onClick={() => setActiveTab(\"System\")}\n              className={`pb-3 relative ${\n                activeTab === \"System\"\n                  ? \"text-foreground font-semibold\"\n                  : \"text-muted-foreground\"\n              }`}\n              data-testid=\"tab-system\"\n            >\n              System\n              {activeTab === \"System\" && (\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-primary\" />\n              )}\n            </button>\n            <button\n              onClick={() => setActiveTab(\"News\")}\n              className={`pb-3 relative ${\n                activeTab === \"News\"\n                  ? \"text-foreground font-semibold\"\n                  : \"text-muted-foreground\"\n              }`}\n              data-testid=\"tab-news\"\n            >\n              Market News\n              {activeTab === \"News\" && (\n                <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-primary\" />\n              )}\n            </button>\n          </div>\n        </div>\n      </header>\n\n      {/* Notifications Container */}\n      <div className=\"container mx-auto px-4 py-4\">\n        {/* Notifications List */}\n        {activeTab === \"News\" ? (\n          <div className=\"space-y-3\">\n            {isNewsLoading ? (\n              <div className=\"text-center py-12 text-muted-foreground\">\n                <p>Loading market news...</p>\n              </div>\n            ) : marketNews.length === 0 ? (\n              <div className=\"text-center py-12 text-muted-foreground\">\n                <p>No market news available</p>\n              </div>\n            ) : (\n              marketNews.map((news) => (\n                <a\n                  key={news._id}\n                  href={news.url}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"block p-4 rounded-lg hover-elevate active-elevate-2 border\"\n                  data-testid={`news-${news._id}`}\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <h3 className=\"font-semibold text-sm\" data-testid={`text-news-title-${news._id}`}>\n                          {news.title}\n                        </h3>\n                        {news.importance === \"critical\" && (\n                          <span className=\"px-2 py-0.5 text-xs font-semibold rounded-full bg-destructive text-destructive-foreground\">\n                            Critical\n                          </span>\n                        )}\n                        {news.importance === \"high\" && (\n                          <span className=\"px-2 py-0.5 text-xs font-semibold rounded-full bg-orange-500 text-white\">\n                            High\n                          </span>\n                        )}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mb-2 line-clamp-2\">\n                        {news.description}\n                      </p>\n                      <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                        <span>{news.source}</span>\n                        <span></span>\n                        <span>{new Date(news.publishedAt).toLocaleDateString()}</span>\n                        {news.category && (\n                          <>\n                            <span></span>\n                            <span>{news.category}</span>\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </a>\n              ))\n            )}\n          </div>\n        ) : (\n        <div className=\"space-y-1\">\n          {isLoading ? (\n              <div className=\"text-center py-12 text-muted-foreground\">\n                <p>Loading notifications...</p>\n              </div>\n            ) : filteredNotifications.length === 0 ? (\n              <div className=\"text-center py-12 text-muted-foreground\">\n                <p>No {activeTab.toLowerCase()} notifications</p>\n              </div>\n            ) : (\n              filteredNotifications.map((notification) => (\n              <button\n                key={notification._id}\n                className=\"w-full text-left p-4 rounded-lg hover-elevate active-elevate-2 flex items-start gap-3 relative\"\n                onClick={() => handleNotificationClick(notification)}\n                data-testid={`notification-${notification._id}`}\n              >\n                <div className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-primary\">\n                  {notification.metadata?.supportChat ? (\n                    <Headphones className=\"h-5 w-5 text-white\" data-testid={`icon-headphones-${notification._id}`} />\n                  ) : notification.type === \"sent\" ? (\n                    <ArrowUpRight className=\"h-5 w-5 text-white\" data-testid={`icon-sent-${notification._id}`} />\n                  ) : (\n                    <ArrowDownLeft className=\"h-5 w-5 text-white\" data-testid={`icon-received-${notification._id}`} />\n                  )}\n                </div>\n                \n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <h3 className={`font-semibold text-sm sm:text-base ${!notification.isRead ? 'font-bold' : ''}`}>\n                      {notification.title}\n                    </h3>\n                    {!notification.isRead && (\n                      <span className=\"w-2 h-2 rounded-full bg-destructive flex-shrink-0\" data-testid={`unread-indicator-${notification._id}`}></span>\n                    )}\n                  </div>\n                  <p className=\"text-xs sm:text-sm text-muted-foreground mb-2\">\n                    {notification.description}\n                  </p>\n                  <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n                    <span>{formatTimestamp(notification.timestamp)}</span>\n                    <span>{notification.metadata?.walletAddress || \"\"}</span>\n                  </div>\n                </div>\n\n                <ChevronDown className=\"h-4 w-4 text-muted-foreground flex-shrink-0 -rotate-90\" />\n              </button>\n            ))\n          )}\n        </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":14931},"client/src/pages/settings-security.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, ChevronRight } from \"lucide-react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Check } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function SettingsSecurity() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [autoSigningOpen, setAutoSigningOpen] = useState(false);\n  const [autoLockOpen, setAutoLockOpen] = useState(false);\n  \n  // Load from localStorage\n  const [autoSigning, setAutoSigning] = useState(() => \n    localStorage.getItem(\"autoSigning\") || \"Off\"\n  );\n  const [autoLock, setAutoLock] = useState(() => \n    localStorage.getItem(\"autoLock\") || \"30minute\"\n  );\n\n  const handleAutoSigningChange = (status: string) => {\n    setAutoSigning(status);\n    localStorage.setItem(\"autoSigning\", status);\n    setAutoSigningOpen(false);\n    const statusText = status === \"On\" ? t('common.on') : t('common.off');\n    toast({\n      description: t('security.autoSigningUpdated', { status: statusText }),\n    });\n  };\n\n  const handleAutoLockChange = (time: string) => {\n    setAutoLock(time);\n    localStorage.setItem(\"autoLock\", time);\n    setAutoLockOpen(false);\n    toast({\n      description: t('security.autoLockUpdated', { time }),\n    });\n  };\n\n  const autoLockOptions = [\n    \"1minute\",\n    \"5minute\",\n    \"15minute\",\n    \"30minute\",\n    \"1hour\",\n    \"Never\"\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/settings\")}\n              data-testid=\"button-back\"\n              className=\"mr-2\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold flex-1 text-center mr-10\">{t('settings.security')}</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl\">\n        {/* Auto Signing */}\n        <button\n          onClick={() => setAutoSigningOpen(true)}\n          className=\"bg-card rounded-xl mb-4 p-4 w-full hover-elevate active-elevate-2\"\n          data-testid=\"button-auto-signing\"\n        >\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-foreground\">{t('security.autoSigning')}</span>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">\n                {autoSigning === \"On\" ? t('common.on') : t('common.off')}\n              </span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n          </div>\n          <p className=\"text-sm text-muted-foreground text-left\">\n            {t('security.autoSigningDescription')}\n          </p>\n        </button>\n\n        {/* Auto Lock */}\n        <button\n          onClick={() => setAutoLockOpen(true)}\n          className=\"bg-card rounded-xl mb-4 p-4 w-full hover-elevate active-elevate-2\"\n          data-testid=\"button-auto-lock\"\n        >\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-foreground\">{t('security.autoLock')}</span>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">{autoLock}</span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n          </div>\n          <p className=\"text-sm text-muted-foreground text-left\">\n            {t('security.autoLockDescription')}\n          </p>\n        </button>\n\n        {/* Change Password */}\n        <Link href=\"/settings/security/change-password\">\n          <button\n            className=\"bg-card rounded-xl mb-4 w-full flex items-center justify-between p-4 hover-elevate active-elevate-2\"\n            data-testid=\"button-change-password\"\n          >\n            <span className=\"text-foreground\">{t('security.changePassword')}</span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </button>\n        </Link>\n      </div>\n\n      {/* Auto Signing Dialog */}\n      <Dialog open={autoSigningOpen} onOpenChange={setAutoSigningOpen}>\n        <DialogContent className=\"sm:max-w-md\" data-testid=\"dialog-auto-signing\">\n          <DialogHeader>\n            <DialogTitle>{t('security.autoSigning')}</DialogTitle>\n          </DialogHeader>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            {t('security.autoSigningDescription')}\n          </p>\n          <div className=\"space-y-2\">\n            <button\n              onClick={() => handleAutoSigningChange(\"On\")}\n              className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-lg\"\n              data-testid=\"option-auto-signing-on\"\n            >\n              <span className=\"text-foreground\">{t('common.on')}</span>\n              {autoSigning === \"On\" && <Check className=\"h-5 w-5 text-primary\" />}\n            </button>\n            \n            <button\n              onClick={() => handleAutoSigningChange(\"Off\")}\n              className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-lg\"\n              data-testid=\"option-auto-signing-off\"\n            >\n              <span className=\"text-foreground\">{t('common.off')}</span>\n              {autoSigning === \"Off\" && <Check className=\"h-5 w-5 text-primary\" />}\n            </button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Auto Lock Dialog */}\n      <Dialog open={autoLockOpen} onOpenChange={setAutoLockOpen}>\n        <DialogContent className=\"sm:max-w-md max-h-[80vh] overflow-hidden flex flex-col\" data-testid=\"dialog-auto-lock\">\n          <DialogHeader>\n            <DialogTitle>{t('security.autoLock')}</DialogTitle>\n          </DialogHeader>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            {t('security.autoLockDescription')}\n          </p>\n          <div className=\"overflow-y-auto flex-1 space-y-2\">\n            {autoLockOptions.map((option) => (\n              <button\n                key={option}\n                onClick={() => handleAutoLockChange(option)}\n                className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-lg\"\n                data-testid={`option-auto-lock-${option}`}\n              >\n                <span className=\"text-foreground\">{option}</span>\n                {autoLock === option && <Check className=\"h-5 w-5 text-primary\" />}\n              </button>\n            ))}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n\n","size_bytes":7104},"client/src/pages/settings-security-change-password.tsx":{"content":"import { ChevronLeft, Loader2 } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Delete } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface User {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  profilePhoto?: string;\n  isAdmin: boolean;\n}\n\nexport default function ChangeSecurityPasswordPage() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [step, setStep] = useState<\"current\" | \"new\" | \"confirm\">(\"current\");\n  const [pin, setPin] = useState<string[]>([\"\", \"\", \"\", \"\", \"\", \"\"]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [newPin, setNewPin] = useState<string>(\"\");\n  const [currentPin, setCurrentPin] = useState<string>(\"\");\n  const [sending, setSending] = useState(false);\n  const [isChanging, setIsChanging] = useState(false);\n  \n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const handleNumberClick = (num: string) => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex < 6) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex] = num;\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex + 1);\n\n      if (currentIndex === 5) {\n        const enteredPin = updatedPin.join(\"\");\n        \n        setTimeout(async () => {\n          if (step === \"current\") {\n            // Save current PIN for API call\n            setCurrentPin(enteredPin);\n            setStep(\"new\");\n            setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n            setCurrentIndex(0);\n            toast({\n              description: \"Enter your new PIN\",\n            });\n          } else if (step === \"new\") {\n            // Save new PIN for confirmation\n            setNewPin(enteredPin);\n            setStep(\"confirm\");\n            setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n            setCurrentIndex(0);\n            toast({\n              description: \"Confirm your new PIN\",\n            });\n          } else {\n            // Confirm PIN and submit to backend\n            if (enteredPin === newPin) {\n              setIsChanging(true);\n              try {\n                const response = await apiRequest(\"POST\", \"/api/auth/change-password\", {\n                  currentPassword: currentPin,\n                  newPassword: newPin,\n                });\n\n                if (response.ok) {\n                  toast({\n                    description: \"Security password updated successfully\",\n                  });\n                  setTimeout(() => {\n                    window.history.back();\n                  }, 1000);\n                } else {\n                  const errorData = await response.json();\n                  toast({\n                    description: errorData.error || \"Failed to change password\",\n                    variant: \"destructive\",\n                  });\n                  // Go back to current PIN step if current password was incorrect\n                  if (errorData.error?.includes(\"incorrect\")) {\n                    setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                    setCurrentIndex(0);\n                    setCurrentPin(\"\");\n                    setNewPin(\"\");\n                    setStep(\"current\");\n                  } else {\n                    setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                    setCurrentIndex(0);\n                    setNewPin(\"\");\n                    setStep(\"new\");\n                  }\n                }\n              } catch (error: any) {\n                toast({\n                  description: error?.message || \"Failed to change password\",\n                  variant: \"destructive\",\n                });\n                setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n                setCurrentIndex(0);\n                setNewPin(\"\");\n                setStep(\"new\");\n              } finally {\n                setIsChanging(false);\n              }\n            } else {\n              toast({\n                description: \"PINs don't match. Please try again.\",\n                variant: \"destructive\",\n              });\n              setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n              setCurrentIndex(0);\n              setNewPin(\"\");\n              setStep(\"new\");\n            }\n          }\n        }, 300);\n      }\n    }\n  };\n\n  const handleDelete = () => {\n    // Haptic vibration feedback\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    if (currentIndex > 0) {\n      const updatedPin = [...pin];\n      updatedPin[currentIndex - 1] = \"\";\n      setPin(updatedPin);\n      setCurrentIndex(currentIndex - 1);\n    }\n  };\n  \n  const handleReset = () => {\n    setPin([\"\", \"\", \"\", \"\", \"\", \"\"]);\n    setCurrentIndex(0);\n    setNewPin(\"\");\n    setCurrentPin(\"\");\n    if (step === \"confirm\") {\n      setStep(\"new\");\n    }\n  };\n\n  const handleForgotPassword = async () => {\n    if (!user?.email) {\n      toast({\n        title: \"Error\",\n        description: \"Please login to reset your security password\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSending(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/send-reset-code\", {\n        email: user.email,\n      });\n\n      if (response.ok) {\n        // Log out the user and redirect to login page with reset flow\n        await apiRequest(\"POST\", \"/api/auth/logout\", {});\n        \n        toast({\n          title: \"Reset Code Sent\",\n          description: \"Check your email for the reset code. Redirecting to login...\",\n        });\n        \n        // Store email in sessionStorage for the login page to use\n        sessionStorage.setItem(\"resetEmail\", user.email);\n        sessionStorage.setItem(\"startResetFlow\", \"true\");\n        \n        // Redirect to login page after a short delay\n        setTimeout(() => {\n          setLocation(\"/login\");\n        }, 2000);\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Failed to Send Reset Code\",\n          description: errorData.error || \"Please try again\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to send reset code\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setSending(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <header className=\"sticky top-0 z-10 flex items-center justify-between px-4 py-4 border-b bg-background\">\n        <div className=\"flex items-center gap-2\">\n          <Link href=\"/settings/security\">\n            <button \n              data-testid=\"button-back\"\n              className=\"p-2 -ml-2 hover-elevate active-elevate-2 rounded-md\"\n            >\n              <ChevronLeft className=\"w-5 h-5\" />\n            </button>\n          </Link>\n        </div>\n        <h1 className=\"absolute left-1/2 -translate-x-1/2 text-base font-medium\">Change Security Password</h1>\n        <div className=\"w-9\"></div>\n      </header>\n\n      <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n        <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n          <h2 className=\"text-xl mb-8\" data-testid=\"text-pin-prompt\">\n            {step === \"current\" && \"Enter old password\"}\n            {step === \"new\" && \"Enter new password\"}\n            {step === \"confirm\" && \"Confirm new password\"}\n          </h2>\n          \n          <div className=\"flex gap-3 mb-12\" data-testid=\"container-pin-inputs\">\n            {pin.map((digit, index) => (\n              <div\n                key={index}\n                data-testid={`pin-box-${index}`}\n                className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl ${\n                  digit ? \"border-primary\" : \"border-muted-foreground/30\"\n                }`}\n              >\n                {digit && <span className=\"text-2xl\"></span>}\n              </div>\n            ))}\n          </div>\n\n          <button\n            data-testid=\"button-forgot-password\"\n            onClick={handleForgotPassword}\n            disabled={sending}\n            className=\"text-primary hover-elevate active-elevate-2 px-4 py-2 rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n          >\n            {sending && <Loader2 className=\"h-4 w-4 animate-spin\" />}\n            {sending ? \"Sending...\" : \"Forget Password\"}\n          </button>\n        </div>\n\n        <div className=\"w-full max-w-md\">\n          <div className=\"grid grid-cols-3 gap-3\">\n            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n              <button\n                key={num}\n                data-testid={`button-num-${num}`}\n                onClick={() => handleNumberClick(num.toString())}\n                disabled={isChanging}\n                className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {num}\n              </button>\n            ))}\n            <div className=\"h-16\"></div>\n            <button\n              data-testid=\"button-num-0\"\n              onClick={() => handleNumberClick(\"0\")}\n              disabled={isChanging}\n              className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              0\n            </button>\n            <button\n              data-testid=\"button-delete\"\n              onClick={handleDelete}\n              disabled={isChanging}\n              className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isChanging ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <Delete className=\"w-6 h-6\" />}\n            </button>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":10085},"client/src/pages/qr-scanner.tsx":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, Flashlight, Image } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Html5Qrcode } from \"html5-qrcode\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWallet } from \"@/contexts/wallet-context\";\n\nexport default function QRScanner() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading } = useWallet();\n  const [flashlightOn, setFlashlightOn] = useState(false);\n  const [scanning, setScanning] = useState(false);\n  const [isNavigating, setIsNavigating] = useState(false);\n  const scannerRef = useRef<Html5Qrcode | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const videoTrackRef = useRef<MediaStreamTrack | null>(null);\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  useEffect(() => {\n    let mounted = true;\n    const qrCodeRegionId = \"qr-reader\";\n    const scanner = new Html5Qrcode(qrCodeRegionId);\n    scannerRef.current = scanner;\n\n    const config = {\n      fps: 10,\n      qrbox: { width: 250, height: 250 },\n      aspectRatio: 1.0,\n    };\n\n    scanner.start(\n      { facingMode: \"environment\" },\n      config,\n      (decodedText) => {\n        // Successfully scanned - prevent multiple scans while navigating\n        if (!isNavigating && mounted) {\n          handleScan(decodedText);\n        }\n      },\n      (errorMessage) => {\n        // Scanning error (ignore, happens frequently)\n      }\n    ).then(() => {\n      if (mounted) {\n        setScanning(true);\n        // Store video track for flashlight control\n        const state = scanner.getState();\n        if (state === 2) { // SCANNING state\n          try {\n            const videoElement = document.querySelector('#qr-reader video') as HTMLVideoElement;\n            if (videoElement && videoElement.srcObject) {\n              const stream = videoElement.srcObject as MediaStream;\n              const tracks = stream.getVideoTracks();\n              if (tracks.length > 0) {\n                videoTrackRef.current = tracks[0];\n              }\n            }\n          } catch (err) {\n            console.error(\"Failed to get video track:\", err);\n          }\n        }\n      }\n    }).catch((err) => {\n      console.error(\"Failed to start scanner:\", err);\n      if (mounted) {\n        toast({\n          title: \"Camera Error\",\n          description: \"Failed to access camera. Please check permissions.\",\n          variant: \"destructive\",\n        });\n      }\n    });\n\n    return () => {\n      mounted = false;\n      // Proper cleanup: stop and clear\n      if (scannerRef.current) {\n        const currentScanner = scannerRef.current;\n        const state = currentScanner.getState();\n        if (state === 2) { // SCANNING\n          currentScanner.stop().then(() => {\n            currentScanner.clear();\n          }).catch(console.error);\n        } else {\n          currentScanner.clear();\n        }\n      }\n      // Release video track\n      if (videoTrackRef.current) {\n        videoTrackRef.current.stop();\n        videoTrackRef.current = null;\n      }\n    };\n  }, []);\n\n  const handleScan = async (decodedText: string) => {\n    if (isNavigating) return;\n    setIsNavigating(true);\n\n    try {\n      // Stop and clear scanner properly\n      if (scannerRef.current && scanning) {\n        await scannerRef.current.stop();\n        scannerRef.current.clear();\n        setScanning(false);\n      }\n\n      // Release video track\n      if (videoTrackRef.current) {\n        videoTrackRef.current.stop();\n        videoTrackRef.current = null;\n      }\n\n      toast({\n        title: \"QR Code Scanned\",\n        description: \"Address detected successfully\",\n      });\n\n      // Store scanned address and go back to previous page\n      // This allows the Send page or any other page to use the scanned address\n      localStorage.setItem('scannedAddress', decodedText);\n      window.history.back();\n    } catch (err) {\n      console.error(\"Error during scan cleanup:\", err);\n      setIsNavigating(false);\n    }\n  };\n\n  const toggleFlashlight = async () => {\n    if (!videoTrackRef.current || !scanning) {\n      toast({\n        title: \"Flashlight Not Available\",\n        description: \"Camera is not active\",\n      });\n      return;\n    }\n\n    try {\n      const capabilities = videoTrackRef.current.getCapabilities() as any;\n      \n      if (capabilities.torch) {\n        await videoTrackRef.current.applyConstraints({\n          advanced: [{ torch: !flashlightOn } as any]\n        });\n        setFlashlightOn(!flashlightOn);\n      } else {\n        toast({\n          title: \"Flashlight Not Supported\",\n          description: \"Your device doesn't support flashlight control\",\n        });\n      }\n    } catch (err) {\n      console.error(\"Flashlight error:\", err);\n      toast({\n        title: \"Flashlight Error\",\n        description: \"Failed to toggle flashlight\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file || isNavigating) return;\n\n    if (scannerRef.current) {\n      try {\n        const result = await scannerRef.current.scanFile(file, false);\n        await handleScan(result);\n      } catch (err) {\n        console.error(\"Failed to scan file:\", err);\n        toast({\n          title: \"Scan Failed\",\n          description: \"Could not detect QR code in the image\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleBack = async () => {\n    if (isNavigating) return;\n    setIsNavigating(true);\n\n    try {\n      // Proper cleanup before navigation\n      if (scannerRef.current && scanning) {\n        await scannerRef.current.stop();\n        scannerRef.current.clear();\n        setScanning(false);\n      }\n\n      // Release video track\n      if (videoTrackRef.current) {\n        videoTrackRef.current.stop();\n        videoTrackRef.current = null;\n      }\n\n      setLocation(\"/dashboard\");\n    } catch (err) {\n      console.error(\"Error during cleanup:\", err);\n      setLocation(\"/dashboard\");\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black flex flex-col\">\n      {/* Back Button */}\n      <div className=\"absolute top-4 left-4 z-50\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={handleBack}\n          data-testid=\"button-back\"\n          className=\"text-white hover:bg-white/20\"\n          disabled={isNavigating}\n        >\n          <ArrowLeft className=\"h-6 w-6\" />\n        </Button>\n      </div>\n\n      {/* Scanner Area */}\n      <div className=\"flex-1 flex items-center justify-center p-8\">\n        <div className=\"relative w-full max-w-md\">\n          {/* QR Reader Container */}\n          <div id=\"qr-reader\" className=\"w-full\" />\n          \n          {/* Scanning Frame Overlay */}\n          <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center\">\n            <div className=\"relative w-64 h-64\">\n              <div className=\"absolute inset-0 border-2 border-primary rounded-lg\">\n                {/* Corner decorations */}\n                <div className=\"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-primary rounded-tl-lg\" />\n                <div className=\"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-primary rounded-tr-lg\" />\n                <div className=\"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-primary rounded-bl-lg\" />\n                <div className=\"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-primary rounded-br-lg\" />\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"text-center px-8 pb-4\">\n        <p className=\"text-white text-sm\">\n          Position the QR code within the frame to scan\n        </p>\n      </div>\n\n      {/* Bottom Controls */}\n      <div className=\"pb-8 px-8\">\n        <div className=\"flex items-center justify-center gap-12\">\n          {/* Flashlight Button */}\n          <button\n            onClick={toggleFlashlight}\n            disabled={isNavigating || !scanning}\n            className={`w-16 h-16 rounded-full flex items-center justify-center transition-colors disabled:opacity-50 ${\n              flashlightOn\n                ? \"bg-primary text-white\"\n                : \"bg-gray-700 text-white\"\n            }`}\n            data-testid=\"button-flashlight\"\n          >\n            <Flashlight className=\"h-7 w-7\" />\n          </button>\n\n          {/* Gallery Button */}\n          <button\n            onClick={() => fileInputRef.current?.click()}\n            disabled={isNavigating}\n            className=\"w-16 h-16 rounded-full bg-gray-700 flex items-center justify-center text-white disabled:opacity-50\"\n            data-testid=\"button-gallery\"\n          >\n            <Image className=\"h-7 w-7\" />\n          </button>\n          \n          {/* Hidden File Input */}\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\"image/*\"\n            onChange={handleFileSelect}\n            className=\"hidden\"\n          />\n        </div>\n      </div>\n\n      <style>{`\n        #qr-reader {\n          width: 100%;\n          max-width: 100%;\n        }\n        #qr-reader video {\n          width: 100% !important;\n          height: auto !important;\n          min-height: 300px;\n          border-radius: 0.5rem;\n          display: block !important;\n        }\n        #qr-reader__scan_region {\n          min-height: 300px !important;\n        }\n        #qr-reader__dashboard {\n          display: none !important;\n        }\n        #qr-reader__dashboard_section {\n          display: none !important;\n        }\n        #qr-reader__camera_selection {\n          display: none !important;\n        }\n      `}</style>\n    </div>\n  );\n}\n","size_bytes":9982},"client/src/pages/feedback.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState } from \"react\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nexport default function Feedback() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [feedbackType, setFeedbackType] = useState(\"general\");\n  const [feedback, setFeedback] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async () => {\n    if (!feedback.trim()) {\n      toast({\n        title: \"Feedback Required\",\n        description: \"Please enter your feedback before submitting\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    // Simulate API call\n    setTimeout(() => {\n      toast({\n        title: \"Feedback Submitted\",\n        description: \"Thank you for your feedback! We'll review it soon.\",\n      });\n      setIsSubmitting(false);\n      setFeedback(\"\");\n      setTimeout(() => {\n        setLocation(\"/settings/about\");\n      }, 1000);\n    }, 1000);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/settings/about\")}\n              data-testid=\"button-back\"\n              className=\"mr-2\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold flex-1 text-center mr-10\">Give Us Feedback</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-6 max-w-2xl\">\n        {/* Introduction */}\n        <div className=\"mb-6\">\n          <p className=\"text-sm text-muted-foreground\">\n            We'd love to hear your thoughts! Your feedback helps us improve the Lumirra App experience.\n          </p>\n        </div>\n\n        {/* Feedback Type */}\n        <div className=\"mb-6\">\n          <label className=\"block text-sm font-medium mb-2\">\n            Feedback Type\n          </label>\n          <Select value={feedbackType} onValueChange={setFeedbackType}>\n            <SelectTrigger data-testid=\"select-feedback-type\">\n              <SelectValue placeholder=\"Select feedback type\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"general\">General Feedback</SelectItem>\n              <SelectItem value=\"bug\">Report a Bug</SelectItem>\n              <SelectItem value=\"feature\">Feature Request</SelectItem>\n              <SelectItem value=\"ui\">UI/UX Improvement</SelectItem>\n              <SelectItem value=\"other\">Other</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Feedback Text */}\n        <div className=\"mb-6\">\n          <label className=\"block text-sm font-medium mb-2\">\n            Your Feedback\n          </label>\n          <Textarea\n            placeholder=\"Share your thoughts, suggestions, or report issues...\"\n            value={feedback}\n            onChange={(e) => setFeedback(e.target.value)}\n            className=\"min-h-[200px] resize-none\"\n            data-testid=\"textarea-feedback\"\n          />\n          <p className=\"text-xs text-muted-foreground mt-2\">\n            {feedback.length}/1000 characters\n          </p>\n        </div>\n\n        {/* Submit Button */}\n        <Button\n          className=\"w-full\"\n          onClick={handleSubmit}\n          disabled={isSubmitting || !feedback.trim()}\n          data-testid=\"button-submit-feedback\"\n        >\n          {isSubmitting ? \"Submitting...\" : \"Submit Feedback\"}\n        </Button>\n\n        {/* Info */}\n        <div className=\"mt-8 p-4 bg-card rounded-xl\">\n          <h3 className=\"font-medium mb-2\">Response Time</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            We typically review feedback within 1-3 business days. For urgent issues, please contact our support team directly.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4421},"client/src/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\n// Map language codes to display names (100+ languages with translations)\nexport const languageCodeToName: Record<string, string> = {\n  \"en\": \"English\",\n  \"de\": \"Deutsch\",\n  \"es\": \"Espaol\",\n  \"fr\": \"Franais\",\n  \"it\": \"Italiano\",\n  \"ja\": \"\",\n  \"ko\": \"\",\n  \"pt\": \"Portugus\",\n  \"ru\": \"\",\n  \"th\": \"\",\n  \"tr\": \"Trke\",\n  \"zh\": \"\",\n  \"ar\": \"\",\n  \"hi\": \"\",\n  \"id\": \"Bahasa Indonesia\",\n  \"nl\": \"Nederlands\",\n  \"pl\": \"Polski\",\n  \"sv\": \"Svenska\",\n  \"vi\": \"Ting Vit\",\n  \"uk\": \"\",\n  \"cs\": \"etina\",\n  \"da\": \"Dansk\",\n  \"fi\": \"Suomi\",\n  \"el\": \"\",\n  \"he\": \"\",\n  \"hu\": \"Magyar\",\n  \"no\": \"Norsk\",\n  \"ro\": \"Romn\",\n  \"sk\": \"Slovenina\",\n  \"bg\": \"\",\n  \"hr\": \"Hrvatski\",\n  \"lt\": \"Lietuvi\",\n  \"lv\": \"Latvieu\",\n  \"sl\": \"Slovenina\",\n  \"sr\": \"\",\n  \"et\": \"Eesti\",\n  \"is\": \"slenska\",\n  \"mk\": \"\",\n  \"sq\": \"Shqip\",\n  \"bs\": \"Bosanski\",\n  \"ca\": \"Catal\",\n  \"eu\": \"Euskara\",\n  \"gl\": \"Galego\",\n  \"cy\": \"Cymraeg\",\n  \"mt\": \"Malti\",\n  \"ga\": \"Gaeilge\",\n  \"af\": \"Afrikaans\",\n  \"sw\": \"Kiswahili\",\n  \"am\": \"\",\n  \"bn\": \"\",\n  \"gu\": \"\",\n  \"kn\": \"\",\n  \"ml\": \"\",\n  \"mr\": \"\",\n  \"ne\": \"\",\n  \"or\": \"\",\n  \"pa\": \"\",\n  \"si\": \"\",\n  \"ta\": \"\",\n  \"te\": \"\",\n  \"ur\": \"\",\n  \"fa\": \"\",\n  \"ps\": \"\",\n  \"ku\": \"Kurd\",\n  \"my\": \"\",\n  \"km\": \"\",\n  \"lo\": \"\",\n  \"ms\": \"Bahasa Melayu\",\n  \"tl\": \"Tagalog\",\n  \"jv\": \"Basa Jawa\",\n  \"az\": \"Azrbaycan\",\n  \"kk\": \"\",\n  \"uz\": \"O'zbek\",\n  \"hy\": \"\",\n  \"ka\": \"\",\n  \"mn\": \"\",\n  \"be\": \"\",\n  \"lb\": \"Ltzebuergesch\",\n  \"fo\": \"Froyskt\",\n  \"fy\": \"Frysk\",\n  \"gd\": \"Gidhlig\",\n  \"kl\": \"Kalaallisut\",\n  \"mg\": \"Malagasy\",\n  \"mi\": \"Mori\",\n  \"ny\": \"Chichewa\",\n  \"sm\": \"Gagana Samoa\",\n  \"sn\": \"Shona\",\n  \"so\": \"Soomaali\",\n  \"st\": \"Sesotho\",\n  \"su\": \"Basa Sunda\",\n  \"tg\": \"\",\n  \"tk\": \"Trkmen\",\n  \"tt\": \"\",\n  \"ug\": \"\",\n  \"yi\": \"\",\n  \"yo\": \"Yorb\",\n  \"zu\": \"isiZulu\",\n  \"xh\": \"isiXhosa\",\n  \"ig\": \"Igbo\",\n  \"ha\": \"Hausa\",\n  \"rw\": \"Kinyarwanda\",\n  \"lg\": \"Luganda\",\n  \"wo\": \"Wolof\"\n};\n\n// Map display names to language codes\nexport const languageNameToCode: Record<string, string> = Object.entries(languageCodeToName).reduce((acc, [code, name]) => {\n  acc[name] = code;\n  return acc;\n}, {} as Record<string, string>);\n\n// Lazy load translation files\nconst loadLocaleData = async (locale: string) => {\n  const data = await import(`./locales/${locale}/common.json`);\n  return data.default;\n};\n\n// Custom backend plugin for lazy loading\nconst lazyLoadBackend = {\n  type: 'backend' as const,\n  init() {},\n  read(language: string, namespace: string, callback: (err: Error | null, data?: any) => void) {\n    // Normalize locale code (e.g., en-US -> en)\n    const baseLocale = language.split('-')[0];\n    \n    loadLocaleData(baseLocale)\n      .then((data) => {\n        callback(null, data);\n      })\n      .catch((error) => {\n        // If loading fails, try fallback\n        if (baseLocale !== 'en') {\n          loadLocaleData('en')\n            .then((data) => {\n              callback(null, data);\n            })\n            .catch((fallbackError) => {\n              callback(fallbackError);\n            });\n        } else {\n          callback(error);\n        }\n      });\n  },\n};\n\ni18n\n  .use(lazyLoadBackend)\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    fallbackLng: 'en',\n    defaultNS: 'common',\n    ns: ['common'],\n    \n    // Disable Suspense to prevent hanging\n    react: {\n      useSuspense: false,\n    },\n    \n    interpolation: {\n      escapeValue: false,\n    },\n    \n    detection: {\n      order: ['localStorage', 'navigator'],\n      caches: ['localStorage'],\n      lookupLocalStorage: 'i18nextLng',\n    },\n  });\n\nexport default i18n;\n","size_bytes":4261},"client/src/pages/terms-of-use.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nexport default function TermsOfUse() {\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/settings/about\")}\n              data-testid=\"button-back\"\n              className=\"mr-2\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold flex-1 text-center mr-10\">Terms of Use</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-6 max-w-3xl\">\n        <div className=\"prose prose-sm dark:prose-invert max-w-none\">\n          <div className=\"mb-6\">\n            <p className=\"text-sm text-muted-foreground\">Last Updated: November 6, 2025</p>\n          </div>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">1. Acceptance of Terms</h2>\n            <p className=\"text-foreground mb-4\">\n              By accessing and using the Lumirra crypto wallet application (\"Service\"), you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this Service.\n            </p>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">2. Use License</h2>\n            <p className=\"text-foreground mb-4\">\n              Permission is granted to temporarily use Lumirra for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title, and under this license you may not:\n            </p>\n            <ul className=\"list-disc pl-6 text-foreground space-y-2\">\n              <li>Modify or copy the materials</li>\n              <li>Use the materials for any commercial purpose or for any public display</li>\n              <li>Attempt to reverse engineer any software contained in Lumirra</li>\n              <li>Remove any copyright or other proprietary notations from the materials</li>\n              <li>Transfer the materials to another person or \"mirror\" the materials on any other server</li>\n            </ul>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">3. Wallet Security</h2>\n            <p className=\"text-foreground mb-4\">\n              You are solely responsible for maintaining the security of your wallet credentials, including your password, recovery phrases, and private keys. Lumirra will never ask for your private keys or recovery phrases. You acknowledge that:\n            </p>\n            <ul className=\"list-disc pl-6 text-foreground space-y-2\">\n              <li>Loss of your credentials may result in permanent loss of access to your crypto assets</li>\n              <li>You are responsible for all activities that occur under your account</li>\n              <li>We cannot recover lost passwords or private keys</li>\n              <li>You should never share your credentials with anyone</li>\n            </ul>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">4. Cryptocurrency Risks</h2>\n            <p className=\"text-foreground mb-4\">\n              You acknowledge and accept the risks associated with using cryptocurrency, including but not limited to:\n            </p>\n            <ul className=\"list-disc pl-6 text-foreground space-y-2\">\n              <li>Volatility and fluctuations in cryptocurrency values</li>\n              <li>Irreversible transactions - once sent, transactions cannot be reversed</li>\n              <li>Regulatory changes that may affect cryptocurrency usage</li>\n              <li>Potential security vulnerabilities in blockchain networks</li>\n              <li>Loss of funds due to user error or network issues</li>\n            </ul>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">5. Transaction Fees</h2>\n            <p className=\"text-foreground mb-4\">\n              All cryptocurrency transactions require network fees (gas fees) that are paid to network validators, not to Lumirra. Transaction fees vary based on network congestion and your selected fee tier (Low, Middle, High). You are responsible for all transaction fees.\n            </p>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">6. Prohibited Activities</h2>\n            <p className=\"text-foreground mb-4\">\n              You agree not to use Lumirra for any unlawful purposes or in any way that could damage, disable, or impair the Service. Prohibited activities include:\n            </p>\n            <ul className=\"list-disc pl-6 text-foreground space-y-2\">\n              <li>Money laundering or terrorist financing</li>\n              <li>Fraud or misrepresentation</li>\n              <li>Violation of any applicable laws or regulations</li>\n              <li>Hacking or unauthorized access attempts</li>\n              <li>Distribution of malware or harmful code</li>\n            </ul>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">7. Disclaimer</h2>\n            <p className=\"text-foreground mb-4\">\n              The materials on Lumirra are provided on an 'as is' basis. Lumirra makes no warranties, expressed or implied, and hereby disclaims and negates all other warranties including, without limitation, implied warranties or conditions of merchantability, fitness for a particular purpose, or non-infringement of intellectual property or other violation of rights.\n            </p>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">8. Limitations</h2>\n            <p className=\"text-foreground mb-4\">\n              In no event shall Lumirra or its suppliers be liable for any damages (including, without limitation, damages for loss of data, loss of profit, or loss of cryptocurrency) arising out of the use or inability to use Lumirra, even if Lumirra or an authorized representative has been notified of the possibility of such damage.\n            </p>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">9. Privacy Policy</h2>\n            <p className=\"text-foreground mb-4\">\n              Your use of Lumirra is also governed by our Privacy Policy. We collect minimal data necessary to provide the Service and never sell your personal information to third parties. We do not have access to your private keys or recovery phrases.\n            </p>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">10. Modifications</h2>\n            <p className=\"text-foreground mb-4\">\n              Lumirra may revise these terms of use at any time without notice. By using this Service, you are agreeing to be bound by the then current version of these terms of use.\n            </p>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">11. Governing Law</h2>\n            <p className=\"text-foreground mb-4\">\n              These terms and conditions are governed by and construed in accordance with applicable international cryptocurrency regulations and you irrevocably submit to the exclusive jurisdiction of the courts in that location.\n            </p>\n          </section>\n\n          <section className=\"mb-8\">\n            <h2 className=\"text-xl font-semibold mb-3\">12. Contact Information</h2>\n            <p className=\"text-foreground mb-4\">\n              If you have any questions about these Terms of Use, please contact us through the Support page in the app settings.\n            </p>\n          </section>\n\n          <div className=\"mt-12 p-4 bg-muted rounded-lg\">\n            <p className=\"text-sm text-muted-foreground text-center\">\n              By continuing to use Lumirra, you acknowledge that you have read, understood, and agree to be bound by these Terms of Use.\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8623},"client/src/pages/settings-about.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, ChevronRight } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Logo } from \"@/components/logo\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function SettingsAbout() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/settings\")}\n              data-testid=\"button-back\"\n              className=\"mr-2\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold flex-1 text-center mr-10\">About</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-8 max-w-2xl\">\n        {/* App Logo and Info */}\n        <div className=\"flex flex-col items-center mb-8\">\n          <div className=\"mb-4\">\n            <Logo size=\"lg\" />\n          </div>\n          <h2 className=\"text-xl font-semibold mb-1\">Lumirra App</h2>\n          <p className=\"text-sm text-muted-foreground\">V4.9.2</p>\n        </div>\n\n        {/* Menu Items */}\n        <div className=\"bg-card rounded-xl mb-4\">\n          <button\n            onClick={() => toast({ \n              title: \"Version Update\", \n              description: \"Version 4.10.3 available\" \n            })}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-t-xl border-b border-border\"\n            data-testid=\"button-version-update\"\n          >\n            <span className=\"text-foreground\">Version Update</span>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"flex items-center gap-1\">\n                <span className=\"w-2 h-2 bg-red-500 rounded-full\"></span>\n                <span className=\"text-sm text-muted-foreground\">4.10.3</span>\n              </span>\n              <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n          </button>\n          \n          <button\n            onClick={() => setLocation(\"/feedback\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 border-b border-border\"\n            data-testid=\"button-feedback\"\n          >\n            <span className=\"text-foreground\">Give Us Feedback</span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </button>\n          \n          <button\n            onClick={() => setLocation(\"/terms-of-use\")}\n            className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-b-xl\"\n            data-testid=\"button-terms\"\n          >\n            <span className=\"text-foreground\">Term of Use</span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </button>\n        </div>\n\n        {/* Footer */}\n        <div className=\"text-center text-sm text-muted-foreground mt-12\">\n           2025 Lumirra\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3363},"client/src/pages/swap-order-details.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, ArrowDown, Copy, Check, ExternalLink, CheckCircle, Clock, AlertCircle, XCircle, MoreVertical } from \"lucide-react\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { SwapOrder } from \"@shared/schema\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ETHEREUM_TOKENS } from \"@shared/ethereum-tokens\";\nimport { BNB_TOKENS } from \"@shared/bnb-tokens\";\nimport { TRON_TOKENS } from \"@shared/tron-tokens\";\nimport { SOLANA_TOKENS } from \"@shared/solana-tokens\";\n\nexport default function SwapOrderDetails() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [copiedField, setCopiedField] = useState<string | null>(null);\n  const [chainIconErrors, setChainIconErrors] = useState<{ [key: string]: boolean }>({});\n  \n  // Get all tokens for icon lookup\n  const allTokens = [\n    ...ETHEREUM_TOKENS,\n    ...BNB_TOKENS,\n    ...TRON_TOKENS,\n    ...SOLANA_TOKENS,\n  ];\n\n  // Fetch chains data for chain icons\n  const { data: chains } = useQuery<any[]>({\n    queryKey: [\"/api/chains\"],\n  });\n\n  // Extract orderId from route params\n  const [, params] = useRoute(\"/swap/orders/:orderId\");\n  const orderId = params?.orderId || \"\";\n\n  // Fetch swap order details\n  const { data: swapOrder, isLoading } = useQuery<SwapOrder>({\n    queryKey: [\"/api/swap-orders\", orderId],\n    queryFn: async () => {\n      const response = await fetch(`/api/swap-orders/${orderId}`);\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch swap order\");\n      }\n      return response.json();\n    },\n    enabled: !!orderId,\n    refetchInterval: (query) => {\n      const data = query.state.data;\n      if (data?.status === \"pending\" || data?.status === \"processing\") {\n        return 3000;\n      }\n      return false;\n    },\n  });\n\n  const copyToClipboard = (text: string, field: string) => {\n    navigator.clipboard.writeText(text);\n    setCopiedField(field);\n    toast({\n      title: \"Copied!\",\n      description: `${field} copied to clipboard`,\n    });\n    setTimeout(() => setCopiedField(null), 2000);\n  };\n\n  const truncateId = (id: string) => {\n    if (!id || id.length < 12) return id;\n    return `${id.substring(0, 6)}...${id.substring(id.length - 6)}`;\n  };\n\n  const formatOrderTime = (date: Date | string) => {\n    const d = typeof date === \"string\" ? new Date(date) : date;\n    return d.toLocaleString(\"en-US\", {\n      year: \"numeric\",\n      month: \"2-digit\",\n      day: \"2-digit\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n      hour12: false,\n    }).replace(\",\", \"\");\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex h-screen w-full items-center justify-center bg-background\">\n        <div className=\"text-center\" data-testid=\"div-loading\">\n          <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-4\"></div>\n          <p className=\"text-sm text-muted-foreground\">Loading order details...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!swapOrder) {\n    return (\n      <div className=\"flex h-screen w-full items-center justify-center bg-background\">\n        <div className=\"text-center space-y-4 p-6\">\n          <h2 className=\"text-xl font-semibold\" data-testid=\"text-error-title\">Order Not Found</h2>\n          <p className=\"text-sm text-muted-foreground\" data-testid=\"text-error-message\">\n            The swap order you're looking for doesn't exist.\n          </p>\n          <Button onClick={() => setLocation(\"/dashboard\")} data-testid=\"button-return-dashboard\">\n            Return to Dashboard\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Helper to truncate transaction hashes and addresses\n  const truncateHash = (hash: string | null | undefined) => {\n    if (!hash || hash.length < 12) return hash || \"N/A\";\n    return `${hash.substring(0, 6)}...${hash.substring(hash.length - 5)}`;\n  };\n\n  // Get blockchain explorer URL for transaction hash\n  const getExplorerUrl = (txHash: string | null | undefined, chainId: string) => {\n    if (!txHash) return null;\n    \n    const normalized = chainId.toLowerCase();\n    switch (normalized) {\n      case \"ethereum\":\n        return `https://etherscan.io/tx/${txHash}`;\n      case \"bnb\":\n      case \"bsc\":\n        return `https://bscscan.com/tx/${txHash}`;\n      case \"polygon\":\n        return `https://polygonscan.com/tx/${txHash}`;\n      case \"tron\":\n        return `https://tronscan.org/#/transaction/${txHash}`;\n      case \"solana\":\n        return `https://solscan.io/tx/${txHash}`;\n      default:\n        return `https://etherscan.io/tx/${txHash}`;\n    }\n  };\n\n  // Get token icon URL from token registry\n  const getTokenIcon = (tokenSymbol: string) => {\n    const tokenInfo = allTokens.find(t => t.symbol === tokenSymbol);\n    return tokenInfo?.icon || null;\n  };\n\n  // Get token's native chain from token registries\n  const getTokenNativeChain = (tokenSymbol: string): string | null => {\n    if (ETHEREUM_TOKENS.find(t => t.symbol === tokenSymbol)) return 'ethereum';\n    if (BNB_TOKENS.find(t => t.symbol === tokenSymbol)) return 'bnb';\n    if (TRON_TOKENS.find(t => t.symbol === tokenSymbol)) return 'tron';\n    if (SOLANA_TOKENS.find(t => t.symbol === tokenSymbol)) return 'solana';\n    return null;\n  };\n\n  // Get chain icon URL from chains data\n  const getChainIcon = (chainId: string) => {\n    if (!chains) return null;\n    const chain = chains.find((c: any) => c.id === chainId);\n    return chain?.icon || null;\n  };\n\n  // Get chain info to determine if token is native\n  const getChainNativeSymbol = (chainId: string) => {\n    if (!chains) return null;\n    const chain = chains.find((c: any) => c.id === chainId);\n    return chain?.symbol || null;\n  };\n\n  // Check if token is native to chain\n  const isNativeToken = (tokenSymbol: string, chainId: string) => {\n    const nativeSymbol = getChainNativeSymbol(chainId);\n    return tokenSymbol === nativeSymbol;\n  };\n\n  // Handle chain icon errors\n  const handleChainIconError = (key: string) => {\n    setChainIconErrors(prev => ({ ...prev, [key]: true }));\n  };\n\n  return (\n    <div className=\"flex flex-col h-screen w-full bg-background\">\n      {/* Header */}\n      <header className=\"flex items-center justify-between px-4 py-3 border-b\">\n        <div className=\"flex items-center gap-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => setLocation(\"/swap/orders\")}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-5 w-5\" />\n          </Button>\n        </div>\n        <h1 className=\"text-base font-semibold absolute left-1/2 -translate-x-1/2\" data-testid=\"text-page-title\">Order Details</h1>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          data-testid=\"button-more-options\"\n        >\n          <MoreVertical className=\"h-5 w-5\" />\n        </Button>\n      </header>\n\n      {/* Content */}\n      <main className=\"flex-1 overflow-y-auto p-4 pb-8\">\n        <div className=\"max-w-md mx-auto space-y-6\">\n          {/* Status Badge */}\n          <div className=\"flex items-center gap-2\" data-testid=\"div-status\">\n            {swapOrder.status === \"completed\" ? (\n              <Badge className=\"bg-[hsl(var(--success))]/10 text-[hsl(var(--success))] hover:bg-[hsl(var(--success))]/20 border-[hsl(var(--success))]/20 flex items-center gap-1.5 px-3 py-1\" data-testid=\"badge-success\">\n                <CheckCircle className=\"h-4 w-4\" />\n                <span>Success</span>\n              </Badge>\n            ) : swapOrder.status === \"pending\" || swapOrder.status === \"processing\" ? (\n              <Badge variant=\"secondary\" className=\"flex items-center gap-1.5 px-3 py-1\" data-testid=\"badge-pending\">\n                <Clock className=\"h-4 w-4\" />\n                <span>{swapOrder.status === \"pending\" ? \"Pending\" : \"Processing\"}</span>\n              </Badge>\n            ) : swapOrder.status === \"failed\" ? (\n              <Badge variant=\"destructive\" className=\"flex items-center gap-1.5 px-3 py-1\" data-testid=\"badge-failed\">\n                <XCircle className=\"h-4 w-4\" />\n                <span>Failed</span>\n              </Badge>\n            ) : (\n              <Badge className=\"bg-[hsl(var(--warning))]/10 text-[hsl(var(--warning))] hover:bg-[hsl(var(--warning))]/20 border-[hsl(var(--warning))]/20 flex items-center gap-1.5 px-3 py-1\" data-testid=\"badge-suspended\">\n                <AlertCircle className=\"h-4 w-4\" />\n                <span>Suspended</span>\n              </Badge>\n            )}\n          </div>\n\n          {/* Token Exchange Display */}\n          <div className=\"space-y-3\">\n            {/* Source Token */}\n            <div className=\"flex items-center gap-3\" data-testid=\"div-source-token\">\n              <div className=\"relative w-12 h-12 flex-shrink-0\">\n                <div className=\"w-full h-full rounded-full bg-primary/10 flex items-center justify-center overflow-hidden\">\n                  {getTokenIcon(swapOrder.sourceToken) ? (\n                    <img \n                      src={getTokenIcon(swapOrder.sourceToken)!} \n                      alt={swapOrder.sourceToken}\n                      className=\"w-full h-full object-cover\"\n                    />\n                  ) : (\n                    <span className=\"text-xl font-bold text-primary\">\n                      {swapOrder.sourceToken.charAt(0)}\n                    </span>\n                  )}\n                </div>\n                {/* Chain Logo Badge - always show for all tokens */}\n                {getChainIcon(swapOrder.chainId) && (\n                  <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n                    {!chainIconErrors['source'] ? (\n                      <img \n                        src={getChainIcon(swapOrder.chainId)!} \n                        alt=\"\" \n                        className=\"w-full h-full object-cover\"\n                        onError={() => handleChainIconError('source')}\n                        loading=\"lazy\"\n                      />\n                    ) : (\n                      <span className=\"text-[9px] font-medium\">{swapOrder.chainId[0].toUpperCase()}</span>\n                    )}\n                  </div>\n                )}\n              </div>\n              <div>\n                <p className=\"text-xl font-bold\" data-testid=\"text-source-amount\">\n                  {parseFloat(swapOrder.sourceAmount).toLocaleString()} {swapOrder.sourceToken}\n                </p>\n                <p className=\"text-sm text-muted-foreground flex items-center gap-1\" data-testid=\"text-source-network\">\n                  <span className=\"inline-flex items-center gap-1\">\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-amber-500\"></span>\n                    {swapOrder.chainId === \"bnb\" ? \"BEP20\" : swapOrder.chainId === \"ethereum\" ? \"ERC20\" : swapOrder.chainId === \"tron\" ? \"TRC20\" : swapOrder.chainId === \"solana\" ? \"SPL\" : swapOrder.chainId.toUpperCase()}\n                  </span>\n                </p>\n              </div>\n            </div>\n\n            {/* Arrow */}\n            <div className=\"flex justify-center\">\n              <ArrowDown className=\"h-4 w-4 text-muted-foreground\" />\n            </div>\n\n            {/* Destination Token */}\n            <div className=\"flex items-center gap-3\" data-testid=\"div-dest-token\">\n              <div className=\"relative w-12 h-12 flex-shrink-0\">\n                <div className=\"w-full h-full rounded-full bg-primary/10 flex items-center justify-center overflow-hidden\">\n                  {getTokenIcon(swapOrder.destToken) ? (\n                    <img \n                      src={getTokenIcon(swapOrder.destToken)!} \n                      alt={swapOrder.destToken}\n                      className=\"w-full h-full object-cover\"\n                    />\n                  ) : (\n                    <span className=\"text-xl font-bold text-primary\">\n                      {swapOrder.destToken.charAt(0)}\n                    </span>\n                  )}\n                </div>\n                {/* Chain Logo Badge - use destination token's native chain, always show */}\n                {(() => {\n                  const destChainId = getTokenNativeChain(swapOrder.destToken);\n                  const chainIcon = destChainId ? getChainIcon(destChainId) : null;\n                  \n                  return chainIcon ? (\n                    <div className=\"absolute -bottom-0.5 -right-0.5 w-4 h-4 rounded-full bg-background border border-border flex items-center justify-center overflow-hidden\">\n                      {!chainIconErrors['dest'] ? (\n                        <img \n                          src={chainIcon} \n                          alt=\"\" \n                          className=\"w-full h-full object-cover\"\n                          onError={() => handleChainIconError('dest')}\n                          loading=\"lazy\"\n                        />\n                      ) : (\n                        <span className=\"text-[9px] font-medium\">{destChainId![0].toUpperCase()}</span>\n                      )}\n                    </div>\n                  ) : null;\n                })()}\n              </div>\n              <div>\n                <p className=\"text-xl font-bold\" data-testid=\"text-dest-amount\">\n                  {parseFloat(swapOrder.destAmount || \"0\").toLocaleString()} {swapOrder.destToken}\n                </p>\n                <p className=\"text-sm text-muted-foreground flex items-center gap-1\" data-testid=\"text-dest-network\">\n                  <span className=\"inline-flex items-center gap-1\">\n                    <span className=\"w-1.5 h-1.5 rounded-full bg-amber-500\"></span>\n                    {(() => {\n                      const destChainId = getTokenNativeChain(swapOrder.destToken);\n                      if (destChainId === \"bnb\") return \"BEP20\";\n                      if (destChainId === \"ethereum\") return \"ERC20\";\n                      if (destChainId === \"tron\") return \"TRC20\";\n                      if (destChainId === \"solana\") return \"SPL\";\n                      return destChainId?.toUpperCase() || \"Unknown\";\n                    })()}\n                  </span>\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* Order Details Grid */}\n          <div className=\"bg-muted/30 rounded-lg p-4 space-y-3\" data-testid=\"div-order-details\">\n            {/* Order ID */}\n            <div className=\"grid grid-cols-[auto,1fr] gap-x-4 gap-y-3\">\n              <span className=\"text-sm text-muted-foreground\">Order ID</span>\n              <div className=\"flex items-center justify-end gap-2\">\n                <span className=\"text-sm font-medium font-mono\" data-testid=\"text-order-id\">\n                  {truncateId(swapOrder.orderId)}\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-6 w-6\"\n                  onClick={() => copyToClipboard(swapOrder.orderId, \"Order ID\")}\n                  data-testid=\"button-copy-order-id\"\n                >\n                  {copiedField === \"Order ID\" ? (\n                    <Check className=\"h-3.5 w-3.5 text-[hsl(var(--success))]\" />\n                  ) : (\n                    <Copy className=\"h-3.5 w-3.5\" />\n                  )}\n                </Button>\n              </div>\n\n              {/* Order Time */}\n              <span className=\"text-sm text-muted-foreground\">Order Time</span>\n              <span className=\"text-sm font-medium text-right\" data-testid=\"text-order-time\">\n                {formatOrderTime(swapOrder.orderTime)}\n              </span>\n\n              {/* Receiving Address */}\n              <span className=\"text-sm text-muted-foreground\">Receiving Address</span>\n              <div className=\"flex items-center justify-end gap-2\">\n                <span className=\"text-sm font-medium font-mono\" data-testid=\"text-receiving-address\">\n                  {truncateHash(swapOrder.receivingAddress)}\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-6 w-6\"\n                  onClick={() => copyToClipboard(swapOrder.receivingAddress || \"\", \"Receiving Address\")}\n                  data-testid=\"button-copy-receiving-address\"\n                >\n                  {copiedField === \"Receiving Address\" ? (\n                    <Check className=\"h-3.5 w-3.5 text-[hsl(var(--success))]\" />\n                  ) : (\n                    <Copy className=\"h-3.5 w-3.5\" />\n                  )}\n                </Button>\n              </div>\n\n              {/* TXID of Transfer-out */}\n              <span className=\"text-sm text-muted-foreground\">TXID of Transfer-out</span>\n              <div className=\"flex items-center justify-end gap-2\">\n                <span className=\"text-sm font-medium font-mono\" data-testid=\"text-txid-out\">\n                  {truncateHash(swapOrder.sendTxHash)}\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-6 w-6\"\n                  onClick={() => {\n                    const url = getExplorerUrl(swapOrder.sendTxHash, swapOrder.chainId);\n                    if (url) window.open(url, \"_blank\");\n                  }}\n                  disabled={!swapOrder.sendTxHash}\n                  data-testid=\"button-view-txid-out\"\n                >\n                  <ExternalLink className=\"h-3.5 w-3.5\" />\n                </Button>\n              </div>\n\n              {/* TXID of Transfer-in */}\n              <span className=\"text-sm text-muted-foreground\">TXID of Transfer-in</span>\n              <div className=\"flex items-center justify-end gap-2\">\n                <span className=\"text-sm font-medium font-mono\" data-testid=\"text-txid-in\">\n                  {truncateHash(swapOrder.receiveTxHash)}\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-6 w-6\"\n                  onClick={() => {\n                    const url = getExplorerUrl(swapOrder.receiveTxHash, swapOrder.chainId);\n                    if (url) window.open(url, \"_blank\");\n                  }}\n                  disabled={!swapOrder.receiveTxHash}\n                  data-testid=\"button-view-txid-in\"\n                >\n                  <ExternalLink className=\"h-3.5 w-3.5\" />\n                </Button>\n              </div>\n\n              {/* Provider */}\n              <span className=\"text-sm text-muted-foreground\">Provider</span>\n              <div className=\"flex items-center justify-end gap-2\">\n                <span className=\"text-sm font-medium\" data-testid=\"text-provider\">\n                  {swapOrder.provider || \"XY Swap\"}\n                </span>\n              </div>\n\n              {/* Rate */}\n              <span className=\"text-sm text-muted-foreground\">Rate</span>\n              <span className=\"text-sm font-medium text-right\" data-testid=\"text-rate\">\n                {swapOrder.rate || `1 ${swapOrder.sourceToken}  ${(parseFloat(swapOrder.destAmount || \"0\") / parseFloat(swapOrder.sourceAmount)).toFixed(6)} ${swapOrder.destToken}`}\n              </span>\n            </div>\n          </div>\n\n          {/* Need Help Link */}\n          <div className=\"text-center pt-4\" data-testid=\"div-help\">\n            <span className=\"text-sm text-muted-foreground\">Need Help? </span>\n            <button\n              className=\"text-sm text-primary hover:underline\"\n              onClick={() => setLocation(\"/contact\")}\n              data-testid=\"button-contact-support\"\n            >\n              Contact customer support\n            </button>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":19993},"client/src/pages/swap-orders.tsx":{"content":"import { useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { ArrowLeft, ArrowDown, Clock, CheckCircle2, XCircle, AlertCircle } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { BottomNav } from \"@/components/bottom-nav\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport type { SwapOrder } from \"@shared/schema\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function SwapOrders() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated, isLoading } = useWallet();\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isLoading, isAuthenticated, setLocation]);\n\n  // Fetch all swap orders\n  const { data: swapOrders, isLoading: ordersLoading } = useQuery<SwapOrder[]>({\n    queryKey: [\"/api/swap-orders\"],\n    enabled: !!isAuthenticated,\n  });\n\n  const formatOrderTime = (date: Date | string) => {\n    const d = typeof date === \"string\" ? new Date(date) : date;\n    return d.toLocaleString(\"en-US\", {\n      year: \"numeric\",\n      month: \"2-digit\",\n      day: \"2-digit\",\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      hour12: false,\n    }).replace(\",\", \"\");\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return (\n          <Badge className=\"bg-[hsl(var(--success))]/10 text-[hsl(var(--success))] hover:bg-[hsl(var(--success))]/20 border-[hsl(var(--success))]/20\" data-testid={`badge-status-completed`}>\n            <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n            Success\n          </Badge>\n        );\n      case \"pending\":\n      case \"processing\":\n        return (\n          <Badge variant=\"secondary\" data-testid={`badge-status-${status}`}>\n            <Clock className=\"h-3 w-3 mr-1\" />\n            {status === \"pending\" ? \"Pending\" : \"Processing\"}\n          </Badge>\n        );\n      case \"failed\":\n        return (\n          <Badge variant=\"destructive\" data-testid={`badge-status-failed`}>\n            <XCircle className=\"h-3 w-3 mr-1\" />\n            Failed\n          </Badge>\n        );\n      case \"suspended\":\n        return (\n          <Badge className=\"bg-[hsl(var(--warning))]/10 text-[hsl(var(--warning))] hover:bg-[hsl(var(--warning))]/20 border-[hsl(var(--warning))]/20\" data-testid={`badge-status-suspended`}>\n            <AlertCircle className=\"h-3 w-3 mr-1\" />\n            Suspended\n          </Badge>\n        );\n      default:\n        return <Badge variant=\"outline\" data-testid={`badge-status-unknown`}>{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <div className=\"border-b border-border\">\n        <div className=\"container max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between py-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/swap\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold\">Swap History</h1>\n            <ThemeToggle />\n          </div>\n        </div>\n      </div>\n\n      {/* Swap Orders List */}\n      <div className=\"container max-w-2xl mx-auto px-4 py-6 space-y-3\">\n        {ordersLoading ? (\n          <div className=\"flex justify-center py-12\">\n            <div className=\"text-muted-foreground\">Loading swap history...</div>\n          </div>\n        ) : swapOrders && swapOrders.length > 0 ? (\n          swapOrders.map((order) => (\n            <Card\n              key={order.orderId}\n              className=\"p-4 cursor-pointer hover-elevate active-elevate-2\"\n              onClick={() => setLocation(`/swap/orders/${order.orderId}`)}\n              data-testid={`card-swap-order-${order.orderId}`}\n            >\n              <div className=\"flex items-start justify-between mb-3\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    {getStatusBadge(order.status)}\n                    <span className=\"text-xs text-muted-foreground\" data-testid={`text-order-time-${order.orderId}`}>\n                      {formatOrderTime(order.orderTime)}\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Token Exchange */}\n              <div className=\"space-y-2\">\n                {/* Source Token */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-muted-foreground\">From</span>\n                    <span className=\"font-medium\" data-testid={`text-source-token-${order.orderId}`}>\n                      {order.sourceToken}\n                    </span>\n                  </div>\n                  <span className=\"font-semibold\" data-testid={`text-source-amount-${order.orderId}`}>\n                    {parseFloat(order.sourceAmount).toLocaleString()}\n                  </span>\n                </div>\n\n                {/* Arrow */}\n                <div className=\"flex justify-center\">\n                  <ArrowDown className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n\n                {/* Destination Token */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-muted-foreground\">To</span>\n                    <span className=\"font-medium\" data-testid={`text-dest-token-${order.orderId}`}>\n                      {order.destToken}\n                    </span>\n                  </div>\n                  <span className=\"font-semibold\" data-testid={`text-dest-amount-${order.orderId}`}>\n                    {parseFloat(order.destAmount || \"0\").toLocaleString()}\n                  </span>\n                </div>\n              </div>\n\n              {/* Order ID */}\n              <div className=\"mt-3 pt-3 border-t border-border\">\n                <div className=\"flex items-center justify-between text-xs\">\n                  <span className=\"text-muted-foreground\">Order ID</span>\n                  <span className=\"font-mono\" data-testid={`text-order-id-${order.orderId}`}>\n                    {order.orderId.substring(0, 16)}...\n                  </span>\n                </div>\n              </div>\n            </Card>\n          ))\n        ) : (\n          <div className=\"flex flex-col items-center justify-center py-12 text-center\" data-testid=\"empty-state\">\n            <div className=\"text-muted-foreground mb-2\">No swap history yet</div>\n            <p className=\"text-sm text-muted-foreground\">\n              Your swap transactions will appear here\n            </p>\n            <Button\n              className=\"mt-4\"\n              onClick={() => setLocation(\"/swap\")}\n              data-testid=\"button-go-to-swap\"\n            >\n              Go to Swap\n            </Button>\n          </div>\n        )}\n      </div>\n\n      <BottomNav />\n    </div>\n  );\n}\n","size_bytes":7295},"server/utils/address-generator.ts":{"content":"/**\n * Generate realistic-looking random addresses for different blockchain networks\n */\n\n// Generate random hex string of specified length\nfunction randomHex(length: number): string {\n  const chars = \"0123456789abcdef\";\n  let result = \"\";\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\n// Generate random base58 string (for Solana/Tron)\nfunction randomBase58(length: number): string {\n  const chars = \"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz\";\n  let result = \"\";\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\n/**\n * Generate a random EVM address (Ethereum, BSC, Polygon, etc.)\n * Format: 0x + 40 hex characters\n */\nexport function generateEvmAddress(): string {\n  return \"0x\" + randomHex(40);\n}\n\n/**\n * Generate a random Tron address\n * Format: T + 33 base58 characters\n */\nexport function generateTronAddress(): string {\n  return \"T\" + randomBase58(33);\n}\n\n/**\n * Generate a random Solana address\n * Format: 32-44 base58 characters\n */\nexport function generateSolanaAddress(): string {\n  return randomBase58(44);\n}\n\n/**\n * Generate a random address for any supported chain\n */\nexport function generateAddressForChain(chainId: string): string {\n  // Normalize chainId\n  const normalized = chainId.toLowerCase();\n  \n  // Tron chains\n  if (normalized === \"tron\") {\n    return generateTronAddress();\n  }\n  \n  // Solana chains\n  if (normalized === \"solana\") {\n    return generateSolanaAddress();\n  }\n  \n  // EVM chains (Ethereum, BSC, Polygon, Avalanche, etc.)\n  // Default to EVM for any other chain\n  return generateEvmAddress();\n}\n\n/**\n * Generate a random transaction hash for any supported chain\n * Most chains use 64-character hex hashes\n */\nexport function generateTxHashForChain(chainId: string): string {\n  const normalized = chainId.toLowerCase();\n  \n  // Solana uses base58 transaction signatures\n  if (normalized === \"solana\") {\n    return randomBase58(88);\n  }\n  \n  // Most blockchains (EVM, Tron) use 64-character hex hashes\n  return \"0x\" + randomHex(64);\n}\n","size_bytes":2157},"client/src/components/processing-overlay.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { CheckCircle2, Loader2, Sparkles } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\ninterface ProcessingOverlayProps {\n  isProcessing: boolean;\n  onComplete: () => void;\n  message?: string;\n  duration?: number;\n}\n\nexport function ProcessingOverlay({\n  isProcessing,\n  onComplete,\n  message = \"Processing transaction...\",\n  duration = 5000,\n}: ProcessingOverlayProps) {\n  const [showSuccess, setShowSuccess] = useState(false);\n\n  useEffect(() => {\n    if (!isProcessing) {\n      setShowSuccess(false);\n      return;\n    }\n\n    const successTimer = setTimeout(() => {\n      setShowSuccess(true);\n    }, duration - 1000);\n\n    const completeTimer = setTimeout(() => {\n      onComplete();\n      setShowSuccess(false);\n    }, duration);\n\n    return () => {\n      clearTimeout(successTimer);\n      clearTimeout(completeTimer);\n    };\n  }, [isProcessing, duration, onComplete]);\n\n  if (!isProcessing) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 z-50 flex items-center justify-center\"\n    >\n      <div className=\"absolute inset-0 bg-background/80 backdrop-blur-md\" />\n      \n      <div className=\"relative z-10 flex flex-col items-center gap-4\">\n        <div className=\"relative\">\n          <AnimatePresence mode=\"wait\">\n            {showSuccess ? (\n              <motion.div\n                key=\"success\"\n                initial={{ scale: 0, rotate: -180 }}\n                animate={{ \n                  scale: [0, 1.2, 1],\n                  rotate: 0,\n                }}\n                transition={{ \n                  duration: 0.6,\n                  ease: [0.34, 1.56, 0.64, 1], // Bouncy easing\n                }}\n                className=\"relative\"\n              >\n                {/* Radial glow effect */}\n                <motion.div\n                  className=\"absolute inset-0 rounded-full bg-success/30 blur-xl\"\n                  animate={{\n                    scale: [1, 1.5, 1],\n                    opacity: [0.5, 0.8, 0.5],\n                  }}\n                  transition={{\n                    duration: 1,\n                    repeat: Infinity,\n                    ease: \"easeInOut\",\n                  }}\n                />\n                \n                {/* Success checkmark icon */}\n                <CheckCircle2 className=\"h-16 w-16 text-success relative z-10\" />\n                \n                {/* Sparkle particles */}\n                {[...Array(6)].map((_, i) => (\n                  <motion.div\n                    key={i}\n                    className=\"absolute top-1/2 left-1/2\"\n                    initial={{ \n                      x: 0, \n                      y: 0, \n                      opacity: 0,\n                      scale: 0,\n                    }}\n                    animate={{ \n                      x: Math.cos((i * Math.PI * 2) / 6) * 40,\n                      y: Math.sin((i * Math.PI * 2) / 6) * 40,\n                      opacity: [0, 1, 0],\n                      scale: [0, 1, 0],\n                    }}\n                    transition={{\n                      duration: 0.8,\n                      delay: 0.1,\n                      ease: \"easeOut\",\n                    }}\n                  >\n                    <Sparkles className=\"h-4 w-4 text-success\" />\n                  </motion.div>\n                ))}\n              </motion.div>\n            ) : (\n              <motion.div\n                key=\"loading\"\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n              >\n                <Loader2 className=\"h-16 w-16 animate-spin text-primary\" />\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n        \n        <motion.p\n          key={showSuccess ? \"success-text\" : \"loading-text\"}\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"text-lg font-medium text-foreground\"\n        >\n          {showSuccess ? \"Transaction Successful!\" : message}\n        </motion.p>\n      </div>\n    </motion.div>\n  );\n}\n","size_bytes":4213},"server/services/email.ts":{"content":"import nodemailer from 'nodemailer';\nimport type { Transporter } from 'nodemailer';\nimport crypto from 'crypto';\n\ninterface EmailOptions {\n  to: string;\n  subject: string;\n  html: string;\n}\n\nclass EmailService {\n  private transporter: Transporter | null = null;\n  private fromAddress: string = '';\n  private fromName: string = 'Lumirra Wallet';\n\n  constructor() {\n    this.initializeTransporter();\n  }\n\n  private initializeTransporter() {\n    const {\n      EMAIL_HOST,\n      EMAIL_PORT,\n      EMAIL_USER,\n      EMAIL_PASSWORD,\n      EMAIL_FROM,\n    } = process.env;\n\n    if (!EMAIL_HOST || !EMAIL_PORT || !EMAIL_USER || !EMAIL_PASSWORD) {\n      console.warn('Email configuration incomplete. Email service disabled.');\n      console.warn('Required: EMAIL_HOST, EMAIL_PORT, EMAIL_USER, EMAIL_PASSWORD');\n      return;\n    }\n\n    this.fromAddress = EMAIL_FROM || EMAIL_USER;\n\n    try {\n      this.transporter = nodemailer.createTransport({\n        host: EMAIL_HOST,\n        port: parseInt(EMAIL_PORT, 10),\n        secure: parseInt(EMAIL_PORT, 10) === 465,\n        auth: {\n          user: EMAIL_USER,\n          pass: EMAIL_PASSWORD,\n        },\n      });\n\n      console.log('Email service initialized successfully with nodemailer');\n      console.log('SMTP Host:', EMAIL_HOST);\n      console.log('SMTP Port:', EMAIL_PORT);\n      console.log('SMTP User:', EMAIL_USER);\n      console.log('From address:', this.fromAddress);\n    } catch (error) {\n      console.error('Failed to initialize email service:', error);\n    }\n  }\n\n  async sendEmail({ to, subject, html }: EmailOptions): Promise<boolean> {\n    if (!this.transporter) {\n      console.error('Email service not initialized');\n      return false;\n    }\n\n    try {\n      const info = await this.transporter.sendMail({\n        from: `\"${this.fromName}\" <${this.fromAddress}>`,\n        to,\n        subject,\n        html,\n      });\n\n      console.log('Email sent successfully to:', to);\n      console.log('Message ID:', info.messageId);\n      return true;\n    } catch (error) {\n      console.error('Failed to send email to:', to);\n      console.error('Error details:', error);\n      return false;\n    }\n  }\n\n  generateOTP(): string {\n    return crypto.randomInt(100000, 1000000).toString();\n  }\n\n  hashOTP(otp: string): string {\n    return crypto.createHash('sha256').update(otp).digest('hex');\n  }\n\n  verifyOTP(inputOTP: string, hashedOTP: string): boolean {\n    const inputHash = this.hashOTP(inputOTP);\n    return crypto.timingSafeEqual(Buffer.from(inputHash), Buffer.from(hashedOTP));\n  }\n\n  async sendVerificationCode(email: string, code: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1E8FF2 0%, #1565C0 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .code-box { background: #f8f9fa; border: 2px dashed #1E8FF2; border-radius: 8px; padding: 30px; text-align: center; margin: 30px 0; }\n          .code { font-size: 36px; font-weight: bold; color: #1E8FF2; letter-spacing: 8px; font-family: 'Courier New', monospace; }\n          .info { color: #666; font-size: 14px; margin-top: 20px; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n          .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 4px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>Lumirra Wallet</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Your Verification Code</p>\n          </div>\n          <div class=\"content\">\n            <p>Hello,</p>\n            <p>You requested a verification code to access your Lumirra Wallet account. Please use the code below to complete your authentication:</p>\n            \n            <div class=\"code-box\">\n              <div class=\"code\">${code}</div>\n              <p class=\"info\">This code will expire in 10 minutes</p>\n            </div>\n            \n            <div class=\"warning\">\n              <strong>Security Notice:</strong> Never share this code with anyone. Lumirra staff will never ask for your verification code.\n            </div>\n            \n            <p>If you didn't request this code, please ignore this email or contact our support team if you have concerns about your account security.</p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This is an automated message, please do not reply to this email.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: 'Your Lumirra Wallet Verification Code',\n      html,\n    });\n  }\n\n  async sendPasswordResetCode(email: string, code: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1E8FF2 0%, #1565C0 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .code-box { background: #f0f7ff; border: 2px dashed #1E8FF2; border-radius: 8px; padding: 30px; text-align: center; margin: 30px 0; }\n          .code { font-size: 36px; font-weight: bold; color: #1E8FF2; letter-spacing: 8px; font-family: 'Courier New', monospace; }\n          .info { color: #666; font-size: 14px; margin-top: 20px; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n          .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 4px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>Password Reset</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Lumirra Wallet</p>\n          </div>\n          <div class=\"content\">\n            <p>Hello,</p>\n            <p>You requested to reset your Lumirra Wallet password. Use the verification code below to proceed with your password reset:</p>\n            \n            <div class=\"code-box\">\n              <div class=\"code\">${code}</div>\n              <p class=\"info\">This code will expire in 10 minutes</p>\n            </div>\n            \n            <div class=\"warning\">\n              <strong>Security Alert:</strong> If you didn't request a password reset, please contact our support team immediately to secure your account.\n            </div>\n            \n            <p>For your security, this verification code can only be used once.</p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This is an automated message, please do not reply to this email.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: 'Lumirra Wallet - Password Reset Code',\n      html,\n    });\n  }\n\n  async sendWelcomeEmail(email: string, username: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1E8FF2 0%, #1565C0 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 32px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .feature { margin: 20px 0; padding: 15px; background: #f0f7ff; border-left: 4px solid #1E8FF2; border-radius: 4px; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>Welcome to Lumirra!</h1>\n          </div>\n          <div class=\"content\">\n            <p>Hello <strong>${username}</strong>,</p>\n            <p>Welcome to Lumirra Wallet! Your account has been successfully created and you're ready to start managing your crypto assets securely.</p>\n            \n            <div class=\"feature\">\n              <strong>Multi-Chain Support</strong>\n              <p style=\"margin: 5px 0 0 0; color: #666;\">Manage assets across Ethereum, BSC, Polygon, Solana, and more</p>\n            </div>\n            \n            <div class=\"feature\">\n              <strong>Instant Swaps</strong>\n              <p style=\"margin: 5px 0 0 0; color: #666;\">Swap between cryptocurrencies seamlessly</p>\n            </div>\n            \n            <div class=\"feature\">\n              <strong>Bank-Grade Security</strong>\n              <p style=\"margin: 5px 0 0 0; color: #666;\">Your assets are protected with enterprise-level security</p>\n            </div>\n            \n            <p style=\"margin-top: 30px;\">If you have any questions or need assistance, our support team is here to help.</p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: 'Welcome to Lumirra Wallet!',\n      html,\n    });\n  }\n\n  async sendCryptoReceived(email: string, username: string, amount: string, token: string, txHash: string, chain: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1E8FF2 0%, #1565C0 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .amount-box { background: #f0f7ff; border: 2px solid #1E8FF2; border-radius: 8px; padding: 30px; text-align: center; margin: 30px 0; }\n          .amount { font-size: 32px; font-weight: bold; color: #1E8FF2; }\n          .details { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; }\n          .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0; }\n          .detail-row:last-child { border-bottom: none; }\n          .detail-label { font-weight: 600; color: #666; }\n          .detail-value { color: #333; word-break: break-all; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n          .button { display: inline-block; margin-top: 20px; padding: 12px 30px; background: #1E8FF2; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>Crypto Received</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Lumirra Wallet</p>\n          </div>\n          <div class=\"content\">\n            <p>Hello <strong>${username}</strong>,</p>\n            <p>You've successfully received cryptocurrency in your Lumirra Wallet!</p>\n            \n            <div class=\"amount-box\">\n              <div class=\"amount\">+${amount} ${token}</div>\n            </div>\n            \n            <div class=\"details\">\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Transaction Hash:</span>\n                <span class=\"detail-value\">${txHash.substring(0, 10)}...${txHash.substring(txHash.length - 8)}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Network:</span>\n                <span class=\"detail-value\">${chain}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Status:</span>\n                <span class=\"detail-value\" style=\"color: #4caf50; font-weight: 600;\">Completed</span>\n              </div>\n            </div>\n            \n            <p style=\"text-align: center;\">\n              <a href=\"https://yourapp.com/transactions\" class=\"button\">View Transaction Details</a>\n            </p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This is an automated notification. Please do not reply to this email.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: `Received ${amount} ${token} - Lumirra Wallet`,\n      html,\n    });\n  }\n\n  async sendCryptoSent(email: string, username: string, amount: string, token: string, txHash: string, chain: string, recipientAddress: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1E8FF2 0%, #1565C0 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .amount-box { background: #fff8f0; border: 2px solid #ff9800; border-radius: 8px; padding: 30px; text-align: center; margin: 30px 0; }\n          .amount { font-size: 32px; font-weight: bold; color: #ff9800; }\n          .details { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; }\n          .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0; }\n          .detail-row:last-child { border-bottom: none; }\n          .detail-label { font-weight: 600; color: #666; }\n          .detail-value { color: #333; word-break: break-all; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n          .button { display: inline-block; margin-top: 20px; padding: 12px 30px; background: #1E8FF2; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>Crypto Sent</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Lumirra Wallet</p>\n          </div>\n          <div class=\"content\">\n            <p>Hello <strong>${username}</strong>,</p>\n            <p>You've successfully sent cryptocurrency from your Lumirra Wallet!</p>\n            \n            <div class=\"amount-box\">\n              <div class=\"amount\">-${amount} ${token}</div>\n            </div>\n            \n            <div class=\"details\">\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Recipient:</span>\n                <span class=\"detail-value\">${recipientAddress.substring(0, 10)}...${recipientAddress.substring(recipientAddress.length - 8)}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Transaction Hash:</span>\n                <span class=\"detail-value\">${txHash.substring(0, 10)}...${txHash.substring(txHash.length - 8)}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Network:</span>\n                <span class=\"detail-value\">${chain}</span>\n              </div>\n              <div class=\"detail-row\">\n                <span class=\"detail-label\">Status:</span>\n                <span class=\"detail-value\" style=\"color: #4caf50; font-weight: 600;\">Completed</span>\n              </div>\n            </div>\n            \n            <p style=\"text-align: center;\">\n              <a href=\"https://yourapp.com/transactions\" class=\"button\">View Transaction Details</a>\n            </p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This is an automated notification. Please do not reply to this email.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    return this.sendEmail({\n      to: email,\n      subject: `Sent ${amount} ${token} - Lumirra Wallet`,\n      html,\n    });\n  }\n\n  async sendContactUsNotification(name: string, email: string, message: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1677FF 0%, #2ED8FF 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .message-box { background: #f8f9fa; border-left: 4px solid #1677FF; padding: 20px; margin: 20px 0; border-radius: 4px; }\n          .detail-row { margin: 10px 0; }\n          .detail-label { font-weight: 600; color: #666; }\n          .detail-value { color: #333; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>New Contact Form Submission</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Lumirra Wallet</p>\n          </div>\n          <div class=\"content\">\n            <p>You have received a new contact form submission:</p>\n            \n            <div class=\"detail-row\">\n              <span class=\"detail-label\">Name:</span>\n              <span class=\"detail-value\"> ${name}</span>\n            </div>\n            \n            <div class=\"detail-row\">\n              <span class=\"detail-label\">Email:</span>\n              <span class=\"detail-value\"> ${email}</span>\n            </div>\n            \n            <div class=\"message-box\">\n              <div class=\"detail-label\">Message:</div>\n              <p style=\"margin: 10px 0 0 0; white-space: pre-wrap;\">${message}</p>\n            </div>\n            \n            <p style=\"margin-top: 30px; color: #666;\">Please respond to this inquiry at your earliest convenience.</p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This is an automated notification from your contact form.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    // Send to admin email if set, otherwise fall back to from address\n    const adminEmail = process.env.ADMIN_EMAIL || this.fromAddress;\n    \n    return this.sendEmail({\n      to: adminEmail,\n      subject: `New Contact Form Submission from ${name}`,\n      html,\n    });\n  }\n\n  async sendSupportReply(to: string, name: string, originalMessage: string, replyMessage: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1677FF 0%, #2ED8FF 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .message-box { background: #f8f9fa; border-left: 4px solid #1677FF; padding: 20px; margin: 20px 0; border-radius: 4px; }\n          .original-message { background: #fff; border: 1px solid #e0e0e0; padding: 15px; margin: 20px 0; border-radius: 4px; }\n          .detail-label { font-weight: 600; color: #666; font-size: 12px; text-transform: uppercase; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>Support Team Response</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Lumirra Wallet</p>\n          </div>\n          <div class=\"content\">\n            <p>Dear ${name},</p>\n            <p>Thank you for contacting Lumirra Wallet support. We have reviewed your inquiry and here is our response:</p>\n            \n            <div class=\"message-box\">\n              <div class=\"detail-label\">Our Response:</div>\n              <p style=\"margin: 10px 0 0 0; white-space: pre-wrap;\">${replyMessage}</p>\n            </div>\n            \n            <div class=\"original-message\">\n              <div class=\"detail-label\">Your Original Message:</div>\n              <p style=\"margin: 10px 0 0 0; white-space: pre-wrap; color: #666;\">${originalMessage}</p>\n            </div>\n            \n            <p style=\"margin-top: 30px;\">If you have any further questions, please don't hesitate to reach out to us again.</p>\n            <p>Best regards,<br>Lumirra Wallet Support Team</p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This email was sent in response to your support inquiry.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    return this.sendEmail({\n      to,\n      subject: 'Response to Your Support Inquiry - Lumirra Wallet',\n      html,\n    });\n  }\n\n  async sendSupportMessage(to: string, name: string, message: string, subject: string = 'Message from Lumirra Wallet Support'): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #1677FF 0%, #2ED8FF 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .message-box { background: #f8f9fa; border-left: 4px solid #1677FF; padding: 20px; margin: 20px 0; border-radius: 4px; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>Message from Support</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Lumirra Wallet</p>\n          </div>\n          <div class=\"content\">\n            <p>Dear ${name},</p>\n            \n            <div class=\"message-box\">\n              <p style=\"margin: 0; white-space: pre-wrap;\">${message}</p>\n            </div>\n            \n            <p style=\"margin-top: 30px;\">If you have any questions or need assistance, please don't hesitate to reach out to our support team.</p>\n            <p>Best regards,<br>Lumirra Wallet Support Team</p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This is a message from Lumirra Wallet Support.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    return this.sendEmail({\n      to,\n      subject,\n      html,\n    });\n  }\n\n  async sendSupportChatFirstMessageAlert(userName: string, userEmail: string, message: string): Promise<boolean> {\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <style>\n          body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f4f4f4; margin: 0; padding: 0; }\n          .container { max-width: 600px; margin: 40px auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }\n          .header { background: linear-gradient(135deg, #0084ff 0%, #0066cc 100%); color: white; padding: 40px 30px; text-align: center; }\n          .header h1 { margin: 0; font-size: 28px; font-weight: 600; }\n          .content { padding: 40px 30px; }\n          .message-box { background: #f0f7ff; border-left: 4px solid #0084ff; padding: 20px; margin: 20px 0; border-radius: 4px; }\n          .detail-row { margin: 10px 0; }\n          .detail-label { font-weight: 600; color: #666; }\n          .detail-value { color: #333; }\n          .badge { display: inline-block; background: #0084ff; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }\n          .footer { background: #f8f9fa; padding: 20px 30px; text-align: center; color: #999; font-size: 12px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h1>New Support Chat Message</h1>\n            <p style=\"margin: 10px 0 0 0; opacity: 0.9;\">Lumirra Wallet</p>\n          </div>\n          <div class=\"content\">\n            <p><span class=\"badge\">NEW USER</span></p>\n            <p>A new user has started a support chat conversation and is waiting for assistance:</p>\n            \n            <div class=\"detail-row\">\n              <span class=\"detail-label\">User:</span>\n              <span class=\"detail-value\"> ${userName}</span>\n            </div>\n            \n            <div class=\"detail-row\">\n              <span class=\"detail-label\">Email:</span>\n              <span class=\"detail-value\"> ${userEmail}</span>\n            </div>\n            \n            <div class=\"message-box\">\n              <div class=\"detail-label\">First Message:</div>\n              <p style=\"margin: 10px 0 0 0; white-space: pre-wrap;\">${message}</p>\n            </div>\n            \n            <p style=\"margin-top: 30px; color: #666; font-weight: 600;\">Please log in to the admin panel to respond to this support request.</p>\n          </div>\n          <div class=\"footer\">\n            <p> ${new Date().getFullYear()} Lumirra Wallet. All rights reserved.</p>\n            <p>This is an automated notification from your support chat system.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n\n    // Send to admin email if set, otherwise fall back to from address\n    const adminEmail = process.env.ADMIN_EMAIL || this.fromAddress;\n    \n    return this.sendEmail({\n      to: adminEmail,\n      subject: `New Support Chat from ${userName}`,\n      html,\n    });\n  }\n}\n\nexport const emailService = new EmailService();\n","size_bytes":28552},"client/src/lib/safe-storage.ts":{"content":"interface StorageOptions {\n  fallback?: string | null;\n  prefix?: string;\n}\n\nclass SafeStorage {\n  private prefix: string;\n\n  constructor(prefix: string = \"lumirra-\") {\n    this.prefix = prefix;\n  }\n\n  getItem(key: string, options: StorageOptions = {}): string | null {\n    const fullKey = `${this.prefix}${key}`;\n    const { fallback = null } = options;\n\n    try {\n      const value = localStorage.getItem(fullKey);\n      return value !== null ? value : fallback;\n    } catch (error) {\n      console.warn(`localStorage.getItem failed for key \"${fullKey}\":`, error);\n      this.removeItem(key);\n      return fallback;\n    }\n  }\n\n  getJSON<T>(key: string, fallback: T): T {\n    const value = this.getItem(key);\n    if (value === null) {\n      return fallback;\n    }\n\n    try {\n      return JSON.parse(value) as T;\n    } catch (error) {\n      console.warn(`JSON.parse failed for key \"${this.prefix}${key}\":`, error);\n      this.removeItem(key);\n      return fallback;\n    }\n  }\n\n  setItem(key: string, value: string): boolean {\n    const fullKey = `${this.prefix}${key}`;\n\n    try {\n      localStorage.setItem(fullKey, value);\n      return true;\n    } catch (error) {\n      console.error(`localStorage.setItem failed for key \"${fullKey}\":`, error);\n      if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n        console.warn('localStorage quota exceeded, attempting to clear old data');\n        this.clearAll();\n        try {\n          localStorage.setItem(fullKey, value);\n          return true;\n        } catch (retryError) {\n          console.error('Failed to set item even after clearing:', retryError);\n          return false;\n        }\n      }\n      return false;\n    }\n  }\n\n  setJSON<T>(key: string, value: T): boolean {\n    try {\n      const serialized = JSON.stringify(value);\n      return this.setItem(key, serialized);\n    } catch (error) {\n      console.error(`JSON.stringify failed for key \"${this.prefix}${key}\":`, error);\n      return false;\n    }\n  }\n\n  removeItem(key: string): void {\n    const fullKey = `${this.prefix}${key}`;\n    try {\n      localStorage.removeItem(fullKey);\n    } catch (error) {\n      console.warn(`localStorage.removeItem failed for key \"${fullKey}\":`, error);\n    }\n  }\n\n  clearAll(): void {\n    try {\n      const keysToRemove: string[] = [];\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key?.startsWith(this.prefix)) {\n          keysToRemove.push(key);\n        }\n      }\n      keysToRemove.forEach(key => {\n        try {\n          localStorage.removeItem(key);\n        } catch (e) {\n          console.warn(`Failed to remove key \"${key}\":`, e);\n        }\n      });\n    } catch (error) {\n      console.error('Failed to clear localStorage:', error);\n      try {\n        localStorage.clear();\n      } catch (e) {\n        console.error('Failed to clear all localStorage:', e);\n      }\n    }\n  }\n\n  isAvailable(): boolean {\n    try {\n      const testKey = '__storage_test__';\n      localStorage.setItem(testKey, '1');\n      localStorage.removeItem(testKey);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  validateJSON(key: string): boolean {\n    const value = this.getItem(key);\n    if (!value) return true;\n\n    try {\n      JSON.parse(value);\n      return true;\n    } catch {\n      console.warn(`Invalid JSON detected in key \"${this.prefix}${key}\", removing...`);\n      this.removeItem(key);\n      return false;\n    }\n  }\n\n  runHealthCheck(): { healthy: boolean; issues: string[] } {\n    const issues: string[] = [];\n\n    if (!this.isAvailable()) {\n      issues.push('localStorage is not available');\n      return { healthy: false, issues };\n    }\n\n    try {\n      const keys = Object.keys(localStorage).filter(k => k.startsWith(this.prefix));\n      \n      for (const key of keys) {\n        const value = localStorage.getItem(key);\n        \n        if (value === null) {\n          issues.push(`Null value for key: ${key}`);\n          continue;\n        }\n\n        if (key.includes('-wallet') || key.includes('-user') || key.includes('-settings')) {\n          try {\n            JSON.parse(value);\n          } catch {\n            issues.push(`Corrupted JSON in key: ${key}`);\n            localStorage.removeItem(key);\n          }\n        }\n      }\n\n      if (keys.length > 100) {\n        issues.push(`Too many keys: ${keys.length} (possible memory leak)`);\n      }\n\n    } catch (error) {\n      issues.push(`Health check failed: ${error}`);\n      return { healthy: false, issues };\n    }\n\n    return { healthy: issues.length === 0, issues };\n  }\n\n  autoCleanup(): number {\n    let cleaned = 0;\n    \n    try {\n      const keys = Object.keys(localStorage).filter(k => k.startsWith(this.prefix));\n      \n      for (const key of keys) {\n        const value = localStorage.getItem(key);\n        \n        if (!value || value === 'null' || value === 'undefined') {\n          localStorage.removeItem(key);\n          cleaned++;\n          continue;\n        }\n\n        if (key.includes('-timestamp')) {\n          try {\n            const timestamp = parseInt(value);\n            const age = Date.now() - timestamp;\n            const thirtyDays = 30 * 24 * 60 * 60 * 1000;\n            \n            if (age > thirtyDays) {\n              localStorage.removeItem(key);\n              cleaned++;\n            }\n          } catch {\n            localStorage.removeItem(key);\n            cleaned++;\n          }\n        }\n      }\n\n      if (cleaned > 0) {\n        console.log(`Auto-cleanup removed ${cleaned} stale/corrupted items`);\n      }\n    } catch (error) {\n      console.error('Auto-cleanup failed:', error);\n    }\n\n    return cleaned;\n  }\n\n  getStorageInfo(): { totalKeys: number; appKeys: number; sizeEstimate: string } {\n    try {\n      const allKeys = Object.keys(localStorage);\n      const appKeys = allKeys.filter(k => k.startsWith(this.prefix));\n      \n      let totalSize = 0;\n      appKeys.forEach(key => {\n        const value = localStorage.getItem(key);\n        if (value) {\n          totalSize += key.length + value.length;\n        }\n      });\n\n      const sizeInKB = (totalSize / 1024).toFixed(2);\n      \n      return {\n        totalKeys: allKeys.length,\n        appKeys: appKeys.length,\n        sizeEstimate: `~${sizeInKB} KB`,\n      };\n    } catch {\n      return {\n        totalKeys: 0,\n        appKeys: 0,\n        sizeEstimate: 'Unknown',\n      };\n    }\n  }\n}\n\nexport const safeStorage = new SafeStorage();\n","size_bytes":6446},"server/services/background-jobs.ts":{"content":"import { MarketNews, PriceAlert, Notification, Wallet, UserPushSubscription } from \"../models\";\nimport { getSimplePrices } from \"./coingecko\";\n\n// CryptoPanic API configuration (free tier)\nconst CRYPTOPANIC_API_URL = \"https://cryptopanic.com/api/v1/posts/\";\nconst CRYPTOPANIC_API_KEY = process.env.CRYPTOPANIC_API_KEY || \"demo\"; // Use 'demo' for testing\n\n// Symbol to CoinGecko ID mapping for common cryptocurrencies\nconst SYMBOL_TO_COINGECKO_ID: Record<string, string> = {\n  btc: \"bitcoin\",\n  eth: \"ethereum\",\n  bnb: \"binancecoin\",\n  usdt: \"tether\",\n  usdc: \"usd-coin\",\n  xrp: \"ripple\",\n  ada: \"cardano\",\n  doge: \"dogecoin\",\n  sol: \"solana\",\n  trx: \"tron\",\n  dot: \"polkadot\",\n  matic: \"matic-network\",\n  ltc: \"litecoin\",\n  shib: \"shiba-inu\",\n  avax: \"avalanche-2\",\n  uni: \"uniswap\",\n  link: \"chainlink\",\n  atom: \"cosmos\",\n  etc: \"ethereum-classic\",\n  xlm: \"stellar\",\n  bch: \"bitcoin-cash\",\n  algo: \"algorand\",\n  vet: \"vechain\",\n  fil: \"filecoin\",\n  apt: \"aptos\",\n};\n\n// Sanitize HTML to prevent XSS attacks\nfunction sanitizeHtml(html: string): string {\n  return html\n    .replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, '')\n    .replace(/<iframe\\b[^<]*(?:(?!<\\/iframe>)<[^<]*)*<\\/iframe>/gi, '')\n    .replace(/on\\w+=\"[^\"]*\"/gi, '')\n    .replace(/on\\w+='[^']*'/gi, '');\n}\n\n// Map news importance based on votes/kind\nfunction determineImportance(votes: any): \"low\" | \"medium\" | \"high\" | \"critical\" {\n  const positiveVotes = votes?.positive || 0;\n  const negativeVotes = votes?.negative || 0;\n  const totalVotes = positiveVotes + negativeVotes;\n\n  if (totalVotes > 100) return \"critical\";\n  if (totalVotes > 50) return \"high\";\n  if (totalVotes > 10) return \"medium\";\n  return \"low\";\n}\n\n// Fetch crypto news from CryptoPanic API\nexport async function fetchCryptoNews(): Promise<void> {\n  try {\n    console.log(\"[Background Job] Fetching crypto news...\");\n    \n    const response = await fetch(\n      `${CRYPTOPANIC_API_URL}?auth_token=${CRYPTOPANIC_API_KEY}&public=true&filter=hot`\n    );\n\n    if (!response.ok) {\n      console.error(\"[Background Job] CryptoPanic API error:\", response.statusText);\n      return;\n    }\n\n    const data = await response.json();\n    const posts = data.results || [];\n\n    let newCount = 0;\n    for (const post of posts.slice(0, 20)) { // Process top 20 hot news\n      try {\n        // Check if news already exists\n        const exists = await MarketNews.findOne({ externalId: post.id.toString() });\n        if (exists) continue;\n\n        // Create news entry\n        const news = new MarketNews({\n          externalId: post.id.toString(),\n          title: sanitizeHtml(post.title || \"Breaking Crypto News\"),\n          description: sanitizeHtml(post.title || \"\"),\n          url: post.url || \"\",\n          source: post.source?.title || \"CryptoPanic\",\n          imageUrl: post.source?.favicon || null,\n          publishedAt: new Date(post.published_at),\n          category: post.currencies?.length > 0 ? post.currencies[0].code : \"General\",\n          importance: determineImportance(post.votes),\n        });\n\n        await news.save();\n        newCount++;\n\n        // Create notifications for high/critical importance news\n        if (news.importance === \"high\" || news.importance === \"critical\") {\n          await createNewsNotifications(news);\n        }\n      } catch (err) {\n        console.error(\"[Background Job] Error saving news item:\", err);\n      }\n    }\n\n    console.log(`[Background Job] Fetched ${newCount} new crypto news items`);\n  } catch (error) {\n    console.error(\"[Background Job] Error fetching crypto news:\", error);\n  }\n}\n\n// Create notifications for all users about important news\nasync function createNewsNotifications(news: any): Promise<void> {\n  try {\n    // Get all wallets\n    const wallets = await Wallet.find({}).select(\"_id\");\n\n    const notifications = wallets.map((wallet) => ({\n      walletId: wallet._id,\n      category: \"System\",\n      type: \"system\",\n      title: `${news.importance === \"critical\" ? \"BREAKING\" : \"Important\"} Crypto News`,\n      description: news.title,\n      metadata: {\n        newsId: news._id,\n        url: news.url,\n        source: news.source,\n        importance: news.importance,\n      },\n    }));\n\n    if (notifications.length > 0) {\n      await Notification.insertMany(notifications);\n      console.log(`[Background Job] Created ${notifications.length} news notifications`);\n    }\n  } catch (error) {\n    console.error(\"[Background Job] Error creating news notifications:\", error);\n  }\n}\n\n// Check price alerts and trigger notifications\nexport async function checkPriceAlerts(): Promise<void> {\n  try {\n    console.log(\"[Background Job] Checking price alerts...\");\n\n    // Get all active, non-triggered alerts\n    const alerts = await PriceAlert.find({\n      isActive: true,\n      $or: [\n        { triggeredAt: null },\n        { triggeredAt: { $lt: new Date(Date.now() - 24 * 60 * 60 * 1000) } }, // Re-trigger after 24h\n      ],\n    });\n\n    if (alerts.length === 0) {\n      console.log(\"[Background Job] No active alerts to check\");\n      return;\n    }\n\n    // Get unique token symbols and map to CoinGecko IDs\n    const uniqueSymbols = new Set(alerts.map((a) => a.tokenSymbol.toLowerCase()));\n    const tokenSymbols = Array.from(uniqueSymbols);\n    const coinIds = tokenSymbols\n      .map((symbol) => SYMBOL_TO_COINGECKO_ID[symbol])\n      .filter((id) => id !== undefined);\n\n    if (coinIds.length === 0) {\n      console.log(\"[Background Job] No supported tokens in alerts\");\n      return;\n    }\n\n    // Fetch current prices from CoinGecko (pass array, not string)\n    const prices = await getSimplePrices(coinIds);\n\n    let triggeredCount = 0;\n    for (const alert of alerts) {\n      const tokenSymbol = alert.tokenSymbol.toLowerCase();\n      const coinId = SYMBOL_TO_COINGECKO_ID[tokenSymbol];\n      \n      if (!coinId) {\n        console.log(`[Background Job] No CoinGecko ID mapping for ${alert.tokenSymbol}`);\n        continue;\n      }\n\n      const currentPrice = prices[coinId]?.usd;\n\n      if (!currentPrice) {\n        console.log(`[Background Job] No price data for ${alert.tokenSymbol} (${coinId})`);\n        continue;\n      }\n\n      // Check if alert condition is met\n      const isTriggered =\n        (alert.condition === \"above\" && currentPrice >= alert.targetPrice) ||\n        (alert.condition === \"below\" && currentPrice <= alert.targetPrice);\n\n      if (isTriggered) {\n        // Update alert\n        alert.triggeredAt = new Date();\n        alert.lastNotifiedAt = new Date();\n        await alert.save();\n\n        // Create notification for user\n        await createPriceAlertNotification(alert, currentPrice);\n\n        triggeredCount++;\n      }\n    }\n\n    console.log(`[Background Job] Triggered ${triggeredCount} price alerts`);\n  } catch (error) {\n    console.error(\"[Background Job] Error checking price alerts:\", error);\n  }\n}\n\n// Create notification for triggered price alert\nasync function createPriceAlertNotification(alert: any, currentPrice: number): Promise<void> {\n  try {\n    // Find user's wallet\n    const wallet = await Wallet.findOne({ userId: alert.userId });\n    if (!wallet) {\n      console.log(`[Background Job] No wallet found for user ${alert.userId}, skipping notification`);\n      return;\n    }\n\n    const notification = new Notification({\n      walletId: wallet._id,\n      category: \"System\",\n      type: \"system\",\n      title: `Price Alert: ${alert.tokenSymbol}`,\n      description: `${alert.tokenName} is now ${alert.condition} $${alert.targetPrice.toLocaleString()}! Current price: $${currentPrice.toLocaleString()}`,\n      metadata: {\n        alertId: alert._id,\n        tokenSymbol: alert.tokenSymbol,\n        targetPrice: alert.targetPrice,\n        currentPrice,\n        condition: alert.condition,\n      },\n    });\n\n    await notification.save();\n\n    // Send browser push notification if user is subscribed\n    await sendPushNotification(alert.userId, {\n      title: `Price Alert: ${alert.tokenSymbol}`,\n      body: `${alert.tokenName} is ${alert.condition} $${alert.targetPrice.toLocaleString()}!`,\n      icon: \"/icon-192.png\",\n      data: {\n        url: \"/notifications\",\n      },\n    });\n  } catch (error) {\n    console.error(\"[Background Job] Error creating price alert notification:\", error);\n  }\n}\n\n// Send browser push notification\nasync function sendPushNotification(userId: string, payload: any): Promise<void> {\n  try {\n    const subscriptions = await UserPushSubscription.find({ userId });\n\n    if (subscriptions.length === 0) {\n      return;\n    }\n\n    // Note: Actual web push implementation requires web-push library\n    // For now, we'll just log that we would send a notification\n    console.log(`[Background Job] Would send push notification to ${subscriptions.length} devices`);\n    \n    // TODO: Implement actual web push using web-push library\n    // const webpush = require('web-push');\n    // for (const sub of subscriptions) {\n    //   try {\n    //     await webpush.sendNotification({\n    //       endpoint: sub.endpoint,\n    //       keys: sub.keys\n    //     }, JSON.stringify(payload));\n    //   } catch (err) {\n    //     if (err.statusCode === 410) {\n    //       // Subscription expired, delete it\n    //       await UserPushSubscription.deleteOne({ _id: sub._id });\n    //     }\n    //   }\n    // }\n  } catch (error) {\n    console.error(\"[Background Job] Error sending push notification:\", error);\n  }\n}\n\n// Wrap background job execution with error handling\nfunction safeExecute(fn: () => Promise<void>, jobName: string) {\n  return async () => {\n    try {\n      await fn();\n    } catch (error) {\n      console.error(`[Background Job] Error in ${jobName}:`, error);\n      // Continue running - don't crash the server\n    }\n  };\n}\n\n// Start background jobs\nexport function startBackgroundJobs(): void {\n  console.log(\"[Background Job] Starting background jobs...\");\n\n  // Fetch crypto news every 15 minutes\n  setInterval(safeExecute(fetchCryptoNews, \"fetchCryptoNews\"), 15 * 60 * 1000);\n  // Run immediately on startup\n  setTimeout(safeExecute(fetchCryptoNews, \"fetchCryptoNews\"), 5000);\n\n  // Check price alerts every 5 minutes\n  setInterval(safeExecute(checkPriceAlerts, \"checkPriceAlerts\"), 5 * 60 * 1000);\n  // Run immediately on startup (after 10 seconds)\n  setTimeout(safeExecute(checkPriceAlerts, \"checkPriceAlerts\"), 10000);\n\n  console.log(\"[Background Job] Background jobs started successfully\");\n}\n","size_bytes":10392},"client/src/pages/price-alerts.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ArrowLeft, Bell, BellOff, Plus, Trash2, Loader2, TrendingUp, TrendingDown } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\n\ninterface PriceAlert {\n  _id: string;\n  userId: string;\n  tokenSymbol: string;\n  tokenName: string;\n  targetPrice: number;\n  condition: \"above\" | \"below\";\n  isActive: boolean;\n  lastNotifiedAt?: string;\n  createdAt: string;\n}\n\nexport default function PriceAlerts() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated, isLoading: isAuthLoading } = useWallet();\n  const { toast } = useToast();\n\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);\n  const [tokenSymbol, setTokenSymbol] = useState(\"\");\n  const [tokenName, setTokenName] = useState(\"\");\n  const [targetPrice, setTargetPrice] = useState(\"\");\n  const [condition, setCondition] = useState<\"above\" | \"below\">(\"above\");\n\n  useEffect(() => {\n    if (!isAuthLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthLoading, isAuthenticated, setLocation]);\n\n  // Fetch price alerts\n  const { data: alertsData, isLoading: isLoadingAlerts } = useQuery<PriceAlert[]>({\n    queryKey: [\"/api/price-alerts\"],\n    enabled: isAuthenticated,\n  });\n\n  const alerts: PriceAlert[] = alertsData || [];\n\n  // Create alert mutation\n  const createAlertMutation = useMutation({\n    mutationFn: async (data: { tokenSymbol: string; tokenName: string; targetPrice: number; condition: string }) => {\n      return await apiRequest(\"POST\", \"/api/price-alerts\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/price-alerts\"] });\n      toast({\n        title: \"Alert created\",\n        description: \"Your price alert has been created successfully\",\n      });\n      setIsCreateDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create price alert\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Toggle alert mutation\n  const toggleAlertMutation = useMutation({\n    mutationFn: async ({ id, isActive }: { id: string; isActive: boolean }) => {\n      return await apiRequest(\"PATCH\", `/api/price-alerts/${id}`, { isActive });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/price-alerts\"] });\n      toast({\n        title: \"Alert updated\",\n        description: \"Alert status has been updated\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update alert\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete alert mutation\n  const deleteAlertMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/price-alerts/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/price-alerts\"] });\n      toast({\n        title: \"Alert deleted\",\n        description: \"Price alert has been deleted\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete alert\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setTokenSymbol(\"\");\n    setTokenName(\"\");\n    setTargetPrice(\"\");\n    setCondition(\"above\");\n  };\n\n  const handleCreateAlert = () => {\n    if (!tokenSymbol || !tokenName || !targetPrice) {\n      toast({\n        title: \"Missing fields\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const price = parseFloat(targetPrice);\n    if (isNaN(price) || price <= 0) {\n      toast({\n        title: \"Invalid price\",\n        description: \"Please enter a valid price\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createAlertMutation.mutate({\n      tokenSymbol: tokenSymbol.toUpperCase(),\n      tokenName,\n      targetPrice: price,\n      condition,\n    });\n  };\n\n  const handleToggleAlert = (alert: PriceAlert) => {\n    toggleAlertMutation.mutate({ id: alert._id, isActive: !alert.isActive });\n  };\n\n  const handleDeleteAlert = (id: string) => {\n    if (window.confirm(\"Are you sure you want to delete this price alert?\")) {\n      deleteAlertMutation.mutate(id);\n    }\n  };\n\n  if (isAuthLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" data-testid=\"loader-auth\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <div className=\"sticky top-0 z-10 bg-background border-b\">\n        <div className=\"flex items-center justify-between p-4\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/dashboard\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <div>\n              <h1 className=\"text-xl font-semibold\" data-testid=\"text-page-title\">Price Alerts</h1>\n              <p className=\"text-sm text-muted-foreground\">Get notified when prices hit your targets</p>\n            </div>\n          </div>\n          <Button\n            onClick={() => setIsCreateDialogOpen(true)}\n            data-testid=\"button-create-alert\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Alert\n          </Button>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"p-4 space-y-4\">\n        {isLoadingAlerts ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" data-testid=\"loader-alerts\" />\n          </div>\n        ) : alerts.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n              <Bell className=\"h-12 w-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">No price alerts yet</h3>\n              <p className=\"text-sm text-muted-foreground text-center mb-4\">\n                Create your first alert to get notified when crypto prices reach your targets\n              </p>\n              <Button onClick={() => setIsCreateDialogOpen(true)} data-testid=\"button-create-first-alert\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Alert\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-3\">\n            {alerts.map((alert) => (\n              <Card key={alert._id} data-testid={`card-alert-${alert._id}`}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between gap-4\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        {alert.condition === \"above\" ? (\n                          <TrendingUp className=\"h-5 w-5 text-green-500\" />\n                        ) : (\n                          <TrendingDown className=\"h-5 w-5 text-red-500\" />\n                        )}\n                        <h3 className=\"font-semibold\" data-testid={`text-alert-token-${alert._id}`}>\n                          {alert.tokenName} ({alert.tokenSymbol})\n                        </h3>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mb-2\" data-testid={`text-alert-condition-${alert._id}`}>\n                        Notify when price goes {alert.condition} ${alert.targetPrice.toLocaleString()}\n                      </p>\n                      {alert.lastNotifiedAt && (\n                        <p className=\"text-xs text-muted-foreground\">\n                          Last notified: {new Date(alert.lastNotifiedAt).toLocaleDateString()}\n                        </p>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <Switch\n                          checked={alert.isActive}\n                          onCheckedChange={() => handleToggleAlert(alert)}\n                          disabled={toggleAlertMutation.isPending}\n                          data-testid={`switch-alert-active-${alert._id}`}\n                        />\n                        {alert.isActive ? (\n                          <Bell className=\"h-4 w-4 text-primary\" />\n                        ) : (\n                          <BellOff className=\"h-4 w-4 text-muted-foreground\" />\n                        )}\n                      </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleDeleteAlert(alert._id)}\n                        disabled={deleteAlertMutation.isPending}\n                        data-testid={`button-delete-alert-${alert._id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Create Alert Dialog */}\n      <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Create Price Alert</DialogTitle>\n            <DialogDescription>\n              Get notified when a cryptocurrency reaches your target price\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"token-symbol\">Token Symbol</Label>\n              <Input\n                id=\"token-symbol\"\n                placeholder=\"BTC\"\n                value={tokenSymbol}\n                onChange={(e) => setTokenSymbol(e.target.value.toUpperCase())}\n                data-testid=\"input-token-symbol\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"token-name\">Token Name</Label>\n              <Input\n                id=\"token-name\"\n                placeholder=\"Bitcoin\"\n                value={tokenName}\n                onChange={(e) => setTokenName(e.target.value)}\n                data-testid=\"input-token-name\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"condition\">Condition</Label>\n              <Select value={condition} onValueChange={(v) => setCondition(v as \"above\" | \"below\")}>\n                <SelectTrigger data-testid=\"select-condition\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"above\">Price goes above</SelectItem>\n                  <SelectItem value=\"below\">Price goes below</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"target-price\">Target Price (USD)</Label>\n              <Input\n                id=\"target-price\"\n                type=\"number\"\n                step=\"0.01\"\n                placeholder=\"50000\"\n                value={targetPrice}\n                onChange={(e) => setTargetPrice(e.target.value)}\n                data-testid=\"input-target-price\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsCreateDialogOpen(false);\n                resetForm();\n              }}\n              data-testid=\"button-cancel-alert\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleCreateAlert}\n              disabled={createAlertMutation.isPending}\n              data-testid=\"button-submit-alert\"\n            >\n              {createAlertMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n              Create Alert\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":13059},"client/src/lib/cache-manager.ts":{"content":"const APP_VERSION = '2.2.0'; // Incremented to force cache clear for all users\nconst VERSION_KEY = 'app-version';\n\ninterface CacheStatus {\n  needsClear: boolean;\n  reason?: string;\n}\n\nclass CacheManager {\n  private isStorageDisabled(): boolean {\n    try {\n      const testKey = '__storage_availability_test__';\n      localStorage.setItem(testKey, '1');\n      localStorage.removeItem(testKey);\n      return false;\n    } catch {\n      return true;\n    }\n  }\n\n  checkVersion(): CacheStatus {\n    if (this.isStorageDisabled()) {\n      console.warn('localStorage is disabled or unavailable');\n      return { needsClear: false };\n    }\n\n    try {\n      const storedVersion = localStorage.getItem(VERSION_KEY);\n      \n      if (!storedVersion) {\n        try {\n          localStorage.setItem(VERSION_KEY, APP_VERSION);\n        } catch (error) {\n          console.warn('Failed to set version key:', error);\n        }\n        return { needsClear: false };\n      }\n\n      if (storedVersion !== APP_VERSION) {\n        return { \n          needsClear: true, \n          reason: `App updated from ${storedVersion} to ${APP_VERSION}` \n        };\n      }\n\n      return { needsClear: false };\n    } catch (error) {\n      console.error('Error checking version:', error);\n      return { needsClear: false };\n    }\n  }\n\n  clearAllCache(): void {\n    try {\n      // Preserve critical keys that must survive cache clears\n      const GLOBAL_RECOVERY_KEY = 'global-auto-recovery-attempts';\n      const GLOBAL_RECOVERY_TIMESTAMP_KEY = 'global-auto-recovery-timestamp';\n      \n      const keysToPreserve = [VERSION_KEY, GLOBAL_RECOVERY_KEY, GLOBAL_RECOVERY_TIMESTAMP_KEY];\n      const preservedData: Record<string, string> = {};\n\n      keysToPreserve.forEach(key => {\n        const value = localStorage.getItem(key);\n        if (value) {\n          preservedData[key] = value;\n        }\n      });\n\n      localStorage.clear();\n      sessionStorage.clear();\n      \n      // Restore preserved keys\n      Object.entries(preservedData).forEach(([key, value]) => {\n        localStorage.setItem(key, value);\n      });\n      \n      // Aggressively clear all cache APIs including service workers\n      if ('caches' in window) {\n        caches.keys().then(names => {\n          names.forEach(name => {\n            caches.delete(name);\n          });\n        });\n      }\n      \n      // Unregister all service workers to prevent stale cache\n      if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.getRegistrations().then(registrations => {\n          registrations.forEach(registration => {\n            registration.unregister();\n          });\n        });\n      }\n      \n      console.log('All cache cleared aggressively (recovery counters preserved, service workers unregistered)');\n    } catch (error) {\n      console.error('Error clearing cache:', error);\n    }\n  }\n\n  /**\n   * Performs a hard reload that bypasses ALL caches including Vite's build cache.\n   * This appends a timestamp to the URL to force the browser to fetch fresh assets.\n   */\n  hardReload(): void {\n    try {\n      // CRITICAL: Update version key to current version BEFORE clearing cache\n      // This prevents infinite reload loops when version bumps trigger cache clears\n      try {\n        localStorage.setItem(VERSION_KEY, APP_VERSION);\n      } catch (versionError) {\n        console.warn('Failed to update version key:', versionError);\n      }\n      \n      // Clear all caches (version key already updated above)\n      this.clearAllCache();\n      \n      // Force a cache-busting reload by appending timestamp\n      // This ensures even Vite's compiled module cache is bypassed\n      const url = new URL(window.location.href);\n      url.searchParams.set('_cache_bust', Date.now().toString());\n      \n      // Use location.replace to bypass browser cache completely\n      window.location.replace(url.toString());\n    } catch (error) {\n      console.error('Hard reload failed, falling back to standard reload:', error);\n      window.location.reload();\n    }\n  }\n\n  clearStorageOnly(): void {\n    try {\n      const keysToPreserve = [VERSION_KEY];\n      const preservedData: Record<string, string> = {};\n\n      keysToPreserve.forEach(key => {\n        const value = localStorage.getItem(key);\n        if (value) {\n          preservedData[key] = value;\n        }\n      });\n\n      localStorage.clear();\n      sessionStorage.clear();\n\n      Object.entries(preservedData).forEach(([key, value]) => {\n        localStorage.setItem(key, value);\n      });\n\n      console.log('Storage cleared (version preserved)');\n    } catch (error) {\n      console.error('Error clearing storage:', error);\n    }\n  }\n\n  validateStorage(): boolean {\n    if (this.isStorageDisabled()) {\n      console.warn('localStorage is disabled');\n      return false;\n    }\n\n    try {\n      const testKey = '__storage_test__';\n      localStorage.setItem(testKey, '1');\n      const value = localStorage.getItem(testKey);\n      localStorage.removeItem(testKey);\n      return value === '1';\n    } catch (error) {\n      console.error('Storage validation failed:', error);\n      return false;\n    }\n  }\n\n  detectCorruption(): boolean {\n    if (this.isStorageDisabled()) {\n      return false;\n    }\n\n    try {\n      const lumirraKeys = Object.keys(localStorage).filter(key => \n        key.startsWith('lumirra-')\n      );\n\n      for (const key of lumirraKeys) {\n        const value = localStorage.getItem(key);\n        if (value === null || value === undefined) {\n          console.warn(`Corrupted key detected: ${key}`);\n          return true;\n        }\n\n        if (key.includes('JSON') || key.includes('wallet') || key.includes('user')) {\n          try {\n            JSON.parse(value);\n          } catch {\n            console.warn(`Invalid JSON in key: ${key}`);\n            return true;\n          }\n        }\n      }\n\n      return false;\n    } catch (error) {\n      console.error('Corruption detection failed:', error);\n      return false;\n    }\n  }\n\n  autoCheck(): void {\n    if (this.isStorageDisabled()) {\n      console.warn('localStorage is disabled or unavailable. App will run with limited functionality.');\n      return;\n    }\n\n    // Prevent reload loops: if we've just done a hard reload (URL has _cache_bust param), skip auto-check\n    const urlParams = new URLSearchParams(window.location.search);\n    if (urlParams.has('_cache_bust')) {\n      console.log('Skipping auto-check after hard reload to prevent infinite loop');\n      // Clean URL without reloading\n      window.history.replaceState({}, '', window.location.pathname);\n      return;\n    }\n\n    const versionStatus = this.checkVersion();\n    \n    if (versionStatus.needsClear) {\n      console.log(`Cache clear needed: ${versionStatus.reason}`);\n      try {\n        this.hardReload();\n      } catch (error) {\n        console.error('Failed to clear cache and reload:', error);\n      }\n      return;\n    }\n\n    if (!this.validateStorage()) {\n      console.warn('Storage validation failed but storage is available. Skipping automatic clear to prevent reload loop.');\n      return;\n    }\n\n    if (this.detectCorruption()) {\n      console.warn('Storage corruption detected, attempting to clear');\n      try {\n        this.clearStorageOnly();\n        this.hardReload();\n      } catch (error) {\n        console.error('Failed to clear corrupted storage:', error);\n      }\n      return;\n    }\n  }\n\n  getRecoveryInfo(): string {\n    const info = [];\n    info.push(`App Version: ${APP_VERSION}`);\n    \n    if (this.isStorageDisabled()) {\n      info.push('LocalStorage: Disabled or Unavailable');\n      info.push('Storage Valid: N/A');\n      info.push('Corruption Detected: N/A');\n      return info.join('\\n');\n    }\n    \n    info.push(`Storage Valid: ${this.validateStorage()}`);\n    info.push(`Corruption Detected: ${this.detectCorruption()}`);\n    \n    try {\n      info.push(`LocalStorage Keys: ${Object.keys(localStorage).length}`);\n    } catch {\n      info.push('LocalStorage: Unavailable');\n    }\n\n    return info.join('\\n');\n  }\n}\n\nexport const cacheManager = new CacheManager();\n","size_bytes":8051},"client/src/pages/support-chat.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { ArrowLeft, Send, Image as ImageIcon, X, MessageSquare, Clock } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { DefaultAvatar } from \"@/components/default-avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface SupportMessage {\n  senderId: string;\n  senderType: \"user\" | \"admin\";\n  senderName: string;\n  content: string;\n  imageUrl?: string | null;\n  timestamp: string;\n}\n\ninterface SupportChat {\n  _id: string;\n  userId: string;\n  userName: string;\n  userEmail: string;\n  status: \"active\" | \"closed\";\n  messages: SupportMessage[];\n  unreadUserCount: number;\n  unreadAdminCount: number;\n  lastMessageAt: string;\n}\n\nexport default function SupportChat() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading: isAuthLoading } = useWallet();\n\n  const [message, setMessage] = useState(\"\");\n  const [selectedImage, setSelectedImage] = useState<File | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  const [optimisticMessages, setOptimisticMessages] = useState<SupportMessage[]>([]);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const wsRef = useRef<WebSocket | null>(null);\n  const notificationsMarkedRef = useRef(false);\n\n  useEffect(() => {\n    if (!isAuthLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthLoading, isAuthenticated, setLocation]);\n\n  const { data: chat, isLoading } = useQuery<SupportChat>({\n    queryKey: [\"/api/support-chat\"],\n    refetchInterval: 5000, // Poll every 5 seconds for faster updates (WebSocket provides real-time updates as primary method)\n    refetchOnMount: true, // Always fetch fresh data when component mounts\n    refetchOnWindowFocus: true, // Refetch when user returns to tab\n  });\n\n  // Mark all support chat notifications as read when user views the chat\n  const markSupportChatNotificationsReadMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(\"/api/notifications/mark-support-chat-read\", {\n        method: \"PATCH\",\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to mark notifications as read\");\n      }\n\n      return response.json();\n    },\n    retry: 2, // Retry up to 2 times on failure\n    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 5000), // Exponential backoff: 1s, 2s, max 5s\n    onSuccess: () => {\n      // Mark as successful only after mutation completes\n      notificationsMarkedRef.current = true;\n      // Invalidate notification queries to update the UI\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n    onError: (error) => {\n      // Log error after all retries exhausted\n      console.error(\"Failed to mark support chat notifications as read after retries:\", error);\n      // Optionally show a toast to inform user\n      toast({\n        title: \"Unable to mark notifications as read\",\n        description: \"Please refresh the page if notifications still appear unread\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Mark notifications as read when user opens the chat (once per page visit)\n  useEffect(() => {\n    if (isAuthenticated && !isLoading && chat && !notificationsMarkedRef.current) {\n      notificationsMarkedRef.current = true;\n      markSupportChatNotificationsReadMutation.mutate();\n    }\n  }, [isAuthenticated, isLoading, chat?._id]);\n\n  // WebSocket connection for real-time chat updates with auto-reconnect\n  useEffect(() => {\n    if (!isAuthenticated) return;\n\n    let reconnectAttempts = 0;\n    const maxReconnectDelay = 30000; // Max 30 seconds\n    let reconnectTimeout: NodeJS.Timeout;\n    let isIntentionalClose = false;\n\n    const connect = () => {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const wsUrl = `${protocol}//${window.location.host}/ws`;\n      \n      console.log('Connecting to WebSocket:', wsUrl);\n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log('WebSocket connected for support chat');\n        reconnectAttempts = 0; // Reset on successful connection\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          console.log('WebSocket message received:', data);\n          \n          if (data.type === 'support_chat_message' || data.type === 'support_chat_message_edited') {\n            // Refresh chat data to get the new or edited message\n            queryClient.invalidateQueries({ queryKey: [\"/api/support-chat\"] });\n          }\n        } catch (error) {\n          console.error('WebSocket message parse error:', error);\n        }\n      };\n\n      ws.onerror = (error) => {\n        console.error('WebSocket error:', error);\n      };\n\n      ws.onclose = () => {\n        console.log('WebSocket disconnected');\n        wsRef.current = null;\n        \n        // Only reconnect if not intentionally closed and still authenticated\n        if (!isIntentionalClose && isAuthenticated) {\n          const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), maxReconnectDelay);\n          reconnectAttempts++;\n          console.log(`Reconnecting in ${delay}ms (attempt ${reconnectAttempts})`);\n          reconnectTimeout = setTimeout(connect, delay);\n        }\n      };\n    };\n\n    connect();\n\n    return () => {\n      isIntentionalClose = true;\n      clearTimeout(reconnectTimeout);\n      if (wsRef.current && (wsRef.current.readyState === WebSocket.OPEN || wsRef.current.readyState === WebSocket.CONNECTING)) {\n        wsRef.current.close();\n      }\n    };\n  }, [isAuthenticated]);\n\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  }, [chat?.messages, optimisticMessages]);\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({ optimisticId, content, image }: { optimisticId: string; content: string; image: File | null }) => {\n      const formData = new FormData();\n      formData.append(\"content\", content);\n      if (image) {\n        formData.append(\"image\", image);\n      }\n\n      const response = await fetch(\"/api/support-chat/messages\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to send message\");\n      }\n\n      return response.json();\n    },\n    onMutate: async ({ optimisticId, content, image }) => {\n      // Add optimistic message immediately\n      const optimisticMessage: SupportMessage = {\n        senderId: \"temp\",\n        senderType: \"user\",\n        senderName: \"You\",\n        content,\n        imageUrl: image ? URL.createObjectURL(image) : null,\n        timestamp: new Date().toISOString(),\n      };\n      setOptimisticMessages(prev => [...prev, { ...optimisticMessage, optimisticId } as any]);\n      \n      return { optimisticId };\n    },\n    onSuccess: (data, variables, context) => {\n      // Remove only the specific optimistic message that got confirmed\n      setOptimisticMessages(prev => prev.filter((msg: any) => msg.optimisticId !== context?.optimisticId));\n      queryClient.invalidateQueries({ queryKey: [\"/api/support-chat\"] });\n    },\n    onError: (error: Error, variables, context) => {\n      // Remove the failed optimistic message\n      setOptimisticMessages(prev => prev.filter((msg: any) => msg.optimisticId !== context?.optimisticId));\n      toast({\n        title: \"Failed to send message\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.size > 5 * 1024 * 1024) {\n        toast({\n          title: \"File Too Large\",\n          description: \"Image must be less than 5MB\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      if (!file.type.startsWith(\"image/\")) {\n        toast({\n          title: \"Invalid File Type\",\n          description: \"Please select an image file\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      setSelectedImage(file);\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setImagePreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleSendMessage = () => {\n    if ((!message.trim() && !selectedImage) || sendMessageMutation.isPending) {\n      return;\n    }\n    const optimisticId = `temp-${Date.now()}`;\n    const content = message;\n    const image = selectedImage;\n    \n    // Clear inputs immediately\n    setMessage(\"\");\n    setSelectedImage(null);\n    setImagePreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n    \n    sendMessageMutation.mutate({ optimisticId, content, image });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const formatMessageTime = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n\n    if (diffInHours < 24) {\n      return date.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n    } else if (diffInHours < 48) {\n      return `Yesterday, ${date.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" })}`;\n    } else {\n      return date.toLocaleDateString([], { month: \"short\", day: \"numeric\", hour: \"2-digit\", minute: \"2-digit\" });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"h-12 w-12 animate-spin rounded-full border-4 border-primary border-t-transparent mx-auto mb-4\" />\n          <p className=\"text-sm text-muted-foreground\">Loading chat...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-[100dvh] bg-background\">\n      {/* Header */}\n      <div className=\"border-b border-border bg-card sticky top-0 z-10\">\n        <div className=\"container max-w-3xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between py-4\">\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-9 w-9 hover-elevate\"\n                onClick={() => setLocation(\"/dashboard\")}\n                data-testid=\"button-back\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              <div>\n                <h1 className=\"text-lg font-semibold flex items-center gap-2\">\n                  <MessageSquare className=\"h-5 w-5 text-primary\" />\n                  Support Chat\n                </h1>\n                <p className=\"text-xs text-muted-foreground\">Our team typically responds within 24 hours</p>\n              </div>\n            </div>\n            {chat && chat.status === \"active\" && (\n              <Badge variant=\"outline\" className=\"gap-1\">\n                <span className=\"h-2 w-2 rounded-full bg-green-500 animate-pulse\" />\n                Active\n              </Badge>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto bg-muted/30\">\n        <div className=\"container max-w-3xl mx-auto px-4 py-6\">\n          {!chat || chat.messages.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-full text-center py-20\">\n              <div className=\"h-20 w-20 rounded-full bg-primary/10 flex items-center justify-center mb-6\">\n                <MessageSquare className=\"h-10 w-10 text-primary\" />\n              </div>\n              <h2 className=\"text-2xl font-semibold mb-3\">Welcome to Support</h2>\n              <p className=\"text-muted-foreground max-w-md mb-2\">\n                Our dedicated support team is here to help you with any questions or concerns.\n              </p>\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Clock className=\"h-4 w-4\" />\n                <span>We typically respond within 24 hours</span>\n              </div>\n              <Card className=\"mt-8 max-w-md\">\n                <CardContent className=\"py-4\">\n                  <h3 className=\"font-semibold mb-2 text-sm\">How can we help you today?</h3>\n                  <ul className=\"text-sm text-muted-foreground space-y-1.5\">\n                    <li> Account and wallet questions</li>\n                    <li> Transaction support</li>\n                    <li> Technical issues</li>\n                    <li> General inquiries</li>\n                  </ul>\n                </CardContent>\n              </Card>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {(() => {\n                // Merge and sort messages chronologically with stable tie-breaker\n                const allMessages = [...chat.messages, ...optimisticMessages].sort((a: any, b: any) => {\n                  const timeA = new Date(a.timestamp).getTime();\n                  const timeB = new Date(b.timestamp).getTime();\n                  \n                  // Primary sort by timestamp\n                  if (timeA !== timeB) {\n                    return timeA - timeB;\n                  }\n                  \n                  // Tie-breaker: confirmed messages (no optimisticId) come before optimistic ones\n                  const aIsOptimistic = !!a.optimisticId;\n                  const bIsOptimistic = !!b.optimisticId;\n                  \n                  if (aIsOptimistic && !bIsOptimistic) return 1;  // b comes first\n                  if (!aIsOptimistic && bIsOptimistic) return -1; // a comes first\n                  return 0;\n                });\n                \n                return allMessages.map((msg: any, index) => {\n                  const isUser = msg.senderType === \"user\";\n                  const showDate = index === 0 || \n                    new Date(allMessages[index - 1].timestamp).toDateString() !== new Date(msg.timestamp).toDateString();\n                  \n                  // Use stable unique key\n                  const messageKey = msg.optimisticId || `msg-${msg.senderId}-${msg.timestamp}`;\n                  \n                  return (\n                    <div key={messageKey}>\n                    {showDate && (\n                      <div className=\"flex items-center justify-center my-6\">\n                        <div className=\"bg-muted px-3 py-1 rounded-full\">\n                          <span className=\"text-xs font-medium text-muted-foreground\">\n                            {new Date(msg.timestamp).toLocaleDateString([], { \n                              weekday: \"short\", \n                              month: \"short\", \n                              day: \"numeric\",\n                              year: new Date(msg.timestamp).getFullYear() !== new Date().getFullYear() ? \"numeric\" : undefined\n                            })}\n                          </span>\n                        </div>\n                      </div>\n                    )}\n                    <div className={`flex ${isUser ? \"justify-end\" : \"justify-start\"}`}>\n                      <div className={`flex gap-3 max-w-[85%] ${isUser ? \"flex-row-reverse\" : \"flex-row\"}`}>\n                        {!isUser && (\n                          <DefaultAvatar\n                            profilePhoto={null}\n                            firstName=\"Support\"\n                            lastName=\"Team\"\n                            size=\"md\"\n                            className=\"flex-shrink-0 border-2 border-primary/20\"\n                          />\n                        )}\n                        <div className={`flex flex-col ${isUser ? \"items-end\" : \"items-start\"}`}>\n                          {!isUser && (\n                            <span className=\"text-xs font-semibold text-muted-foreground mb-1 px-1\">\n                              Support Team\n                            </span>\n                          )}\n                          <div\n                            className={`rounded-2xl px-4 py-3 shadow-sm ${\n                              isUser\n                                ? \"bg-primary text-primary-foreground\"\n                                : \"bg-card border border-border\"\n                            }`}\n                          >\n                            {msg.imageUrl && (\n                              <img\n                                src={msg.imageUrl}\n                                alt=\"Uploaded\"\n                                className=\"max-w-full rounded-lg mb-3 cursor-pointer hover:opacity-90 transition-opacity\"\n                                style={{ maxHeight: \"300px\" }}\n                                onClick={() => window.open(msg.imageUrl!, \"_blank\")}\n                              />\n                            )}\n                            <p className=\"text-sm break-words whitespace-pre-wrap\">{msg.content}</p>\n                          </div>\n                          <div className=\"flex items-center gap-1.5 mt-1.5 px-1\">\n                            <span className=\"text-xs text-muted-foreground\">\n                              {formatMessageTime(msg.timestamp)}\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  );\n                });\n              })()}\n              <div ref={messagesEndRef} />\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Input Area */}\n      <div className=\"border-t border-border bg-card\">\n        <div className=\"container max-w-3xl mx-auto px-4 py-4\">\n          {imagePreview && (\n            <div className=\"mb-3 relative inline-block\">\n              <img\n                src={imagePreview}\n                alt=\"Preview\"\n                className=\"h-24 w-24 rounded-lg object-cover border-2 border-border\"\n              />\n              <button\n                onClick={() => {\n                  setSelectedImage(null);\n                  setImagePreview(null);\n                  if (fileInputRef.current) {\n                    fileInputRef.current.value = \"\";\n                  }\n                }}\n                className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-destructive text-destructive-foreground flex items-center justify-center shadow-md hover-elevate active-elevate-2\"\n                data-testid=\"button-remove-image\"\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            </div>\n          )}\n          <div className=\"flex gap-2 items-end\">\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleImageSelect}\n              className=\"hidden\"\n            />\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              className=\"h-10 w-10 flex-shrink-0\"\n              onClick={() => fileInputRef.current?.click()}\n              disabled={sendMessageMutation.isPending}\n              data-testid=\"button-image\"\n            >\n              <ImageIcon className=\"h-5 w-5\" />\n            </Button>\n            <Input\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder=\"Type your message...\"\n              className=\"flex-1 h-10\"\n              disabled={sendMessageMutation.isPending}\n              data-testid=\"input-message\"\n            />\n            <Button\n              onClick={handleSendMessage}\n              disabled={(!message.trim() && !selectedImage) || sendMessageMutation.isPending}\n              className=\"h-10 px-4\"\n              data-testid=\"button-send\"\n            >\n              {sendMessageMutation.isPending ? (\n                <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent\" />\n              ) : (\n                <>\n                  <Send className=\"h-4 w-4 mr-2\" />\n                  Send\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":21081},"client/src/pages/connected-dapps.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { useWallet } from \"@/contexts/wallet-context\";\n\nexport default function ConnectedDapps() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated, isLoading: isAuthLoading } = useWallet();\n  const [activeTab, setActiveTab] = useState<\"web\" | \"mobile\">(\"web\");\n\n  useEffect(() => {\n    if (!isAuthLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthLoading, isAuthenticated, setLocation]);\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <div className=\"border-b border-border\">\n        <div className=\"container max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between py-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 hover-elevate\"\n              onClick={() => setLocation(\"/profile\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold\">Connected dapps</h1>\n            <div className=\"w-8\" />\n          </div>\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"border-b border-border\">\n        <div className=\"container max-w-2xl mx-auto px-4\">\n          <div className=\"flex gap-8\">\n            <button\n              onClick={() => setActiveTab(\"web\")}\n              className={`pb-3 px-1 border-b-2 transition-colors ${\n                activeTab === \"web\"\n                  ? \"border-primary text-foreground\"\n                  : \"border-transparent text-muted-foreground\"\n              }`}\n              data-testid=\"tab-web\"\n            >\n              Web\n            </button>\n            <button\n              onClick={() => setActiveTab(\"mobile\")}\n              className={`pb-3 px-1 border-b-2 transition-colors ${\n                activeTab === \"mobile\"\n                  ? \"border-primary text-foreground\"\n                  : \"border-transparent text-muted-foreground\"\n              }`}\n              data-testid=\"tab-mobile\"\n            >\n              Mobile\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Empty State */}\n      <div className=\"container max-w-2xl mx-auto px-4 py-16\">\n        <div className=\"flex flex-col items-center justify-center text-center\">\n          {/* Icon Placeholder */}\n          <div className=\"mb-6 relative\">\n            <div className=\"grid grid-cols-2 gap-4 mb-4\">\n              <div className=\"h-16 w-16 rounded-lg bg-blue-500/10 flex items-center justify-center\">\n                <div className=\"h-8 w-8 rounded-full bg-blue-500/20\" />\n              </div>\n              <div className=\"h-16 w-16 rounded-lg bg-yellow-500/10 flex items-center justify-center\">\n                <div className=\"h-8 w-8 rounded-full bg-yellow-500/20\" />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"h-16 w-16 rounded-lg bg-purple-500/10 flex items-center justify-center\">\n                <div className=\"h-8 w-8 rounded-full bg-purple-500/20\" />\n              </div>\n              <div className=\"h-16 w-16 rounded-lg bg-green-500/10 flex items-center justify-center\">\n                <div className=\"h-8 w-8 rounded-full bg-green-500/20\" />\n              </div>\n            </div>\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <div className=\"h-12 w-12 rounded-full bg-background border-4 border-border flex items-center justify-center\">\n                <div className=\"h-6 w-6 rounded-full bg-muted\" />\n              </div>\n            </div>\n          </div>\n\n          <h2 className=\"text-xl font-semibold mb-2\" data-testid=\"text-empty-title\">\n            No dapp connections yet\n          </h2>\n          <p className=\"text-muted-foreground max-w-sm\" data-testid=\"text-empty-description\">\n            The dapps you're connected to will appear here after you start using your wallet.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4234},"client/src/pages/view-profile-details.tsx":{"content":"import { useEffect } from \"react\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { useWallet } from \"@/contexts/wallet-context\";\n\ninterface UserProfile {\n  _id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  profilePhoto?: string | null;\n  bio?: string | null;\n  createdAt: string;\n  walletCreatedAt?: string;\n}\n\nexport default function ViewProfileDetails() {\n  const [, setLocation] = useLocation();\n  const { isAuthenticated, isLoading: isAuthLoading } = useWallet();\n\n  useEffect(() => {\n    if (!isAuthLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthLoading, isAuthenticated, setLocation]);\n\n  const { data: profile, isLoading } = useQuery<UserProfile>({\n    queryKey: [\"/api/user/profile\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (!profile) {\n    return null;\n  }\n\n  const displayName = `${profile.firstName}${profile.lastName}`;\n  const initials = `${profile.firstName[0]}${profile.lastName[0]}`.toUpperCase();\n  const walletDate = profile.walletCreatedAt \n    ? new Date(profile.walletCreatedAt).toLocaleDateString('en-US', { \n        year: 'numeric', \n        month: 'long', \n        day: 'numeric' \n      })\n    : \"Not created yet\";\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <div className=\"border-b border-border\">\n        <div className=\"container max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between py-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 hover-elevate\"\n              onClick={() => setLocation(\"/profile\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold\">View Profile</h1>\n            <div className=\"w-8\" />\n          </div>\n        </div>\n      </div>\n\n      {/* Profile Content */}\n      <div className=\"container max-w-2xl mx-auto px-4 py-8\">\n        {/* Profile Header */}\n        <div className=\"flex flex-col items-center mb-8\">\n          <Avatar className=\"h-24 w-24 mb-4\">\n            <AvatarImage src={profile.profilePhoto || undefined} alt={displayName} />\n            <AvatarFallback className=\"bg-primary/10 text-primary text-2xl\">\n              {initials}\n            </AvatarFallback>\n          </Avatar>\n          <h2 className=\"text-2xl font-semibold mb-1\" data-testid=\"text-display-name\">\n            {displayName}\n          </h2>\n          <p className=\"text-sm text-muted-foreground\" data-testid=\"text-email\">\n            {profile.email}\n          </p>\n        </div>\n\n        {/* Bio Section */}\n        {profile.bio && (\n          <Card className=\"mb-6\">\n            <CardContent className=\"pt-6\">\n              <h3 className=\"text-sm font-medium text-muted-foreground mb-2\">Bio</h3>\n              <p className=\"text-base\" data-testid=\"text-bio\">\n                {profile.bio}\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Account Info */}\n        <Card>\n          <CardContent className=\"pt-6 space-y-4\">\n            <div>\n              <h3 className=\"text-sm font-medium text-muted-foreground mb-1\">Email</h3>\n              <p className=\"text-base\" data-testid=\"text-profile-email\">\n                {profile.email}\n              </p>\n            </div>\n            <div className=\"border-t pt-4\">\n              <h3 className=\"text-sm font-medium text-muted-foreground mb-1\">\n                Wallet Created\n              </h3>\n              <p className=\"text-base\" data-testid=\"text-wallet-date\">\n                {walletDate}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4245},"client/src/pages/edit-profile.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { ArrowLeft, Camera, X } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { DefaultAvatar } from \"@/components/default-avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useWallet } from \"@/contexts/wallet-context\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface UserProfile {\n  _id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  profilePhoto?: string | null;\n  bio?: string | null;\n  website?: string | null;\n  twitterUsername?: string | null;\n  redditUsername?: string | null;\n  githubUsername?: string | null;\n}\n\nexport default function EditProfile() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { isAuthenticated, isLoading: isAuthLoading } = useWallet();\n\n  const [bio, setBio] = useState(\"\");\n  const [website, setWebsite] = useState(\"\");\n  const [twitterUsername, setTwitterUsername] = useState(\"\");\n  const [redditUsername, setRedditUsername] = useState(\"\");\n  const [githubUsername, setGithubUsername] = useState(\"\");\n  const [selectedImage, setSelectedImage] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (!isAuthLoading && !isAuthenticated) {\n      setLocation(\"/\");\n    }\n  }, [isAuthLoading, isAuthenticated, setLocation]);\n\n  const { data: profile, isLoading } = useQuery<UserProfile>({\n    queryKey: [\"/api/user/profile\"],\n  });\n\n  useEffect(() => {\n    if (profile) {\n      setBio(profile.bio || \"\");\n      setWebsite(profile.website || \"\");\n      setTwitterUsername(profile.twitterUsername || \"\");\n      setRedditUsername(profile.redditUsername || \"\");\n      setGithubUsername(profile.githubUsername || \"\");\n    }\n  }, [profile]);\n\n  // Handle image selection\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: \"Invalid file\",\n        description: \"Please select an image file\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Validate file size (5MB max)\n    if (file.size > 5 * 1024 * 1024) {\n      toast({\n        title: \"File too large\",\n        description: \"Please select an image smaller than 5MB\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSelectedImage(file);\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreviewUrl(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  // Remove selected image\n  const handleRemoveImage = () => {\n    setSelectedImage(null);\n    setPreviewUrl(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async () => {\n      const formData = new FormData();\n      formData.append(\"bio\", bio);\n      formData.append(\"website\", website);\n      formData.append(\"twitterUsername\", twitterUsername);\n      formData.append(\"redditUsername\", redditUsername);\n      formData.append(\"githubUsername\", githubUsername);\n      \n      if (selectedImage) {\n        formData.append(\"profilePhoto\", selectedImage);\n      }\n\n      const response = await fetch(\"/api/user/profile\", {\n        method: \"PUT\",\n        credentials: \"include\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Failed to update profile\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/profile\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Success\",\n        description: \"Profile updated successfully\",\n      });\n      setLocation(\"/profile\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent\" />\n      </div>\n    );\n  }\n\n  if (!profile) {\n    return null;\n  }\n\n  const displayName = `${profile.firstName}${profile.lastName}`;\n  const initials = `${profile.firstName[0]}${profile.lastName[0]}`.toUpperCase();\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <div className=\"border-b border-border\">\n        <div className=\"container max-w-2xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between py-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 hover-elevate\"\n              onClick={() => setLocation(\"/profile\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Profile Header */}\n      <div className=\"container max-w-2xl mx-auto px-4 py-8\">\n        <div className=\"flex items-center gap-4 mb-8\">\n          <div className=\"relative group\">\n            <Avatar className=\"h-20 w-20\">\n              <AvatarImage \n                src={previewUrl || profile.profilePhoto || undefined} \n                alt={displayName} \n                data-testid=\"avatar-preview\"\n              />\n              <AvatarFallback className=\"bg-primary/10 text-primary text-lg\">\n                {initials}\n              </AvatarFallback>\n            </Avatar>\n            \n            {/* Change/Remove Photo Buttons */}\n            <div className=\"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded-full\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-8 w-8 text-white hover:bg-white/20\"\n                onClick={() => fileInputRef.current?.click()}\n                data-testid=\"button-change-photo\"\n              >\n                <Camera className=\"h-4 w-4\" />\n              </Button>\n              {(previewUrl || profile.profilePhoto) && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"h-8 w-8 text-white hover:bg-white/20\"\n                  onClick={handleRemoveImage}\n                  data-testid=\"button-remove-photo\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n            \n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              className=\"hidden\"\n              onChange={handleImageSelect}\n              data-testid=\"input-photo\"\n            />\n          </div>\n          \n          <div className=\"flex-1\">\n            <h2 className=\"text-xl font-semibold\">{displayName}</h2>\n            <p className=\"text-sm text-muted-foreground\">{profile.email}</p>\n            <button\n              className=\"text-sm text-primary hover:underline cursor-pointer\"\n              onClick={() => fileInputRef.current?.click()}\n              data-testid=\"button-change-profile-photo\"\n            >\n              Change profile photo\n            </button>\n          </div>\n        </div>\n\n        {/* Form */}\n        <div className=\"space-y-6\">\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">Bio</label>\n            <Textarea\n              placeholder=\"Describe yourself\"\n              value={bio}\n              onChange={(e) => setBio(e.target.value)}\n              className=\"min-h-[100px]\"\n              data-testid=\"input-bio\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">Your website</label>\n            <Input\n              type=\"url\"\n              placeholder=\"Add your website address\"\n              value={website}\n              onChange={(e) => setWebsite(e.target.value)}\n              data-testid=\"input-website\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">Twitter username</label>\n            <Input\n              type=\"text\"\n              placeholder=\"Twitter username\"\n              value={twitterUsername}\n              onChange={(e) => setTwitterUsername(e.target.value)}\n              data-testid=\"input-twitter\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">Reddit username</label>\n            <Input\n              type=\"text\"\n              placeholder=\"Reddit username\"\n              value={redditUsername}\n              onChange={(e) => setRedditUsername(e.target.value)}\n              data-testid=\"input-reddit\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium mb-2\">GitHub username</label>\n            <Input\n              type=\"text\"\n              placeholder=\"GitHub username\"\n              value={githubUsername}\n              onChange={(e) => setGithubUsername(e.target.value)}\n              data-testid=\"input-github\"\n            />\n          </div>\n\n          <Button\n            className=\"w-full\"\n            onClick={() => updateProfileMutation.mutate()}\n            disabled={updateProfileMutation.isPending}\n            data-testid=\"button-save\"\n          >\n            {updateProfileMutation.isPending ? \"Saving...\" : \"Save\"}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":10113},"client/src/components/chat-bubble.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { FaFacebookMessenger } from \"react-icons/fa\";\n\ninterface SupportChatUnreadCount {\n  unreadCount: number;\n}\n\nexport function ChatBubble() {\n  const [, setLocation] = useLocation();\n  const [isDragging, setIsDragging] = useState(false);\n  const [position, setPosition] = useState({ x: 0, y: 0 });\n  const bubbleRef = useRef<HTMLDivElement>(null);\n  const dragStartPos = useRef({ x: 0, y: 0 });\n  const dragOffset = useRef({ x: 0, y: 0 });\n\n  // Fetch unread count (use separate endpoint that doesn't reset count)\n  // WebSocket updates handled by global WebSocketProvider\n  const { data: chatData } = useQuery<SupportChatUnreadCount>({\n    queryKey: [\"/api/support-chat/unread-count\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/support-chat/unread-count\", {\n        credentials: \"include\",\n      });\n      if (!res.ok) throw new Error(\"Failed to fetch unread count\");\n      return res.json();\n    },\n    refetchInterval: 60000, // Fallback polling every 60 seconds (WebSocket is primary)\n  });\n\n  // Initialize position to right edge\n  useEffect(() => {\n    const savedPosition = localStorage.getItem(\"chatBubblePosition\");\n    if (savedPosition) {\n      setPosition(JSON.parse(savedPosition));\n    } else {\n      // Default to right edge, vertically centered\n      const defaultX = window.innerWidth - 80; // 80px from right\n      const defaultY = window.innerHeight / 2 - 32; // Centered vertically\n      setPosition({ x: defaultX, y: defaultY });\n    }\n  }, []);\n\n  // Save position to localStorage whenever it changes\n  useEffect(() => {\n    localStorage.setItem(\"chatBubblePosition\", JSON.stringify(position));\n  }, [position]);\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if ((e.target as HTMLElement).closest('button')) {\n      return; // Don't start drag if clicking the X button\n    }\n    \n    setIsDragging(true);\n    dragStartPos.current = { x: e.clientX, y: e.clientY };\n    dragOffset.current = {\n      x: e.clientX - position.x,\n      y: e.clientY - position.y,\n    };\n  };\n\n  const handleTouchStart = (e: React.TouchEvent) => {\n    if ((e.target as HTMLElement).closest('button')) {\n      return; // Don't start drag if touching the X button\n    }\n    \n    const touch = e.touches[0];\n    setIsDragging(true);\n    dragStartPos.current = { x: touch.clientX, y: touch.clientY };\n    dragOffset.current = {\n      x: touch.clientX - position.x,\n      y: touch.clientY - position.y,\n    };\n  };\n\n  const handleMouseMove = (e: MouseEvent) => {\n    if (!isDragging) return;\n\n    const newX = e.clientX - dragOffset.current.x;\n    const newY = e.clientY - dragOffset.current.y;\n    \n    // Constrain to viewport bounds\n    const maxX = window.innerWidth - 64; // 64px bubble width\n    const maxY = window.innerHeight - 64; // 64px bubble height\n    \n    setPosition({\n      x: Math.max(0, Math.min(newX, maxX)),\n      y: Math.max(0, Math.min(newY, maxY)),\n    });\n  };\n\n  const handleTouchMove = (e: TouchEvent) => {\n    if (!isDragging) return;\n\n    const touch = e.touches[0];\n    const newX = touch.clientX - dragOffset.current.x;\n    const newY = touch.clientY - dragOffset.current.y;\n    \n    // Constrain to viewport bounds\n    const maxX = window.innerWidth - 64;\n    const maxY = window.innerHeight - 64;\n    \n    setPosition({\n      x: Math.max(0, Math.min(newX, maxX)),\n      y: Math.max(0, Math.min(newY, maxY)),\n    });\n  };\n\n  const snapToEdge = () => {\n    const centerX = position.x + 32; // Center of bubble\n    const centerY = position.y + 32;\n    \n    const margin = 16; // Distance from edge\n    \n    // Calculate distances to each edge\n    const distToLeft = centerX;\n    const distToRight = window.innerWidth - centerX;\n    const distToTop = centerY;\n    const distToBottom = window.innerHeight - centerY;\n    \n    // Find the closest edge\n    const minDist = Math.min(distToLeft, distToRight, distToTop, distToBottom);\n    \n    let snapX, snapY;\n    \n    if (minDist === distToLeft) {\n      // Snap to left edge\n      snapX = margin;\n      snapY = position.y; // Keep current Y position\n    } else if (minDist === distToRight) {\n      // Snap to right edge\n      snapX = window.innerWidth - 64 - margin;\n      snapY = position.y; // Keep current Y position\n    } else if (minDist === distToTop) {\n      // Snap to top edge\n      snapX = position.x; // Keep current X position\n      snapY = margin;\n    } else {\n      // Snap to bottom edge\n      snapX = position.x; // Keep current X position\n      snapY = window.innerHeight - 64 - margin;\n    }\n    \n    // Ensure the bubble stays within bounds on the other axis\n    if (minDist === distToLeft || minDist === distToRight) {\n      // Snapping to left or right - constrain Y\n      const maxY = window.innerHeight - 64 - margin;\n      snapY = Math.max(margin, Math.min(snapY, maxY));\n    } else {\n      // Snapping to top or bottom - constrain X\n      const maxX = window.innerWidth - 64 - margin;\n      snapX = Math.max(margin, Math.min(snapX, maxX));\n    }\n    \n    setPosition({ x: snapX, y: snapY });\n  };\n\n  const handleMouseUp = () => {\n    if (isDragging) {\n      snapToEdge();\n      setIsDragging(false);\n    }\n  };\n\n  const handleClick = (e: React.MouseEvent) => {\n    if ((e.target as HTMLElement).closest('button')) {\n      return; // Don't navigate if clicking the X button\n    }\n    \n    // Check if this was a drag or a click\n    const dragDistance = Math.sqrt(\n      Math.pow(dragStartPos.current.x - e.clientX, 2) +\n      Math.pow(dragStartPos.current.y - e.clientY, 2)\n    );\n    \n    // If moved less than 5px, consider it a click\n    if (dragDistance < 5) {\n      setLocation(\"/support-chat\");\n    }\n  };\n\n  useEffect(() => {\n    if (isDragging) {\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n      document.addEventListener(\"touchmove\", handleTouchMove);\n      document.addEventListener(\"touchend\", handleMouseUp);\n      \n      return () => {\n        document.removeEventListener(\"mousemove\", handleMouseMove);\n        document.removeEventListener(\"mouseup\", handleMouseUp);\n        document.removeEventListener(\"touchmove\", handleTouchMove);\n        document.removeEventListener(\"touchend\", handleMouseUp);\n      };\n    }\n  }, [isDragging, position]);\n\n  // Only show when there are unread messages\n  const unreadCount = chatData?.unreadCount || 0;\n  if (unreadCount === 0) return null;\n\n  return (\n    <div\n      ref={bubbleRef}\n      className=\"fixed z-50 cursor-grab active:cursor-grabbing\"\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n        touchAction: \"none\",\n      }}\n      onMouseDown={handleMouseDown}\n      onTouchStart={handleTouchStart}\n      onClick={handleClick}\n      data-testid=\"chat-bubble\"\n    >\n      <div className=\"relative\">\n        {/* Main Chat Bubble - Messenger Style */}\n        <div className=\"h-16 w-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg flex items-center justify-center hover-elevate active-elevate-2 transition-transform duration-200\">\n          <FaFacebookMessenger className=\"h-8 w-8 text-white\" />\n        </div>\n        \n        {/* Unread Badge */}\n        <Badge \n          variant=\"destructive\" \n          className=\"absolute -top-1 -right-1 h-6 w-6 rounded-full p-0 flex items-center justify-center text-xs font-bold\"\n          data-testid=\"chat-bubble-unread-badge\"\n        >\n          {unreadCount > 9 ? \"9+\" : unreadCount}\n        </Badge>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7690},"client/src/components/default-avatar.tsx":{"content":"import { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\n\ninterface DefaultAvatarProps {\n  profilePhoto?: string | null;\n  firstName?: string;\n  lastName?: string;\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n  className?: string;\n}\n\nexport function DefaultAvatar({ \n  profilePhoto, \n  firstName = \"\", \n  lastName = \"\", \n  size = \"md\",\n  className = \"\" \n}: DefaultAvatarProps) {\n  // Get initials from first name and last name\n  const initials = `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase() || \"?\";\n  \n  // Generate a consistent color based on the name\n  const getColorFromName = (name: string) => {\n    let hash = 0;\n    for (let i = 0; i < name.length; i++) {\n      hash = name.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    \n    // Facebook-style colors (softer palette)\n    const colors = [\n      \"hsl(210, 100%, 56%)\", // Blue\n      \"hsl(150, 100%, 40%)\", // Green\n      \"hsl(280, 100%, 50%)\", // Purple\n      \"hsl(30, 100%, 50%)\",  // Orange\n      \"hsl(340, 100%, 50%)\", // Pink\n      \"hsl(190, 100%, 45%)\", // Teal\n    ];\n    \n    return colors[Math.abs(hash) % colors.length];\n  };\n\n  const backgroundColor = getColorFromName(firstName + lastName);\n  \n  // Size classes\n  const sizeClasses = {\n    sm: \"h-8 w-8 text-xs\",\n    md: \"h-10 w-10 text-sm\",\n    lg: \"h-12 w-12 text-base\",\n    xl: \"h-16 w-16 text-lg\",\n  };\n\n  return (\n    <Avatar className={`${sizeClasses[size]} ${className}`} data-testid=\"avatar-default\">\n      {profilePhoto && (\n        <AvatarImage \n          src={profilePhoto} \n          alt={`${firstName} ${lastName}`}\n          data-testid=\"avatar-image\"\n        />\n      )}\n      <AvatarFallback \n        style={{ backgroundColor }}\n        className=\"text-white font-semibold\"\n        data-testid=\"avatar-fallback\"\n      >\n        {initials}\n      </AvatarFallback>\n    </Avatar>\n  );\n}\n","size_bytes":1844},"client/src/pages/settings-currency.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, Check } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Input } from \"@/components/ui/input\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { safeStorage } from \"@/lib/safe-storage\";\n\nexport default function SettingsCurrency() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t } = useTranslation('common');\n  \n  const [selectedCurrency, setSelectedCurrency] = useState(() => \n    safeStorage.getItem(\"fiatCurrency\") || \"USD\"\n  );\n  const [currencySearch, setCurrencySearch] = useState(\"\");\n\n  // Mutation to save fiat currency preference to database\n  const saveCurrencyMutation = useMutation({\n    mutationFn: async (data: { currency: string; previousCurrency: string }) => {\n      return apiRequest('PATCH', '/api/user/fiat-currency', { fiatCurrency: data.currency });\n    },\n    onSuccess: (_, variables) => {\n      toast({\n        title: t('settings.currencyUpdated'),\n        description: t('settings.currencyDescription', { currency: variables.currency }),\n      });\n      \n      setTimeout(() => {\n        setLocation(\"/settings\");\n      }, 500);\n    },\n    onError: (error, variables) => {\n      console.error('Failed to save currency preference:', error);\n      \n      // Rollback currency change on failure\n      setSelectedCurrency(variables.previousCurrency);\n      safeStorage.setItem(\"fiatCurrency\", variables.previousCurrency);\n      \n      toast({\n        title: \"Error\",\n        description: \"Failed to save currency preference. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCurrencyChange = async (currency: string) => {\n    // Save previous currency for potential rollback\n    const previousCurrency = selectedCurrency;\n    \n    // Update UI immediately\n    setSelectedCurrency(currency);\n    safeStorage.setItem(\"fiatCurrency\", currency);\n    \n    // Save preference to database (will show toast on success/error)\n    try {\n      await saveCurrencyMutation.mutateAsync({ currency, previousCurrency });\n    } catch (error) {\n      // Error handling is in mutation's onError\n    }\n  };\n\n  const currencies = [\n    { code: \"USD\", symbol: \"$\", color: \"bg-orange-500\" },\n    { code: \"AED\", symbol: \".\", color: \"bg-emerald-500\" },\n    { code: \"ALL\", symbol: \"L\", color: \"bg-red-500\" },\n    { code: \"AMD\", symbol: \"\", color: \"bg-orange-500\" },\n    { code: \"ANG\", symbol: \"\", color: \"bg-blue-600\" },\n    { code: \"ARS\", symbol: \"AR$\", color: \"bg-blue-400\" },\n    { code: \"AUD\", symbol: \"$\", color: \"bg-blue-600\" },\n    { code: \"AZN\", symbol: \"\", color: \"bg-red-500\" },\n    { code: \"BAM\", symbol: \"KM\", color: \"bg-blue-600\" },\n    { code: \"BBD\", symbol: \"Bds$\", color: \"bg-blue-600\" },\n    { code: \"EUR\", symbol: \"\", color: \"bg-blue-600\" },\n    { code: \"GBP\", symbol: \"\", color: \"bg-blue-600\" },\n    { code: \"JPY\", symbol: \"\", color: \"bg-red-500\" },\n    { code: \"CNY\", symbol: \"\", color: \"bg-red-500\" },\n    { code: \"INR\", symbol: \"\", color: \"bg-orange-500\" },\n    { code: \"KRW\", symbol: \"\", color: \"bg-blue-600\" },\n    { code: \"RUB\", symbol: \"\", color: \"bg-blue-600\" },\n    { code: \"BRL\", symbol: \"R$\", color: \"bg-emerald-500\" },\n    { code: \"CAD\", symbol: \"C$\", color: \"bg-red-500\" },\n    { code: \"CHF\", symbol: \"Fr\", color: \"bg-red-500\" },\n    { code: \"MXN\", symbol: \"Mex$\", color: \"bg-emerald-500\" },\n    { code: \"SGD\", symbol: \"S$\", color: \"bg-red-500\" },\n    { code: \"NZD\", symbol: \"NZ$\", color: \"bg-blue-600\" },\n    { code: \"ZAR\", symbol: \"R\", color: \"bg-emerald-500\" },\n    { code: \"THB\", symbol: \"\", color: \"bg-blue-600\" },\n    { code: \"TRY\", symbol: \"\", color: \"bg-red-500\" },\n    { code: \"SAR\", symbol: \"\", color: \"bg-emerald-500\" },\n  ];\n\n  const filteredCurrencies = currencies.filter(c => \n    c.code.toLowerCase().includes(currencySearch.toLowerCase())\n  );\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/settings\")}\n              data-testid=\"button-back\"\n              className=\"mr-2\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold flex-1 text-center mr-10\">{t('settings.fiatCurrency')}</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl\">\n        <Input\n          placeholder={t('common.search')}\n          value={currencySearch}\n          onChange={(e) => setCurrencySearch(e.target.value)}\n          className=\"mb-4\"\n          data-testid=\"input-currency-search\"\n        />\n        \n        <div className=\"space-y-2\">\n          {filteredCurrencies.map((currency) => (\n            <button\n              key={currency.code}\n              onClick={() => handleCurrencyChange(currency.code)}\n              className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-lg bg-card\"\n              data-testid={`currency-${currency.code}`}\n            >\n              <div className=\"flex items-center gap-3\">\n                <div className={`w-10 h-10 ${currency.color} rounded-full flex items-center justify-center text-white font-semibold`}>\n                  {currency.symbol}\n                </div>\n                <span className=\"text-foreground\">{currency.code}</span>\n              </div>\n              {selectedCurrency === currency.code && <Check className=\"h-5 w-5 text-primary\" />}\n            </button>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6047},"client/src/pages/settings-language.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { ArrowLeft, Check } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTranslation } from \"react-i18next\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { languageCodeToName, languageNameToCode } from \"@/i18n\";\nimport { safeStorage } from \"@/lib/safe-storage\";\n\nexport default function SettingsLanguage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation('common');\n  \n  // Get current language from i18n and convert to display name\n  const currentLanguageCode = i18n.language || 'en';\n  const selectedLanguage = languageCodeToName[currentLanguageCode] || \"English\";\n\n  // Mutation to save language preference to database\n  const saveLanguageMutation = useMutation({\n    mutationFn: async (data: { langCode: string; languageDisplayName: string; previousLang: string }) => {\n      return apiRequest('PATCH', '/api/user/language', { language: data.langCode });\n    },\n    onSuccess: (_, variables) => {\n      toast({\n        title: t('settings.languageUpdated'),\n        description: t('settings.languageDescription', { language: variables.languageDisplayName }),\n      });\n      \n      setTimeout(() => {\n        setLocation(\"/settings\");\n      }, 500);\n    },\n    onError: (error, variables) => {\n      console.error('Failed to save language preference:', error);\n      \n      // Rollback language change on failure\n      i18n.changeLanguage(variables.previousLang);\n      safeStorage.setItem(\"language\", variables.previousLang);\n      \n      toast({\n        title: \"Error\",\n        description: \"Failed to save language preference. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleLanguageChange = async (languageDisplayName: string) => {\n    // Convert display name to language code\n    const langCode = languageNameToCode[languageDisplayName];\n    if (langCode) {\n      // Save previous language for potential rollback\n      const previousLang = i18n.language;\n      \n      // Change i18n language (this updates UI immediately)\n      i18n.changeLanguage(langCode);\n      \n      // Save to localStorage for fallback\n      safeStorage.setItem(\"language\", langCode);\n      \n      // Save preference to database (will show toast on success/error)\n      try {\n        await saveLanguageMutation.mutateAsync({ langCode, languageDisplayName, previousLang });\n      } catch (error) {\n        // Error handling is in mutation's onError\n      }\n    }\n  };\n\n  // Only show languages with proper translations\n  const languages = [\n    \"English\",\n    \"Deutsch\",     // German\n    \"Espaol\",     // Spanish\n    \"Franais\",    // French\n    \"\",       // Japanese\n    \"Portugus\",   // Portuguese\n    \"\"      // Russian\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background pb-20\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-3 sm:px-4 py-3 sm:py-4\">\n          <div className=\"flex items-center\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/settings\")}\n              data-testid=\"button-back\"\n              className=\"mr-2\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold flex-1 text-center mr-10\">{t('settings.language')}</h1>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-3 sm:px-4 py-4 max-w-2xl\">\n        <div className=\"space-y-2\">\n          {languages.map((language) => (\n            <button\n              key={language}\n              onClick={() => handleLanguageChange(language)}\n              className=\"w-full flex items-center justify-between p-4 hover-elevate active-elevate-2 rounded-lg bg-card\"\n              data-testid={`language-${language}`}\n            >\n              <span className=\"text-foreground\">{language}</span>\n              {selectedLanguage === language && <Check className=\"h-5 w-5 text-primary\" />}\n            </button>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":4335},"client/src/components/numeric-keyboard.tsx":{"content":"import { Delete } from \"lucide-react\";\n\ninterface NumericKeyboardProps {\n  pin: string[];\n  onNumberClick: (num: string) => void;\n  onDelete: () => void;\n  pinLength?: number;\n  title?: string;\n  showForgotPassword?: boolean;\n  onForgotPassword?: () => void;\n}\n\nexport function NumericKeyboard({\n  pin,\n  onNumberClick,\n  onDelete,\n  pinLength = 6,\n  title = \"Enter PIN\",\n  showForgotPassword = false,\n  onForgotPassword,\n}: NumericKeyboardProps) {\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <main className=\"flex-1 flex flex-col items-center justify-between p-4 pb-8\">\n        <div className=\"flex-1 flex flex-col items-center justify-center w-full max-w-md\">\n          <h2 className=\"text-xl mb-8\" data-testid=\"text-pin-prompt\">\n            {title}\n          </h2>\n          \n          <div className=\"flex gap-3 mb-12\" data-testid=\"container-pin-inputs\">\n            {pin.map((digit, index) => (\n              <div\n                key={index}\n                data-testid={`pin-box-${index}`}\n                className={`w-12 h-16 border-2 rounded-lg flex items-center justify-center text-2xl ${\n                  digit ? \"border-primary\" : \"border-muted-foreground/30\"\n                }`}\n              >\n                {digit && <span className=\"text-2xl\"></span>}\n              </div>\n            ))}\n          </div>\n\n          {showForgotPassword && (\n            <button\n              data-testid=\"button-forgot-password\"\n              onClick={onForgotPassword}\n              className=\"text-primary hover-elevate active-elevate-2 px-4 py-2 rounded-md\"\n            >\n              Forgot Password\n            </button>\n          )}\n        </div>\n\n        <div className=\"w-full max-w-md\">\n          <div className=\"grid grid-cols-3 gap-3\">\n            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (\n              <button\n                key={num}\n                data-testid={`button-num-${num}`}\n                onClick={() => onNumberClick(num.toString())}\n                className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n              >\n                {num}\n              </button>\n            ))}\n            <div className=\"h-16\"></div>\n            <button\n              data-testid=\"button-num-0\"\n              onClick={() => onNumberClick(\"0\")}\n              className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 text-xl font-medium\"\n            >\n              0\n            </button>\n            <button\n              data-testid=\"button-delete\"\n              onClick={onDelete}\n              className=\"h-16 rounded-lg bg-muted hover-elevate active-elevate-2 flex items-center justify-center\"\n            >\n              <Delete className=\"w-6 h-6\" />\n            </button>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":2849},"client/src/locales/restore-translations.js":{"content":"const fs = require('fs');\n\n// Language-specific translations (only for existing keys, new keys will be in English)\nconst translations = {\n  de: {\n    settings: {\n      title: \"Einstellungen\",\n      security: \"Sicherheit\",\n      clearCache: \"Cache leeren\",\n      cacheCleared: \"Cache geleert\",\n      cacheDescription: \"App-Cache wurde erfolgreich geleert.\",\n      appearance: \"Aussehen\",\n      darkMode: \"Dunkler Modus\",\n      lightMode: \"Heller Modus\",\n      transactionCost: \"Transaktionskosten\",\n      transactionCostUpdated: \"Transaktionskosten aktualisiert\",\n      transactionCostDescription: \"Gebhrenprferenz auf {{cost}} festgelegt\",\n      transactionCostInfo: \"Eine hhere Gebhr kann den Prozess beschleunigen.\",\n      low: \"Niedrig\",\n      middle: \"Mittel\",\n      high: \"Hoch\",\n      fiatCurrency: \"Fiat-Whrung\",\n      currencyUpdated: \"Whrung aktualisiert\",\n      currencyDescription: \"Fiat-Whrung auf {{currency}} gendert\",\n      language: \"Sprache\",\n      languageUpdated: \"Sprache aktualisiert\",\n      languageDescription: \"Sprache auf {{language}} gendert\",\n      helpCenter: \"Hilfezentrum\",\n      support: \"Untersttzung\",\n      about: \"ber\",\n      logOut: \"Ausloggen\",\n      loggedOut: \"Ausgeloggt\",\n      loggedOutDescription: \"Sie wurden aus Ihrer Wallet ausgeloggt.\"\n    },\n    dashboard: {\n      title: \"Dashboard\",\n      portfolio: \"Portfolio\",\n      totalBalance: \"Gesamtguthaben\",\n      balance: \"Guthaben\",\n      tokens: \"Token\",\n      send: \"Senden\",\n      receive: \"Empfangen\",\n      swap: \"Tauschen\",\n      buy: \"Kaufen\",\n      search: \"Suchen\",\n      all: \"Alle\",\n      allNetworks: \"Alle Netzwerke\",\n      updating: \"Aktualisierung...\",\n      pullToRefresh: \"Zum Aktualisieren ziehen\",\n      releaseToRefresh: \"Loslassen zum Aktualisieren\",\n      transactionHistory: \"Transaktionsverlauf\",\n      sell: \"Verkaufen\"\n    },\n    common: {\n      back: \"Zurck\",\n      cancel: \"Abbrechen\",\n      confirm: \"Besttigen\",\n      save: \"Speichern\",\n      search: \"Suchen\",\n      loading: \"Laden...\",\n      error: \"Fehler\",\n      success: \"Erfolg\",\n      send: \"Senden\",\n      receive: \"Empfangen\",\n      swap: \"Tauschen\",\n      buy: \"Kaufen\",\n      sell: \"Verkaufen\"\n    },\n    bottomNav: {\n      wallet: \"Wallet\",\n      market: \"Markt\",\n      swap: \"Tauschen\",\n      profile: \"Profil\"\n    }\n  }\n};\n\n// Read the English file to get the complete structure with new keys\nconst enFile = JSON.parse(fs.readFileSync('en/common.json', 'utf8'));\n\n// Restore German file with original translations + new English keys\nconst deFile = {\n  ...enFile,\n  settings: { ...enFile.settings, ...translations.de.settings },\n  dashboard: { ...enFile.dashboard, ...translations.de.dashboard },\n  common: { ...enFile.common, ...translations.de.common },\n  bottomNav: { ...enFile.bottomNav, ...translations.de.bottomNav }\n};\n\nfs.writeFileSync('de/common.json', JSON.stringify(deFile, null, 2) + '\\n');\nconsole.log('Restored German translations');\n","size_bytes":2962},"client/src/locales/generate-locales.js":{"content":"const fs = require('fs');\nconst path = require('path');\n\n// Read the English template\nconst enTemplate = JSON.parse(fs.readFileSync(path.join(__dirname, 'en/common.json'), 'utf8'));\n\n// Language configurations with proper native names\nconst languages = {\n  // Existing languages (11)\n  \"en\": \"English\",\n  \"de\": \"Deutsch\",\n  \"es\": \"Espaol\",\n  \"fr\": \"Franais\",\n  \"it\": \"Italiano\",\n  \"ja\": \"\",\n  \"ko\": \"\",\n  \"pt\": \"Portugus\",\n  \"ru\": \"\",\n  \"th\": \"\",\n  \"tr\": \"Trke\",\n  \n  // Major world languages (continuing to 100)\n  \"zh\": \"\",        // Chinese\n  \"ar\": \"\",    // Arabic\n  \"hi\": \"\",     // Hindi\n  \"id\": \"Bahasa Indonesia\", // Indonesian\n  \"nl\": \"Nederlands\",  // Dutch\n  \"pl\": \"Polski\",      // Polish\n  \"sv\": \"Svenska\",     // Swedish\n  \"vi\": \"Ting Vit\",  // Vietnamese\n  \"uk\": \"\",  // Ukrainian\n  \"cs\": \"etina\",     // Czech\n  \"da\": \"Dansk\",       // Danish\n  \"fi\": \"Suomi\",       // Finnish\n  \"el\": \"\",    // Greek\n  \"he\": \"\",       // Hebrew\n  \"hu\": \"Magyar\",      // Hungarian\n  \"no\": \"Norsk\",       // Norwegian\n  \"ro\": \"Romn\",      // Romanian\n  \"sk\": \"Slovenina\",  // Slovak\n  \"bg\": \"\",   // Bulgarian\n  \"hr\": \"Hrvatski\",    // Croatian\n  \"lt\": \"Lietuvi\",    // Lithuanian\n  \"lv\": \"Latvieu\",    // Latvian\n  \"sl\": \"Slovenina\", // Slovenian\n  \"sr\": \"\",      // Serbian\n  \"et\": \"Eesti\",       // Estonian\n  \"is\": \"slenska\",    // Icelandic\n  \"mk\": \"\",  // Macedonian\n  \"sq\": \"Shqip\",       // Albanian\n  \"bs\": \"Bosanski\",    // Bosnian\n  \"ca\": \"Catal\",      // Catalan\n  \"eu\": \"Euskara\",     // Basque\n  \"gl\": \"Galego\",      // Galician\n  \"cy\": \"Cymraeg\",     // Welsh\n  \"mt\": \"Malti\",       // Maltese\n  \"ga\": \"Gaeilge\",     // Irish\n  \"af\": \"Afrikaans\",   // Afrikaans\n  \"sw\": \"Kiswahili\",   // Swahili\n  \"am\": \"\",       // Amharic\n  \"bn\": \"\",       // Bengali\n  \"gu\": \"\",     // Gujarati\n  \"kn\": \"\",       // Kannada\n  \"ml\": \"\",      // Malayalam\n  \"mr\": \"\",       // Marathi\n  \"ne\": \"\",      // Nepali\n  \"or\": \"\",       // Odia\n  \"pa\": \"\",      // Punjabi\n  \"si\": \"\",       // Sinhala\n  \"ta\": \"\",       // Tamil\n  \"te\": \"\",      // Telugu\n  \"ur\": \"\",        // Urdu\n  \"fa\": \"\",       // Persian\n  \"ps\": \"\",        // Pashto\n  \"ku\": \"Kurd\",       // Kurdish\n  \"my\": \"\",      // Burmese\n  \"km\": \"\",       // Khmer\n  \"lo\": \"\",         // Lao\n  \"ms\": \"Bahasa Melayu\", // Malay\n  \"tl\": \"Tagalog\",     // Tagalog\n  \"jv\": \"Basa Jawa\",   // Javanese\n  \"az\": \"Azrbaycan\",  // Azerbaijani\n  \"kk\": \"\",       // Kazakh\n  \"uz\": \"O'zbek\",      // Uzbek\n  \"hy\": \"\",     // Armenian\n  \"ka\": \"\",     // Georgian\n  \"mn\": \"\",      // Mongolian\n  \"be\": \"\",  // Belarusian\n  \"lb\": \"Ltzebuergesch\", // Luxembourgish\n  \"fo\": \"Froyskt\",    // Faroese\n  \"fy\": \"Frysk\",       // Frisian\n  \"gd\": \"Gidhlig\",    // Scottish Gaelic\n  \"kl\": \"Kalaallisut\", // Greenlandic\n  \"mg\": \"Malagasy\",    // Malagasy\n  \"mi\": \"Mori\",       // Maori\n  \"mn\": \"\",      // Mongolian\n  \"ne\": \"\",      // Nepali\n  \"ny\": \"Chichewa\",    // Chichewa\n  \"sm\": \"Gagana Samoa\", // Samoan\n  \"sn\": \"Shona\",       // Shona\n  \"so\": \"Soomaali\",    // Somali\n  \"st\": \"Sesotho\",     // Southern Sotho\n  \"su\": \"Basa Sunda\",  // Sundanese\n  \"tg\": \"\",      // Tajik\n  \"tk\": \"Trkmen\",     // Turkmen\n  \"tt\": \"\",       // Tatar\n  \"ug\": \"\",      // Uyghur\n  \"yi\": \"\",      // Yiddish\n  \"yo\": \"Yorb\",      // Yoruba\n  \"zu\": \"isiZulu\"      // Zulu\n};\n\n// Create locale file for each language\nObject.keys(languages).forEach(langCode => {\n  const localeDir = path.join(__dirname, langCode);\n  \n  // Create directory if it doesn't exist\n  if (!fs.existsSync(localeDir)) {\n    fs.mkdirSync(localeDir, { recursive: true });\n  }\n  \n  const filePath = path.join(localeDir, 'common.json');\n  \n  // Only create if doesn't exist\n  if (!fs.existsSync(filePath)) {\n    fs.writeFileSync(filePath, JSON.stringify(enTemplate, null, 2) + '\\n', 'utf8');\n    console.log(`Created: ${langCode}/common.json`);\n  } else {\n    console.log(`Skipped: ${langCode}/common.json (already exists)`);\n  }\n});\n\nconsole.log('\\n Locale files generated successfully!');\nconsole.log(`Total languages: ${Object.keys(languages).length}`);\n","size_bytes":4689},"client/src/pages/add-custom-token.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ArrowLeft, ChevronRight, ScanLine, X } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\nexport default function AddCustomToken() {\n  const [, setLocation] = useLocation();\n  const [selectedNetwork, setSelectedNetwork] = useState<string>(\"\");\n  const [contractAddress, setContractAddress] = useState(\"\");\n  const [showNetworkSheet, setShowNetworkSheet] = useState(false);\n  const [showErrorAlert, setShowErrorAlert] = useState(false);\n  const [networkSearch, setNetworkSearch] = useState(\"\");\n  \n  // Show error popup automatically when contract address is entered\n  useEffect(() => {\n    if (selectedNetwork && contractAddress.length > 10) {\n      setShowErrorAlert(true);\n    }\n  }, [contractAddress, selectedNetwork]);\n\n  // Fetch available chains\n  const { data: chainsData } = useQuery({\n    queryKey: [\"/api/chains\"],\n  });\n\n  const chains = (chainsData as any) || [];\n\n  // Filter networks based on search\n  const filteredNetworks = chains.filter((chain: any) =>\n    chain.name.toLowerCase().includes(networkSearch.toLowerCase())\n  );\n\n  // Group networks - Hot networks first\n  const hotNetworks = [\"ethereum\", \"bnb\", \"tron\", \"solana\"];\n  const hotChains = filteredNetworks.filter((chain: any) =>\n    hotNetworks.includes(chain.id)\n  );\n  const otherChains = filteredNetworks.filter((chain: any) =>\n    !hotNetworks.includes(chain.id)\n  );\n\n  const selectedChain = chains.find((c: any) => c.id === selectedNetwork);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-3\">\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setLocation(\"/manage-coins\")}\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n            <h1 className=\"text-lg font-semibold\">Add Custom Token</h1>\n            <div className=\"w-10\" />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"container mx-auto px-4 py-6 max-w-2xl\">\n        {/* Network Selection */}\n        <div className=\"mb-6\">\n          <label className=\"text-sm font-medium mb-2 block\">Network</label>\n          <Button\n            variant=\"outline\"\n            className=\"w-full justify-between h-12 px-4\"\n            onClick={() => setShowNetworkSheet(true)}\n            data-testid=\"button-select-network\"\n          >\n            <span className={!selectedNetwork ? \"text-muted-foreground\" : \"\"}>\n              {selectedNetwork ? selectedChain?.name : \"Select Network\"}\n            </span>\n            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n          </Button>\n        </div>\n\n        {/* Contract Address */}\n        <div className=\"mb-6\">\n          <label className=\"text-sm font-medium mb-2 block\">Contract Address</label>\n          <div className=\"relative\">\n            <Input\n              placeholder=\"Enter the contract address\"\n              value={contractAddress}\n              onChange={(e) => setContractAddress(e.target.value)}\n              className=\"pr-12 h-12\"\n              data-testid=\"input-contract-address\"\n            />\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"absolute right-2 top-1/2 -translate-y-1/2\"\n              data-testid=\"button-scan-qr\"\n            >\n              <ScanLine className=\"h-5 w-5 text-muted-foreground\" />\n            </Button>\n          </div>\n          {contractAddress && selectedNetwork && (\n            <p className=\"text-sm text-destructive mt-2\">\n              Token information not found\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Network Selection Sheet */}\n      <Sheet open={showNetworkSheet} onOpenChange={setShowNetworkSheet}>\n        <SheetContent side=\"bottom\" className=\"h-[90vh] p-0\">\n          <div className=\"flex flex-col h-full\">\n            <SheetHeader className=\"px-4 pt-4 pb-3 border-b\">\n              <div className=\"flex items-center justify-center relative\">\n                <SheetTitle>Select Network</SheetTitle>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => setShowNetworkSheet(false)}\n                  data-testid=\"button-close-sheet\"\n                  className=\"absolute right-0\"\n                >\n                  <X className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </SheetHeader>\n\n            {/* Search */}\n            <div className=\"px-4 py-3 border-b\">\n              <Input\n                placeholder=\"Search\"\n                value={networkSearch}\n                onChange={(e) => setNetworkSearch(e.target.value)}\n                className=\"h-11\"\n                data-testid=\"input-search-network\"\n              />\n            </div>\n\n            {/* Network List */}\n            <div className=\"flex-1 overflow-y-auto\">\n              {/* Hot Networks */}\n              {hotChains.length > 0 && (\n                <div>\n                  <div className=\"px-4 py-2 text-sm text-muted-foreground\">Hot</div>\n                  {hotChains.map((chain: any) => (\n                    <button\n                      key={chain.id}\n                      onClick={() => {\n                        setSelectedNetwork(chain.id);\n                        setShowNetworkSheet(false);\n                      }}\n                      className=\"w-full px-4 py-3 flex items-center gap-3 hover-elevate active-elevate-2\"\n                      data-testid={`button-network-${chain.id}`}\n                    >\n                      {chain.icon && (\n                        <img\n                          src={chain.icon}\n                          alt={chain.name}\n                          className=\"w-10 h-10 rounded-full\"\n                        />\n                      )}\n                      <span className=\"font-medium\">{chain.name}</span>\n                    </button>\n                  ))}\n                </div>\n              )}\n\n              {/* Other Networks */}\n              {otherChains.length > 0 && (\n                <div>\n                  {hotChains.length > 0 && (\n                    <div className=\"px-4 py-2 text-sm text-muted-foreground border-t mt-2\">\n                      A\n                    </div>\n                  )}\n                  {otherChains.map((chain: any) => (\n                    <button\n                      key={chain.id}\n                      onClick={() => {\n                        setSelectedNetwork(chain.id);\n                        setShowNetworkSheet(false);\n                      }}\n                      className=\"w-full px-4 py-3 flex items-center gap-3 hover-elevate active-elevate-2\"\n                      data-testid={`button-network-${chain.id}`}\n                    >\n                      {chain.icon && (\n                        <img\n                          src={chain.icon}\n                          alt={chain.name}\n                          className=\"w-10 h-10 rounded-full\"\n                        />\n                      )}\n                      <span className=\"font-medium\">{chain.name}</span>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </SheetContent>\n      </Sheet>\n\n      {/* Error Alert Dialog */}\n      <AlertDialog open={showErrorAlert} onOpenChange={setShowErrorAlert}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"text-center\">\n              Failed to retrieve token information.\n            </AlertDialogTitle>\n            <AlertDialogDescription className=\"text-center\">\n              (code=205)\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter className=\"sm:justify-center\">\n            <AlertDialogAction\n              onClick={() => setShowErrorAlert(false)}\n              className=\"w-full sm:w-auto\"\n              data-testid=\"button-ok\"\n            >\n              OK\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","size_bytes":8797},"shared/update-icons.js":{"content":"const fs = require('fs');\n\n// Function to update icon URLs in a file\nfunction updateIcons(filename) {\n  let content = fs.readFileSync(filename, 'utf8');\n  \n  // Replace all CoinGecko icon URLs with CoinCap CDN\n  // Pattern: https://assets.coingecko.com/coins/images/*/large/*.* or *.jpg\n  content = content.replace(\n    /icon:\\s*\"https:\\/\\/assets\\.coingecko\\.com\\/coins\\/images\\/\\d+\\/large\\/([^\"]+)\"/g,\n    (match, filename) => {\n      // Extract the base name without extension\n      const baseName = filename.replace(/\\.(png|jpg|jpeg)$/, '').toLowerCase();\n      return `icon: \"https://assets.coincap.io/assets/icons/${baseName}@2x.png\"`;\n    }\n  );\n  \n  fs.writeFileSync(filename, content);\n  console.log(` Updated ${filename}`);\n}\n\n// Update all token files\n['ethereum-tokens.ts', 'bnb-tokens.ts', 'tron-tokens.ts', 'solana-tokens.ts'].forEach(file => {\n  updateIcons(file);\n});\n\nconsole.log('\\n All token icon URLs updated to CoinCap CDN!');\n","size_bytes":953},"client/src/utils/liquid-glass.js":{"content":"export function initLiquidGlassEffect() {\n  const liquidGlassElements = document.querySelectorAll('.liquid-glass');\n  \n  liquidGlassElements.forEach(element => {\n    const shine = element.querySelector('.liquid-glass-shine');\n    if (!shine) return;\n    \n    element.addEventListener('mousemove', (e) => {\n      const rect = element.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n      \n      const centerX = rect.width / 2;\n      const centerY = rect.height / 2;\n      \n      const deltaX = (x - centerX) / centerX;\n      const deltaY = (y - centerY) / centerY;\n      \n      const moveX = deltaX * 15;\n      const moveY = deltaY * 15;\n      \n      shine.style.transform = `translate(${moveX}px, ${moveY}px)`;\n      shine.style.opacity = '0.9';\n    });\n    \n    element.addEventListener('mouseleave', () => {\n      shine.style.transform = 'translate(0, 0)';\n      shine.style.opacity = '0.7';\n    });\n  });\n}\n\nexport function applyLiquidGlassToElement(element) {\n  if (!element) return;\n  \n  const shine = element.querySelector('.liquid-glass-shine');\n  if (!shine) return;\n  \n  element.addEventListener('mousemove', (e) => {\n    const rect = element.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    \n    const centerX = rect.width / 2;\n    const centerY = rect.height / 2;\n    \n    const deltaX = (x - centerX) / centerX;\n    const deltaY = (y - centerY) / centerY;\n    \n    const moveX = deltaX * 15;\n    const moveY = deltaY * 15;\n    \n    shine.style.transform = `translate(${moveX}px, ${moveY}px)`;\n    shine.style.opacity = '0.9';\n  });\n  \n  element.addEventListener('mouseleave', () => {\n    shine.style.transform = 'translate(0, 0)';\n    shine.style.opacity = '0.7';\n  });\n}\n","size_bytes":1791},"client/src/styles/liquid-glass.css":{"content":".liquid-glass {\n  position: relative;\n  border-radius: 16px;\n  padding: 16px;\n  background: rgba(255,255,255,0.10);\n  border: 1px solid rgba(255,255,255,0.20);\n  overflow: hidden;\n  box-shadow: 0 6px 30px rgba(0,0,0,0.35);\n}\n\n@supports (backdrop-filter: blur(1px)) {\n  .liquid-glass {\n    backdrop-filter: blur(14px) saturate(1.1);\n    -webkit-backdrop-filter: blur(14px) saturate(1.1);\n    background: rgba(255,255,255,0.06);\n  }\n}\n\n.liquid-glass-shine {\n  position: absolute;\n  top: -40%;\n  left: -40%;\n  width: 180%;\n  height: 180%;\n  background: linear-gradient(\n    130deg,\n    rgba(255,255,255,0.14) 0%,\n    rgba(255,255,255,0.05) 40%,\n    rgba(255,255,255,0.09) 60%,\n    rgba(255,255,255,0.03) 100%\n  );\n  mix-blend-mode: screen;\n  pointer-events: none;\n  transition: transform 0.3s ease, opacity 0.4s ease;\n  opacity: 0.7;\n}\n","size_bytes":833}},"version":2}